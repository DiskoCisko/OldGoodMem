!function(e){function t(t){for(var o,_,l=t[0],r=t[1],n=t[2],u=0,c=[];u<l.length;u++)_=l[u],Object.prototype.hasOwnProperty.call(s,_)&&s[_]&&c.push(s[_][0]),s[_]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);for(d&&d(t);c.length;)c.shift()();return a.push.apply(a,n||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],o=!0,l=1;l<i.length;l++){var r=i[l];0!==s[r]&&(o=!1)}o&&(a.splice(t--,1),e=_(_.s=i[0]))}return e}var o={},s={"web/audio":0},a=[];function _(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,_),i.l=!0,i.exports}_.e=function(){return Promise.resolve()},_.m=e,_.c=o,_.d=function(e,t,i){_.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},_.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},_.t=function(e,t){if(1&t&&(e=_(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(_.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)_.d(i,o,function(t){return e[t]}.bind(null,o));return i},_.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return _.d(t,"a",t),t},_.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},_.p="/js/cmodules/";var l=window.webpackJsonp=window.webpackJsonp||[],r=l.push.bind(l);l.push=t,l=l.slice();for(var n=0;n<l.length;n++)t(l[n]);var d=r;a.push([127,"audioplayer","common","56f93864a237b8c95e675dcf9d396cb3"]),i()}({"/rxS":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"currentAudioPage",(function(){return currentAudioPage})),__webpack_require__.d(__webpack_exports__,"AudioPage",(function(){return AudioPage}));var core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("Oyvg"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("rGqo"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("Btvt"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("Vd3H"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("OG14"),_lib_stats__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("XzvV"),_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("rEJs"),_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("6ng+"),_web_audio_player_stat_onAdditionalEvent__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("5xrp"),_web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("ldAL"),_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("D33C"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("jE6c"),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("59zB"),_web_legacy_ui_slider__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("gUSy"),_web_lib_feature_boxes__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("Ieup"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("zxIV"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("EasH"),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("RdBX"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("aong"),_web_grid_sorted__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("4PuL"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("v+DW"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("4+be"),_web_lib_feature_tooltips__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("MiCK"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("FWc3"),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("pp2G"),_shared_audio_enums__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("uk5P"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("t7n3"),_web_audio_catalog_CatalogController__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("qrDO"),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("W9Tc"),SLIDER_TIMEOUT=1e4,sectionsToUpdate=[];function currentAudioPage(e){var t=gpeByClass("_audio_page_layout",e);return!!t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(t,"audioPage")}function AudioPage(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(e,"audioPage",this),extend(cur.lang||{},t.langs),getAudioPlayer().langs=t.langs,this._data=t,this._ownerId=t.ownerId,this.isLayer()||(cur.audioPage=this),this.isLayer()&&uiSearch.init("audio_search_layer"),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.toggleAudioHQBodyClass(),this._els={pageContainer:e,sections:geByClass1("_audio_page_sections",e),playerWrap:geByClass1("_audio_page_player_wrap",e),player:geByClass1("_audio_page_player",e),contentBlock:geByClass1("_audio_page_content_block",e)||geByClass1("_playlist_page_content_block",e),scrollWrap:geByClass1("_audio_page_content_block_wrap",e),searchSectionAudios:geByClass1("_audio_section_search__local_audios_list",e),searchSectionAudiosHeader:geByClass1("audio_section_search__local_audios_header",e),searchSectionPlaylists:geByClass1("_audio_section_search__local_playlists_list",e),searchSectionPlaylistsHeader:geByClass1("_audio_section_search__local_playlists_header",e),searchNoLocalResults:geByClass1("_audio_local_no_results",e),searchGlobalBlocks:geByClass1("_audio_section_global_search__blocks",e),searchGlobalCommunitiesPlace:geByClass1("_audio_section_global_search__communities_place",e),searchGlobalPlaylistsPlace:geByClass1("_audio_section_global_search__playlists_place",e),searchGlobalArtistsPlace:geByClass1("_audio_section_global_search__artists_place",e),searchGlobalAudiosBlock:geByClass1("_audio_section_global_search__audios_block",e),searchGlobalAudiosBlockHeader:geByClass1("_audio_section_global_search__audios_header",e),searchGlobalAudiosList:geByClass1("_audio_section_global_search__audios_list",e),searchInput:geByClass1("ui_search_field",geByClass1("_audio_search",e)),footer:geByClass1("_audio_page__footer",e),footerNowPlayingInfo:geByClass1("_audio_page__footer_now_playing",e),footerClearNowPlayingButton:geByClass1("_audio_page__footer_clear_playlist",e)},this.isLayer()&&(this._scroll=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_14__.default(this._els.scrollWrap,{global:!0,stopScrollPropagation:!0,stopScrollPropagationAlways:!0})),this._readyAudio=this._data.readyAudio;var i=this._data.readyPlaylist;i&&(this._pagePlaylist=getAudioPlayer().getPlaylist(i.type,i.ownerId,i.id),this._pagePlaylist.mergeWith(i)),!this._readyAudio&&this._pagePlaylist&&(this._readyAudio=this._pagePlaylist.getAudioAt(0)),this._data.playlistCoverUploadOptions&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[this._ownerId]=this._data.playlistCoverUploadOptions),this.isLayer()||(cur.module=t.module||"audio",cur.oid=this._ownerId,+this._ownerId==+vk.id?cur.submodule="my":this._ownerId<0?cur.submodule="group_list":cur.submodule="user_list"),vk.id&&this._initPlayer(),this._initPlaylists(),this.initNavigation(),this.catalogController=new _web_audio_catalog_CatalogController__WEBPACK_IMPORTED_MODULE_29__.CatalogController(e),this.showSection(t.initSection);var o=new URLSearchParams(location.search);this.defaultSection=!o.get("section")&&t.initSection||"all",this._initSearchParams(),this.promoAlbumSlideInit(),this._els.searchInput&&this._els.searchInput.focus(),this.isLayer()||this.isPodcastPage()||!nav.objLoc.q||"search_playlists"===nav.objLoc.section||(this._els.searchInput&&(this._els.searchInput.value=winToUtf(nav.objLoc.q)),this._showSearchSection(nav.objLoc)),this.updateCurrentPlayingInfo(),getAudioPlayer().setStatusExportInfo(this._data.export),this.updateStatusExportControls(),this._initKeyEvents(),window.onAudioPageLoaded&&(window.onAudioPageLoaded.call(this),delete window.onAudioPageLoaded),this.updateShuffleButton()}AudioPage.address="audio",AudioPage.updateSearchHighlight=function(e){var t=geByClass1("_audio_playlist",gpeByClass("_audio_layout",this));toggleClass(t,"audio_search_focused","focus"===e.type)},AudioPage.onSearchFocused=function(e){AudioPage.updateSearchHighlight(e)},AudioPage.prototype.updatePlaylistsCounter=function(e){var t;if(cur.audioPage&&e===cur.audioPage.getOwnerId()&&(t=cur.audioPage._els.pageContainer.querySelector(".CatalogBlock__own_only_playlists_header .CatalogBlock__title"))){var i=cur.audioPage._data.playlists.length;t.innerHTML=langNumeric(i,cur.lang.audio_playlists_count_title),toggleClass(gpeByClass("_audio_page_section_layout",t),"audio_section_empty",!i)}},AudioPage.deletePlaylist=function(e,t,i){var o=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,e,t),s=AudioPlayer.getLang("audio_sure_delete_playlist_box_text");s='<div style="overflow: hidden; text-overflow: ellipsis;">'+(s=s.replace("{name}",o.getTitle()))+"</div>",Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__.showFastBox)({title:AudioPlayer.getLang("audio_sure_delete_playlist_box_title"),dark:1},s,AudioPlayer.getLang("audio_sure_delete_playlist_box_yes"),function(){if(ajax.post("al_audio.php?act=delete_playlist",{hash:i,playlist_owner_id:e,playlist_id:t,page_owner_id:cur.audioPage?cur.audioPage.getOwnerId():0},{onDone:function(e){if(cur.audioPage){var t=geByClass1("_audio_section__all",cur.audioPage.getPageContainer()),i=geByClass1("_audio_page_block__playlists_items",t);if(t&&i){var o=intval(domData(i,"max-items"));e&&i.children.length<o&&i.appendChild(se(getTemplate("audio_pl_item",e))),i.children.length||(addClass(gpeByClass("_audio_page_section_layout",i),"no_playlists"),re(gpeByClass("_audio_page_titled_block",i)))}}},onFail:()=>!0}),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide(),each(geByClass("_audio_pl_"+e+"_"+t),(function(){re(this)})),cur.audioPage){if(cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((function(i){return!(i.id==t&&i.owner_id==e)})),!cur.audioPage._data.playlists.length)return void nav.reload();cur.audioPage.updatePlaylistsCounter&&cur.audioPage.updatePlaylistsCounter(e)}}.bind(this),getLang("global_cancel"))},AudioPage.prototype.getCurrentSection=function(){return this._currentSection},AudioPage.prototype._initPlaylists=function(e){if(this._data.generic)return e&&e([]);AudioPage.loadPlaylists(this.getOwnerId(),this._data.playlistsTotal,!0,!1,function(t){this._data.playlists=this._data.playlists.concat(t),this._data.playlistsIndex=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_19__.vkIndexer(this._data.playlists,(function(e){return e.title})),e&&e()}.bind(this))},AudioPage.prototype.getOwnerPlaylists=function(){return this._data.playlists},AudioPage.loadPlaylists=function(ownerId,totalCount,skipFirstChunk,forAttachBox,onDone){var chunkSize=50,chunks=[];Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isFunction)(totalCount)&&(onDone=totalCount,totalCount=void 0,skipFirstChunk=!1),cur.playlistsCache=cur.playlistsCache||{};var cacheKey=ownerId+"_"+intval(skipFirstChunk);if(cur.playlistsCache[cacheKey])return onDone(cur.playlistsCache[cacheKey]);function onAllLoaded(){var e=[];each(chunks,(function(t,i){i&&(e=e.concat(i))})),cur.playlistsCache[cacheKey]=e,onDone&&onDone(e)}function _loadChunk(chunkIndex,_cb){var groupId=cur.group_id||(cur.oid<0?-cur.oid:0);ajax.post("al_audio.php?act=owner_playlists",{owner_id:ownerId,group_id:groupId,offset:chunkIndex*chunkSize,is_attach:forAttachBox?1:0},{onDone:function onDone(playlists,totalCount,additionalData){additionalData.templates_script&&eval(additionalData.templates_script),additionalData.langs&&extend(cur.lang,additionalData.langs),additionalData.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[ownerId]=additionalData.audio_playlist_cover_upload_options),chunks[chunkIndex]=playlists,_cb(totalCount)},onFail:function(e){if(hide(boxLoader),e)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__.showFastBox)({title:getLang("global_error")},e),!0}})}function _loadAllChunks(e,t,i){var o=Math.ceil(e/chunkSize);o&&o-t!=0?function(){for(var e=new callHub(i,o-t),s=t;s<o;s++)_loadChunk(s,(function(){e.done()}))}():i()}isUndefined(totalCount)?_loadChunk(0,(function(e){_loadAllChunks(e,1,onAllLoaded)})):_loadAllChunks(totalCount,skipFirstChunk?1:0,onAllLoaded)},AudioPage.prototype.getOwnerId=function(){return+this._ownerId},AudioPage.prototype.getPageContainer=function(){return this._els.pageContainer},AudioPage.prototype.getCurrentSectionEl=function(){return this.catalogController.currentSection&&this.catalogController.currentSection.getSectionElement()},AudioPage.prototype.canAddToGroup=function(){return this._data.canAudioAddToGroup},AudioPage.prototype.canEditGroup=function(){return this._data.canEdit},AudioPage.prototype.updateCurrentPlayingInfo=function(){if(this.isLayer()){var e=getAudioPlayer(),t=e.getCurrentPlaylist(),i=t?t.getTitle():"";if(t&&window.langConfig&&window.langConfig.id!==t.getTitleLang()&&ajax.post("al_audio.php?act=get_playlist_info",{owner_id:t.getOwnerId(),playlist_id:t.getAlbumId(),access_hash:t.getAccessHash()},{onDone:i=>{t.updatePlaylist(i)&&(e.saveStateCurrentPlaylist(),this.updateCurrentPlayingInfo())},onFail:()=>{}}),i){var o,s,a,_=t.getOriginalPlaylistRawId();if(_||t.getType()===_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST&&t.getAlbumId()>0)_?(o=(_=_.split("_"))[0],s=_[1],a=_[2]||""):(o=t.getOwnerId(),s=t.getAlbumId(),a=t.getAccessHash()||""),i=`<a href="${nav.toStr(extend({},nav.objLoc,{z:"audio_playlist"+o+"_"+s+(a?"/"+a:"")}))}"\n                  class="audio_page__footer_now_playing_link"\n                  onclick="if (checkEvent(event)) { return true } else { AudioUtils.showAudioPlaylist(${o}, ${s}, '${a}'); return cancelEvent(event) }">\n                  ${i}\n                </a>`;else if(t.getBlockId()){i=`<a href="${"/audio?section=recoms_block&type="+t.getBlockId()}"\n                  class="audio_page__footer_now_playing_link">\n                  ${i}\n                </a>`}this._els.footerNowPlayingInfo.innerHTML=getLang("audio_current_playing_from").replace("{playlist}",i)}else{var l=getAudioPlayer().getCurrentAudio();_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(l)?this._els.footerNowPlayingInfo.innerHTML=getLang("audio_current_playing_from").replace("{playlist}",getLang("audio_podcast_playing").replace("{name}",l[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER])):this._els.footerNowPlayingInfo.innerHTML=""}this._els.footerClearNowPlayingButton.innerHTML=getLang("audio_clear_current_playlist"),toggle(this._els.footer,!!t)}},AudioPage.prototype.onSearchFiltersChanged=function(e){var t=window.radioBtns["audio_search_type_"+intval(this.isLayer())],i=intval(this._searchSortFilter.selectedItems()[0][0]),o={performer:t.val?1:null,lyrics:hasClass(geByClass1("_audio_fltr_with_lyrics",this._els.pageContainer),"on")?1:null,sort:i?1:null};this.syncParametersUI(o);var s=e&&isObject(e)?e:o;this.isLayer()&&(s=extend({},this._prevLoc,s)),nav.change(s,!1,{fromSearch:!0,filtersChanged:!0})},AudioPage.prototype._initSearchParams=function(){window.radioBtns["audio_search_type_"+intval(this.isLayer())]={els:geByClass("_audio_search_type",this._els.pageContainer),keep:this.isLayer()};var e=geByClass1("_audio_fltr_sort",this._els.pageContainer);e&&(this._searchSortFilter=new Dropdown(e,this._data.sortFilters,{big:1,zeroPlaceholder:!0,onChange:this.onSearchFiltersChanged.bind(this)})),this.isLayer()||this.syncParametersUI(nav.objLoc)},AudioPage.prototype.syncParametersUI=function(e){var t="audio_search_type_"+intval(this.isLayer()),i=window.radioBtns[t];i&&radiobtn(i.els[e.performer?1:0],!!e.performer,t);var o=geByClass1("_audio_fltr_with_lyrics",this._els.pageContainer);toggleClass(o,"on",!!e.lyrics);var s={performer:AudioPlayer.getLang("audio_performers_only"),lyrics:AudioPlayer.getLang("audio_search_with_text"),sort:AudioPlayer.getLang("audio_search_by_length")},a=this._els.searchInput;each(["performer","lyrics","sort"],(function(t,i){uiSearch.toggleFilter(a,i,s[i],!!e[i])}))},AudioPage.onFilterRemoved=function(e,t,i){var o=currentAudioPage(t);(function(){switch(e){case"performer":var t="audio_search_type_"+intval(this.isLayer()),o=window.radioBtns[t];radiobtn(o.els[0],0,t);break;case"sort":var s=this._searchSortFilter.options.defaultItems[0][0];this._searchSortFilter.selectItem(s,!1);break;case"lyrics":removeClass(geByClass1("_audio_fltr_with_lyrics",this._els.pageContainer),"on")}i||this.onSearchFiltersChanged()}).apply(o)},AudioPage.prototype._showSearchSection=function(e){this._toggleSearchProgress(!0);var t=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,this.getOwnerId(),_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID);if(geByClass1("audio_page_player2")){var i=e.globalQuery||e.q;this._sectionData={q:i,performer:e.performer},this.showSection("search",function(){if(i){var e=this._data.sectionData.search?this._data.sectionData.search.qid:0;Object(_lib_stats__WEBPACK_IMPORTED_MODULE_7__.saveSearchAttemptStats)(_lib_stats__WEBPACK_IMPORTED_MODULE_7__.serviceAudio,0,!isVisible(this._els.searchNoLocalResults),i,e)}this._toggleSearchProgress(!1)}.bind(this))}else t.loadAll(function(){this._toggleSearchProgress(!1),this._doShowSearchSection(e)}.bind(this))},AudioPage.prototype._toggleSearchProgress=function(e){this._els.searchInput&&!this._muteSearch&&(e?uiSearch.showProgress(this._els.searchInput):uiSearch.hideProgress(this._els.searchInput))},AudioPage.prototype._doShowSearchSection=function(e){var t=getAudioPlayer();if(e&&(this._prevSearchParams=e),e=e||this._prevSearchParams){var i=replaceEntities(e.q)+replaceEntities(e.globalQuery||"");each(["performer","lyrics","sort"],(function(t,o){i+=e[o]||0})),i+=this._ownerId,this._toggleSearchProgress(!0);var o=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,this._ownerId,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID);o.loadAll(function(){clearTimeout(this._onSilendLoadedTO),this._onSilendLoadedTO=setTimeout(function(){s.call(this)}.bind(this))}.bind(this))}function s(){o.search(e,function(o){var s="";this._searchAudiosAutoList&&(this._els.searchSectionAudios.innerHTML="",this._searchAudiosAutoList.destroy());var a=this._data.playlistsIndex?this._data.playlistsIndex.search(e.q):[];if(this.showSection("search"),a.length){var _="";each(a,(function(e,t){_+=getTemplate("audio_pl_item",t)})),show(this._els.searchSectionPlaylistsHeader),show(this._els.searchSectionPlaylists),s=+this._ownerId===vk.id?t.langs.audio_found_your_local_playlists:this._ownerId>0?t.langs.audio_found_user_local_playlists:t.langs.audio_found_group_local_playlists,this._els.searchSectionPlaylistsHeader.innerHTML=langNumeric(a.length,s),this._els.searchSectionPlaylists.innerHTML=_}else hide(this._els.searchSectionPlaylistsHeader),hide(this._els.searchSectionPlaylists);var l=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_SEARCH,vk.id,Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_20__.hashCode)(i));l.mergeWith({list:o,searchParams:{globalQuery:e.globalQuery||e.q,performer:e.performer,lyrics:e.lyrics,sort:e.sort}}),l.setLocalFoundCount(o.length),o.length||a.length?hide(this._els.searchNoLocalResults):(show(this._els.searchNoLocalResults),s=vk.id===+this._ownerId?t.langs.audio_no_local_results:this._ownerId>0?t.langs.audio_no_user_local_results:t.langs.audio_no_group_local_results,this._els.searchNoLocalResults.innerHTML=s.replace("{query}","<strong>"+clean(e.q)+"</strong>")),o.length||(hide(this._els.searchSectionAudiosHeader),hide(this._els.searchSectionAudios)),this._searchAudiosAutoList=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(this._els.searchSectionAudios,{onNeedRows:function(e,i,a,_,r){this._toggleSearchProgress(!0),l.load(i,function(){if(this._toggleSearchProgress(!1),!r.isDone()){if(i||(o.length?(show(this._els.searchSectionAudiosHeader),show(this._els.searchSectionAudios),s=+this._ownerId===vk.id?t.langs.audio_found_your_local:this._ownerId>0?t.langs.audio_found_user_local:t.langs.audio_found_group_local,this._els.searchSectionAudiosHeader.innerHTML=langNumeric(o.length,s),toggleClass(this._els.searchSectionAudios,"audio_owner_list_canedit",!!this._data.canEdit)):(hide(this._els.searchSectionAudiosHeader),hide(this._els.searchSectionAudios)),hide(this._els.searchGlobalCommunitiesPlace),hide(this._els.searchGlobalPlaylistsPlace),hide(this._els.searchGlobalArtistsPlace)),+i===o.length){var a=l.getCommunititesBlock(),_=l.getPlaylistsBlock(),n=l.getArtistsBlock();toggle(this._els.searchGlobalCommunitiesPlace,!!a),toggle(this._els.searchGlobalPlaylistsPlace,!!_),toggle(this._els.searchGlobalArtistsPlace,!!n),this._els.searchGlobalCommunitiesPlace&&(this._els.searchGlobalCommunitiesPlace.innerHTML=a||""),this._els.searchGlobalPlaylistsPlace&&(this._els.searchGlobalPlaylistsPlace.innerHTML=_||""),this._els.searchGlobalArtistsPlace&&(this._els.searchGlobalArtistsPlace.innerHTML=n||""),this._els.searchGlobalAudiosList.innerHTML="",l.getAudiosCount()>o.length?(show(this._els.searchGlobalAudiosBlock),r.setListEl(this._els.searchGlobalAudiosList),this._els.searchGlobalAudiosBlockHeader.innerHTML=langNumeric(l.getTotalCount(),t.langs.audio_global_search_found,!0)):hide(this._els.searchGlobalAudiosBlock)}for(var d=[],u=l.getAudiosList(),c=i,h=i<o.length?Math.min(o.length,i+30):i+30,p=c;p<h&&u[p];p++)d.push(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.drawAudio(u[p]));e(d)}}.bind(this))}.bind(this)}),this._onSectionOut(function(){this._els.searchSectionAudios.innerHTML="",this._searchAudiosAutoList&&(this._searchAudiosAutoList.destroy(),this._searchAudiosAutoList=!1)}.bind(this)),this._pagePlaylist=l,this._toggleSearchProgress(!1)}.bind(this))}},AudioPage.prototype.showFriendMusic=function(e,t){return statlogsValueEvent("audio_friends_block","click_friend"),this.isLayer()?nav.go({0:"/audios"+t},!1,{friendId:t}):nav.go("/audios"+t,e),cancelEvent(e)},AudioPage.prototype._deinitNavigation=function(){cur.nav.pop(),this._navigationInited=!1},AudioPage.PageSections=["recoms_audio","recoms_block","search_block","recoms_personal","my"];var layerSectionsToMainFrame=["search_block","search_playlists","recoms_block"];AudioPage.prototype.initNavigation=function(){this._navigationInited||this.isPodcastPage()||(this._navigationInited=!0,this._prevLoc={},cur.nav.push(function(e,t,i,o){var s=this._ignoreResetedSearch;if(delete this._ignoreResetedSearch,s&&o.fromSearch)return!1;if(o.isLayer&&!this.isLayer())return!1;if(this.isLayer()&&!1!==this._prevLoc)for(var a in t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(this._prevLoc),e=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(i),t)t.hasOwnProperty(a)&&(t[a]&&void 0===i[a]?e[a]=!1:t[a]==i[a]&&delete e[a]);if(e&&Object.keys(e).length){this._deleteDeletedAudios();var _=i.section||this.defaultSection,l=!1;return 0===i[0].indexOf("podcasts")&&(_="podcast"),o.tab||o.fromSearch||!1===e.q&&1===Object.keys(e).length||o.searchPerformer?l=!1:o.friendId&&this.isLayer()?(_="friend",this.resetSection(_),this._sectionData={friend_id:o.friendId},l=!1):(2!==Object.keys(e).length||!1!==e.q||isUndefined(e[0]))&&isUndefined(e[0])?(inArray(e.section,AudioPage.PageSections)||e.hasOwnProperty("block")||inArray(t.section,AudioPage.PageSections)&&!inArray(e.section,AudioPage.PageSections))&&(!this.isLayer()||layerSectionsToMainFrame.includes(i.section)||e.hasOwnProperty("block")?l=!0:(l=!1,this._sectionData={audio_id:e.audio_id},_="recoms",delete this._currentSection)):l=!0,l?!0:("recoms"===_&&this.isLayer()&&this.resetSection("recoms"),i.q?(this._els.searchInput&&!o.fromSearch&&(this._els.searchInput.value=i.q,triggerEvent(this._els.searchInput,"keyup",{},!0),this.lastQuery=i.q),this._showSearchSection(extend({},i,o))):(this._ignoreResetedSearch=!1===e.q,this._els.searchInput&&uiSearch.reset(this._els.searchInput,!0),this.showSection(_),this._switchTab(_)),this.isLayer()?this._prevLoc=i:nav.setLoc(i),(o.back||o.hist||o.nav)&&this.syncParametersUI(i),!1)}}.bind(this)))},AudioPage.prototype._deleteDeletedAudios=function(){var e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAddRestoreInfo();each(e,(function(e,t){"deleted"!==t.state&&"recom_hidden"!==t.state||getAudioPlayer().deleteAudioFromAllPlaylists(e)}))},AudioPage.prototype._switchTab=function(e){if(!this.isPodcastPage()){var t=geByClass1("_audio_section_tab__"+e,this._els.pageContainer);t?uiTabs.switchTab(domFC(t)):removeClass(geByClass1("ui_tab_sel",this._els.pageContainer),"ui_tab_sel")}},AudioPage.prototype.onLayerHide=function(){this._deinitNavigation(),this._deinitKeyEvents(),this._onSectionOut(),delete this._currentSection,this._muteSearch=!0,geByClass1("audio_page_player2")&&hide(this._els.searchNoLocalResults),setTimeout(()=>uiSearch.reset(this._els.searchInput),1e3)},AudioPage.prototype.updateLayerHeight=function(){var e=700;e=Math.min(e,window.innerHeight-150),e=Math.max(e,400),isVisible(this._els.footer)&&(e-=getSize(this._els.footer)[1]),setStyle(this._els.scrollWrap,{height:e}),this._els&&this._els.scrollWrap&&"function"==typeof this._els.scrollWrap.updateScroll&&this._els.scrollWrap.updateScroll()},AudioPage.prototype.onLayerShow=function(e){var t=getAudioPlayer().getCurrentPlaylist(),i=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(getAudioPlayer().getCurrentAudio());i?this.showSection("podcast"):t?this.showSection("current"):e?this.showSection(e):this.showSection("all"),toggleClass(geByClass1("_audio_section_tab__current",this._els.pageContainer),"unshown",!t||i),this.initNavigation(),this.updateCurrentPlayingInfo(),this._initKeyEvents(),this.updateLayerHeight(),this.updateShuffleButton();var o=this.getPageCurrentPlaylist(),s=getAudioPlayer().getCurrentAudio();if(this._audioRowsAutoList&&o&&s&&o.indexOfAudio(s)>=0)for(var a=10;a--;){var _=geByClass1(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_CURRENT_CLS,this._audioRowsAutoList.getListEl());if(_){var l=getXY(_)[1];this._scroll.scroller.scrollTop=l-scrollGetY()-300,this._scroll.update();break}this._audioRowsAutoList.drawMore(),getAudioPlayer().updateCurrentPlaying()}delete this._muteSearch},AudioPage.prototype.resetSection=function(e){var t=geByClass1("_audio_section__"+e,this._els.sections);re(t)},AudioPage.prototype.isUpdateRequested=function(e){return Array.isArray(sectionsToUpdate)&&sectionsToUpdate.includes(e+this.getOwnerId())},AudioPage.disableAdsClick=function(e){statlogsValueEvent("audio_web_ad_link","click"),nav.go(e)},AudioPage.prototype.requestUpdate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";sectionsToUpdate=e.map(e=>e+t)},AudioPage.prototype.showSection=function(e,t,i){this.isPodcastPage()&&(e="podcast"),"search"!==this._currentSection||"all"!==e&&"current"!==e||uiSearch.reset(this._els.searchInput,!0),layers.fullhide&&layers.fullhide(),this._switchTab(e);var o=geByClass1("audio_page_player2")&&"search"===e||this.isUpdateRequested(e);if(this._currentSection!==e||"search"===this._currentSection){this._currentSection=e;var s=geByClass1("_audio_section__"+e,this._els.sections),a=this._data.sectionData&&this._data.sectionData[e]||{};if(s&&(!o||!1===i)){if(each(geByClass("_audio_section",this._els.pageContainer),(function(){hide(this)})),hide(this._els.searchGlobalBlocks),hide(this._els.searchGlobalCommunitiesPlace),hide(this._els.searchGlobalPlaylistsPlace),hide(this._els.searchGlobalArtistsPlace),hide(this._els.searchGlobalAudiosBlock),show(s),geByClass1("audio_page_player2")&&(hide(this._els.searchNoLocalResults),"search"===e&&!s.innerHTML)){show(this._els.searchNoLocalResults);var _=getAudioPlayer(),l=vk.id===+this._ownerId?_.langs.audio_no_local_results:this._ownerId>0?_.langs.audio_no_user_local_results:_.langs.audio_no_group_local_results,r=winToUtf(clean(a.searchParams.globalQuery));this._els.searchNoLocalResults.innerHTML=l.replace("{query}","<strong>"+r+"</strong>")}if(this._onSectionOut(),delete cur._back,!["podcast","current"].includes(e))return this.catalogController.setSection(s,a),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isFunction)(t)&&t(),void getAudioPlayer().updateCurrentPlaying();switch(e){case"current":this._initSection_current(s,a,!0);break;case"podcast":this._initSection_podcast(s,a)}return this.catalogController.setSection(s,{}),getAudioPlayer().updateCurrentPlaying(),void(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isFunction)(t)&&t())}var n=this._ownerId;if("podcast"===e&&!this.isPodcastPage())n=(getAudioPlayer().getCurrentAudio()||this._readyAudio)[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID];this.isUpdateRequested(e)&&(sectionsToUpdate=null),ajax.post("al_audio.php",extend({act:"section",section:e,owner_id:n,is_layer:this.isLayer()?1:0,claim:intval(nav.objLoc.claim)},this._sectionData||{}),{onDone:(i,s)=>{if(this._data.sectionData=this._data.sectionData||{},this._data.sectionData[e]=s,o){var a=geByClass1("_audio_section__"+e,this._els.sections);a&&re(a)}var _=se('<div class="audio_section _audio_section _audio_section__'+e+" audio_section__"+e+' clear_fix audio_w_covers">'+i+"</div>");this._els.sections.appendChild(_),delete this._currentSection,this.showSection(e,t,!1)},onFail:()=>!0}),delete this._sectionData}else Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isFunction)(t)&&t()},AudioPage.prototype._onSectionOut=function(e){e?(this._onSectionOutCbs=this._onSectionOutCbs?this._onSectionOutCbs:[],this._onSectionOutCbs.push(e)):(each(this._onSectionOutCbs||[],(function(e,t){t()})),this._onSectionOutCbs=[])},AudioPage.prototype._initSection_playlistsRecoms=function(e,t,i){var o=geByClass1("audio_page_block__playlists_items",t);if(o){var s=i.playlistsData.next,a=3,_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;a?(a--,setTimeout((function(){l(e,2*t)}),t)):e([])},l=function(t,o){ajax.post("al_audio.php",{act:"load_playlists_block",block_id:i.playlistsData.id,section:e,offset:s,render_html:1},{onDone:function(e,i){s=e.next,e&&i&&i.length?(a=3,s=e.next,t(i)):_(t,o)},onFail:function(){return _(t,o),!0}})},r=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(o,{onNeedRows:function(e){if(!o.clientHeight)return r&&r.destroy();s?l(e):e([])},onNoMore:function(){r&&r.toggleProgress(!1)},showProgress:showProgress.pbind(o,"","audio_more_rows"),hideProgress:hideProgress.pbind(o)});this._onSectionOut((function(){r.destroy()}))}},AudioPage.prototype.onPlaylistsReorder=function(e,t,i){var o=domData(e,"raw-id"),s=domData(i,"raw-id");ajax.post("al_audio.php",{act:"reorder_playlist",owner_id:this.getOwnerId(),playlist_id:o.split("_")[1],prev_playlist_id:s?s.split("_")[1]:0,hash:this._data.reorderHash},{onFail:()=>!0})},AudioPage.prototype._initSection_current=function(e,t){var i;if(extend(this._els,{audioRows:geByClass1("_audio_page__audio_rows_list",e),audioRowsMore:geByClass1("_audio_more_rows",e),friendsBlock:geByClass1("_audio_friends_list_wrap",e),friendsBlockContent:geByClass1("_audio_friends_list_content",e)}),!(i=getAudioPlayer().getCurrentPlaylist())&&!this.retriedCurrent)return this.retriedCurrent=!0,setTimeout(()=>this._initSection_current(e,t));this.isLayer()&&(this._scroll=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_14__.default(this._els.scrollWrap,{global:!0,stopScrollPropagation:!0,stopScrollPropagationAlways:!0})),i&&(this._pagePlaylist=i,domData(this._els.audioRows,"playlist-id",i.getId()));var o=geByClass1("_audio_friends_search",e);o&&uiSearch.init(o),this._initAudioRowsAutoList(!0),setTimeout(()=>this._initFixedFriendsBlock(e))},AudioPage.prototype.drawMore=function(){this._audioRowsAutoList&&this._audioRowsAutoList.drawMore()},AudioPage.prototype.scrollIntoView=function(e,t){this._scroll.scrollIntoView(e,t)},AudioPage.prototype._initSection_podcast=function(e,t){extend(this._els,{audioRows:geByClass1("_audio_page__audio_rows_list",e),audioRowsMore:geByClass1("podcast_episodes_more",e)});var i=getAudioPlayer().getCurrentPlaylist();if(!i){var o=t.playlistData;o&&((i=getAudioPlayer().getPlaylist(o.type,o.ownerId,o.id)).getAudiosCount()||(i.mergeWith(o),i.load()))}i&&(this._pagePlaylist=i,domData(this._els.audioRows,"playlist-id",i.getId())),this._initAudioRowsAutoList(),this._data.reverse||this._enableAudioRowsSorter()},AudioPage.prototype.setPagePlaylist=function(e){this._pagePlaylist=e},AudioPage.prototype.getSortedList=function(){return this._sortedList},AudioPage.prototype.clearSortedList=function(){this._sortedList=null},AudioPage.prototype.shuffleAudioPage=function(){if(!this.isPodcastPage()){var e=this.getPageCurrentPlaylist(),t=domData(this._els.audioRows,"audio-context");e.loadAll(function(){this._sortedList=[].concat(e.getUnshuffledAudiosList()),this._sortedList.fullId=e.getFullId(),Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_20__.shuffle)(this._sortedList);var i=new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_TEMP,e.getOwnerId(),e.getAlbumId());i.mergeWith({list:this._sortedList}),getAudioPlayer().play(i.getAudioAt(0),i,t),this._disableAudioRowsSorter(),this._initAudioRowsAutoList(),this._sortDD&&this._sortDD.select("random",!0)}.bind(this)),statlogsValueEvent("audio_sort_stat","audio_sort","shuffle_page",this.isLayer()?"layer":"page")}},AudioPage.prototype._onSortSelected=function(e){var t=this.getPageCurrentPlaylist();t.loadAll(function(){switch(e){case 0:delete this._sortedList,this._enableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_default");break;case"performer":var i=[].concat(t.getUnshuffledAudiosList());i.sort((function(e,t){var i=trim(e[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].toLowerCase()),o=trim(t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].toLowerCase());return 0==i.indexOf("the ")&&(i=i.slice(4)),0==o.indexOf("the ")&&(o=o.slice(4)),i<o?-1:i>o?1:0})),this._sortedList=i,this._sortedList.fullId=t.getFullId(),this._disableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_performer");break;case"random":this._sortedList=[].concat(t.getUnshuffledAudiosList()),this._sortedList.fullId=t.getFullId(),Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_20__.shuffle)(this._sortedList),this._disableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_shuffle");break;case"reverse":this._sortedList=[].concat(t.getUnshuffledAudiosList()),this._sortedList.fullId=t.getFullId(),this._sortedList.reverse(),this._disableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_reverse")}this._initAudioRowsAutoList()}.bind(this))},AudioPage.prototype._initFixedFriendsBlock=function(){if(this._els.friendsBlock){this._isFixed=!1,this._isDraggable=!1,this._initialPos=getXY(this._els.friendsBlock);var e=this.isLayer(),t=getSize("page_header")[1],i=getSize(this._els.playerWrap)[1],o=e?13:15;this._fixedThreshold=e?t+i+o:this._initialPos[1]-t-i-o;var s=e?this._scroll.scroller:window;if(!(this._fixedThreshold<0)){addEvent(window,"resize",this._resizeHandler=()=>{this._initialPos=getXY(this._els.friendsBlock)}),addEvent(s,"scroll",this._scrollHandler=()=>{this._moveFriendsBlock()});var a=this;AudioPage.onUpdateDraggablePosition=()=>{a._isDraggable=!0,a._moveFriendsBlock(),requestAnimationFrame(()=>a._isDraggable=!1)},AudioPage.forceFix=()=>{var e=a._els.friendsBlockContent.getBoundingClientRect();if(e.width>0&&e.height>0){var t=a.isLayer()?a._scroll.scroller.scrollTop:scrollGetY();a._els.friendsBlockContent.style.transform=`translate(0,${Math.max(0,t-a._fixedThreshold-9)}px)`,a._unfixedFriendsBlock()}},this._onSectionOut(()=>{this._scrollHandler&&removeEvent(s,"scroll",this._scrollHandler),this._resizeHandler&&removeEvent(window,"resize",this._resizeHandler),this._fixedBlockScrollHandler&&removeEvent(this._els.friendsBlockContent,"mousewheel",this._fixedBlockScrollHandler),removeClass(this._els.friendsBlockContent,"audio_friends_fixed")})}}},AudioPage.prototype._moveFriendsBlock=function(){var e=this.isLayer()?this._scroll.scroller.scrollTop:scrollGetY(),t=this._els.friendsBlockContent.getBoundingClientRect(),i=t.width>0&&t.height>0;this._isDraggable&&i?(this._els.friendsBlockContent.style.transform=`translate(0,${Math.max(0,e-this._fixedThreshold-9)}px)`,this._unfixedFriendsBlock()):(this._els.friendsBlockContent.style.transform="",e>this._fixedThreshold?this._fixedFriendsBlock():this._unfixedFriendsBlock())},AudioPage.prototype._fixedFriendsBlock=function(){this._isFixed||(this._initialPos=getXY(this._els.friendsBlock),addClass(this._els.friendsBlock,"audio_friends_fixed"),this._isFixed=!0,this.isLayer()&&(this._fixedBlockScrollHandler=addEvent(this._els.friendsBlockContent,"mousewheel",e=>(this._scroll.scroller.scrollTop=this._scroll.scroller.scrollTop+e.deltaY,cancelEvent(e)))))},AudioPage.prototype._unfixedFriendsBlock=function(){this._isFixed&&(removeClass(this._els.friendsBlock,"audio_friends_fixed"),this._isFixed=!1,this._fixedBlockScrollHandler&&removeEvent(this._els.friendsBlockContent,"mousewheel",this._fixedBlockScrollHandler))},AudioPage.prototype.playPlaylist=function(e,t,i,o){var s=getAudioPlayer(),a=s.getCurrentPlaylist(),_=s.getPlaylist(e,t,i);a&&a.equals(_)&&s.isPlaying()?s.pause():_.load(0,(function(){s.play(_.getAudiosList()[0],_,o)}))},AudioPage.prototype.playShuffledBlockPlaylist=function(e){var t=getAudioPlayer(),i=t.getPlaylistByBlockId(e)||new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist({hasMore:!0,blockId:e});i.clean(),i.loadByBlockId("",(function(e){t.play(e.getAudiosList()[0],e,e.getContext())}))},AudioPage.prototype.playBlockPlaylist=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=getAudioPlayer(),o=i.getCurrentPlaylist(),s=i.getPlaylistByBlockId(e)||new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist({hasMore:!0,blockId:e});if(o&&o.equals(s)&&i.isPlaying())i.pause();else{var a=s.getContext()||t&&t.dataset.context||"";s.loadByBlockId("",e=>i.play(e.getAudiosList()[0],e,a))}},AudioPage.prototype.onAudioRowsReorder=function(e,t,i,o){var s,a=getAudioPlayer(),_=domData(t,"full-id"),l=domData(o,"full-id"),r=e?a.getCurrentPlaylist():this.getPageCurrentPlaylist(),n=r.indexOfAudio(_);l?(s=r.indexOfAudio(l),s++):s=0,r.moveAudio(n,s),e&&a.saveStateCurrentPlaylist(),this.isPodcastPage()?ajax.post("al_podcasts.php",{act:"a_reorder_episodes",hash:this._data.audiosReorderHash,oid:this.getOwnerId(),episode_id:_?_.split("_")[1]:0,next_episode_id:l?l.split("_")[1]:0},{onFail:()=>!0}):e||ajax.post("al_audio.php",{act:"reorder_audios",hash:this._data.audiosReorderHash,owner_id:this.getOwnerId(),audio_id:_?_.split("_")[1]:0,next_audio_id:l?l.split("_")[1]:0},{onFail:()=>!0})},AudioPage.prototype._enableAudioRowsSorter=function(e){(this._data.audiosReorderHash||e)&&(this._audioRowsSorter&&this._audioRowsSorter.destroy(),this._audioRowsSorter=new _web_grid_sorted__WEBPACK_IMPORTED_MODULE_21__.default(this._els.audioRows,"",{wrapNode:this.isLayer()?this._scroll.scroller:void 0,onReorder:(t,i,o)=>this.onAudioRowsReorder(e,t,i,o)}),this._onSectionOut(function(){this._audioRowsSorter&&this._audioRowsSorter.destroy()}.bind(this)))},AudioPage.prototype._disableAudioRowsSorter=function(){this._audioRowsSorter&&this._audioRowsSorter.disable()},AudioPage.prototype._initAudioRowsAutoList=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._els.audioRows){var t=this.isPodcastPage()||"podcast"===this._currentSection,i=this._pagePlaylist;this._els.audioRows.innerHTML="",toggleClass(this._els.audioRows,"audio_owner_list_canedit",!t&&!!this._data.canEdit),this._audioRowsAutoList&&this._audioRowsAutoList.destroy(),this._audioRowsAutoList=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(this._els.audioRows,{scrollNode:!!this._scroll&&this._scroll.scroller,onRendered:function(){getAudioPlayer().updateCurrentPlaying()},onNoMore:function(){hide(this._els.audioRowsMore)}.bind(this),onNeedRows:function(o,s,a,_,l){var r=[];t?(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(this._els.audioRowsMore),this._loadPodcastEpisodes(s,function(e){(e||[]).slice(s).forEach((function(e){r.push(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.drawAudio(e))})),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(this._els.audioRowsMore),o(r)}.bind(this))):i&&i.load(s,()=>{var t;t=e?((t=i.getAudiosList())||[]).map(e=>{if(e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_27__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]){var t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(e);return t[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_27__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]=!1,t}return e}):this._sortedList&&this._sortedList.fullId===i.getFullId()?this._sortedList:i.getUnshuffledAudiosList();for(var a=s;a<s+30&&t[a];a++)r.push(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.drawAudio(t[a]));o(r),0===s&&this._audioRowsSorter&&this._audioRowsSorter.update(),0===s&&1===r.length&&l.drawMore()})}.bind(this)}),this._onSectionOut(function(){this._audioRowsAutoList.destroy(),this._els.audioRows.innerHTML=""}.bind(this))}},AudioPage.prototype._loadPodcastEpisodes=function(e,t){var i,o=getAudioPlayer().getCurrentAudio()||this._readyAudio;i=this.isPodcastPage()?this._ownerId:o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],cur._podcastsEpisodes=cur._podcastsEpisodes||{},cur._podcastsEpisodes[i]=cur._podcastsEpisodes[i]||[];var s=cur._podcastsEpisodes[i];s.length&&e<s.length?t(s):ajax.post("al_podcasts.php",{act:"a_episodes",oid:i,episode_full_id:o?o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_ID]:"",offset:e,rev:this._data.reverse},{onDone:function(e){cur._podcastsEpisodes[i]=s.concat(e||[]),t(cur._podcastsEpisodes[i])},onFail:function(){return t(cur._podcastsEpisodes[i]),!0}})},AudioPage.showAttachBox=function(e,t){curBox()&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(geByClass1("_ape_item_list",curBox().bodyNode),"offset")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(geByClass1("_ape_item_list",curBox().bodyNode),"offset",0),1===vk.widget?showBox("al_audio.php",{act:"choose_box",owner_id:e,options:JSON.stringify(t)}):AudioPage.editPlaylist(e,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID,"attach",t)},AudioPage.editPlaylist=function(e,t,i,o){if(vk.widget)for(var s in o)o.hasOwnProperty(s)&&(isString(o[s])?o[s]=clean(o[s]):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isFunction)(o[s])?delete o[s]:o[s]=intval(o[s]));var a,_;if("edit"===i&&o&&(o.audioAttachSwitchOwnerId=!1),o&&o.audioAttachSwitchOwnerId&&(cur.audioAttachSwitchOwnerId=o.audioAttachSwitchOwnerId),i=i||"edit",t)a=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,e,t);else if(cur.audioPage){var l=cur.audioPage._data.maxPlaylistsCount;if(isArray(cur.audioPage._data.playlists)&&cur.audioPage._data.playlists.length>=l){var r=langNumeric(l,cur.lang.audio_playlists_limit_error).replace("{limit}",l);return void new MessageBox({title:getLang("global_error")}).content(r).setButtons("Ok",(function(){curBox().hide()})).show()}}show(boxLoader),show(boxLayerWrap),boxRefreshCoords(boxLoader),Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_20__.parallel)(e=>{stManager.add(["audio.css",jsc("web/indexer.js"),jsc("web/auto_list.js"),jsc("web/grid_sorter.js"),"edit"===i&&jsc("web/upload.js")],e)},e=>{a?a.loadAll(e,i):e()},t=>{cur.audioPage&&cur.audioPage.getOwnerId()===+e&&(_=cur.audioPage.getOwnerPlaylists()),_?t():AudioPage.loadPlaylists(e,void 0,!1,"attach"===i,e=>{_=e,t()})},()=>{AudioPage._openEditPlaylist(i,e,t,_,o)})},AudioPage.initBoxEls=function(e){return{boxContent:geByClass1("_audio_pl_edit_box",e.bodyNode),playlistNameInput:geByClass1("ape_pl_input",geByClass1("ape_pl_title",e.bodyNode)),playlistDescriptionInput:geByClass1("ape_pl_input",geByClass1("ape_pl_description",e.bodyNode)),playlistDiscoverToggle:geByClass1("ape_discover_checkbox",geByClass1("ape_pl_discover",e.bodyNode)),stat:geByClass1("_ape_pl_stat",e.bodyNode),uploadCoverButtonWrapper:geByClass1("_ape_cover",e.bodyNode),uploadCoverInput:geByClass1("_ape_cover_upload",e.bodyNode),errorMsg:geByClass1("_ape_error_msg",e.bodyNode),header:geByClass1("_ape_header",e.bodyNode),search:geByClass1("_ape_search",e.bodyNode),searchInput:geByClass1("_field",e.bodyNode),addAudiosButton:geByClass1("ape_add_audios_btn",e.bodyNode),addAudiosFromPlaylistsButton:geByClass1("ape_add_pl_audios_btn",e.bodyNode),listWrap:geByClass1("_ape_list_wrap",e.bodyNode),list:geByClass1("_ape_item_list",e.bodyNode),globalResults:geByClass1("_ape_item_global_results",e.bodyNode),globalResultsList:geByClass1("_ape_item_global_list",e.bodyNode),emptyPlaceholder:geByClass1("_ape_audios_empty_list",e.bodyNode),emptyPlaylistsPlaceholder:geByClass1("_ape_audios_empty_playlists_list",e.bodyNode),emptyGlobalPlaceholder:geByClass1("_ape_audios_empty_global_list",e.bodyNode)}},AudioPage._openEditPlaylist=function(e,t,i,o,s){var a,_,l,r,n,d,u,c=getAudioPlayer(),h=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_TEMP,t,irand(0,999999));if(curBox()){n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(geByClass1("_ape_item_list",curBox().bodyNode),"offset"),d=val("ape_edit_playlist_search");var p=geByClass1("_ape_item_list",curBox().bodyNode);p&&(u=p.scrollTop)}hide(boxLoader),curBox()||hide(boxLayerWrap),cur.apLayer&&(r=cur.apLayerPlaylistId,layers.fullhide()),s=extend({audioPickerButtonText:getLang("global_add_media"),playlistPickerButtonText:getLang("audio_attach_playlist_button"),canPlaylistAttach:!1,onAudioChoose:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.onAudioChoose,onPlaylistChoose:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.onPlaylistChoose},s),cur.onChooseAudio=s.onAudioChoose,cur.onChoosePlaylist=s.onPlaylistChoose;var g,y=!i||i===_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID,P="attach"===e,E=!1,A=!1,f=!1,b=!1,v=0,C=null,w=!0;o=o.filter(e=>e.id!==_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID&&e.size>0);var O=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_19__.vkIndexer(o,e=>e.title),m=o.length>0,L=!1;!y||P?(L=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,t,i),h.addAudio(L.getUnshuffledAudiosList()),h.mergeWith({title:L.getTitle(),description:L.getDescription(),rawDescription:L.getRawDescription(),coverUrl:L.getCoverUrl(),editHash:L.getEditHash(),noDiscover:L.getNoDiscover()})):s.addAudio&&h.addAudio(s.addAudio);var D=P?getLang("audio_choose_audio_title"):i?getLang("audio_edit_playlist_title"):getLang("audio_new_playlist_title");function B(e){if(e=trim(e)){var t=" "+(e+"|")+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_23__.parseLatin)(e)||"")+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_23__.parseCyr)(e)||"");t=trim(t.replace(/\)/g,"").replace(/&/,"&amp;")),b=new RegExp("(\\s|^)("+t.replace(_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_19__.vkIndexer.delimiter,"|").replace(/(^\||\|$|\?)/g,"")+")","gi")}else b=!1;W(A,"playlists"!==E,e),hide(_.emptyGlobalPlaceholder)}function M(){s.onClose&&s.onClose(),w||(h.clean(),c.deletePlaylist(h),r&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.showAudioPlaylist(r[0],r[1]))}function I(t){var o,s;return!(!t&&"attach"!==e)||(i?(o=getLang("audio_edit_playlist_cancel_confirm_text"),s=getLang("audio_edit_playlist_cancel_confirm_yes")):(o=getLang("audio_new_playlist_remove_confirm_text"),s=getLang("audio_new_playlist_remove_confirm_continue")),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__.showFastBox)(getLang("global_warning"),o,s,()=>{w=!1,curBox().hide(),a.hide(!0)},getLang("global_cancel")),!1)}function T(){return trim(_.searchInput.value)}function S(t){var i=h.indexOfAudio(t)>=0?"ape_selected":"",o=t;b&&((t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_28__.clone)(o))[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_TITLE].replace(b,"$1<em>$2</em>"),t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].replace(b,"$1<em>$2</em>"));var a="";if("edit"===e)a='<div class="ape_check"><div class="ape_check_icon"></div></div>';else{var _=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(o);if(s&&s.wiki)a='<div role="button" class="ape_attach" onclick="'+`editorChooseAudio(\n        '${clean(_.performer)}',\n        '${clean(_.title)}',\n        ${_.duration},\n        '${_.fullId}',\n        '${_.url}',\n        ${_.duration},\n        this)`+'">'+s.audioPickerButtonText+"</div>";else a=`<div role="button" class="ape_attach" onclick="cur.onChooseAudio(event, this, ${_=clean(JSON.stringify(_))}, ${clean(JSON.stringify(o))})">${s.audioPickerButtonText}</div>`}return'<div class="ape_audio_item_wrap _ape_audio_item '+i+'">'+a+_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.drawAudio(t)+"</div>"}(2===vk.widget||3===vk.widget)&&window.box&&(!boxQueue.count()&&!curBox()||cur.audioChooseBox===curBox())?(a=window.box).setOptions({title:D,bodyStyle:"padding: 0",width:560,onBeforeHide:M,onHideAttempt:I,hideButtons:!0}):(cur.audioChooseBox&&cur.audioChooseBox===curBox()&&curBox().hide(),a=new MessageBox({title:D,bodyStyle:"padding: 0",width:560,onBeforeHide:M,onHideAttempt:I})),cur.audioChooseBox=a,a.content(getTemplate("audio_edit_playlist")),a.show(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(a,"ownerId",t),_=AudioPage.initBoxEls(a),function(){var i=window.innerHeight;setStyle(_.boxContent,"height",Math.min(800,Math.max(i-200,500))),addEvent(_.addAudiosFromPlaylistsButton,"click",j.bind(this,"playlists")),addEvent(_.addAudiosButton,"click",j.bind(this,"default")),addEvent(_.list,"click",q),P&&domData(_.list,"audio-context","attach");if(addEvent(a.titleWrap,"click",(function(e){hasClass(e.target,"_back")&&function(){switch(E){case"initial":break;case"default":j("initial");break;case"playlists":j("default");break;case"playlist":j("playlists")}}()})),uiSearch.init("ape_edit_playlist_search",{onChange:B}),"edit"===e){j("initial"),G(),function(){if(!cur.audioCoverUploadOptions||!cur.audioCoverUploadOptions[t])return;var e=cur.audioCoverUploadOptions[t],i={file_name:"photo",file_size_limit:5242880,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF;*.bmp;*.BMP",onUploadStart:function(e,t){show(geByClass1("_ape_cover_progress"))},onUploadComplete:function(e,t){(t=JSON.parse(t)).error?(show(_.errorMsg),K()):(hide(_.errorMsg),Y((v=t).url),K()),hide(geByClass1("_ape_cover_progress"))},onUploadProgress:function(e,t,i){},onUploadError:function(e,t){hide(geByClass1("_ape_cover_progress"))},clear:1,type:"photo",max_attempts:3,server:e.server,noCheck:!0,chooseBox:!0,uploadButton:!0,accept:".jpg,.jpeg,.png",filesize_hide_last:!0,label:e.button};Upload.init(_.uploadCoverButtonWrapper,e.url,e.vars,i),_.uploadCoverButton=geByClass1("ape_cover_accessibility_upload_btn",a.bodyNode),addEvent(geByClass1("_ape_cover_delete"),"click",$),addEvent(_.uploadCoverButton,"click",()=>{isObject(v)&&!isVisible(geByClass1("_ape_cover_progress"))||geByTag1("input",_.uploadCoverButtonWrapper).click()}),_.coverThumb=geByClass1("_ape_cover_thumb")}(),h.getCoverUrl()&&Y(h.getCoverUrl()),autosizeSetup(_.playlistDescriptionInput,{minHeight:30,maxHeight:150,onResize:K}),_.playlistNameInput.value=replaceEntities(h.getTitle()),_.playlistDescriptionInput.value=replaceEntities(h.getRawDescription().replace(/<br>/g,"\n"));var o=Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__.getTestGroup)(661);2===o?_.playlistDiscoverToggle&&_.playlistDiscoverToggle.classList.toggle("on",!h.getNoDiscover()):3===o&&_.playlistDiscoverToggle&&_.playlistDiscoverToggle.classList.toggle("on",h.getNoDiscover())}P&&j("default");x(),L&&"attach"!==e&&a.setControlsText(`<a onclick="AudioPage.deletePlaylist(${L.getOwnerId()}, ${L.getPlaylistId()}, '${L.getEditHash()}')">\n                              ${getLang("audio_delete_playlist")}\n                            </a>`)}(a.bodyNode),d&&val(_.searchInput,d),R();var k=0;function R(){clearTimeout(k);var e=T();e&&(k=setTimeout((function(){k=!1,(f=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_SEARCH,vk.id,Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_20__.hashCode)(e+"no conflict"))).mergeWith({searchParams:{globalQuery:e},hasMore:!0});var t=0;l&&(t=l.getOffset(),l.destroy()),(l=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(_.list,{scrollNode:_.list,onNeedRows:function(e,i){i-=t,f.load(i,(function(){var t=[],o=f.getAudiosList();if(0==+i&&o.length&&t.push('<div class="ape_list_header">'+getLang("audio_edit_playlist_global_results")+"<div>"),o.length)for(var s=Math.min(o.length,i+20),a=i;a<s;a++)t.push(S(o[a]));f.getAudiosCount()||l&&l._offset?(hide(_.emptyGlobalPlaceholder),show(_.list)):(show(_.emptyGlobalPlaceholder),hide(_.list)),e(t)}))}})).drawMore()}),300),C=null)}function U(){a.setOptions({title:'<div class="back _back">'+getLang("global_back")+"</div>",bodyStyle:"padding: 0"})}function x(){var e="";cur.audioAttachSwitchOwnerId&&cur.audioAttachOriginalOwnerId&&(e='<span class="dvd"></span><a class="tab_link" onclick="cur.audioAttachSwitch()">',e+=getLang(h.getOwnerId()<0?"audio_choose_wall_to_my_audios":"audio_choose_wall_to_group_audios"),h.getOwnerId()===cur.audioAttachOriginalOwnerId?cur.audioAttachSwitch=function(){AudioPage.showAttachBox(cur.audioAttachSwitchOwnerId,s)}:cur.audioAttachSwitch=function(){AudioPage.showAttachBox(cur.audioAttachOriginalOwnerId,s)},e+="</a>"),a.setOptions({title:D+e,bodyStyle:"padding: 0"})}function K(){var e=_.boxContent.getBoundingClientRect();if(e.height&&e.width){var t=_.list.getBoundingClientRect();setStyle(_.list,{height:e.height-(t.y-e.y)})}}function W(e,t,i){A=e,t?i?e.search({q:i},(function(e){H(!0,e)})):H(!0,e.getUnshuffledAudiosList()):H(!1,i?O.search(i):o),N("initial"===E&&!i)}function H(e,t){_.list.innerHTML="",l&&l.destroy(),show(_.list),hide(_.emptyPlaceholder),hide(_.emptyGlobalPlaceholder),hide(_.emptyPlaylistsPlaceholder),K();var i=0;l=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(_.list,{scrollNode:_.list,onNoMore:function(){0===i&&(T()?e||(hide(_.list),show(_.emptyPlaylistsPlaceholder)):(hide(_.list),show(_.emptyPlaceholder))),e&&R()},onNeedRows:function(o,s){for(var a=[],_=n||20,l=Math.min(t.length,s+_),r=s;r<l;r++){var d=t[r],u=void 0;if(e)u=S(d);else{var c='<div class="ape_pl_item_inner"><span class="ape_pl_title">'+(b?d.title.replace(b,"$1<em>$2</em>"):d.title)+'</span> <span class="ape_pl_size">'+langNumeric(d.size,cur.lang.audio_playlist_audios_count,!0).replace("{count}",d.size)+"</span></div>";u=`<div class="ape_pl_item"\n                        data-playlist-access-hash="${d.access_hash}"\n                        data-playlist-owner-id="${d.owner_id}"\n                        data-playlist-id="${d.id}">\n                          ${c}\n                        </div>`}a.push(u)}i+=a.length,o(a)},onRendered:e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(_.list,"offset",e),u&&n&&(_.list.scrollTop=u,n=0,u=0)}})}function N(e){g||(g=new _web_grid_sorted__WEBPACK_IMPORTED_MODULE_21__.default(_.list,"ape_audio_item_wrap",{wrapNode:_.list,onReorder:function(e,t){var i,o=domData(geByClass1("_audio_row",e),"full-id"),s=h.indexOfAudio(o);t?(o=domData(geByClass1("_audio_row",t),"full-id"),i=h.indexOfAudio(o)):i=h.getAudiosCount(),h.moveAudio(s,i)}})),e?g.enable():g.disable()}function j(i,l){if("default"===i&&cur.audioPage&&cur.audioPage._data.addBanned)Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__.showFastBox)({title:getLang("global_error")},cur.audioPage._data.addBannedText);else{switch(E=i,a.removeButtons(),domData(_.list,"view",i),i){case"initial":show(_.header),hide(_.addAudiosFromPlaylistsButton),show(_.addAudiosButton),show(_.search),hide(_.globalResults),W(h,!0),F(),x();break;case"default":var r=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,t,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.disableEl)(_.addAudiosButton),showProgress(_.addAudiosButton),r.load((function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.enableEl)(_.addAudiosButton),hideProgress(_.addAudiosButton),hide(_.header),show(_.search),toggle(_.addAudiosFromPlaylistsButton,m),hide(_.addAudiosButton),"edit"===e?U():x(),W(r,!0,d),K(),"edit"===e&&F()}));break;case"playlists":hide(_.header),show(_.search),hide(_.addAudiosFromPlaylistsButton),hide(_.addAudiosButton),hide(_.globalResults),U(),W(o);break;case"playlist":hide(_.header),show(_.search),hide(_.addAudiosFromPlaylistsButton),hide(_.addAudiosButton),U(),W(l,!0),P&&function(e){if(!s.canPlaylistAttach)return;a.addButton(s.playlistPickerButtonText,(function(t){cur.onChoosePlaylist(t,e)}),"ok",!0)}(l),"edit"===e&&F()}K(),_.searchInput.value="",elfocus(_.searchInput),b=!1,C=null,clearTimeout(k),c&&c.updateCurrentPlaying&&c.updateCurrentPlaying()}}function F(){a.addButton(getLang("audio_save_playlist_button"),V,"ok",!0)}function q(e){var t=domClosest("ape_pl_item",e.target);if(t){var i=domData(t,"playlist-id"),o=domData(t,"playlist-owner-id"),s=domData(t,"playlist-access-hash"),a=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,o,i,s);showProgress(t),a.load((function(){hideProgress(t),j("playlist",a)}))}if(hasClass(e.target,"ape_check")){function l(e,t){if(cur.audioPage&&cur.audioPage._data.addBanned)Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__.showFastBox)({title:getLang("global_error")},cur.audioPage._data.addBannedText);else{var i=toggleClass(e,"ape_selected",t),o=geByClass1("_audio_row",e),s=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAudioFromEl(o);i?h.addAudio(s,0):h.removeAudio(s)}}var r=domClosest("_ape_audio_item",e.target);if(e.shiftKey&&C){var n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domChildIndex)(C),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domChildIndex)(r),u=domPN(r);if(n>d){var p=d;d=n,n=p}for(var g=hasClass(C,"ape_selected"),y=n;y<=d;y++)l(u.children[y],g)}else l(r),C=r;G()}if(P&&hasClass(e.target,"artist_link")){if(e.metaKey&&browser.mac||e.ctrlKey)return;var E=domData(e.target,"performer")||trim(e.target.innerText);E&&(val(_.searchInput,E),uiSearch.onChanged(_.searchInput),B(E))}return cancelEvent(e)}function G(){var e,t=h.getAudiosCount(),i=h.getTotalDuration();if(t){var o;e=(e=langNumeric(t,cur.lang.audio_edit_playlist_audios_info)).replace("{count}",t);var s=i%60,a=Math.floor(i/60)%60,l=Math.floor(i/3600);i<60?o=langNumeric(i,cur.lang.audio_total_dur_seconds):i<3600?(o=langNumeric(a,cur.lang.audio_total_dur_minutes),s&&(o+=" "+langNumeric(s,cur.lang.audio_total_dur_seconds))):(o=langNumeric(l,cur.lang.audio_total_dur_hours),a&&(o+=" "+langNumeric(a,cur.lang.audio_total_dur_minutes))),e+='<span class="dvd">'+o+"</span>"}else e=getLang("audio_edit_playlist_no_audios");_.stat.innerHTML=e}function V(e){var i=trim(val(_.playlistNameInput)),o=trim(val(_.playlistDescriptionInput)),l=Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_30__.getTestGroup)(661),r=null,n=_.playlistDiscoverToggle&&_.playlistDiscoverToggle.classList.contains("on");if(2===l?r=+!n:3===l&&(r=+n),!i)return j("initial"),void Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.notaBene)(ge("ape_pl_name"));var d=[];each(h.getUnshuffledAudiosList(),(function(e,t){d.push(t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_ID]+"_"+t[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_27__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY])}));var u=s.newPlaylistHash||cur.audioPage&&cur.audioPage._data.newPlaylistHash||"",c={hash:y?u:L.getEditHash(),owner_id:t,playlist_id:y?0:L.getPlaylistId(),title:i,description:o,Audios:d.join(","),cover:isObject(v)?JSON.stringify(v):v};null!==r&&(c.no_discover=r),ajax.post("al_audio.php?act=save_playlist",c,{showProgress:()=>Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(e),onDone:(e,i)=>{y&&!document.querySelector(".CatalogSection ._audio_page__playlists")?nav.reload():(each(geByClass("_audio_pl_"+e.ownerId+"_"+e.id),(function(){var t=geByClass1("audio_pl__cover",this);if(t){setStyle(t,"background-image",e.coverUrl?"url("+e.coverUrl+")":null),setStyle(t,"background-size",e.coverUrl?"cover":null);var i=geByClass1("_audio_pl_grid_covers_wrap",this);i&&(i.innerHTML=e.coverUrl?"":e.gridCovers)}var o=geByClass1("audio_pl__title",this);if(o){var s=geByClass1("audio_item__title",o);s?val(s,e.title):val(o,e.title)}var a=geByClass1("_audio_pl__stats_count",this);a&&(a.innerHTML=e.totalCount)})),y&&cur.audioPage&&t==cur.audioPage.getOwnerId()&&["all","my_playlists"].includes(cur.audioPage._currentSection)&&(each(geByClass("_audio_page_block__playlists_items",cur.audioPage._els.pageContainer),(function(){var e=se(getTemplate("audio_pl_item",i));this.insertBefore(e,this.firstChild);var t=intval(domData(this,"max-items"));t&&this.children.length>t&&this.removeChild(this.lastChild),show(gpeByClass("_audio_page__playlists",this))})),cur.audioPage._data.playlists=cur.audioPage._data.playlists||[],cur.audioPage._data.playlists.unshift(i)),y&&cur.audioPage&&cur.audioPage.catalogController.updateSectionReorder(),cur.audioPage&&cur.audioPage.updatePlaylistsCounter&&cur.audioPage.updatePlaylistsCounter(t),L&&(L.clean(),L.mergeWith(e)),a.hide(!0),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_13__.isFunction)(s.onPlaylistSave)&&s.onPlaylistSave(L))},onFail:()=>(a.hide(!0),!0)})}function Y(e){show(_.coverThumb),setStyle(_.coverThumb,"background-image","url("+e+")"),addClass(_.uploadCoverButtonWrapper,"ape_thumb_set"),hide(_.uploadCoverButton)}function $(e){return removeClass(_.uploadCoverButtonWrapper,"ape_thumb_set"),hide(geByClass1("_ape_cover_thumb")),show(_.uploadCoverButton),v=-1,cancelEvent(e)}},AudioPage.prototype._deinitKeyEvents=function(){this._audioHQKeyEventHandler1&&removeEvent(window.document,"keydown",this._audioHQKeyEventHandler1),this._audioHQKeyEventHandler2&&removeEvent(window.document,"keyup",this._audioHQKeyEventHandler2),this._audioHQKeyEventHandler3&&removeEvent(window.document,"visibilitychange",this._audioHQKeyEventHandler3),this._audioHQKeyEventHandler4&&removeEvent(window.document,"mousedown",this._audioHQKeyEventHandler4),this._audioSeekKeyEventHandler&&removeEvent(window.document,"keydown",this._audioSeekKeyEventHandler)},AudioPage.prototype._initKeyEvents=function(){this._deinitKeyEvents();var e=getAudioPlayer(),t=()=>!this.isLayer()&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getLayer().isShown();addEvent(window.document,"mousedown",this._audioHQKeyEventHandler4=function(e){e.ctrlKey&&(cur.ctrlMouseDown=!0,cur.ctrlPressed=!1)},!0),addEvent(window.document,"keydown",this._audioHQKeyEventHandler1=function(e){t()||(cur.ctrlPressed=e.keyCode===KEY.CTRL)}),addEvent(window.document,"keyup",this._audioHQKeyEventHandler2=function(e){t()||(e.keyCode!==KEY.CTRL||cur.ctrlMouseDown)&&(delete cur.ctrlMouseDown,delete cur.ctrlPressed)}),addEvent(window.document,"keydown",this._audioSeekKeyEventHandler=function(i){var o=i.target,s=o&&inArray(o.tagName.toLowerCase(),["input","textarea"])&&""!==val(o),a=o&&o.isContentEditable,_=cur&&cur.pvShown;s||a||_||t()||!e.isPlaying()||!inArray(i.keyCode,[KEY.RIGHT,KEY.LEFT])||cur.wallLayer||i.ctrlKey||e.seekCurrentAudio(i.keyCode===KEY.RIGHT)}),cur.destroy.push(()=>this._deinitKeyEvents())},AudioPage.prototype.editFeed=function(){var e=this;showTabbedBox("al_settings.php",{act:"a_edit_owners_list",list:"audio",height:lastWindowHeight},{stat:[jsc("web/privacy.js"),"privacy.css","ui_controls.js","ui_controls.css",jsc("web/indexer.js")],dark:1}),cur.onOListSave=function(t,i,o,s){var a=curBox(),_={act:"a_ignore_olist",hash:s.hash};return t.length<i.length?_.White=t.join(","):_.Black=i.join(","),ajax.post("al_audio.php",_,{onDone:function(){a.hide(),e.getCurrentPlaylist().clean(),e.refreshCurrentPage()},onFail:()=>!0,showProgress:a.showProgress,hiderogress:a.hideProgress}),!1}},AudioPage.prototype.updateStatusExportControls=function(e){var t=getAudioPlayer(),i=t.getStatusExportInfo();each(geByClass("_audio_export_status",this._els.pageContainer),(function(){toggleClass(this,"on",i&&!!i[domData(this,"oid")])}));var o=t.hasStatusExport(),s=geByClass1("_audio_page_player_status",this._els.pageContainer);if(toggleClass(s,"audio_page_player_btn_enabled",o),!e)if(this.isLayer())cur.audioPage&&cur.audioPage.updateStatusExportControls(!0);else{var a=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getLayer().getPageInstance();a&&a.updateStatusExportControls(!0)}return!1},AudioPage.prototype.updateStatusExport=function(e,t){e&&checkbox(e),t=intval(t);var i,o,s=getAudioPlayer(),a=s.getStatusExportInfo()||{};if(t)a[t]?(delete a[t],i=!1):(a[t]=1,i=!0);else if(s.hasStatusExport()){for(var _ in a)a.hasOwnProperty(_)&&delete a[_];i=!1}else a[t=vk.id]=1,i=!0;s.setStatusExportInfo(a),t!=vk.id&&t||checkbox("currinfo_audio",s.hasStatusExport()),this.updateStatusExportControls();var l=s.getCurrentAudio();l&&(o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(l).fullId);s.stats.sendCurrentAudioEvent({type:_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.TYPE_BROADCASTING,subtype:i?_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.SUBTYPE_ON:_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.SUBTYPE_OFF,targetOwnerId:t}),ajax.post("al_audio.php?act=toggle_status",{exp:intval(i),oid:t,hash:vk.statusExportHash,id:o,top:intval(null)},{onFail:()=>!0})},AudioPage.prototype.playStatusAudio=function(e,t,i){var o=gpeByClass("_audio_friend",i);getAudioPlayer().playLive(e,{showProgress:showProgress.pbind(o),hideProgress:hideProgress.pbind(o)}),cancelEvent(t)},AudioPage.showActionTooltip=function(e,t){var i=[3,-8,0],o=currentAudioPage(e),s=o&&o.isLayer();hasClass(e,"_audio_page_player_add")?Object(_web_lib_feature_tooltips__WEBPACK_IMPORTED_MODULE_24__.audioShowActionTooltip)(e,i,s):(hasClass(e,"_audio_page_player_play_rate")&&(i[0]=-17),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_25__.showTooltip)(e,{text:t,black:1,shift:i,appendParentCls:"_audio_page_player",forcetodown:s,needLeft:s}))},AudioPage.prototype.onHide=function(){var e=this;cur.nav=cur.nav.filter((function(t){return e._nav_func!=t})),this._deinitKeyEvents()},AudioPage.prototype.showRecoms=function(e,t){if(!t){var i=this._readyAudio?this._readyAudio:getAudioPlayer().getCurrentAudio();t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(i).fullId}statlogsValueEvent("audio_recoms_by_track_button_click",!0),nav.go({0:"audios"+this.getOwnerId(),section:"recoms_audio",audio_id:t},null,{nocur:!0})},AudioPage.prototype.onAudioUploaded=function(e,t){if(t){var i=getAudioPlayer(),o=i.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_PLAYLIST,this.getOwnerId(),_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID);o.addAudio(t,0);var s=i.getCurrentPlaylist();s&&s.getSelf()==o&&s.addAudio(t),"all"!==this._currentSection&&this.resetSection("all");var a=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(t);Object(_web_audio_player_stat_onAdditionalEvent__WEBPACK_IMPORTED_MODULE_10__.onAdditionalEvent)(null,a,{type:_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.TYPE_ADDED,subtype:_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.SUBTYPE_UPLOAD,context:"on_audio_uploaded",playlistId:o.getOwnerId()+"_"+o.getPlaylistId()});var _=5,l=this;!function e(i){--_<0||setTimeout((function(){ajax.post("al_audio.php?act=check_audio_data",{audio_owner_id:a.ownerId,audio_id:a.id},{onDone:function(o){if(o){var s=o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]!=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_TITLE];(s=(s=s||o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]!=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER])||o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]!=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_FLAGS])&&(getAudioPlayer().updateAudio(a.fullId,o),"all"===l._currentSection&&"audio"===cur.module&&l._initAudioRowsAutoList(),a=o),e(1.5*i)}},onFail:()=>!0})}),i)}(1e3)}},AudioPage.prototype.onAudioAllUploaded=function(){"all"===this._currentSection&&nav.reload()},AudioPage.prototype.uploadAudio=function(e){this._data.uploadBanned?Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_18__.showFastBox)({title:getLang("global_error")},this._data.uploadBannedText):showBox("al_audio.php",extend(e||{},{act:"new_audio",gid:this.getOwnerId()<0?-this.getOwnerId():0}),{params:{width:"450px",bodyStyle:"padding: 0px; position: relative;"},dark:1})},AudioPage.prototype.editAudio=function(e,t,i){return showBox("al_audio.php",{act:"edit_audio_box",aid:t},{params:{width:"456px",bodyStyle:"padding: 20px; background-color: #F7F7F7;",hideButtons:1},dark:1}),i&&cancelEvent(i),!1},AudioPage.prototype.restoreRecommendation=function(e){var t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAudioFromEl(e,!0),i={act:"restore_recommendation",hash:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAudioExtra(t).recom.hash,audio_id:t.fullId};nav.objLoc.audio_id&&(i.recommendation_type="query"),nav.objLoc.album_id&&(i.recommendation_type="album"),ajax.post("al_audio.php",i,{onFail:()=>!0}),removeClass(e,"audio_row__deleted");var o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAddRestoreInfo(),s=o[t.fullId].removedCurrentPos,a=getAudioPlayer().getCurrentPlaylist();s>=0&&a&&a.getType()==_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_RECOM&&a.addAudio(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAudioFromEl(e),s),delete o[t.fullId],_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.onRowOver(e,!1,!0)},AudioPage.isInRecentPlayed=function(e){var t=gpeByClass("_audio_playlist",e);return!(!t||!hasClass(t,"audio_recent_rows"))&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(t,"playlist")},AudioPage.prototype.chooseFromMyAudios=function(e){var t=!1;AudioPage.editPlaylist(vk.id,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.DEFAULT_PLAYLIST_ID,"attach",{audioPickerButtonText:getLang("global_add"),playlistPickerButtonText:getLang("global_add"),onClose:()=>{t&&nav.reload()},onAudioChoose:(i,o,s)=>{var a=i.ctrlKey||i.metaKey;if(ajax.post("al_audio.php?act=add",{group_id:e,audio_owner_id:s.ownerId,audio_id:s.id,hash:s.addHash},{onDone:e=>{e&&(t=!0)},onFail:()=>!0}),a)o.innerHTML=getLang("audio_choose_added"),addClass(o,"ape_added");else{t=!0;var _=window.__bq;if(_)for(;_.count();)_.hideLast()}}})},AudioPage.prototype.updateShuffleButton=function(){var e=getAudioPlayer().getCurrentPlaylist()||this._pagePlaylist;if(e){var t=e.isShuffled()&&!e.isInitedSortedList();toggleClass(geByClass1("_audio_page_player_shuffle",this._els.pageContainer),"audio_page_player_btn_enabled",t),this.isLayer()&&cur.audioPage&&cur.audioPage.updateShuffleButton()}},AudioPage.prototype.togglePodcast=function(e,t){if(toggleClass(this._els.player,"audio_player_podcast",e),this._updatePlaybackRate(),!this.isPodcastPage()){this.isLayer()&&toggleClass(geByClass1("_audio_section_tab__current",this._els.pageContainer),"unshown",e||!getAudioPlayer().getCurrentPlaylist());var i=geByClass1("_audio_section_tab__podcast",this._els.pageContainer);toggle(i,e),i&&e&&(t=t||getAudioPlayer().getCurrentAudio(),attr(geByClass1("ui_tab",i),"href","podcasts"+t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]))}},AudioPage.prototype.updateFaveButton=function(){var e=getAudioPlayer().getCurrentFaveStatus(),t=geByClass1("audio_page_player_fave",this._els.player);t&&toggleClass(t,"activated",e)},AudioPage.prototype.toggleRepeat=function(){if(!this.isPodcastPage()){var e=getAudioPlayer();e.isRepeatAll()||e.isRepeatCurrentAudio()?e.toggleRepeatCurrentAudio():e.toggleRepeatAll(),this.updateRepeatButton()}},AudioPage.prototype.updateRepeatButton=function(){var e=geByClass("_audio_page_player_repeat");if(e&&e.length){var t=getAudioPlayer(),i=t.isRepeatAll(),o=t.isRepeatCurrentAudio();each(e,(e,t)=>{t.ariaLabel=t.ariaLabel&&AudioPage.getRepeatButtonText(),t.onmouseover=t.onmouseover&&AudioPage.showActionTooltip.bind(void 0,t,AudioPage.getRepeatButtonText),toggleClass(t,"audio_page_player_btn_enabled",i),toggleClass(t,"audio_page_player_btn_repeat_one",o)})}},AudioPage.getRepeatButtonText=function(){var e=getAudioPlayer(),t=e.isRepeatAll(),i=e.isRepeatCurrentAudio(),o="audio_repeat_tooltip";return t?o="audio_repeat_track_tooltip":i&&(o="audio_dont_repeat_tooltip"),getLang(o)},AudioPage.prototype.toggleShuffle=function(e){if(!this.isPodcastPage()){toggleClass(e,"audio_page_player_btn_enabled")&&statlogsValueEvent("audio_sort_stat","audio_sort","shuffle_player",this.isLayer()?"layer":"page");var t=getAudioPlayer().getCurrentPlaylist()||this._pagePlaylist;t.loadAll(function(){t.isShuffled()&&t.isInitedSortedList()?(t.shuffle(0),t.shuffle(irand(1,999999))):t.isShuffled()?t.shuffle(0):t.shuffle(irand(1,999999)),"current"===this._currentSection&&this._initAudioRowsAutoList(!0);var e=getAudioPlayer().getCurrentAudio()||t.getAudioAt(0);getAudioPlayer().play(e,t),this.updateShuffleButton()}.bind(this))}},AudioPage.prototype.toggleFave=function(e){var t=getAudioPlayer().getCurrentAudio()||this._readyAudio;_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(t)&&AudioPlayer.podcastToggleFave(e,t)},AudioPage.prototype.changePlaybackRate=function(e,t){var i=getAudioPlayer().getCurrentAudio()||this._readyAudio;_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(i)&&(getAudioPlayer().podcastChangePlaybackRate(!!t.shiftKey),this._updatePlaybackRate())},AudioPage.prototype._updatePlaybackRate=function(){var e=geByClass1("audio_page_player_play_rate",this._els.player);e&&val(geByClass1("btn_icon",e),AudioPlayer.podcastGetPlaybackRate()+"x")},AudioPage.prototype._getCurrentSearchParams=function(){var e=window.radioBtns["audio_search_type_"+intval(this.isLayer())],t=intval(this._searchSortFilter.selectedItems()[0][0]);return{performer:e&&e.val?1:null,lyrics:hasClass(geByClass1("_audio_fltr_with_lyrics",this._container),"on")?1:null,sort:t?1:null}},AudioPage.searchAudios=function(e,t,i){currentAudioPage(this).searchAudios(e,t,i)},AudioPage.prototype.searchAudios=function(e,t,i){this.lastQuery!==e&&(this.lastQuery=e,this._muteSearch?delete this._muteSearch:(e=trim(e),nav.change(extend(this._getCurrentSearchParams(),{q:e||null}),!1,{fromSearch:!0,globalQuery:e,fromHistory:i,isLayer:this.isLayer()})))},AudioPage.prototype.onUserAction=function(e,t){var i=t.indexOfAudio(e);if(-1!=+i&&t.getType()===_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_SEARCH&&(!(t.getOwnerId()===vk.id&&i>=0&&i<t.getLocalFoundCount())&&t.getSearchParams())){var o=t.getSearchParams();o.globalQuery&&uiSearch.saveHistorySearch(this.searchInputEl,o.globalQuery,e.ownerId,e.id,t.getTotalCount(),t.getTotalCountHash())}},AudioPage.prototype._updateFriendsList=function(e,t,i){if(e=trim(e),this._friendSearchInProgress=!1,e){var o=geByClass1("_audio_friends_list",this._els.pageContainer),s=se('<div class="audio_friends_list _audio_friends_list" style="">'+e+"</div>");i&&(this._shownFriends=[]),domPN(o).appendChild(s),re(o)}},AudioPage.prototype.shareAudio=function(){var e=e||getAudioPlayer().getCurrentAudio()||this._readyAudio;_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.shareAudio(!1,e)},AudioPage.prototype.showStatusTooltip=function(e){this.statusTT||(this.statusTT=!0,ajax.post("al_audio.php?act=status_tt",{},{onDone:(t,i)=>{this.statusTT=new ElementTooltip(e,{content:i,width:250,offset:[1,14],elClassWhenShown:"audio_status_tt_shown",id:"audio_status_tt",onFirstTimeShow:function(e){this.sb=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_14__.default(geByClass1("audio_status_wrap",e),{global:!0})},onShow:function(){setTimeout(function(){this.statusTT.sb.update()}.bind(this),0)}.bind(this)}),cur._onStatusExportBtn&&(this.statusTT.show(),this.statusTT.sb.update())},onFail:()=>!0}))},AudioPage.prototype.isLayer=function(){return this._data.isLayer},AudioPage.prototype.isPodcastPage=function(){return!this.isLayer()&&!!this._data.podcastPage},AudioPage.prototype.destroy=function(){this._trackSlider&&this._trackSlider.destroy(),this._volumeSlider&&this._volumeSlider.destroy(),removeEvent(window,"scroll",this._ev_onScroll)},AudioPage.prototype.getPageCurrentPlaylist=function(){return this._pagePlaylist},AudioPage.prototype.clearCurrentPlaylist=function(){if(this.isLayer()){var e=getAudioPlayer();e.deleteCurrentPlaylist();var t=geByClass1("_audio_section_tab__current",this._els.pageContainer);addClass(t,"unshown"),uiTabs.switchTab(domFC(geByClass1("_audio_section_tab__all",this._els.pageContainer)),{noAnim:!0}),this.updateCurrentPlayingInfo(),this.togglePodcast(!1),this.showSection("all",()=>{var t,i=(t=e.getPlaylistsByType(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_MY).find(e=>e.getAudiosList().length))&&t.getUnshuffledAudiosList()[0];i&&(this._readyAudio=i,this._initPlayer(!0),this.isLayer()&&cur.audioPage&&(cur.audioPage._readyAudio=i,cur.audioPage._initPlayer(!0)))}),this.updateLayerHeight()}},AudioPage.prototype.setTooltipTitle=function(e){if(!e.titleSet){var t=geByClass1("audio_page_player_title_performer",e),i=geByClass1("audio_page_player_title_song",e);(t.scrollWidth>t.clientWidth||i.scrollWidth>i.clientWidth)&&e.setAttribute("title",e.innerText),e.titleSet=!0}},AudioPage.prototype._initPlayer=function(e){var t=this,i=getAudioPlayer(),o=this._els.pageContainer,s=geByClass1("_audio_page_player",o),a=geByClass1("audio_page_player_title",s),_=geByClass1("audio_page_player_title_performer",s),l=geByClass1("audio_page_player_title_song",s),r=geByClass1("audio_page_player_title_song_title",s),n=geByClass1("audio_page_player_title_song_subtitle",s),d=geByClass1("audio_page_player_duration",s),u=geByClass1("_audio_page_player__cover",s),c=geByClass1("_audio_page_player_play",s),h=geByClass1("_play_blind_label",c),p=geByClass1("_audio_page_player_add",s),g=void 0;function y(e){if(i.ads.isPlaying())_.innerHTML=getLang("global_audio_ad"),setStyle(l,"display","none"),toggleClass(s,"audio_song_is_explicit",!1);else{var o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAudioPerformers(e);e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(e),setStyle(l,"display","block"),_.innerHTML=geByClass1("audio_page_player2")?o:e.performer,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(e)?r.innerHTML=`<a href="/podcast${e.fullId}" onclick="return showPodcast(this, '${e.fullId}', event, 'player');" class="audio_player_podcast_title">${e.title}</a>`:r.innerHTML=e.title,n.innerHTML=e.subTitle?e.subTitle:"",e.coverUrl_p?(setStyle(u,"background-image","url("+e.coverUrl_p+")"),setStyle(u,"background-size","cover")):(setStyle(u,"background-image",null),setStyle(u,"background-size","")),toggleClass(s,"audio_title_long_performer",e.isLongPerformer),toggleClass(s,"audio_song_is_explicit",e.isExplicit),!t.isLayer()&&i.getCurrentAudio()&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(i.getCurrentAudio()).fullId==e.fullId&&(setDocumentTitle(replaceEntities(stripHTML(e.performer+" — "+e.title))),clearTimeout(window.pageSetTitleTimer)),l&&setStyle(l,"display","none"),_&&setStyle(_,"display","none"),requestAnimationFrame(()=>{var e=i.ads.isPlaying()?"none":"block";l&&setStyle(l,"display",e),_&&setStyle(_,"display","block")})}}function P(e,t){return t=intval(t),AudioPlayer.getDurationType()&&1!=e?"-"+formatTime(Math.round(t-e*t)):formatTime(Math.round(e*t))}function E(){if(t._trackSlider){var e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(i.getCurrentAudio()||t._readyAudio);if(e){var o;o=t.getOwnerId()<0&&t.canAddToGroup()?e.ownerId!=t.getOwnerId():e.ownerId!=vk.id,g!==o&&(toggle(p,o),g=o),cur._audioAddRestoreInfo=cur._audioAddRestoreInfo||{};var s=cur._audioAddRestoreInfo[e.fullId];addClass(p,"no_transition"),toggleClass(p,"audio_player_btn_added",!(!s||"added"!=s.state)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClassDelayed)(p,"no_transition"),t.updateRepeatButton()}}}if(!this._trackSlider){var A=i.ads.isPlaying()?i.ads.getCurrentProgress():i.getCurrentProgress(),f=i.ads.isPlaying()?0:i.getCurrentBuffered(),b=geByClass1("audio_page_player_track_slider",s),v=geByClass1("audio_page_player_volume_slider",s);b&&(this._trackSlider=new _web_legacy_ui_slider__WEBPACK_IMPORTED_MODULE_15__.default(b,{value:A,backValue:f,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>{var t=i.getCurrentAudio()||this._readyAudio;return t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(t),formatTime(Math.round(e*(t?t.duration:0)))},onEndDragging:e=>{var t=i.getCurrentAudio()||this._readyAudio;(t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(t))&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(t)&&i.podcastSetActionRef(t,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.PodcastsLogs.ACTION_SEEK,"",s),i.seek(e)}}),i.ads.isPlaying()&&(this._trackSlider.toggleAdState(!0),this.toggleRemoveAdsLink(!0))),v&&(this._volumeSlider=new _web_legacy_ui_slider__WEBPACK_IMPORTED_MODULE_15__.default(v,{value:i.getVolume(),size:1,hintClass:"audio_player_hint",log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>{i.setVolume(e)}})),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_DEINITED,()=>{}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_READY,()=>{}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_STARTED,()=>{this.toggleRemoveAdsLink(!0),this._trackSlider&&(this._trackSlider.toggleAdState(!0),this._trackSlider.setBackValue(0))}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_COMPLETED,()=>{this.toggleRemoveAdsLink(!1),this._trackSlider&&this._trackSlider.toggleAdState(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.START_LOADING,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!0)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.CAN_PLAY,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.ADDED,(e,t)=>{(e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(e))&&e.fullId==t&&addClass(p,"audio_player_btn_added")}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.REMOVED,(e,t)=>{(e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(e))&&e.fullId==t&&removeClass(p,"audio_player_btn_added")}),i.on(this,[_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PLAY,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PLAY_REQUESTED],(e,t,o)=>{delete this._readyAudio,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(s,"audio",e),E(),y(e),addClass(c,"audio_playing"),t&&!cur.audioStartReadyAudio&&(this._trackSlider&&this._trackSlider.setBackValue(0),i.ads.isPlaying()||(d.innerHTML=P(0,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(e).duration)),a.setAttribute("title",""),a.titleSet=!1),h.innerHTML=getLang("global_audio_pause"),this.updateCurrentPlayingInfo(),this.updateShuffleButton(),this.updateFaveButton()}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PAUSE,()=>{removeClass(c,"audio_playing"),h.innerHTML=getLang("global_audio_play")}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.STOP,()=>{removeClass(c,"audio_playing"),h.innerHTML=getLang("global_audio_play")}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.BUFFERED,(e,t)=>{this._trackSlider&&this._trackSlider.setBackValue(t)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.VOLUME,(e,t)=>{this._volumeSlider&&this._volumeSlider.setValue(t,!0)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.ENDED,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.UPDATE,(e,t)=>{e&&y(e),i.ads.isPlaying()||e&&t&&(d.innerHTML=P(t,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(e).duration))}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PROGRESS,(e,t,i)=>{this._trackSlider&&(this._trackSlider.toggleLoading(!1),this._trackSlider.setValue(t)),isUndefined(i)||isNaN(i)||(d.innerHTML=P(t,i))}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.FAILED,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.CURRENT_CHANGED,()=>{var e=i.getCurrentAudio()||this._readyAudio;domData(this._els.player,"audio",JSON.stringify(e)),this.togglePodcast(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(e),e),this._trackSlider.setValue(0)})}var C=i.getCurrentAudio()||this._readyAudio;C&&(domData(s,"audio",JSON.stringify(C)),y(C),toggleClass(c,"audio_playing",i.isPlaying()),d.innerHTML=P(1,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(C).duration),e&&this._trackSlider&&(this._trackSlider.setValue(0),this._trackSlider.setBackValue(0),this._trackSlider.toggleLoading(!1))),E();var w=i.getCurrentAudio()||this._readyAudio;this.togglePodcast(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isPodcast(w),w),this.isLayer()||this._initFixedPlayer()},AudioPage.prototype._initFixedPlayer=function(){var e=getSize(this._els.playerWrap);setStyle(this._els.playerWrap,{width:e[0],height:e[1]});var t=getSize(this._els.player);setStyle(this._els.player,{width:t[0],height:t[1]});var i,o,s=getSize("page_header_wrap")[1],a=getXY(this._els.contentBlock)[1],_=getXY(this._els.playerWrap)[1]+getSize(this._els.playerWrap)[1]-s,l=!1,r=()=>{var e=scrollGetY(),t=e>a;if(e<_&&(i||l))return clearTimeout(i),clearTimeout(o),removeClass(this._els.player,"audio_page_player_fixed_shown"),removeClass(this._els.player,"audio_page_player_fixed"),void(l=i=!1);t&&!l&&(clearTimeout(i),i=0,addClass(this._els.player,"audio_page_player_fixed"),o=setTimeout(()=>addClass(this._els.player,"audio_page_player_fixed_shown")),l=!0),!t&&l&&(clearTimeout(i),i=0,removeClass(this._els.player,"audio_page_player_fixed_shown"),i=setTimeout(()=>{removeClass(this._els.player,"audio_page_player_fixed"),i=!1},250),l=!1)};addEvent(window,"scroll",r),cur.destroy.push(()=>{r&&removeEvent(window,"scroll",r)})},AudioPage.prototype.togglePlayerPlay=function(e){var t=getAudioPlayer();if(t.isPlaying()){var i=t.getCurrentAudio();i&&t.podcastSetActionRef(i,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.PodcastsLogs.ACTION_PAUSE,"",e),t.pause()}else{var o,s=this.getPageCurrentPlaylist(),a=t.getCurrentPlaylist(),_=t.getCurrentAudio()||this._readyAudio;if(_=_||s.getAudioAt(0),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.isClaimedAudio(_)){_=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.asObject(_);var l=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.getAudioExtra(_).claim;return void Object(_web_lib_feature_boxes__WEBPACK_IMPORTED_MODULE_16__.showAudioClaimWarning)(_,l)}s&&-1!==s.indexOfAudio(_)?o=s:a&&-1!==a.indexOfAudio(_)?o=a:(o=new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_12__.AudioPlaylist.TYPE_TEMP,vk.id)).addAudio(_),delete this._readyAudio,cur.audioStartReadyAudio=!0,t.podcastSetActionRef(_,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_26__.AudioUtils.PodcastsLogs.ACTION_PLAY,"",e),t.play(_,o)}},AudioPage.prototype.promoAlbumSlideInit=function(){var e=geByClass1("audio_promo");if(!this.isLayer()&&e){var t=geByClass1("audio_promo__items",e);if(t&&!(t.children.length<=1)){this.promoAlbumSlideAutoStart(t);var i=()=>this.promoAlbumSlideAutoStop(),o=()=>this.promoAlbumSlideAutoStart(t);addEvent(e,"mouseenter",i),addEvent(e,"mouseleave",o),window.cur&&cur.destroy.push(()=>{this.promoAlbumSlideAutoStop(),removeEvent(e,"mouseenter",i),removeEvent(e,"mouseleave",o)})}}},AudioPage.prototype.promoAlbumSlideAutoStart=function(e){window.cur&&(cur._promoAlbumSlideTO=setTimeout(()=>this.promoAlbumSlide(e,1),SLIDER_TIMEOUT))},AudioPage.prototype.promoAlbumSlideAutoStop=function(){window.cur&&clearTimeout(cur._promoAlbumSlideTO)},AudioPage.prototype.promoAlbumSlide=function(e,t){var i=vk.rtl?t>0?-1:1:t<0?-1:1,o=gpeByClass("audio_promo",e);if(o){var s=geByClass1("audio_promo__items",o);if(s&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(s,"sliding")){this.promoAlbumSlideAutoStop();var a=s.scrollLeft,_=s.offsetWidth,l=s.children,r=l.length,n=e=>vk.rtl?s.scrollWidth-e*_-_:e*_;if(l.length>1){this.promoAlbumSlideAutoStart(e);var d=!1,u=null,c=!1,h=Math.round(a/_);(h+=i)>=r||h<0?(d=l[0].cloneNode(!0),s.appendChild(d),h>=r?(c=!0,u=n(h)):h<0&&(s.scrollLeft=n(r),u=n(h=r-1))):u=n(h),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(s,"sliding",!0),animate(s,{scrollLeft:u},{duration:500,transition:Fx.Transitions.swiftOut,onComplete:()=>{c&&(s.scrollLeft=n(0)),d&&re(d),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(s,"sliding",!1)}})}}}},AudioPage.prototype.toggleRemoveAdsLink=function(e){toggleClass(this._els.player,"audio_page_player_show_remove_ads",!!e)}},127:function(e,t,i){e.exports=i("9IjV")},"9IjV":function(e,t,i){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t.querySelector(e)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t.querySelectorAll(e)}i.r(t),window.$=o,window.$$=s,function(){HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll;try{SVGElement.prototype.$=SVGElement.prototype.querySelector,SVGElement.prototype.$$=SVGElement.prototype.querySelectorAll}catch(e){}}();var a=i("rEJs"),_=i("/PiP"),l=i("Se/q"),r=i("wtP8"),n=i("Oupy"),d=i("D33C"),u=i("/rxS");class c{constructor(e,t){this.playlistElement=o("#playlist-"+e),this.playlist=t,this.playlistList=o(`.${c.playListClass}__list`,this.playlistElement),this.playlistListAll=o(`.${c.actionButtonsClass}--all`,this.playlistList),this.audio={},this.audioElements=s(`.${c.playListClass}__audioRow`,this.playlistList);for(var i=0;i<this.audioElements.length;i++)this.audio[this.audioElements[i].dataset.fullId]=this.audioElements[i];this.body=o(`.${c.playListClass}__body`,this.playlistElement),this.shuffle=o(`.${c.actionButtonsClass}--shuffle`,this.body),this.actions=o(`.${c.playListClass}__actions`,this.playlistElement),this.actions&&(this.add=o(`.${c.actionButtonsClass}--add`,this.actions),this.addText=o(`.${c.actionButtonsClass}--add__text`,this.add),this.share=o(`.${c.actionButtonsClass}--share`,this.actions),this.add.addEventListener("click",this.addPlayList.bind(this)),this.share.addEventListener("click",this.sharePlayList.bind(this))),this.menu=o(`.${c.menuButtonsClass}__inner`,this.playlistElement),this.menu&&(this.playNext=o(`.${c.menuButtonsClass}__item--playNext`,this.menu),this.editPlaylist=o(`.${c.menuButtonsClass}__item--editPlaylist`,this.menu),this.deletePlaylist=o(`.${c.menuButtonsClass}__item--deletePlaylist`,this.menu),this.addToGroup=o(`.${c.menuButtonsClass}__item--addToGroup`,this.menu),this.removeFromGroup=o(`.${c.menuButtonsClass}__item--removeFromGroup`,this.menu),this.copyLink=o(`.${c.menuButtonsClass}__item--copyLink`,this.menu)),this.play=o(`.${c.playListClass}__play`,this.playlistElement),this.play&&(this.player=getAudioPlayer(),this.player.addPlaylist(new d.AudioPlaylist(this.playlist,this.playlist.ownerId,this.playlist.albumId)),this.player.on(this.playlist.context,a.events.PLAY,this.onPlay.bind(this)),this.player.on(this.playlist.context,a.events.PAUSE,this.onStop.bind(this)),this.player.on(this.playlist.context,a.events.STOP,this.onStop.bind(this)),this.play.addEventListener("click",this.playSong.bind(this)),this.playlistList.addEventListener("click",this.playFromList.bind(this))),this.playlistListAll&&this.playlistListAll.addEventListener("click",this.showAllAudio.bind(this)),this.shuffle&&this.shuffle.addEventListener("click",this.shufflePlayList.bind(this)),this.playNext&&this.playNext.addEventListener("click",this.playNextSong.bind(this)),this.editPlaylist&&this.editPlaylist.addEventListener("click",this.handleEditPlaylist.bind(this)),this.deletePlaylist&&this.deletePlaylist.addEventListener("click",this.handleDeletePlaylist.bind(this)),this.addToGroup&&this.addToGroup.addEventListener("click",this.handleAddToGroup.bind(this)),this.removeFromGroup&&this.removeFromGroup.addEventListener("click",this.handleRemoveFromGroup.bind(this)),this.copyLink&&this.copyLink.addEventListener("click",this.copyPlayListLink.bind(this))}showAllAudio(){this.playlistList.classList.add(c.playListClass+"__list--all")}shufflePlayList(){this.showAllAudio(),this.player.playPlaylist(this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash,this.playlist.context,!0)}addPlayList(){AudioUtils.followPlaylist(this.addText,this.playlist.ownerId,this.playlist.albumId,this.playlist.followHash),this.add.classList.toggle(c.actionButtonsClass+"--add--added"),this.add.classList.contains(c.actionButtonsClass+"--add--added")?this.addText.innerText=this.addText.dataset.textFollowed:this.addText.innerText=this.addText.dataset.textFollow}sharePlayList(e){Object(_.shareAudioPlaylist)(e,this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash)}playNextSong(){this.player.playNextPlaylist(this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash,this.playlist.context)}copyPlayListLink(){AudioUtils.copyPlaylistLink(this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash)}playSong(){this.isCurrentPlaylist()?!0===this.isPlaying?this.player.pause():this.player.play():this.player.playPlaylist(this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash,this.playlist.context)}playFromList(e){var t,i=e.target;if(-1!==i.className.indexOf("AudioRow")){for(;i&&!i.classList.contains(c.playListClass+"__audioRow");)i=i.parentNode;t=i.dataset.id}if(t){var o=this.player.getPlaylist(this.playlist.type,this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash);this.player.play(t,o,this.playlist.context)}}onPlay(){this.isCurrentPlaylist()&&(this.isPlaying=!0,this.play.classList.add(c.playListClass+"__stop"),this.play.classList.remove(c.playListClass+"__play"))}onStop(){this.isCurrentPlaylist()&&(this.isPlaying=!1,this.play.classList.add(c.playListClass+"__play"),this.play.classList.remove(c.playListClass+"__stop"))}isCurrentPlaylist(){var e=this.player.getCurrentAudio();return Boolean(e)&&this.playlist.list.some(t=>t[0]===e[0]&&t[1]===e[1])}handleEditPlaylist(){Object(n.editPlaylist)(this.playlist.ownerId,this.playlist.albumId,"edit",{onPlaylistSave:()=>nav.reload()})}handleDeletePlaylist(){u.AudioPage.deletePlaylist(this.playlist.ownerId,this.playlist.albumId,this.playlist.editHash)}handleAddToGroup(){Object(r.addToGroupBox)(this.playlist.ownerId,this.playlist.albumId,this.playlist.accessHash)}handleRemoveFromGroup(){Object(l.removeFromGroup)(this.playlist.ownerId,this.playlist.albumId,this.playlist.followHash)}}c.playListClass="AudioPlaylistSnippet",c.actionButtonsClass="ActionButton",c.menuButtonsClass="ActionsMenu";var h=i("4mg9");window.AudioPage||(window.AudioPage=u.AudioPage,window.currentAudioPage=u.currentAudioPage),window.PlayList||(window.PlayList=c),window.BlockController=h.BlockController;try{window.stManager.done(window.jsc("web/audio.js"))}catch(e){}},RdBX:function(e,t,i){"use strict";i.r(t),i.d(t,"vkIndexer",(function(){return o}));i("Vd3H"),i("OG14"),i("a1Th"),i("Btvt"),i("KKXr"),i("Oyvg");function o(e,t,i){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=i||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}o.prototype.delimiter=o.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),o.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),o.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},o.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},o.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},o.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var i=this.list[t];try{i._order=t}catch(e){}this.add(i)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},o.prototype.strToPrefixes=function(e){for(var t={},i=winToUtf(e).toLowerCase().split(this.delimiter),o=i.length;o--;){var s=i[o],a="";if(s){for(var _=0;_<6;_++){var l=s.charCodeAt(_);if(l){var r=this.toTranslit[l],n=s.substr(_,1);a+=null!=r?r:n}}t[a]=1}}return t},o.prototype.strToSearchPrefixes=function(e){for(var t=[],i=e.toLowerCase().split(this.delimiter),o=i.length;o--;){var s={},a=i[o],_="",l="",r="",n=a.length>1;if(a){for(var d=0;d<6;d++){var u=a.charCodeAt(d);if(u){var c=this.toTranslit[u],h=a.substr(d,1);if(_+=null!=c?c:h,n){var p=this.toLocalCase[h],g=this.toLocalTranslit[u];l+=null!=p?p:h,r+=null!=g?g:h}}}s[_]=1,n&&(s[l]=2,s[r]=3),t.push(s)}}return t},o.prototype.toIndexTree=function(e,t){for(var i=this.index,o=0;o<6;o++){var s=e.substr(o,1)||-1;i=i[s]?i[s]:i[s]=5==o?[]:{}}i.push(t)},o.prototype.remove=function(e){var t=this.prepareFunc(e),i=this.strToPrefixes(t);for(var o in i)if(i.hasOwnProperty(o)){for(var s=this.index,a=0;a<6;a++){var _=o.substr(a,1)||-1;if(!s[_])break;s=s[_]}if(s.length)for(var l in s)if(this.equals(s[l],e)){s.splice(l,1);break}}},o.prototype.equals=function(e,t){for(var i in e)if(e.hasOwnProperty(i))switch(typeof e[i]){case"object":if(!this.equals(e[i],t[i]))return!1;break;case"function":if(void 0===e[i]||e[i].toString()!=t[i].toString())return!1;break;default:if(e[i]!=t[i])return!1}for(var o in t)if(void 0===t[o])return!1;return!0},o.prototype.intersect=function(e,t){var i=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&i.push(e.shift()),t.shift());return i},o.prototype.add=function(e){var t=this.prepareFunc(e),i=this.strToPrefixes(t);for(var o in i)i.hasOwnProperty(o)&&this.toIndexTree(o,e)},o.prototype.search=function(e){var t=this.index,i=this.strToSearchPrefixes(e),o=[],s=!1;for(var a in i)if(i.hasOwnProperty(a)){if(s&&!o)break;var _=this.localSearch(i[a],0,t);_.sort((function(e,t){return e._order-t._order})),o=s?this.intersect(o,_):_,s=!0}for(var l=o[0],r=o.length+1,n=[],d=1;d<r;d++){var u=o[d];u!=l&&(n.push(l),l=u)}return n},o.prototype.localSearch=function(e,t,i){if(!i)return[];var o={};for(var s in e)if(e.hasOwnProperty(s)){var a=s.substr(t,1)||-1;o[a]||(o[a]={}),o[a][s]=1}if(6==t++||!i)return i;var _=[];for(var l in o)if(-1==l)for(var r in i)i.hasOwnProperty(r)&&_.push.apply(_,this.localSearch(o[l],t,i[r]));else{var n=this.localSearch(o[l],t,i[l]);_.push.apply(_,n)}return _}},gUSy:function(e,t,i){"use strict";i.r(t);var o=i("zxIV"),s=i("Egk5"),a=i("BJj/");function _(e,t){if(this.constructor!=_)throw new Error("Slider was called without 'new' operator");if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},this.options.backValue=this.options.backValue||0;var i=100*this.options.backValue,s=`<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> ${this.options.withBackLine?'<div class="slider_back" style="width:'+i+'%"></div>':""} <div class="slider_amount"></div> <div class="slider_handler"></div> </div>`;this._el=ce("div",{innerHTML:s,className:"slider",id:e.getAttribute("id")||""});for(var l=e.classList||[],r=this,n=0,d=l.length;n<d;n++)addClass(this._el,l[n]);each(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||r._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),Object(o.data)(this._el,"slider",this),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.handlerColor&&setStyle(this._handlerEl,{backgroundColor:this.options.handlerColor}),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=Object(a.debounce)(this._onValueChange,this.options.debounce)),t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}_.prototype.toggleAdState=function(e){this._adState=!!e,Object(o.toggleClass)(this._el,"slider_ad_mode",!!e)},_.prototype.toggleAdMarker=function(e){e=!!e;var t=geByClass1("slider_ad_marker",this._el);if(e){if(!t){var i="onmouseover=\"showTooltip(this, {text: '"+getLang("global_audio_ad")+"', black: 1, shift: [16, 9, 10]})\"";t=Object(o.se)('<div class="slider_ad_marker_wrap" '+i+'><div class="slider_ad_marker"></div></div>'),Object(o.domPN)(this._slideEl).insertBefore(t,this._slideEl),delete this._width,addClass(this._el,"slider_ad_marker_shown")}}else Object(o.re)(t),delete this._width,removeClass(this._el,"slider_ad_marker_shown")},_.prototype.showAdMarker=function(e){var t=Object(o.se)('<div class="slider_ad_marker"></div>');Object(o.domPN)(this._slideEl).insertBefore(t,this._slideEl),delete this._width,addClass(this._el,"slider_ad_marker_shown")},_.prototype.isAdMode=function(){return hasClass(this._el,"slider_ad_mode")},_.prototype.setBlocked=function(e){this.blocked=e,addClass(this._el,"slider_blocked")},_.prototype.getBlocked=function(){return this.blocked},_.prototype.isBlocked=function(){return this.isAdMode()||this.getBlocked()},_.prototype.toggleLoading=function(e){e=!!e,Object(o.toggle)(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},_.prototype.destroy=function(e){this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown)),Object(o.re)(this._el),Object(o.re)(this._currHintEl)},_.prototype._updateHint=function(e,t){this._currHintEl||(this._currHintEl=Object(o.se)('<div class="slider_hint" id="slider_hint"></div>'),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl)),this._width=this._width||getSize(this._slideEl)[0];var i=this._getPos(),s=Math.round(e.pageX-i[0]),a=this._width;if((s=t?Math.min(Math.max(0,s),a):s)>=0&&s<=a){var _=s/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,_):_;var l=getSize(this._currHintEl);setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+s-l[0]/2,top:this._slideEl.offsetTop-l[1]-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},_.prototype._toggleHint=function(e){this.isAdMode()&&(e=!1),Object(o.toggleClass)(this._currHintEl,"visible",e)},_.prototype._onMouseOver=function(e){_._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(e)},_.prototype._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},_.prototype._onMouseDown=function(e){0==e.button&&(delete cur._sliderMouseUpNowEl,this._adState||this.getBlocked()||(addEvent(window,"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._width=getSize(this._slideEl)[0],this._onMouseMove(e),_._currenSliderDrag=this,addClass(this._el,"active"),Object(s.cancelEvent)(e)))},_.prototype._onMouseUp=function(e){cur._sliderMouseUpNowEl=this._el,removeEvent(window,"mousemove",this._ev_onMouseMove),removeEvent(window,"mouseup",this._ev_onMouseUp),clearTimeout(this._debounceto),this._onValueChange(),removeClass(this._el,"active"),_._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue)},_.prototype._onMouseMove=function(e){var t=this._getPos(),i=Math.max(e.pageX,t[0]);i=Math.min(i,t[0]+this._width),i-=t[0],this.setValue(i/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),Object(s.cancelEvent)(e)},_.prototype._getPos=function(){return this._slidePos=getXY(this._slideEl)},_.LOGFBASE=35,_.prototype._logf=function(e){if(!this.options.log)return e;var t=_.LOGFBASE;return(Math.pow(t,e)-1)/(t-1)},_.prototype._unlogf=function(e){if(!this.options.log)return e;var t,i,o=_.LOGFBASE;return t=o,i=1+e*(o-1),Math.log(i)/Math.log(t)},_.prototype.setValue=function(e,t,i){if(!hasClass(this._el,"active")||i){var o=i?this._logf(e):e;if(this._currValue!=o){this._currValue=o;var s=i?e:this._unlogf(e);s=100*s+"%",setStyle(this._amountEl,{width:s}),setStyle(this._handlerEl,{left:s}),!t&&this._onValueChange()}}},_.prototype.setBackValue=function(e){Object(o.toggleClass)(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},_.prototype._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},t.default=_},qrDO:function(e,t,i){"use strict";i.r(t),i.d(t,"CatalogController",(function(){return c}));var o,s=i("D33C"),a=i("ldAL"),_=i("4mg9"),l=i("vDiJ"),r=i("TmuT"),n=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),d=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var o=Array(e),s=0;for(t=0;t<i;t++)for(var a=arguments[t],_=0,l=a.length;_<l;_++,s++)o[s]=a[_];return o},u=function(e){function t(t,i){var o=e.call(this)||this;o.sectionData=i;var s=t.classList.contains(l.SECTION)?t:t.querySelector("."+l.SECTION);return s?(o.sectionEl=s,o.initBlocks(),o.nextFrom=void 0===o.sectionEl.dataset.next?i.nextFrom:o.sectionEl.dataset.next,o.id=i.sectionId,i.playlists&&i.playlists.length&&o.addPlaylists(i.playlists),i.playlist&&o.setPagePlaylist(i.playlist),o.isBlockPagination=o.sectionData.isBlockPagination,o.initSectionAutoList(),o.hideShowMoreLoaders(),o.sectionInited(),o):o}return n(t,e),t.prototype.getSectionElement=function(){return this.sectionEl},t.prototype.sectionInited=function(){this.blocks.forEach((function(e){return e.onSectionInit()}))},t.prototype.destroy=function(){this.sectionAutoList&&this.sectionAutoList.destroy(),this.blocks&&this.blocks.forEach((function(e){return e.destroy()}))},t.prototype.getBlockById=function(e){return this.blocks&&this.blocks.find((function(t){return t.getId()===e}))||null},t.prototype.reloadBlock=function(e){var t=this.findBlockByBlockName(e);t&&t.reloadData()},t.prototype.updateReorder=function(){this.blocks&&this.blocks.forEach((function(e){e.updateListReorder()}))},t.prototype.hideShowMoreLoaders=function(){this.blocks.forEach((function(e){return e.hideLoader()}))},t.prototype.addPlaylists=function(e){var t=window.getAudioPlayer();e.forEach((function(e){if(e){var i=new s.AudioPlaylist(e);i.getAudiosList().length||i.mergeWith(e),t.addPlaylist(i)}}))},t.prototype.setPagePlaylist=function(e){var t=window.currentAudioPage(this.sectionEl),i=window.getAudioPlayer().getPlaylist(e.type,e.ownerId,e.id,"",e.blockId);i.getAudiosCount()||(i.mergeWith(e),i.load()),t.setPagePlaylist(i)},t.prototype.setNextFrom=function(e){this.nextFrom=e,this.sectionEl&&(this.sectionEl.dataset.next=e)},t.prototype.initSectionAutoList=function(){var e=this;this.sectionAutoList=new a.default(this.sectionEl,{fetchImmediate:!1,onNeedRows:function(t){var i;if(e.isBlockPagination)return e.initBlockAutoList(),void t(null);e.nextFrom?(null===(i=e.paginatedBlockController)||void 0===i||i.showLoader(),e.fetchNext().then((function(i){var o=i.blocks,s=i.data,a=i.blockItems;(e.nextFrom=s.nextFrom,e.setNextFrom(s.nextFrom),s.isBlockPagination)?(t(null),e.initBlockAutoList(a,e.nextFrom),s.playlist&&"search"===s.playlist.type&&window.getAudioPlayer().getPlaylist().sendSearchStats("search_view")):(s.playlists&&e.addPlaylists(s.playlists),t(o||null),e.initBlocks())})).catch((function(){}))):t(null)}})},t.prototype.initBlocks=function(){var e=this;this.blocks=d(this.sectionEl.getElementsByClassName(l.BLOCK_ELEMENT)).map((function(t){return new _.BlockController(e,t)}));var t=this.sectionEl.querySelector("."+l.PAGINATED_BLOCKS_CONTAINER);if(t){var i=d(t.getElementsByClassName(l.BLOCK_CONTENT)),o=i[i.length-1].dataset.id;o&&(this.paginatedBlockController=this.getBlockById(o))}else this.paginatedBlockController=this.blocks[this.blocks.length-1]},t.prototype.initBlockAutoList=function(e,t){void 0===e&&(e=[]),this.paginatedBlockController&&(void 0!==t&&this.paginatedBlockController.setNextFrom(t),this.paginatedBlockController.initAutoList(e))},t.prototype.findBlockByBlockName=function(e){return this.blocks.find((function(t){return t.hasBlockName(e)}))},t}(r.BaseController),c=function(){function e(e){this.root=e;var t=this.root.querySelector(".CatalogSection--header_section");t instanceof HTMLElement&&(this.headerSection=new u(t,{}))}return e.prototype.setSection=function(e,t){this.currentSection&&this.currentSection.destroy(),this.currentSection=new u(e,t)},e.prototype.updateSectionReorder=function(){this.currentSection&&this.currentSection.updateReorder()},e}()}});