!function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={"web/calls":0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(){return Promise.resolve()},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([141,"common","palette","1cac183b8851071aa94890b5b99ff74a","vendors","ce10c8a950c9293c31cd32e7ec389138","97eb3afca142bb7a7187dda4654ffe58"]),n()}({"/oKx":function(e,t,n){"use strict";var r=n("zMZw"),i=n("LQSR");function a(e){"number"==typeof e.mid&&(e.mid=e.mid.toString())}function o(){this.cache={mlB2UMap:{},mlU2BMap:{}}}e.exports=o,o.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},o.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},o.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=r.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},o.prototype.toPlanB=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Unified Plan."),e;for(var o=e.sdp,c=!1,l=0;l<n.media.length;l++){n.media[l].rtp.forEach((function(e){if("NULL"===e.codec){c=!0;var n=r.parse(t.cache.offer);e.codec=n.media[l].rtp[0].codec}}))}c&&(o=r.write(n)),this.cache[e.type]=o;var u=n.media;n.media=[];var d={},p=[],h={};u.forEach((function(e){if(a(e),("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction&&"application"!==e.type)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==d[e.type]&&"inactive"!==d[e.type].direction||(d[e.type]=e)})),u.forEach((function(e){var t=e.type;if("application"===t)return e.mid="data",n.media.push(e),void p.push(e.mid);"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(n){"object"!=typeof d[t].sources&&(d[t].sources={}),d[t].sources[n]=e.sources[n],void 0!==e.msid&&(d[t].sources[n].msid=e.msid)})),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==d[t].ssrcGroups&&Array.isArray(d[t].ssrcGroups)||(d[t].ssrcGroups=[]),i.apply(d[t].ssrcGroups,[e.ssrcGroups])||(d[t].ssrcGroups=d[t].ssrcGroups.concat(e.ssrcGroups)));var r=e.direction;h[t]=(h[t]||0)|s[r||"inactive"],d[t]===e&&(e.mid=t,delete e.bundleOnly,delete e.msid,"inactive"!==r&&p.push(t),n.media.push(e))})),n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=p.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var f=r.write(n);return new RTCSessionDescription({type:e.type,sdp:f})},o.prototype.toUnifiedPlan=function(e){var t=this;if("object"!=typeof e||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=r.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every((function(e){return-1!==["video","audio","data"].indexOf(e.mid)})))return console.warn("This description does not look like Plan B."),e;var o=[];n.media.forEach((function(e){o.push(e.mid)}));var s,c=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(c=n.groups.every((function(e){return"BUNDLE"!==e.type||i.apply(e.mids.sort(),[o.sort()])}))),!c)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");void 0!==this.cache[e.type]&&(s=r.parse(this.cache[e.type]));var l={audio:{},video:{}},u={},d=0,p=0;if(n.media.forEach((function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction&&"application"!==n.type)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"===n.type){var r=null;return s&&s.media&&(r=s.media.find((function(e){return"application"===e.type}))),void(r?u[r.mid]=r:u[n.mid]=n)}var i=n.sources,o=n.ssrcGroups,c=n.candidates,h=n.iceUfrag,f=n.icePwd,m=n.fingerprint,v=n.port;delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid;var g={};void 0!==o&&Array.isArray(o)&&o.forEach((function(e){"SIM"!==e.semantics&&void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach((function(t){void 0===g[t]&&(g[t]=[]),g[t].push(e)}))}));var _={};"object"==typeof i&&Object.keys(i).forEach((function(r){var o;if("offer"!==e.type||i[r].msid)if(void 0!==g[r]&&Array.isArray(g[r])&&g[r].some((function(e){return e.ssrcs.some((function(e){if("object"==typeof _[e])return o=_[e],!0}))})),"object"==typeof o)o.sources[r]=i[r],delete i[r].msid;else{if(o=Object.create(n),_[r]=o,void 0!==i[r].msid&&(o.msid=i[r].msid,delete i[r].msid),o.sources={},o.sources[r]=i[r],o.ssrcGroups=g[r],void 0!==s&&void 0!==s.media&&Array.isArray(s.media)&&s.media.forEach((function(e){"object"==typeof e.sources&&Object.keys(e.sources).forEach((function(t){t===r&&(o.mid=e.mid)}))})),a(o),void 0===o.mid){if("answer"===e.type)throw new Error("An unmapped SSRC was found.");o.mid=[n.type,"-",r].join("")}o.candidates=c,o.iceUfrag=h,o.icePwd=f,o.fingerprint=m,o.port=v,u[o.mid]=o,t.cache.mlU2BMap[p]=d,void 0===t.cache.mlB2UMap[d]&&(t.cache.mlB2UMap[d]=p),p++}else l[n.type][r]=i[r]})),d++})),n.media=[],o=[],"answer"===e.type)for(var h=0;h<s.media.length;h++){var f=s.media[h];a(f),void 0===u[f.mid]&&(delete f.msid,delete f.sources,delete f.ssrcGroups,f.direction&&"sendrecv"!==f.direction?"sendonly"===f.direction&&(f.direction="inactive"):f.direction="recvonly"),n.media.push(f),"string"==typeof f.mid&&o.push(f.mid)}else void 0!==s&&void 0!==s.media&&Array.isArray(s.media)&&s.media.forEach((function(e){a(e),o.push(e.mid),void 0!==u[e.mid]?n.media.push(u[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="recvonly"),e.direction&&"sendonly"!==e.direction||(e.direction="inactive"),n.media.push(e))})),Object.keys(u).forEach((function(e){-1===o.indexOf(e)&&(o.push(e),"recvonly"===u[e].direction?n.media.some((function(t){if(("sendrecv"===t.direction||"sendonly"===t.direction)&&t.type===u[e].type)return Object.keys(u[e].sources).forEach((function(n){t.sources[n]=u[e].sources[n]})),!0})):n.media.push(u[e]))}));["audio","video"].forEach((function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(l[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var a=n.media[r];Object.keys(l[e]).forEach((function(t){a.sources&&a.sources[t]&&console.warn("Replacing an existing SSRC."),a.sources||(a.sources={}),a.sources[t]=l[e][t]}))}}})),n.groups.some((function(e){if("BUNDLE"===e.type)return e.mids=o.join(" "),!0})),n.msidSemantic={semantic:"WMS",token:"*"};var m=r.write(n);return this.cache[e.type]=m,new RTCSessionDescription({type:e.type,sdp:m})};var s={inactive:0,recvonly:1,sendonly:2,sendrecv:3}},141:function(e,t,n){e.exports=n("7ylw")},"7ylw":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shimGetUserMedia",(function(){return dn})),n.d(r,"shimGetDisplayMedia",(function(){return pn})),n.d(r,"shimMediaStream",(function(){return hn})),n.d(r,"shimOnTrack",(function(){return fn})),n.d(r,"shimGetSendersWithDtmf",(function(){return mn})),n.d(r,"shimGetStats",(function(){return vn})),n.d(r,"shimSenderReceiverGetStats",(function(){return gn})),n.d(r,"shimAddTrackRemoveTrackWithNative",(function(){return _n})),n.d(r,"shimAddTrackRemoveTrack",(function(){return yn})),n.d(r,"shimPeerConnection",(function(){return En})),n.d(r,"fixNegotiationNeeded",(function(){return Sn}));var i={};n.r(i),n.d(i,"shimGetUserMedia",(function(){return On})),n.d(i,"shimGetDisplayMedia",(function(){return Tn})),n.d(i,"shimPeerConnection",(function(){return wn})),n.d(i,"shimReplaceTrack",(function(){return In}));var a={};n.r(a),n.d(a,"shimGetUserMedia",(function(){return Pn})),n.d(a,"shimGetDisplayMedia",(function(){return Rn})),n.d(a,"shimOnTrack",(function(){return An})),n.d(a,"shimPeerConnection",(function(){return Nn})),n.d(a,"shimSenderGetStats",(function(){return kn})),n.d(a,"shimReceiverGetStats",(function(){return Ln})),n.d(a,"shimRemoveStream",(function(){return Dn})),n.d(a,"shimRTCDataChannel",(function(){return Mn})),n.d(a,"shimAddTransceiver",(function(){return jn})),n.d(a,"shimGetParameters",(function(){return xn})),n.d(a,"shimCreateOffer",(function(){return Un})),n.d(a,"shimCreateAnswer",(function(){return Gn}));var o={};n.r(o),n.d(o,"shimLocalStreamsAPI",(function(){return Vn})),n.d(o,"shimRemoteStreamsAPI",(function(){return Bn})),n.d(o,"shimCallbacksAPI",(function(){return Hn})),n.d(o,"shimGetUserMedia",(function(){return Fn})),n.d(o,"shimConstraints",(function(){return Wn})),n.d(o,"shimRTCIceServerUrls",(function(){return zn})),n.d(o,"shimTrackEventTransceiver",(function(){return Kn})),n.d(o,"shimCreateOfferLegacy",(function(){return Jn})),n.d(o,"shimAudioContext",(function(){return qn}));var s={};n.r(s),n.d(s,"shimRTCIceCandidate",(function(){return Zn})),n.d(s,"shimMaxMessageSize",(function(){return $n})),n.d(s,"shimSendThrowTypeError",(function(){return Qn})),n.d(s,"shimConnectionState",(function(){return er})),n.d(s,"removeAllowExtmapMixed",(function(){return tr}));var c={};n.r(c),n.d(c,"Api",(function(){return ta})),n.d(c,"BaseApi",(function(){return li})),n.d(c,"BaseLogger",(function(){return ui})),n.d(c,"BaseSignaling",(function(){return pi})),n.d(c,"CallType",(function(){return fi})),n.d(c,"ExternalIdType",(function(){return gi})),n.d(c,"HangupReason",(function(){return Ti})),n.d(c,"HangupType",(function(){return vi})),n.d(c,"ParticipantStatus",(function(){return hr})),n.d(c,"Signaling",(function(){return aa})),n.d(c,"SignalingCommandType",(function(){return ia})),n.d(c,"SignalingConnectionType",(function(){return yi})),n.d(c,"acceptCall",(function(){return ga})),n.d(c,"addParticipant",(function(){return Ca})),n.d(c,"addParticipantInternal",(function(){return Oa})),n.d(c,"authorize",(function(){return va})),n.d(c,"browser",(function(){return sa})),n.d(c,"call",(function(){return pa})),n.d(c,"callInternal",(function(){return ha})),n.d(c,"captureScreen",(function(){return Pa})),n.d(c,"changeDevice",(function(){return Ia})),n.d(c,"changeParticipantState",(function(){return Da})),n.d(c,"changePriorities",(function(){return La})),n.d(c,"chatHistory",(function(){return za})),n.d(c,"chatMessage",(function(){return Fa})),n.d(c,"chatMessageInternal",(function(){return Wa})),n.d(c,"createJoinLink",(function(){return Ya})),n.d(c,"customData",(function(){return Ka})),n.d(c,"customDataInternal",(function(){return Ja})),n.d(c,"debug",(function(){return ro})),n.d(c,"declineCall",(function(){return _a})),n.d(c,"forceRelayPolicy",(function(){return Qa})),n.d(c,"getAnonymTokenByLink",(function(){return Za})),n.d(c,"getStreamInfo",(function(){return no})),n.d(c,"grantRoles",(function(){return xa})),n.d(c,"grantRolesInternal",(function(){return Ua})),n.d(c,"hangup",(function(){return ba})),n.d(c,"init",(function(){return da})),n.d(c,"joinCall",(function(){return ya})),n.d(c,"joinCallByLink",(function(){return Sa})),n.d(c,"joinCallInternal",(function(){return Ea})),n.d(c,"muteParticipant",(function(){return Ga})),n.d(c,"muteParticipantInternal",(function(){return Va})),n.d(c,"pinParticipant",(function(){return Ba})),n.d(c,"pinParticipantInternal",(function(){return Ha})),n.d(c,"processPush",(function(){return fa})),n.d(c,"processPushInternal",(function(){return ma})),n.d(c,"removeJoinLink",(function(){return Xa})),n.d(c,"removeParticipant",(function(){return Ta})),n.d(c,"removeParticipantInternal",(function(){return wa})),n.d(c,"setApi",(function(){return ca})),n.d(c,"setLocalResolution",(function(){return ka})),n.d(c,"setLogger",(function(){return ua})),n.d(c,"setSignalingFactory",(function(){return la})),n.d(c,"setVideoStream",(function(){return Ra})),n.d(c,"setVolume",(function(){return $a})),n.d(c,"startConversation",(function(){return qa})),n.d(c,"startStream",(function(){return eo})),n.d(c,"stopStream",(function(){return to})),n.d(c,"switchConference",(function(){return ja})),n.d(c,"toggleLocalAudio",(function(){return Na})),n.d(c,"toggleLocalVideo",(function(){return Aa})),n.d(c,"updateDisplayLayout",(function(){return Ma}));n("91GP"),n("VRzm"),n("Btvt");var l=n("q1tI"),u=n.n(l),d=n("i8i4"),p=(n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("83Q7")),h=function(){return(h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},f=function(e,t,n){var r,i=n.participantLimit,a=void 0===i?128:i,o=window.vk.id||e.peerId;return{me:o,mode:p.Mode.READY,peer:0,participants:(r={},r[o]=h(h({},e),{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1},statusData:{hand:!1}}),r),callData:{type:null,ts:null},imHash:t,participantLimit:a,popup:null,uiMode:p.UIMode.DEFAULT,orator:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!1,chatMembers:[],preselectedIds:null,friends:[],speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null}},m=(n("T39b"),function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}),v={},g=0,_=0;function y(e,t,n){var r;g?(v[t]=v[t]?Object.assign(v[t],n):n,_++):function t(n){e({type:p.UPDATE_PARTICIPANTS_BATCH,data:n}),g=window.setTimeout((function(){_>0&&(t(v),v={},_=0),clearTimeout(g),g=0}),30)}(((r={})[t]=n,r))}function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function S(e,t){switch(t.type){case p.LOAD_PEERS:var n=t.conversation||e.callData.conversation,r=t.members;return E({},e,{participants:E({},e.participants,{},r.reduce((t,n)=>(n&&n.peerId&&(t[n.peerId]=E({},e.participants[n.peerId]||{},{},n)),t),{})),callData:E({},e.callData,{conversation:n}),peer:"peerId"in t?t.peerId:e.peer});case p.CHANGE_MODE:var i=t.mode!==p.Mode.READY&&t.data&&t.data.type?t.data.type:null;return t.mode===p.Mode.READY?f(e.participants[e.me],e.imHash,{participantLimit:e.participantLimit}):E({},e,{mode:t.mode,peer:"peerId"in t?t.peerId:e.peer,callData:E({},e.callData,{type:i,ts:t.ts||e.callData.ts||null}),hangupType:e.hangupType});case p.HANGUP:return E({},e,{hangupType:t.data});case p.TIME_START:return E({},e,{callData:E({},e.callData,{ts:t.data})});case p.REMOVE_USER:var a=b(e,t.participantId,{status:void 0,statusData:void 0,wasConnected:void 0});if(e.screenSharers[t.participantId]&&delete a.screenSharers[t.participantId],e.orator===t.participantId&&(a.orator=null),e.pinnedParticipant===t.participantId&&(a.pinnedParticipant=null),e.participantsAddedByMe.has(t.participantId)){var o=new Set(e.participantsAddedByMe);o.delete(t.participantId),a.participantsAddedByMe=o}return a;case p.SET_CHAT_INFO:return E({},e,{chatMembers:t.data,chatData:t.conversation});case p.GROUP_CALL_SETUP:return E({},e,{groupCallSetup:t.open,peer:t.peerId||e.peer||0,preselectedIds:t.preselectedIds});case p.TOGGLE_POPUP:return E({},e,{popup:t.data||null});case p.UPDATE_HASH:return E({},e,{imHash:t.hash});case p.CHANGE_UI_MODE:return E({},e,{uiMode:t.mode||p.UIMode.DEFAULT});case p.TOGGLE_ORATOR_MODE:return E({},e,{isOratorMode:t.isOratorMode});case p.TOGGLE_PARTICIPANTS_ASIDE:return E({},e,{isShownParticipantsAside:t.isShownParticipantsAside});case p.SET_ORATOR:return E({},e,{orator:t.orator||null});case p.SET_PINNED_PARTICIPANT:return E({},e,{pinnedParticipant:t.pinnedParticipant});case p.MANAGEMENT:return E({},e,{isManagementOpen:t.isOpen});case p.CALL_STATE:return E({},e,{callData:E({},e.callData,{},t.callData)});case p.CALL_NOTIFICATION:return E({},e,{notification:t.notification});case p.JOIN:return E({},e,{mode:p.Mode.JOIN,join:t.data});case p.ERROR:return E({},e,{mode:p.Mode.ERROR,error:{title:t.title,text:t.text}});case p.CHANGE_PARTICIPANT_STATE:var s=e.participants[t.participantId].statusData;return b(e,t.participantId,{statusData:E({},s,{},t.data)});case p.SET_SCREEN_SHARER:return E({},e,{screenSharers:E({},e.screenSharers,{[t.participantId]:t.isScreenSharingEnabled})});case p.SET_FRIENDS:return E({},e,{friends:t.data});case p.SET_SPEAKERS:var c=t.data,l=c.speakers,u=c.speakersInHeader;return E({},e,{speakers:l||e.speakers,speakersInHeader:u||e.speakersInHeader});case p.UPDATE_PARTICIPANTS_BATCH:return function(e,t){var n=Object.assign({},e);for(var r in t)if(t.hasOwnProperty(r)){var i=e.participants[r]||{},a=t[r],o=a.statusData?m(m({},i.statusData),a.statusData):i.statusData,s=i.wasConnected||a.status===p.CallStatus.CONNECTED;n.participants[r]=m(m(m({},e.participants[r]),t[r]),{statusData:o,wasConnected:s})}return n}(e,t.data);case p.SET_UNREAD_COUNT:return E({},e,{chatUnreadCount:t.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in t?t.chatUpToMsgId:e.chatUpToMsgId});case p.SHOW_LOADER:return E({},e,{isLoaderVisible:t.isLoaderVisible});case p.SET_TOOLTIP:var d=t.tooltips?t.tooltips:Object.keys(e.tooltips).reduce((e,t)=>(e[t]=!1,e),{});return E({},e,{tooltips:E({},e.tooltips,{},d)});case p.MANUAL_ADD_PARTICIPANTS:return E({},e,{participantsAddedByMe:(t.participants||[]).reduce((e,t)=>e.add(t),new Set(e.participantsAddedByMe))})}return e}function b(e,t,n){return E({},e,{participants:E({},e.participants,{[t]:E({},e.participants[t],{},n)})})}var C,O=n("ZxpX"),T=function(){return(T=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},w=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear"}(C||(C={}));var I=function(e){var t=e.icon,n=e.text,r=e.type,i=e.className,a=w(e,["icon","text","type","className"]),o=Object(O.classNames)("CallButton","CallButton--"+r,i,{"CallButton--withText":!!n}),s=T(T({},a),{onMouseDown:function(e){e.preventDefault(),a.onMouseDown&&a.onMouseDown(e)}});return u.a.createElement("button",T({className:o},s),u.a.createElement("figure",{className:"CallButton__icon"},t),n)},P=function(){return(P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},R=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},A=function(e){var t=R(e,[]);return u.a.createElement("svg",P({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"}))},N=function(){return(N=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},k=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},L=function(e){var t=k(e,[]);return u.a.createElement("svg",N({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"}))},D=function(){return(D=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},M=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},j=function(e){var t=M(e,[]);return u.a.createElement("svg",D({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"}))},x=n("17x9"),U=n.n(x);function G(e){var t=e.id,n=e.disablePhoto,r=e.photo,i=e.className,a=e.children,o=t%6+1,s=Object(O.classNames)("BlurredBackground",i,"BlurredBackground--"+o,{"BlurredBackground--noPhoto":!n&&!r});return l.createElement("div",{className:s},l.createElement("div",{className:"BlurredBackground__in"},!n&&r&&l.createElement("div",{className:"BlurredBackground__inner",style:{backgroundImage:`url(${r})`}})),l.createElement("div",{className:"BlurredBackground__content"},a))}G.defaultProps={photo:"",children:"",disablePhoto:!1};var V=n("756/"),B=function(e){var t=e.id,n=e.waves,r=void 0!==n&&n,i=e.size,a=void 0===i?"m":i,o=e.photo,s=void 0===o?"":o,c=e.alt,l=Object(O.classNames)("CallPhoto","CallPhoto--"+a,{"CallPhoto--waves":!!r});return s?u.a.createElement("img",{src:s,className:l,alt:c}):u.a.createElement(V.ConversationNoPhoto,{id:t,text:c.slice(0,1),size:a,className:l})},H=n("2zsc");function F(e){var t=e.title,n=e.description,r=e.className;return l.createElement("header",{className:Object(O.classNames)("CallHeader",r)},l.createElement("h1",{className:"CallHeader__title"},l.createElement(H.default,null,t)),l.createElement("div",{className:"CallHeader__description"},n))}var W=function(){return(W=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},z=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},K=Object(l.forwardRef)((function(e,t){var n,r=e.type,i=e.isActive,a=e.icon,o=e.className,s=z(e,["type","isActive","icon","className"]),c=Object(O.classNames)("CallIconButton",o,((n={"CallIconButton--active":i})["CallIconButton--"+r]=!!r,n)),l=W(W({},s),{onMouseDown:function(e){e.preventDefault(),s.onMouseDown&&s.onMouseDown(e)}});return u.a.createElement("button",W({},l,{className:c,ref:t}),a)})),J=n("dt/K"),q=n("6krn");function Y(e){var t=e.id,n=e.photo,r=e.title,i=e.description,a=e.onCollapseCall,o=e.children;return l.createElement("section",{className:"IncomingCall"},l.createElement(G,{id:t,photo:n}),l.createElement(J.default,{position:"b",text:Object(q.getLang)("calls_collapse"),marginTop:-6},l.createElement(K,{type:"collapse",className:"IncomingCall__collapse",onClick:a})),l.createElement(F,{title:r,description:i}),l.createElement(B,{id:t,waves:!0,photo:n,alt:r||""}),l.createElement("footer",{className:"IncomingCall__footer"},o))}var X=n("r7nW"),Z=n("EasH"),$=n("4+be"),Q=n("P13b");function ee(e){return new Promise((t,n)=>{var r=new Image;r.src=e,r.onload=t,r.onerror=n})}function te(e){var t=[].concat(...e).map(e=>{var t=e.photo;return t?ee(t):Promise.resolve()});return Promise.all(t).then(()=>e).catch(()=>e)}function ne(e){return e&&Object(Z.showFastBox)(Object($.getLang)("global_error"),e)}function re(e){var t=Object(Z.showFastBox)(Object($.getLang)("global_error"),Object($.getLang)("calls_incoming_process_error"),Object($.getLang)("global_close"),()=>{t.hide(),e&&e()})}function ie(e){nav.go(Object(Q.getConvoLocation)(e))}var ae=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},r=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),i=r.length;i--;){var a=r[i],o="";if(a){for(var s=0;s<6;s++){var c=a.charCodeAt(s);if(c){var l=this.toTranslit[c],u=a.substr(s,1);o+=null!=l?l:u}}n[o]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),r=n.length;r--;){var i={},a=n[r],o="",s="",c="",l=a.length>1;if(a){for(var u=0;u<6;u++){var d=a.charCodeAt(u);if(d){var p=this.toTranslit[d],h=a.substr(u,1);if(o+=null!=p?p:h,l){var f=this.toLocalCase[h],m=this.toLocalTranslit[d];s+=null!=f?f:h,c+=null!=m?m:h}}}i[o]=1,l&&(i[s]=2,i[c]=3),t.push(i)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,r=0;r<6;r++){var i=e.substr(r,1)||-1;n=n[i]?n[i]:n[i]=5==r?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)if(n.hasOwnProperty(r)){for(var i=this.index,a=0;a<6;a++){var o=r.substr(a,1)||-1;if(!i[o])break;i=i[o]}if(i.length)for(var a in i)if(this.equals(i[a],e)){i.splice(a,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(oe(e[0])||oe(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var r=e.shift();r&&n.push(r)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var r in n)n.hasOwnProperty(r)&&this.toIndexTree(r,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),r=[],i=!1;for(var a in n)if(n.hasOwnProperty(a)){if(i&&!r)break;var o=this.localSearch(n[a],0,t);o.sort((function(e,t){return e._order-t._order})),r=i?this.intersect(r,o):o,i=!0}for(var s=r[0],c=r.length+1,l=[],u=1;u<c;u++){var d=r[u];d!=s&&(l.push(s),s=d)}return l},e.prototype.localSearch=function(e,t,n){if(!n)return[];var r={};for(var i in e)e.hasOwnProperty(i)&&(r[o=i.substr(t,1)||-1]||(r[o]={}),r[o][i]=1);if(6==t++)return n;var a=[];for(var o in r)if("-1"===o)for(var s in n)n.hasOwnProperty(s)&&a.push.apply(a,this.localSearch(r[o],t,n[s]));else{var c=this.localSearch(r[o],t,n[o]);a.push.apply(a,c)}return a},e}();function oe(e){return!isNaN(e)}var se=function(e,t,n){var r=Object(l.useRef)(null);r.current=r.current?r.current:new ae(e,t);var i=r.current,a=Object(l.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),o=Object(l.useState)(e),s=o[0],c=o[1],u=Object(l.useState)(a(e)),d=u[0],p=u[1];return Object(l.useEffect)((function(){var t=a(e),r=e.filter((function(e){return!d[n(e)]})),o=s.filter((function(e){return!t[n(e)]}));(r.length||o.length)&&(r.forEach((function(e){i.add(e)})),o.forEach((function(e){i.remove(e)})),c(e),p(t))}),[e]),i};var ce=function(e){var t=e.onClose,n=e.onBackdropClick,r=e.isIncoming,i=void 0!==r&&r,a=e.isCautionBoxShown,o=void 0!==a&&a,s=e.children;Object(l.useEffect)((function(){return window.bodyNode.classList.add("layers_shown"),function(){window.bodyNode.classList.remove("layers_shown")}}),[]);var c=o?function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?Object($.getLang)("calls_reject_title"):Object($.getLang)("calls_hangup_description"),r=t?Object($.getLang)("calls_reject_description"):Object($.getLang)("calls_hangup_description");return Object(Z.showFastBox)(n,r,Object($.getLang)("global_yes"),e,Object($.getLang)("global_no"))}((function(){t(),e.hide()}),i||!1);return e}:t;return u.a.createElement(X.default,{className:"CallModal",disableBodyScroll:!0,onClose:c,onBackdropClick:n},s)},le=n("rudk"),ue=function(e){return 0===e||Object(le.isChatPeer)(e)};function de(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r=e.browser.hasMicrophonePermission(),i=e.browser.hasCameraPermission(),a=n&&!r,o=t&&!i;return a||o?function(e,t,n){return e.browser.getUserMedia(t,n).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))}(e,o,a):Promise.resolve()}var pe=n("r0fY"),he=n("FbVm"),fe=function(){return(fe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},me=new(function(){function e(){this.productionStatCollector=new he.ProductionStatCollector,this.actionStatCollector=new he.ActionStatCollector(this.productionStatCollector)}return e.prototype.logEvent=function(e){var t,n=fe(fe({},e),{peer_id:e.peer_id.toString(),session_id:e.session_id||"",lib_version:"calls_v2"});return this.actionStatCollector.logEvent(((t={type:pe.ActionProductionStatEventTypes.TYPE_CALL_ITEM})[pe.ActionProductionStatEventTypes.TYPE_CALL_ITEM]=n,t))},e}());function ve(e){var t=e.SDK,n=e.state,r=e.dispatch,i=n.peer,a=ue(i)?n.callData.conversation:n.participants[i],o=n.callData.type===p.CallType.VIDEO,s=o?Object(q.getLang)("calls_incoming_videocall"):Object(q.getLang)("calls_incoming_audiocall"),c=o?Object(q.getLang)("calls_reply_with_audio"):Object(q.getLang)("calls_reply"),l=o?Object(q.getLang)("calls_reject_call"):Object(q.getLang)("calls_reject"),d=function(e,i){return de(t,e,i).then((function(){return t.acceptCall(e,i)})).then((function(t){var i=t.acceptTime;r({type:p.CHANGE_MODE,mode:p.Mode.CALL,ts:i}),me.logEvent({call_event_type:p.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:n.callData.callId,peer_id:n.peer,is_group_call:ue(n.peer),reason:e?p.CallType.VIDEO:p.CallType.AUDIO})})).catch((function(e){console.error(e),t.declineCall()}))};return u.a.createElement(ce,{onClose:t.declineCall,isIncoming:!0,isCautionBoxShown:!0},u.a.createElement(Y,{id:i,title:(null==a?void 0:a.tab)||"",description:s,photo:(null==a?void 0:a.photo)||"",onCollapseCall:function(){r({type:p.CHANGE_UI_MODE,mode:p.UIMode.COLLAPSED})}},o&&u.a.createElement(I,{text:Object(q.getLang)("calls_reply_with_video"),type:C.POSITIVE,icon:u.a.createElement(A,null),onClick:function(){return d(!0,!0)}}),u.a.createElement(I,{text:c,type:o?C.REGULAR:C.POSITIVE,icon:u.a.createElement(L,null),onClick:function(){return d(!1,!0)}}),u.a.createElement(I,{text:l,type:C.NEGATIVE,icon:u.a.createElement(j,null),onClick:function(){t.declineCall(),me.logEvent({call_event_type:p.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:n.callData.callId,peer_id:n.peer,is_group_call:ue(n.peer),reason:"none"})}})))}n("pIFo"),n("SRfc"),n("hhXQ"),n("KKXr");var ge=n("DM26"),_e=n("vT4u"),ye=n("gdug"),Ee=n("1BRX"),Se=n("nAFc");function be(){return(be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Te(e){var t=e.shortName,n=e.firstName;if(!t||!n){var r=Ce(e.name.split(" "),2),i=r[0],a=r[1];t=`${i} ${a?a.length>2?a.substring(0,1)+".":a:""}`,n=i}return be({},e,{peerId:+e.id,tab:e.name,shortName:t,firstName:n})}function we(e){var t=Ce(e,2),n=t[0],r=t[1];return["peerId"in n?n:Te(n),r?r.map(Te):[]]}function Ie(e){var t=Ce(e,2),n=t[0],r=t[1];return[be({},n,{tab:n.name}),Object(le.isUserPeer)(n.peerId)?[n]:r]}function Pe(e){var t=e.caller_info,n=e.chat_info;return n?2e9+n.chat_id:t.user_id}function Re(e){return!!e.payload.chat_info}function Ae(e){return Object.values(e.participants).filter(t=>t.peerId===e.me||t.status)}function Ne(e){return!!Object.values(e.participants).find(t=>(t.peerId===e.me||t.wasConnected)&&t.mediaSettings&&t.mediaSettings.isVideoEnabled)}function ke(e){var t=Date.now(),n=Math.max(0,Math.floor((t-e)/1e3));return n<=599?"0"+Object(Ee.formatTime)(n):Object(Ee.formatTime)(n)}function Le(e,t){return JSON.stringify({is_video:t,chat_id:Object(le.isChatPeer)(e)?e-2e9:void 0,with_join_link:ue(e),join_by_link:ue(e)})}function De(e){ye.browser.safari&&+ye.browser.version.split(".")[0]<13&&window.setTimeout(()=>{e&&e.current&&(e.current.volume=1e-4)},10)}var Me=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(){return n.reduce((e,t)=>t(e),e)(...arguments)}},je=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{attempts:10,timeout:0};return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return n.attempts>0?Object(ge.pause)(n.timeout).then(()=>t(...i)).catch(()=>(!n.timeout&&(n.timeout=1),n.attempts--,n.timeout=Math.min(2*n.timeout,300),e(t,n)(...i))):Promise.reject()}},xe=(e,t,n)=>function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];var o=window.Calls.id<0&&{anonymId:window.Calls.id};return n(e(),...i).catch(e=>e&&e.match&&e.match(/1001;/)?Object(_e.loadWriteHash)(o).then(e=>{var n=Ce(e,1)[0];return t(n)}).then(e=>n(e,...i)):Promise.reject(e))};function Ue(e,t){if(e.length>t.length){var n=e.length-t.length,r=e.slice(0,3).map(Ge).join(", ");return langNumeric(n,Object($.getLang)("calls_members_list_label",n)).replace("{name}",r)}if(t.length>1){var i=t.length>2?e.slice(0,2).map(Ge).join(", "):Ge(e[0]),a=Ge(e[t.length-1]);return Object($.getLang)("global_and").replace("{before}",i).replace("{after}",a)}return 1===t.length?Ge(e[0]):""}function Ge(e){return Object(Se.decodeHTMLEntities)(e.firstName)}function Ve(){return(Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Be(e){var t=e.hasVideo,n=e.stream,r=e.isMe,i=e.isVideoVisible,a=e.isScreenShareStream,o=e.setVideoVisibility,s=e.className,c=e.allowContain,u=l.useRef(null),d=t&&n,p={autoPlay:!0,controls:!1,crossOrigin:"anonymous",playsInline:"playsinline",preload:"metadata",onLoadedData:()=>d&&!i&&o&&o(!0)},h=c&&function(e,t){if(t&&t.active){var n=t.getVideoTracks();if(!n||0===n.length)return!1;var r=n[0].getSettings(),i=void 0!==r.width?r.width:e?e.videoWidth:0;return(void 0!==r.height?r.height:e?e.videoHeight:0)>=i}return!1}(u.current,n)||a,f=Object(O.classNames)("Video",s,{"Video--contain":d&&n&&h,"Video--visible":d&&i,"Video--mirrored":r&&d&&!a});return l.useEffect(()=>{d&&u.current&&(u.current.srcObject=n,u.current.volume=0,De(u)),!d&&i&&o&&o(!1)},[e.hasVideo,e.stream,i]),d?l.createElement("video",Ve({className:f,ref:u},p)):null}Be.defaultProps={hasVideo:!1,isMe:!1,isVideoVisible:!1,allowContain:!0,isScreenShareStream:!1};var He=n("FEsp");function Fe(e){var t=e.isInverted,n=Object(O.classNames)("CallingStatus",{"CallingStatus--inverted":!!t});return u.a.createElement("div",{className:n},u.a.createElement("span",{className:"CallingStatus__part"}),u.a.createElement("span",{className:"CallingStatus__part"}),u.a.createElement("span",{className:"CallingStatus__part"}))}var We,ze=function(e){var t=e.id,n=e.photo,r=e.photoSize,i=void 0===r?"m":r,a=e.status,o=e.wasConnected,s=e.alt,c=e.className;return u.a.createElement(He.default,{className:Object(O.classNames)("ParticipantCard",c)},u.a.createElement("span",{className:"ParticipantCard__in"},u.a.createElement(B,{id:t,photo:n,size:i,alt:s||""}),a===p.CallStatus.WAITING&&!o&&u.a.createElement("div",{className:"ParticipantCard__status"},u.a.createElement(Fe,{isInverted:!0}))))},Ke=function(){return(Ke=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Je=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},qe=function(e){var t=Je(e,[]);return u.a.createElement("svg",Ke({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},t),u.a.createElement("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"}))},Ye=function(){return(Ye=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Xe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ze=function(e){var t=Xe(e,[]);return u.a.createElement("svg",Ye({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},t),u.a.createElement("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"}))},$e=n("N+uU"),Qe=function(){return(Qe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},et=function(e){var t=e.children,n=e.items,r=Object(l.useState)(!1),i=r[0],a=r[1],o=Object(l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),a(!i)}),[i]),s=function(e){e.target&&e.target.closest(".CallsDropdown")||a(!1)};return Object(l.useEffect)((function(){return document.documentElement.addEventListener("click",s),function(){return document.documentElement.removeEventListener("click",s)}}),[]),i?u.a.createElement($e.Popper,{content:u.a.createElement("ul",{className:"CallsDropdown"},n.map((function(e,t){return u.a.createElement("li",{className:"CallsDropdown__item",key:e.key||t},"href"in e&&u.a.createElement("a",{href:e.href,target:"_blank",onClick:function(){return a(!1)},className:"CallsDropdown__button"},e.text),"onClick"in e&&u.a.createElement("button",{onClick:function(){e.onClick(),a(!1)},className:"CallsDropdown__button"},e.text))}))),mode:"point"},u.a.cloneElement(t,Qe(Qe({},t.props),{onClick:o,"data-active":i}))):u.a.cloneElement(t,Qe(Qe({},t.props),{onClick:o}))},tt=function(e){var t=e.id,n=e.isInfoShown,r=e.isPinned,i=e.isHandRaised,a=e.photo,o=e.hasVideo,s=e.hasAudio,c=e.isSharingScreen,d=e.isSpeaking,p=void 0!==d&&d,h=e.stream,f=e.isMe,m=void 0!==f&&f,v=e.photoSize,g=e.name,_=e.status,y=e.wasConnected,E=e.onClickParticipant,S=e.allowContain,b=void 0!==S&&S,C=e.actions,T=!!E,w=Object(O.classNames)("Participant",{"Participant--isInteractive":T,"Participant--isPinned":r,"Participant--isSpeaking":p}),I=u.a.useState(!1),P=I[0],R=I[1];u.a.useEffect((function(){o&&h||R(!1)}),[o,h,P]);var A=!(o&&h)||!P,N=Object(l.useCallback)((function(e){E&&E(e,t)}),[E]);return u.a.createElement("article",{className:w,onClick:N},C&&C.length>0&&u.a.createElement(et,{items:C},u.a.createElement("button",{className:"Participant__more","aria-label":Object(q.getLang)("global_actions")},u.a.createElement(Ze,null))),T&&u.a.createElement("header",{className:"Participant__header"},r&&u.a.createElement("div",{className:"Participant__pin"})),A&&u.a.createElement(G,{id:t,photo:a,className:"Participant__main"},u.a.createElement(ze,{id:t,photo:a,photoSize:v,status:_,wasConnected:y,alt:g||"",className:n?"Participant__offsetCard":""})),i&&u.a.createElement("div",{className:"Participant__handIndicator"},u.a.createElement(qe,{className:"Participant__handIcon"})),o&&u.a.createElement(Be,{className:"Participant__main",hasVideo:o,stream:h,isMe:m,isVideoVisible:P,isScreenShareStream:c,setVideoVisibility:R,allowContain:b}),n&&u.a.createElement("footer",{className:"Participant__footer"},u.a.createElement(H.default,{className:"Participant__name"},g),(y||m)&&!s&&u.a.createElement("span",{className:"Participant__statusIcon Participant__statusIcon--mic"})))},nt=function(e){var t=e.id,n=e.name,r=e.hasAudio,i=e.hasVideo,a=e.isSharingScreen,o=e.stream,s=e.wasConnected,c=e.opponentId,l=e.opponentHasAudio,d=e.opponentHasVideo,p=e.opponentIsSharingScreen,h=e.opponentStream,f=e.opponentPhoto,m=e.opponentName,v=e.opponentWasConnected,g=Object(O.classNames)("OneToOne",{"OneToOne--hasVideo":i,"OneToOne--opponentHasVideo":d});return u.a.createElement("div",{className:g},u.a.createElement("aside",{className:"OneToOne__local"},u.a.createElement(tt,{id:t,hasVideo:i,hasAudio:r,isSharingScreen:a,stream:o,isMe:!0,name:n,photoSize:"m",wasConnected:s})),u.a.createElement("main",{className:"OneToOne__remote"},u.a.createElement(tt,{id:c,hasVideo:d,hasAudio:l,isSharingScreen:p,stream:h,photo:f,name:m,photoSize:"l",wasConnected:v})))},rt=function(){return(rt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},it=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},at=function(e){var t=e.children,n=e.className,r=e.alignX,i=e.alignY,a=e.size,o=void 0===a?"m":a,s=it(e,["children","className","alignX","alignY","size"]),c=Object(O.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+r,"CallIconButtonGroup--"+i,"CallIconButtonGroup--size-"+o,n);return u.a.createElement("div",rt({className:c},s),t)},ot=function(){return(ot=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},st=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ct=function(e){var t=st(e,[]);return u.a.createElement("svg",ot({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),u.a.createElement("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"}))},lt=function(){return(lt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ut=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},dt=Object(l.forwardRef)((function(e,t){var n=e.unreadCount,r=void 0===n?0:n,i=ut(e,["unreadCount"]),a="",o="";switch(!0){case!r:a="none";break;case r<=9:a="single",o=r.toString();break;case r<=99:a="double",o=r.toString();break;case r>99:a="max",o="99+"}var s=Object(O.classNames)("ChatIconButton","ChatIconButton--"+a);return u.a.createElement("button",lt({className:s},i,{ref:t}),o&&u.a.createElement("div",{className:"ChatIconButton__count "},o))})),pt=function(){return(pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ht=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},ft=function(e){var t=ht(e,[]);return u.a.createElement("svg",pt({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"}))},mt=function(){return(mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},vt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},gt=function(e){var t=vt(e,[]);return u.a.createElement("svg",mt({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"}),u.a.createElement("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"}))},_t=function(){return(_t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},yt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Et=function(e){var t=yt(e,[]);return u.a.createElement("svg",_t({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"}))},St=n("UlUB"),bt=function(){return(bt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ct=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ot=function(e){var t=Ct(e,[]);return u.a.createElement("svg",bt({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),u.a.createElement("path",{d:"M3.86 14c-.24 0-.47.02-.7.06a1 1 0 11-.33-1.98 6.14 6.14 0 017.08 7.08 1 1 0 01-1.97-.33A4.14 4.14 0 003.85 14z"}),u.a.createElement("path",{d:"M4 20a2 2 0 100-4 2 2 0 000 4zM10.96 4h2.08c1.37 0 2.45 0 3.33.07.9.07 1.65.23 2.35.58a6 6 0 012.63 2.63c.35.7.5 1.46.58 2.35.07.88.07 1.33.07 1.33v2.08s0 .45-.07 1.33c-.07.9-.23 1.65-.58 2.35a6 6 0 01-2.63 2.63c-.7.35-1.46.5-2.35.58-.88.07-1.96.07-3.33.07H13a1 1 0 110-2c1.42 0 2.42 0 3.2-.06a4.23 4.23 0 001.62-.38 4 4 0 001.74-1.74c.2-.37.31-.85.38-1.62.06-.78.06-1.2.06-1.2v-2s0-.42-.06-1.2a4.23 4.23 0 00-.38-1.62 4 4 0 00-1.74-1.74c-.37-.2-.85-.31-1.62-.38C15.42 6 14.42 6 13 6h-2c-1.42 0-2.42 0-3.2.06-1.78.15-3.35 1.23-3.66 3.1a1 1 0 11-1.97-.32 5.8 5.8 0 013.1-4.19c.7-.35 1.47-.5 2.36-.58C8.51 4 9.6 4 10.96 4z"}))},Tt=function(){return(Tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},wt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},It=function(e){var t=wt(e,[]);return u.a.createElement("svg",Tt({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"}))},Pt=function(){return(Pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Rt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},At=function(e){var t=Rt(e,[]);return u.a.createElement("svg",Pt({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"}))},Nt=function(){return(Nt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},kt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Lt=function(e){var t=kt(e,[]);return u.a.createElement("svg",Nt({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"}))},Dt=function(){return(Dt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Mt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},jt=function(e){var t=Mt(e,[]);return u.a.createElement("svg",Dt({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),u.a.createElement("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"}))},xt=function(){return(xt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ut=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Gt(e){var t=e.children,n=e.content,r=e.position,i=void 0===r?"auto":r,a=e.align,o=void 0===a?"auto":a,s=e.appearance,c=void 0===s?"dark":s,d=e.open,p=void 0!==d&&d,h=e.onOpen,f=e.onClose,m=e.delay,v=void 0===m?50:m,g=Ut(e,["children","content","position","align","appearance","open","onOpen","onClose","delay"]),_=Object(l.useState)(p?We.OPENED:We.CLOSED),y=_[0],E=_[1],S=Object(l.useRef)(null);Object(l.useEffect)((function(){var e=null,t=null,n=function(){e&&(clearTimeout(e),e=null)},r=function(){n(),e=window.setTimeout((function(){E(We.OPENED),h&&h()}),v)},i=function(){n(),t=window.setTimeout((function(){y===We.OPENED?E(We.IS_CLOSING):(E(We.CLOSED),f&&f())}),0)};return S&&S.current&&(S.current.addEventListener("mouseenter",r),S.current.addEventListener("mouseleave",i)),function(){S&&S.current&&(S.current.removeEventListener("mouseenter",r),S.current.removeEventListener("mouseleave",i)),n(),t&&(window.clearTimeout(t),t=null)}}),[S,y]),Object(l.useEffect)((function(){var e=p?We.OPENED:We.CLOSED;y!==e&&E(e)}),[p]);var b=Object(l.useCallback)((function(){y===We.IS_CLOSING&&(E(We.CLOSED),f&&f())}),[y]),C=Object(O.classNames)("TooltipNew",{"TooltipNew--removed":"isClosing"===y,"TooltipNew--dark":"dark"===c,"TooltipNew--light":"light"===c}),T=u.a.createElement("div",{className:C,onTransitionEnd:b},n);return u.a.createElement($e.Popper,xt({content:T,position:i,align:o,open:y!==We.CLOSED,ref:S},g),t)}!function(e){e.OPENED="opened",e.IS_CLOSING="isClosing",e.CLOSED="closed"}(We||(We={}));var Vt=function(){return u.a.createElement("svg",{height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},u.a.createElement("mask",{id:"MicIconWithSpeakingIndicatorMask"},u.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"})),u.a.createElement("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"}),u.a.createElement("g",{mask:"url(#MicIconWithSpeakingIndicatorMask)"},u.a.createElement("g",{className:"MicIconWithSpeakingIndicator__scale"},u.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"}),u.a.createElement("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"}))))};function Bt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ht(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ft(e){var t=e.id,n=e.photo,r=e.disablePhoto,i=e.info,a=e.chatUnreadCount,o=void 0===a?0:a,s=e.callMenuActions,c=e.isVideoEnabled,u=e.isAudioEnabled,d=e.isScreenSharingEnabled,p=e.isOratorMode,h=e.isFullScreen,f=e.onToggleVideo,m=e.onToggleAudio,v=e.onLeaveCall,g=e.onCollapseCall,_=e.onToggleOratorMode,y=e.onChat,E=e.onHandClick,S=e.onToggleScreenShare,b=e.onFullScreenToggle,T=e.isParticipantControlActive,w=e.isLayoutSwitchShown,P=e.isScreenShareControlShown,R=e.isHandRaised,N=e.isHandControlShown,k=e.isChatControlShown,L=e.onParticipantsClick,D=e.onTooltipChange,M=e.onHidePanel,j=e.notification,x=e.tooltips,U=e.amISpeaking,V=e.children,B=Object(O.classNames)("Call",{"Call--fullscreen":h}),H=l.useRef(null),F=function(e,t){var n=Bt(l.useState(!0),2),r=n[0],i=n[1],a=l.useRef(null),o=l.useRef(!1),s=l.useRef(!1),c=()=>{o.current||s.current?s.current=!1:(a.current&&window.clearTimeout(a.current),i(!0),a.current=window.setTimeout(()=>{i(!1),a.current=null,t&&t()},5e3))};return l.useEffect(()=>{c();var t=Object(St.throttle)(()=>{c()},1e3);return e.current.addEventListener("mousemove",t),()=>{o.current=!0,a.current&&window.clearTimeout(a.current),e.current.removeEventListener("mousemove",t)}},[]),[r,e=>{e?i(!0):(i(!1),s.current=!0)}]}(H,M),W=Bt(F,2),z=W[0],J=W[1],Y=Object(O.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!z}),X=Object(O.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!z},"Call__curtain"),Z=Object(O.classNames)("Call__buttons","Call__controlPanel",{"Call__controlPanel--hideBottom":!z});return l.createElement("section",{className:B,onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),ref:H},l.createElement(G,{id:t,photo:n,disablePhoto:r},V),i,l.createElement("div",{className:X}),l.createElement(at,{alignX:"l",alignY:"b",className:Y},k&&l.createElement(Gt,{content:Object(q.getLang)("calls_chat"),open:x.chat,delay:300,onOpen:()=>D("chat",!0),onClose:()=>D("chat",!1)},l.createElement(dt,{unreadCount:o,onClick:y})),N&&l.createElement(Gt,{content:R?Object(q.getLang)("calls_tooltip_lower_hand"):Object(q.getLang)("calls_tooltip_raise_hand"),open:x.hand,delay:300,onOpen:()=>D("hand",!0),onClose:()=>D("hand",!1)},l.createElement(K,{icon:l.createElement(It,null),type:"hand",isActive:R,onClick:E})),P&&l.createElement(Gt,{content:d?Object(q.getLang)("calls_stop_screen_share"):Object(q.getLang)("calls_start_screen_share"),open:x.screenShare,delay:300,onOpen:()=>D("screenShare",!0),onClose:()=>D("screenShare",!1)},l.createElement(K,{icon:l.createElement(Ot,null),isActive:d,onClick:S}))),l.createElement(at,{alignX:"r",alignY:"b",style:h?{right:"70px"}:void 0,className:Y},w&&l.createElement(Gt,{content:Object(q.getLang)(p?"calls_show_grid":"calls_show_orator"),open:x.layout,delay:300,onOpen:()=>D("layout",!0),onClose:()=>D("layout",!1)},l.createElement(K,{type:p?"changeToGrid":"changeToOrator",onClick:_})),l.createElement(et,{items:s},l.createElement(K,{type:"settings"})),l.createElement(Gt,{content:Object(q.getLang)("calls_collapse"),open:x.collapse,delay:300,onOpen:()=>D("collapse",!0),onClose:()=>D("collapse",!1)},l.createElement(K,{type:"collapse",onClick:g})),l.createElement(Gt,{content:h?Object(q.getLang)("calls_tooltip_fullscreen_off"):Object(q.getLang)("calls_tooltip_fullscreen_on"),open:x.fullscreen,delay:300,onOpen:()=>D("fullscreen",!0),onClose:()=>D("fullscreen",!1)},l.createElement(K,{onClick:b,icon:h?l.createElement(At,null):l.createElement(Lt,null)}))),l.createElement("footer",{className:"Call__footer"},j&&l.createElement("div",{className:"Call__notification"},j),l.createElement("div",{className:Z},l.createElement(I,{type:T?C.OFF:C.ON,icon:l.createElement(Et,null),onClick:L,className:"Call__footerButton"}),l.createElement(I,{type:c?C.ON:C.OFF,icon:c?l.createElement(A,null):l.createElement(jt,null),onClick:f,className:"Call__footerButton"}),l.createElement(I,{type:u?C.ON:C.OFF,icon:u?U?l.createElement(Vt,null):l.createElement(gt,null):l.createElement(ft,null),onClick:m,className:"Call__footerButton"}),l.createElement(I,{type:C.NEGATIVE,icon:l.createElement(ct,null),onClick:v,className:"Call__footerButton"}))))}var Wt=function(e){var t=e.limit,n=e.children,r=l.Children.toArray(n),i=Math.min(r.length,t),a=Object(O.classNames)("CallGridNew","CallGridNew--c"+i);return u.a.createElement("section",{className:a},u.a.createElement("div",{className:"CallGridNew__in"},r.map((function(e,t){return u.a.createElement("article",{className:"CallGridNew__item",key:e.key||t},e)}))))},zt=function(e){var t=e.children,n=e.orator,r=e.onToggleParticipantsAside,i=e.isShownParticipantsAside,a=u.a.Children.toArray(t),o=Object(O.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!i}),s=Object(O.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!i}),c=Object(O.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":i,"CallOrator__toggleArrow--toRight":!i});return u.a.createElement("article",{className:o},u.a.createElement("main",{className:"CallOrator__orator"},n),u.a.createElement("button",{className:"CallOrator__toggleOthers",onClick:r},u.a.createElement("div",{className:"CallOrator__toggleIcon"},u.a.createElement("div",{className:c}))),u.a.createElement("aside",{className:s},u.a.createElement("ul",{className:"CallOrator__list"},a.map((function(e){return u.a.createElement("li",{className:"CallOrator__participant",key:e.key?e.key:void 0},e)})))))},Kt=function(e){var t=e.children,n=e.className,r=Object(O.classNames)("CallNotification",n);return u.a.createElement("div",{className:r},t)},Jt=function(){return(Jt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},qt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Yt=function(e){var t=qt(e,[]);return u.a.createElement("svg",Jt({width:"14",height:"12",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),u.a.createElement("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"}))},Xt=function(e){var t=e.state,n=e.dispatch,r=Object(l.useMemo)((function(){return function(e){if(!e.notification)return null;switch(e.notification.type){case p.NotificationType.SPEAKING_ON_MUTE:return u.a.createElement(H.default,null,Object(q.getLang)("calls_notification_mic_is_mute"));case p.NotificationType.SCREEN_SHARING_STARTED:if(!(n=e.participants[e.notification.data])||!n.name)return u.a.createElement(H.default,null,Object(q.getLang)("calls_notification_screen_sharing_started"));var t=Object($.langSex)(n.sex,Object(q.getLang)("calls_notification_user_started_screen_sharing",!0));return u.a.createElement(H.default,null,t.replace("{user}",n.name));case p.NotificationType.RAISED_HAND:var n=e.participants[e.notification.data];t=Object($.langSex)(n.sex,Object(q.getLang)("calls_notification_raised_hand",!0));return u.a.createElement(H.default,null,t.replace("{user}",n.name));case p.NotificationType.BAD_NETWORK_CONNECTION:return u.a.createElement(H.default,null,Object(q.getLang)("calls_notification_bad_network_connection"));case p.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[u.a.createElement(Yt,{key:"icon"}),u.a.createElement(H.default,{key:"text"},Object(q.getLang)("calls_notification_bad_network_connection_disable_camera"))];default:return null}}(t)}),[t.notification]),i=Object(l.useRef)(0);return Object(l.useEffect)((function(){return i.current&&window.clearTimeout(i.current),t.notification&&0!==t.notification.timer&&(i.current=window.setTimeout((function(){n({type:p.CALL_NOTIFICATION,notification:null}),i.current=0}),t.notification.timer||p.defaultNotificationLifeSpan)),function(){i.current&&window.clearTimeout(i.current)}}),[t.notification]),t.notification?u.a.createElement(Kt,null,r):null};let Zt=!0,$t=!0;function Qt(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function en(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const a=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};const a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function tn(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Zt=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function nn(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):($t=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function rn(){if("object"==typeof window){if(Zt)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function an(e,t){$t&&console.warn(e+" is deprecated, please use "+t+" instead.")}function on(e){const{navigator:t}=e,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=Qt(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=Qt(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=Qt(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=Qt(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function sn(e){return"[object Object]"===Object.prototype.toString.call(e)}function cn(e){return sn(e)?Object.keys(e).reduce((function(t,n){const r=sn(e[n]),i=r?cn(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,{[n]:i})}),{}):e}function ln(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const a=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(n=>{e(t,t.get(n),r)})}))}(e,n,i)})}),i}const un=rn;function dn(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=on(e),r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const o=n.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||o)){let n;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?n=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then(t=>{let o=(t=t.filter(e=>"videoinput"===e.kind)).find(e=>n.some(t=>e.label.toLowerCase().includes(t)));return!o&&t.length&&n.includes("back")&&(o=t[t.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),un("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return un("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(a(e))})})}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(a(e))))}}}function pn(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function hn(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function fn(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else en(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function mn(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vn(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(a(i(e)))};return t.apply(this,[r,e])}return new Promise((e,n)=>{t.apply(this,[function(t){e(a(i(t)))},n])}).then(n,r)}}function gn(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ln(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),en(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ln(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function _n(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function yn(e){if(!e.RTCPeerConnection)return;const t=on(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return _n(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>a(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function En(e){const t=on(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;const n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function Sn(e){const t=on(e);en(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var bn=n("8D0k"),Cn=n.n(bn);function On(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function Tn(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function wn(e){const t=on(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=Cn()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&an("RTCIceServer.url","RTCIceServer.urls");const r="string"==typeof t;return r&&(t=[t]),t=t.filter(e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n}),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers,t.version),rn("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function In(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function Pn(e){const t=on(e),n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){an("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Rn(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function An(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Nn(e){const t=on(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})),t.version<68){const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,a]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,a)}}function kn(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ln(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),en(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Dn(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){an("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Mn(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function jn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();"encodings"in n||(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function xn(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"sendEncodings"in this?Object.assign({},{encodings:this.sendEncodings},e):e})}function Un(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Gn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Vn(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function Bn(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function Hn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function Fn(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Wn(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function Wn(e){return e&&void 0!==e.video?Object.assign({},e,{video:cn(e.video)}):e}function zn(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(an("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Kn(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Jn(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function qn(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Yn=n("KCt4"),Xn=n.n(Yn);function Zn(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Xn.a.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,en(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function $n(e){if(!e.RTCPeerConnection)return;const t=on(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Xn.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Xn.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Xn.a.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=a(arguments[0],e);let o;o=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>o}),this._sctp=s}return o.apply(this,arguments)}}function Qn(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},en(e,"datachannel",e=>(t(e.channel,e.target),e))}function er(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function tr(e){if(!e.RTCPeerConnection)return;const t=on(e);if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n")),n.apply(this,arguments)}}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=rn,c=on(e),l={browserDetails:c,commonShim:s,extractVersion:Qt,disableLog:tn,disableWarnings:nn};switch(c.browser){case"chrome":if(!r||!En||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),l;if(null===c.version)return n("Chrome shim can not determine version, not shimming."),l;n("adapter.js shimming chrome."),l.browserShim=r,dn(e),hn(e),En(e),fn(e),yn(e),mn(e),vn(e),gn(e),Sn(e),Zn(e),er(e),$n(e),Qn(e),tr(e);break;case"firefox":if(!a||!Nn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),l;n("adapter.js shimming firefox."),l.browserShim=a,Pn(e),Nn(e),An(e),Dn(e),kn(e),Ln(e),Mn(e),jn(e),xn(e),Un(e),Gn(e),Zn(e),er(e),$n(e),Qn(e);break;case"edge":if(!i||!wn||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),l;n("adapter.js shimming edge."),l.browserShim=i,On(e),Tn(e),wn(e),In(e),$n(e),Qn(e);break;case"safari":if(!o||!t.shimSafari)return n("Safari shim is not included in this adapter release."),l;n("adapter.js shimming safari."),l.browserShim=o,zn(e),Jn(e),Hn(e),Vn(e),Bn(e),Kn(e),Fn(e),qn(e),Zn(e),$n(e),Qn(e),tr(e);break;default:n("Unsupported browser!")}}({window});var nr=n("dAlA"),rr=n.n(nr),ir=n("9XzT"),ar=function(e,t){return(ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function or(e,t){function n(){this.constructor=e}ar(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var sr,cr,lr=function(){return(lr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ur(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function dr(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function pr(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}(cr=sr||(sr={})).CAMERA_PERMISSION="camera",cr.MIC_PERMISSION="mic",cr.CAMERA_ACCESS="cameralock",cr.MIC_ACCESS="miclock",cr.MIC_NOT_FOUND="nomic",cr.SCREEN_PERMISSION="screenpermission",cr.SCREEN_ACCESS="screenlock",cr.CONNECTION="connection",cr.NETWORK="network",cr.UNKNOWN="unknown",cr.UNSUPPORTED="unsupported",cr.SIGNALING_FAILED="signalingfailed",cr.API="api",cr.AUTH="auth";var hr,fr,mr=sr,vr=function(){function e(){}return Object.defineProperty(e,"sessionKey",{get:function(){return e._sessionKey},set:function(t){e._sessionKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sessionSecretKey",{get:function(){return e._sessionSecretKey},set:function(t){e._sessionSecretKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"accessToken",{get:function(){return e._accessToken},set:function(t){e._accessToken=t},enumerable:!1,configurable:!0}),e.isEmpty=function(){return!e._sessionKey||!e._sessionSecretKey},e}(),gr=function(){function e(){}return e.set=function(t){t.hasOwnProperty("voiceParams")&&(Object.assign(e._params.voiceParams,t.voiceParams),delete t.voiceParams),t.hasOwnProperty("specListenerParams")&&(Object.assign(e._params.specListenerParams,t.specListenerParams),delete t.specListenerParams),t.hasOwnProperty("unifiedPlanBrowsers")&&(Object.assign(e._params.unifiedPlanBrowsers,t.unifiedPlanBrowsers),delete t.unifiedPlanBrowsers),t.hasOwnProperty("apiAuth")&&(vr.accessToken=t.apiAuth.accessToken,vr.sessionKey=t.apiAuth.sessionKey,vr.sessionSecretKey=t.apiAuth.sessionSecretKey),Object.assign(e._params,t)},e.get=function(t){return e._params[t]},Object.defineProperty(e,"appName",{get:function(){return e._params.appName},enumerable:!1,configurable:!0}),Object.defineProperty(e,"appVersion",{get:function(){return e._params.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"protocolVersion",{get:function(){return e._params.protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"platform",{get:function(){return e._params.platform},enumerable:!1,configurable:!0}),Object.defineProperty(e,"clientType",{get:function(){return e._params.clientType},set:function(t){e._params.clientType=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"device",{get:function(){return e._params.device},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiAppId",{get:function(){return e._params.apiAppId},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiKey",{get:function(){return e._params.apiKey},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiEnv",{get:function(){switch(e._params.apiEnv){case"TEST":return{api:"https://apitest.ok.ru/api/",connect:"https://test.ok.ru/"};case"VIDEOTEST":return{api:"https://videotestapi.ok.ru/api/",connect:"https://test.ok.ru/"};default:return{api:"https://api.ok.ru/",connect:"https://connect.ok.ru/"}}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"authToken",{get:function(){return e._params.authToken},set:function(t){e._params.authToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"anonymToken",{get:function(){return e._params.anonymToken},set:function(t){e._params.anonymToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"domain",{get:function(){return e._params.domain},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceServers",{get:function(){return e._params.iceServers},set:function(t){e._params.iceServers=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssBase",{get:function(){return e._params.wssBase},set:function(t){e._params.wssBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssToken",{get:function(){return e._params.wssToken},set:function(t){e._params.wssToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectDelay",{get:function(){return e._params.signalingReconnectDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxDelay",{get:function(){return e._params.signalingReconnectMaxDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxCount",{get:function(){return e._params.signalingReconnectMaxCount},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitConnectionDelay",{get:function(){return e._params.waitConnectionDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitResponseDelay",{get:function(){return e._params.waitResponseDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitMessageDelay",{get:function(){return e._params.waitMessageDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"forceRelayPolicy",{get:function(){return e._params.forceRelayPolicy},set:function(t){e._params.forceRelayPolicy=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinWidth",{get:function(){return e._params.videoMinWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxWidth",{get:function(){return e._params.videoMaxWidth},set:function(t){e._params.videoMaxWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinHeight",{get:function(){return e._params.videoMinHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxHeight",{get:function(){return e._params.videoMaxHeight},set:function(t){e._params.videoMaxHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoAspectRatio",{get:function(){return e._params.videoAspectRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFrameRate",{get:function(){return e._params.videoFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFacingMode",{get:function(){return e._params.videoFacingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e,"screenFrameRate",{get:function(){return e._params.screenFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"voiceParams",{get:function(){return e._params.voiceParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"specListenerParams",{get:function(){return e._params.specListenerParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceRestartWaitTime",{get:function(){return e._params.iceRestartWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"transportConnectionWaitTime",{get:function(){return e._params.transportConnectionWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"statisticsInterval",{get:function(){return e._params.statisticsInterval},enumerable:!1,configurable:!0}),Object.defineProperty(e,"perfStatReportEnabled",{get:function(){return e._params.perfStatReportEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e,"allowMissingMic",{get:function(){return e._params.allowMissingMic},enumerable:!1,configurable:!0}),Object.defineProperty(e,"directAudioOutput",{get:function(){return e._params.directAudioOutput},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionAudioBitrate",{get:function(){return e._params.badConnectionAudioBitrate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionSilenceBitrate",{get:function(){return e._params.badConnectionSilenceBitrate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"badConnectionVideoBitrate",{get:function(){return e._params.badConnectionVideoBitrate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"noiseSuppression",{get:function(){return e._params.noiseSuppression},set:function(t){e._params.noiseSuppression=t},enumerable:!1,configurable:!0}),e.isUnifiedPlan=function(t,n){var r=e._params.unifiedPlanBrowsers;return!!r.hasOwnProperty(t)&&n>=r[t]},e._params={appName:"ok.calls.sdk.js",appVersion:1.1,protocolVersion:3,platform:"WEB",clientType:"PORTAL",device:"browser",apiAppId:42,apiKey:"",authToken:"",anonymToken:"",apiEnv:"PROD",domain:"",iceServers:[],wssBase:"",wssToken:"",signalingReconnectDelay:1e3,signalingReconnectMaxDelay:5e3,signalingReconnectMaxCount:20,waitConnectionDelay:1e4,waitResponseDelay:1e4,waitMessageDelay:15e3,forceRelayPolicy:!1,videoMinWidth:428,videoMinHeight:240,videoMaxWidth:1280,videoMaxHeight:720,videoAspectRatio:16/9,videoFrameRate:25,screenFrameRate:10,iceRestartWaitTime:2e4,transportConnectionWaitTime:5e3,statisticsInterval:5e3,perfStatReportEnabled:!0,voiceParams:{smoothing:.8,minFreq:200,maxFreq:5e3,interval:500,threshold:.35,speakerLevelMultiplier:1.8},specListenerParams:{connectionTimeout:1e4,volumeTimeout:1e4},unifiedPlanBrowsers:{Firefox:10,Chrome:76,Safari:12},allowMissingMic:!1,directAudioOutput:!1,badConnectionAudioBitrate:2e3,badConnectionSilenceBitrate:800,badConnectionVideoBitrate:3e4,noiseSuppression:!0},e}();function _r(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=gr.get(e);r&&r.apply(null,t)}function yr(e){return Object.assign({},e)}!function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(hr||(hr={})),function(e){e.onLocalStream=function(e,t){_r("onLocalStream",e,yr(t))},e.onLocalStreamUpdate=function(e,t){_r("onLocalStreamUpdate",yr(e),t)},e.onLocalStatus=function(e){_r("onLocalStatus",e)},e.onRemoteStream=function(e,t){_r("onRemoteStream",e,t)},e.onConversation=function(e){_r("onConversation",e)},e.onRemoteMediaSettings=function(e,t){_r("onRemoteMediaSettings",e,yr(t))},e.onRemoteParticipantState=function(e,t){_r("onRemoteParticipantState",e,yr(t))},e.onParticipantStatus=function(e,t,n){void 0===n&&(n=null),_r("onParticipantStatus",e,t,n)},e.onUserPermissions=function(e){_r("onUserPermissions",e.slice())},e.onPermissionsRequested=function(){_r("onPermissionsRequested")},e.onPermissionsError=function(e){_r("onPermissionsError",e)},e.onRemoteRemoved=function(e){_r("onRemoteRemoved",e)},e.onCallState=function(e,t,n){_r("onCallState",e,t,yr(n))},e.onConferenceMode=function(e){_r("onConferenceMode",e)},e.onDeviceSwitched=function(e,t){_r("onDeviceSwitched",e,t)},e.onUnmuteRequest=function(e,t){_r("onUnmuteRequest",e,t)},e.onRolesChanged=function(e,t){_r("onRolesChanged",e,t)},e.onLocalRolesChanged=function(e){_r("onLocalRolesChanged",e)},e.onPinnedParticipant=function(e,t){_r("onPinnedParticipant",e,t)},e.onCallAccepted=function(){_r("onCallAccepted")},e.onRateNeeded=function(){_r("onRateNeeded")},e.onSpeakerChanged=function(e){_r("onSpeakerChanged",e)},e.onVolumesDetected=function(e){_r("onVolumesDetected",e)},e.onLocalVolume=function(e,t){_r("onLocalVolume",e,t)},e.onJoinStatus=function(e,t){_r("onJoinStatus",e,t)},e.onHangup=function(e,t){_r("onHangup",e,t)},e.onMultipartyChatCreated=function(e){_r("onMultipartyChatCreated",yr(e))},e.onDeviceChange=function(){_r("onDeviceChange")},e.onFingerprintChange=function(e){_r("onFingerprintChange",e)},e.onTokenExpired=function(){_r("onTokenExpired")},e.onChatMessage=function(e,t,n){void 0===n&&(n=!1),_r("onChatMessage",e,t,n)},e.onCustomData=function(e,t,n){void 0===n&&(n=!1),_r("onCustomData",e,t,n)},e.onRecordStarted=function(e,t,n,r){_r("onRecordStarted",e,t,n,r)},e.onRecordStopped=function(){_r("onRecordStopped")},e.onNetworkStatus=function(e){_r("onNetworkStatus",e)},e.onDebugMessage=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];_r.apply(void 0,pr(["onDebugMessage",e],t))},e.onStatistics=function(e,t){_r("onStatistics",Object.assign({},e,{memory:t}))}}(fr||(fr={}));var Er,Sr,br=fr;!function(e){e.DEBUG="DEBUG",e.LOG="LOG",e.WARN="WARN",e.ERROR="ERROR"}(Er||(Er={})),function(e){var t=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];br.onDebugMessage.apply(br,pr([e],t))},n=console.debug.bind(console,"📞"),r=console.log.bind(console,"📞"),i=console.warn.bind(console,"📞"),a=console.error.bind(console,"📞"),o=t.bind(null,Er.DEBUG),s=t.bind(null,Er.LOG),c=t.bind(null,Er.WARN),l=t.bind(null,Er.ERROR);e.debug=o,e.log=s,e.warn=c,e.error=l,e.toggle=function(t){t?(e.debug=n,e.log=r,e.warn=i,e.error=a):(e.debug=o,e.log=s,e.warn=c,e.error=l)}}(Sr||(Sr={}));var Cr,Or=Sr,Tr=function(){try{var e,t=Date.now().toString(),n=window.localStorage;return n.setItem(t,t),e=n.getItem(t)===t,n.removeItem(t),e?n:null}catch(e){return null}}();!function(e){e.get=function(e){return function(e){var t=Tr?Tr.getItem("_okcls_"+e):null;if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}}(e)||null},e.set=function(e,t){!function(e,t){try{Tr&&Tr.setItem("_okcls_"+e,JSON.stringify(t))}catch(e){}}(e,t)},e.remove=function(e){!function(e){Tr&&Tr.removeItem("_okcls_"+e)}(e)}}(Cr||(Cr={}));var wr,Ir=Cr;!function(e){e.patchSDP=function(e,t,n){if(!t&&!n)return e;var r=new RegExp("[\r\n]+");function i(e,t,n){var r,i=e.split(" "),a=i.slice(0,3);for(r=3;r<i.length;r++)n.includes(i[r])&&a.push(i[r]);for(r=3;r<i.length;r++)n.includes(i[r])||t.includes(i[r])||a.push(i[r]);return a.join(" ")}function a(e,t,n,r){var a,o="m="+t;for(a=0;a<e.length;++a)if(e[a].startsWith(o)){e[a]=i(e[a],n,r);break}}var o=[],s=e.split(r);if((n||t)&&(o=function(e,t){var n,r=new RegExp("a=rtpmap:(\\d+) ([a-zA-Z0-9-]+)\\/\\d+"),i=[];for(n=0;n<e.length;++n){var a=e[n].match(r);a&&3===a.length&&"H264"===a[2]&&i.push(a[1])}return i}(s)),n){var c=o.slice(0),l=new RegExp("a=fmtp:(\\d+) apt=(\\d+)"),u=void 0;for(u=0;u<s.length;++u)(p=s[u].match(l))&&3===p.length&&c.includes(p[2])&&c.push(p[1]);var d=new RegExp("a=(rtpmap|rtcp-fb|fmtp):(\\d+) .*");for(u=s.length;u--;){var p;(p=s[u].match(d))&&3===p.length&&c.includes(p[2])&&s.splice(u,1)}a(s,"video",c,[])}else t&&a(s,"video",[],o);return s.join("\r\n")},e.getPeerIdString=function(e){return e?e.type+"_"+e.id:"_"},e.getPeerConnectionHostInfo=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return e&&e.getStats?[2,e.getStats(null).then((function(e){var t=null,n=null;if(e.forEach((function(t){"transport"===t.type&&t.selectedCandidatePairId?n=e.get(t.selectedCandidatePairId):"candidate-pair"!==t.type||"succeeded"!==t.state||n||t.hasOwnProperty("selected")&&!t.selected||(n=t)})),n&&n.localCandidateId){var r=e.get(n.localCandidateId);r&&(t={type:r.candidateType,ip:r.ip||r.ipAddress,port:r.port||r.portNumber})}return t})).catch((function(){return null}))]:[2,Promise.resolve(null)]}))}))};var t=/^[0-9]+$/,n=/^([gu])([0-9]+)$/;function r(e,r){var i=String(e);return n.test(i)?(Or.warn("Already composite id ["+e+"] type supplied ["+r+"]"),i):"GROUP"===r?"g"+i:"USER"===r?"u"+i:(Or.warn("Unknown type ["+r+"] for id ["+e+"]"),i.match(t)?"u"+i:i)}function i(e){return r(e.id,e.idType)}e.composeId=r,e.composeParticipantId=i,e.composeMessageId=function(e){return e.participant?i(e.participant):r(e.participantId,e.participantType)},e.decomposeId=function(e){var r=String(e),i=r.match(n);return i?{id:String(i[2]),type:"g"===i[1]?"GROUP":"USER"}:(Or.warn("Unsupported compositeId ["+e+"]"),{id:t.test(r)?r:e,type:"USER"})},e.uuid=function(){var e,t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[t]=n[19===t?3&e|8:e]);return r.join("")},e.throttle=function(e,t){var n;return function(){var r=this,i=arguments;n&&window.clearTimeout(n),n=window.setTimeout((function(){e.apply(r,i)}),t)}},e.sdpFingerprint=function(e){for(var t="",n=0,r=e.split("\n");n<r.length;n++){var i=r[n];if(i.startsWith("a=fingerprint")){var a=i.split(" ");if(2===a.length){t=a[1];break}}}if(!t)return rr.a.minusOne;for(var o=t.split(":"),s=rr.a.zero,c=Math.min(7,o.length-1);c>=0;c--){var l=rr()(o[c],16);s=s.shiftLeft(8).or(l)}return function(e,t){var n=t.value;if("bigint"==typeof n)return rr()(BigInt.asIntN(64,n));var r=rr.a.one.shiftLeft(64),i=t.and(r.subtract(1));return i.greaterOrEquals(r.subtract(i))?i.subtract(r):i}(0,s)},e.delay=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,new Promise((function(t){return window.setTimeout(t,e)}))]}))}))},e.comparePlainObjects=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0,a=n;i<a.length;i++){var o=a[i];if(!t.hasOwnProperty(o))return!1;if(t[o]!==e[o])return!1}return!0},e.applySettings=function(e,t,n){var r=[];return e.getSenders().forEach((function(e){var i=e.track;if(t&&i&&"video"===i.kind){var a=i.getSettings();if(a){var o=a.width,s=a.height,c=t.maxBitrateK?1024*t.maxBitrateK:null,l=o&&s&&t.maxDimension?Math.max(1,Math.max(o,s)/t.maxDimension):null,u=t.maxFramerate?t.maxFramerate:null,d=t.degradationPreference?t.degradationPreference:"balanced",p=n[i.id];if(p&&p.bitrate===c&&p.scaleResolutionDownBy===l&&p.maxFramerate===u&&p.degradationPreference===d)return void(r[i.id]=p);r[i.id]={bitrate:c,scaleResolutionDownBy:l,maxFramerate:u,degradationPreference:d};var h=e.getParameters();h.encodings||(h.encodings=[{}]),h.encodings.forEach((function(e){c?e.maxBitrate=c:delete e.maxBitrate,l?e.scaleResolutionDownBy=l:delete e.scaleResolutionDownBy,u?e.maxFramerate=u:delete e.maxFramerate})),h.degradationPreference=d,e.setParameters(h)}}})),r},e.includesOneOf=function(e,t){Array.isArray(t)||(t=[t]);for(var n=0,r=t;n<r.length;n++){var i=r[n];if(e.includes(i))return!0}return!1}}(wr||(wr={}));var Pr,Rr,Ar,Nr,kr=wr,Lr=null,Dr=null,Mr=[],jr=[],xr=[],Ur=null,Gr=null,Vr=null,Br=!1,Hr=!1,Fr=!1,Wr=!1,zr=null,Kr="",Jr=[],qr=null,Yr=navigator.appVersion,Xr=navigator.appName,Zr=navigator.userAgent;!function(e){e.USER="user",e.ENVIRONMENT="environment",e.LEFT="left",e.RIGHT="right"}(Nr||(Nr={}));var $r,Qr=function(){function e(e,t){void 0===t&&(t=!1);var n=!1;if(e){n={noiseSuppression:gr.noiseSuppression,echoCancellation:!0,autoGainControl:!0};var r=void 0;Gr&&(r=Gr.deviceId),"string"==typeof e&&(r=e),r&&(n.deviceId={exact:r})}var i=!1;if(t){i={width:{min:gr.videoMinWidth,max:gr.videoMaxWidth,ideal:gr.videoMaxWidth},height:{min:gr.videoMinHeight,max:gr.videoMaxHeight,ideal:gr.videoMaxHeight},aspectRatio:{ideal:gr.videoAspectRatio},frameRate:{ideal:gr.videoFrameRate}};var a=void 0;Ur&&(a=Ur.deviceId),"string"==typeof t&&(a=t),a&&(i.deviceId={exact:a}),gr.videoFacingMode&&(i.facingMode={exact:gr.videoFacingMode})}this.audio=n,this.video=i,this.needVideo=!!i}return e.prototype.getNative=function(){return Object.assign({},{audio:this.audio,video:this.video})},e.prototype.simplify=function(){return"object"==typeof this.video&&(this.video.width||this.video.height?(delete this.video.width,delete this.video.height):this.video.aspectRatio?delete this.video.aspectRatio:this.video.frameRate?delete this.video.frameRate:(this.video.deviceId||this.video.facingMode)&&(delete this.video.deviceId,delete this.video.facingMode)),"object"==typeof this.audio&&(this.audio.echoCancellation||this.audio.autoGainControl||this.audio.noiseSuppression?(delete this.audio.echoCancellation,delete this.audio.autoGainControl,delete this.audio.noiseSuppression):this.audio.deviceId&&delete this.audio.deviceId),!0===this.video&&!0===this.audio?this.video=!1:!1===this.video&&!0===this.audio&&gr.allowMissingMic?(this.audio=!1,this.video=this.needVideo):!0===this.video&&!1===this.audio&&(this.video=!1),this.video&&!Object.keys(this.video).length&&(this.video=!0),this.audio&&!Object.keys(this.audio).length&&(this.audio=!0),this},e.prototype.canSimplify=function(){var e="object"==typeof this.video&&(this.video.width||this.video.height||this.video.aspectRatio||this.video.frameRate||this.video.facingMode||this.video.deviceId)||this.video;return!!("object"==typeof this.audio&&(this.audio.deviceId||this.audio.noiseSuppression||this.audio.echoCancellation||this.audio.autoGainControl)||gr.allowMissingMic&&this.audio||e)},e.prototype.isVideo=function(){return!!this.video},e.prototype.isAudio=function(){return!!this.audio},e}(),ei=function(e){function t(t,n){var r=e.call(this,!1,!0)||this;return"object"==typeof r.video?(delete r.video.deviceId,delete r.video.aspectRatio,delete r.video.frameRate,delete r.video.facingMode):r.video={},r.video.cursor="motion",r.video.width=t,r.video.height=n,r.video.frameRate=gr.screenFrameRate,r}return or(t,e),t}(Qr);function ti(){Lr=null,ni().then((function(){return br.onDeviceChange()}))}function ni(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return Lr?[2,Lr]:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(!Dr&&navigator.mediaDevices.addEventListener&&(Dr=kr.throttle(ti,1e3),navigator.mediaDevices.addEventListener("devicechange",Dr)),[2,Lr=navigator.mediaDevices.enumerateDevices().then((function(e){Mr=e.filter((function(e){return"videoinput"===e.kind&&(e.label&&(Br=!0),!0)})),jr=e.filter((function(e){return"audioinput"===e.kind&&(e.label?Hr=!0:$r.isMobile()&&"Firefox"===$r.browserName()&&(Hr=Br),!0)})),xr=e.filter((function(e){return"audiooutput"===e.kind}));var t=Ir.get("videoinput"),n=Ir.get("audioinput"),r=Ir.get("audiooutput");return Ur=Mr.find((function(e){return e.deviceId===t}))||null,Gr=jr.find((function(e){return e.deviceId===n}))||null,Vr=xr.find((function(e){return e.deviceId===r}))||null,Lr=Promise.resolve(e),e})).catch((function(){return Lr=null,[]}))]):[2,Promise.resolve([])]}))}))}function ri(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return $r.isBrowserSupported()?[2,new Promise((function(e){var t={};$r.baseChromeVersion()&&(t.sdpSemantics="plan-b"),new window.RTCPeerConnection(t).createOffer({offerToReceiveVideo:!0}).then((function(t){/^a=rtpmap:\d+ VP8\/\d+$/m.test(t.sdp)&&(Fr=!0),/^a=mid:0$/m.test(t.sdp)&&(Wr=!0),e()})).catch(e)}))]:[2,Promise.resolve()]}))}))}function ii(e,t){return ur(this,void 0,void 0,(function(){var n,r,i=this;return dr(this,(function(a){return Or.debug("Try to get media",e.getNative()),(n=$r.hasPermissions(e.isVideo()))||t||br.onPermissionsRequested(),r=function(e){return n||ti(),t&&br.onPermissionsError(t),e},!gr.allowMissingMic||e.isAudio()||e.isVideo()?[2,navigator.mediaDevices.getUserMedia(e.getNative()).then((function(e){return r(e)})).catch((function(n){return ur(i,void 0,void 0,(function(){return dr(this,(function(r){switch(n.name){case"PermissionDeniedError":case"PermissionDismissedError":case"NotAllowedError":case"SecurityError":case"DOMException":t=e.isVideo()?mr.CAMERA_PERMISSION:mr.MIC_PERMISSION;break;case"OverconstrainedError":case"TypeError":case"NotFoundError":break;case"AbortError":case"NotReadableError":t=e.isVideo()?mr.CAMERA_ACCESS:mr.MIC_ACCESS}if(e.canSimplify())return[2,ii(e.simplify(),t)];throw t||mr.UNKNOWN}))}))}))]:[2,r(new MediaStream)]}))}))}function ai(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return Or.debug("Try to get screen",e.getNative()),[2,navigator.mediaDevices.getDisplayMedia(e.getNative()).catch((function(e){switch(e.name){case"PermissionDeniedError":case"NotAllowedError":case"SecurityError":throw mr.SCREEN_PERMISSION;default:throw mr.SCREEN_ACCESS}}))]}))}))}function oi(){return Jr.length?Jr:Jr=function(){var e,t=!1,n=0,r=Zr.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(r[1]))return["IE",(e=/\brv[ :]+(\d+)/g.exec(Zr))&&e[1]||"Unknown",t,n];if("Safari"===r[1]){if(e=Zr.match(/\bEdge\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(e=Zr.match(/\bCriOS\/(\d+)/))return["Chrome",e[1],!0,e[1]];if(e=Zr.match(/\bFxiOS\/(\d+)/))return["Firefox",e[1],!1,n];if(e=Zr.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1],!1,n];if(e=Zr.match(/\bOPT\/(\d+)/))return["Opera",e[1],!1,n]}if("Chrome"===r[1]){if(t=!0,n=Number(r[2]),e=Zr.match(/\bOPR\/(\d+)/))return["Opera",e[1]||"Unknown",t,n];if(e=Zr.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1]||"Unknown",t,n];if(e=Zr.match(/\bEdge?\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return["Opera","Hidden",t,n]}return e=Zr.match(/version\/(\d+)/i),[r[2]?r[1]:Xr,e&&e[1]||r[2]||Yr,t,n]}()}!function(e){function t(){return Mr.length>0}function n(){return Br}function r(){return Hr}function i(){if(!Ar||"ended"===Ar.readyState){var e=c(),t=e.createMediaStreamDestination(),n=e.createGain();n.gain.value=1e-5,n.connect(t),n.connect(e.destination);var r=e.createOscillator();r.type="sine",r.frequency.value=0,r.connect(n),r.start(),Ar=t.stream.getAudioTracks()[0]}return Object.assign(Ar.clone(),{enabled:!1})}function a(e,t){if(void 0===e&&(e=gr.videoMinWidth),void 0===t&&(t=gr.videoMinHeight),Rr||(Rr=document.createElement("canvas")).getContext("2d"),Rr.width=e,Rr.height=t,!Pr||"ended"===Pr.readyState){var n=Rr.captureStream(25);Pr=n.getVideoTracks()[0]}return Object.assign(Pr.clone(),{enabled:!1})}function o(){return oi()[0]}function s(){return oi()[1]}function c(){return qr||(qr=new(window.AudioContext||window.webkitAudioContext)),qr}e.init=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){switch(e.label){case 0:return[4,ri()];case 1:return e.sent(),[2,ni()]}}))}))},e.getCameras=function(){return Mr},e.getMicrophones=function(){return jr},e.getOutput=function(){return xr},e.hasCamera=t,e.hasMicrophone=function(){return jr.length>0},e.getSavedCamera=function(){return Ur},e.getSavedMicrophone=function(){return Gr},e.getSavedOutput=function(){return Vr},e.hasCameraPermission=n,e.hasMicrophonePermission=r,e.hasPermissions=function(e){return void 0===e&&(e=!1),!!r()&&(!t()||!e||n())},e.getUserMedia=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),ur(this,void 0,void 0,(function(){var r,o;return dr(this,(function(s){return r=n,o=t()&&e,[2,ii(new Qr(r,o)).then((function(e){return e.getVideoTracks().length||e.addTrack(a()),e.getAudioTracks().length||e.addTrack(i()),e}))]}))}))},e.getScreenMedia=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,ai(new ei(window.screen.width,window.screen.height))]}))}))},e.getUserVideo=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,ii(new Qr(!1,e||!0)).then((function(e){return e.getVideoTracks().length||e.addTrack(a()),e}))]}))}))},e.getUserAudio=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,ii(new Qr(e||!0,!1)).then((function(e){return e.getAudioTracks().length||e.addTrack(i()),e}))]}))}))},e.saveDeviceId=function(e,t){return ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return[4,ni()];case 1:return n=i.sent(),(r=n.find((function(n){return n.kind===e&&n.deviceId===t})))?("videoinput"===e?Ur=r:"audioinput"===e?Gr=r:"audiooutput"===e&&(Vr=r),Ir.set(e,t),[2,r]):[2,null]}}))}))},e.getSilentMediaTrack=i,e.getBlackMediaTrack=a,e.isBrowserSupported=function(){if("Edge"===o()&&s()<70)return!1;try{var e=window;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&e.RTCPeerConnection&&e.RTCIceCandidate&&e.RTCSessionDescription&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.RTCRtpSender&&e.RTCRtpSender.prototype.replaceTrack&&navigator.sendBeacon&&!0}catch(e){return!1}},e.isScreenCapturingSupported=function(){return!!navigator.mediaDevices.getDisplayMedia},e.canVP8=function(){return Fr},e.isUnifiedPlan=function(){return Wr},e.isBrokenH264=function(){return"Opera"===e.browserName()&&"Windows"===e.os()},e.canPreferH264=function(){return!(e.baseChromeVersion()&&e.isMobile())},e.os=function(){return Kr||(Kr=function(){var e={Windows:/Win/,Android:/Android/,OpenBSD:/OpenBSD/,SunOS:/SunOS/,Linux:/(Linux|X11)/,iPad:/(iPad)/,iPhone:/(iPhone)/,iPod:/(iPod)/,MacOS:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/,QNX:/QNX/,UNIX:/UNIX/,BeOS:/BeOS/,OS2:/OS\/2/,Bot:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/};for(var t in e)if(e.hasOwnProperty(t)&&e[t].test(Zr))return t;return"Unknown"}()),Kr},e.isMobile=function(){return null===zr&&(zr=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(Yr)),zr},e.browserName=o,e.browserVersion=s,e.baseChromeVersion=function(){return oi()[3]},e.getAudioContext=c}($r||($r={}));var si,ci=$r,li=function(){function e(){}return e.prototype.createJoinLink=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,{join_link:"nop"}]}))}))},e.prototype.removeJoinLink=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,{success:!0}]}))}))},e.prototype.getAnonymTokenByLink=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,""]}))}))},e.prototype.log=function(e){},e.prototype.prepareUserIds=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2]}))}))},e.prototype.hangupConversation=function(e){},e}(),ui=function(){function e(){}return e.prototype.log=function(e,t,n){},e.prototype.destroy=function(){},e}(),di=function(){function e(){this._handlers={},this._listeners=[],this.EVENT_LOG="EVENT_LOG"}return e.prototype._triggerEvent=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._handlers.hasOwnProperty(e)&&this._handlers[e].slice().forEach((function(e){e.apply(t,n)}))},e.prototype.addEventListener=function(e,t){if("function"!=typeof t)throw new Error("Listener should be a function");return this._handlers.hasOwnProperty(e)||(this._handlers[e]=[]),this._handlers[e].push(t),{dispose:this.removeEventListener.bind(this,e,t)}},e.prototype.removeEventListener=function(e,t){if(this._handlers.hasOwnProperty(e)){t||delete this._handlers[e];var n=this._handlers[e].indexOf(t);n>=0&&this._handlers[e].splice(n,1)}},e.prototype.subscribe=function(e,t,n){var r=e.addEventListener(t,n);this._listeners.push(r)},e.prototype.unsubscribe=function(){this._listeners.forEach((function(e){e.dispose()}))},e.prototype.log=function(e,t,n){void 0===n&&(n=!1),this._triggerEvent(this.EVENT_LOG,e,t,n)},e.prototype.onLog=function(e,t){this.subscribe(e,this.EVENT_LOG,t)},e}(),pi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return or(t,e),t.prototype.requestRealloc=function(e){},t.prototype.setEndpoint=function(e){},t.prototype.setConversationId=function(e){},t.prototype.readyToSend=function(){},t}(di);!function(e){e.USER="USER",e.GROUP="GROUP",e.CHAT="CHAT"}(si||(si={}));var hi,fi=si;!function(e){e.CANCELED="CANCELED",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.BUSY="BUSY",e.FAILED="FAILED",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.NOT_FRIENDS="NOT_FRIENDS",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED",e.OLD_VERSION="OLD_VERSION",e.SERVICE_DISABLED="SERVICE_DISABLED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.SOCKET_CLOSED="SOCKET_CLOSED"}(hi||(hi={}));var mi,vi=hi;!function(e){e.START="start",e.ACCEPT="accept",e.JOIN="join",e.RETRY="retry"}(mi||(mi={}));var gi,_i,yi=mi;function Ei(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.includes(i))return!1}return!0}function Si(e,t){return null===e||null===t?null===e&&null===t:e.maxDimension===t.maxDimension&&e.maxBitrateK===t.maxBitrateK&&e.maxFramerate===t.maxFramerate&&e.degradationPreference===t.degradationPreference}function bi(e,t){return!!Si(e.camera,t.camera)&&!!Si(e.screenSharing,t.screenSharing)}!function(e){e.USER="USER",e.ANONYM="ANONYM",e.GROUP="GROUP"}(gi||(gi={})),function(e){function t(e,t){return void 0===t&&(t=gi.USER),{id:e,type:t}}function n(e){return'{"id":"'+e.id+'","type":"'+e.type+'"}'}e.fromIds=function(e){return e.length?"object"==typeof e[0]?e:e.map((function(e){return t(e)})):[]},e.fromId=t,e.toString=n,e.fromIdToString=function(e,r){return void 0===r&&(r=gi.USER),n(t(e,r))},e.fromString=function(e){try{return JSON.parse(e)}catch(t){throw new Error("Failed to parse ExternalId from string '"+e+"'")}},e.compare=function(e,t){return e.id===t.id&&e.type===t.type}}(_i||(_i={}));var Ci=function(){function e(){if(this._outputs={},this._mixOutput=null,this._gainNode=null,this._enabled=!1,this._volume=1,this._enabled="AudioContext"===gr.directAudioOutput||"AudioElement"===gr.directAudioOutput||"AudioElementMix"===gr.directAudioOutput,"AudioContext"===gr.directAudioOutput){var e=ci.getAudioContext();this._gainNode=e.createGain(),this._gainNode.gain.value=this._volume,this._gainNode.connect(e.destination)}}return e.prototype.add=function(e,t){if(this._enabled){this.remove(e);var n={};if(n.audioTrack=t.clone(),this._gainNode){var r=ci.getAudioContext();n.mediaSource=r.createMediaStreamSource(new MediaStream([n.audioTrack])),n.mediaSource.connect(this._gainNode)}else this._initAudioElement("participant"+e,n);this._outputs[e]=n}},e.prototype.remove=function(e){if(this._outputs.hasOwnProperty(e)){var t=this._outputs[e];this._stopAudioElement(t),delete this._outputs[e]}},e.prototype.addMix=function(e){if(this._enabled){this.removeMix();var t={};t.audioTrack=e.clone(),this._initAudioElement("audio mix",t),this._mixOutput=t}},e.prototype.removeMix=function(){this._mixOutput&&(this._stopAudioElement(this._mixOutput),this._mixOutput=null)},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(this._volume=Math.max(0,Math.min(1,e)),this._gainNode)this._gainNode.gain.value=this._volume;else for(var t=0,n=Object.values(this._outputs);t<n.length;t++){var r=n[t];r.audioElement&&(r.audioElement.volume=this._volume)}},enumerable:!1,configurable:!0}),e.prototype._initAudioElement=function(e,t){if(t.audioTrack){var n=new Audio;n.muted=!1,n.volume=this._volume,n.preload="auto";var r=function(t){n.srcObject=new MediaStream([t]),n.load(),n.play().catch((function(){Or.warn("Error on play audio for participant ["+e+"]")}))},i=function(){Or.debug("Recover audio playback for participant ["+e+"]");var n=t.audioTrack;n?r(n):Or.warn("Broken audio track for participant ["+e+"]")};n.onpause=i,n.onstalled=i,n.onerror=i,r(t.audioTrack),t.audioElement=n}},e.prototype._stopAudioElement=function(e){var t,n;e.audioElement&&(e.audioElement.pause(),e.audioElement.srcObject=null),null===(t=e.mediaSource)||void 0===t||t.disconnect(),null===(n=e.audioTrack)||void 0===n||n.stop()},e.prototype.destroy=function(){for(var e=0,t=Object.keys(this._outputs);e<t.length;e++){var n=t[e];this.remove(n)}this.removeMix(),this._gainNode&&this._gainNode.disconnect()},e}(),Oi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lastMemoryStat={percent:0,bytes:0},t._lastNetworkStat={bandwidth:0,kind:"video",good:!0},t}return or(t,e),t.prototype.onRemoteDataStats=function(e,t,n){var r;this._calcMemory(),n&&(this._checkBadNetwork(e.outbound.rtps,n),null===(r=e.inbound.rtps)||void 0===r||r.map((function(e){var n=t[e.userId];e.userId=null==n?void 0:n.externalId})),br.onStatistics(e,this._lastMemoryStat))},t.prototype._calcMemory=function(){var e=window.performance&&window.performance.memory;if(e&&e.usedJSHeapSize&&e.jsHeapSizeLimit){var t=Number((100*e.usedJSHeapSize/e.jsHeapSizeLimit).toFixed(2)),n=Number((e.usedJSHeapSize/1024/1024).toFixed(1));t>90?Or.warn("High memory usage: "+t+"% ("+n+" MiB)"):(!this._lastMemoryStat.percent||Math.abs(t-this._lastMemoryStat.percent)>=3)&&(Or.debug("Memory usage: "+t+"% ("+n+" MiB)"),this._lastMemoryStat.percent=t,this._lastMemoryStat.bytes=e.usedJSHeapSize)}},t.prototype._checkBadNetwork=function(e,t){var n,r,i,a=!1,o=!0;if(t.isVideoEnabled?(n=e.find((function(e){return"video"===e.kind})),r=1.05*gr.badConnectionVideoBitrate,i=.95*gr.badConnectionVideoBitrate):t.isAudioEnabled?(n=e.find((function(e){return"audio"===e.kind})),r=1.05*gr.badConnectionAudioBitrate,i=.95*gr.badConnectionAudioBitrate):(n=e.find((function(e){return"audio"===e.kind})),r=1.05*gr.badConnectionSilenceBitrate,i=.95*gr.badConnectionSilenceBitrate),n){var s=n.bandwidth,c=this._lastNetworkStat.bandwidth,l=this._lastNetworkStat.kind;this._lastNetworkStat.bandwidth=s,this._lastNetworkStat.kind=n.kind,l===n.kind&&c&&(s<i&&c<i&&(a=!0),s<=r&&c<=r&&(o=!1),a&&this._lastNetworkStat.good?(this._lastNetworkStat.good=!1,br.onNetworkStatus(!1),this.log("callPoorConnection",n.kind)):o&&!this._lastNetworkStat.good&&(this._lastNetworkStat.good=!0,br.onNetworkStatus(!0)))}},t}(di),Ti=function(e){function t(n,r){var i=e.call(this)||this;i.name="HangupReason",i.code=r&&r.code||0,i.remote=r&&r.remote||!1,Object.values(vi).indexOf(n)>-1?i.hangup=n:i.error=n;var a=[];return i.error&&a.push("error"),i.remote&&a.push("remote"),i.code&&a.push("code: "+i.code),r&&r.message&&a.push("message: '"+r.message+"'"),i.message=n+(a.length?" ("+a.join(", ")+")":""),Error.captureStackTrace&&Error.captureStackTrace(i,t),i}return or(t,e),t}(Error),wi=function(){function e(e){this._analyser=null,this._gainNode=null,this._fftBins=null,this._mediaStreamSource=null,this._lastSmoothedLevel=0,this._stream=e;try{var t=ci.getAudioContext();this._gainNode=t.createGain(),this._gainNode.gain.value=1e-5,this._gainNode.connect(t.destination),this._analyser=t.createAnalyser(),this._analyser.fftSize=1024,this._analyser.smoothingTimeConstant=0,this._analyser.connect(this._gainNode),this._fftBins=new Uint8Array(this._analyser.frequencyBinCount),this._mediaStreamSource=t.createMediaStreamSource(e),this._mediaStreamSource.connect(this._analyser)}catch(e){}}return Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),e.prototype._getBins=function(){if(!this._fftBins||!this._analyser)return new Uint8Array;this._analyser.getByteFrequencyData(this._fftBins);var e=44100/this._fftBins.length,t=Math.ceil(gr.voiceParams.minFreq/e),n=Math.floor(gr.voiceParams.maxFreq/e);return this._fftBins.subarray(t,n)},e.prototype.getLevel=function(){var e=this._getBins(),t=e.reduce((function(e,t){return e+t}),0)/e.length/255,n=this._lastSmoothedLevel*gr.voiceParams.smoothing+t*(1-gr.voiceParams.smoothing);return this._lastSmoothedLevel=n,{real:t,smoothed:n}},e.prototype.destroy=function(){this._mediaStreamSource&&(this._mediaStreamSource.disconnect(),this._mediaStreamSource=null),this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null),this._analyser&&(this._analyser.disconnect(),this._analyser=null,this._fftBins=null,this._lastSmoothedLevel=0)},e}(),Ii=function(e){function t(t){var n=e.call(this)||this;n._detector=null,n._track=null,n._interval=null;var r=function(){n._detector&&br.onLocalVolume(n._detector.getLevel().real,t.getMediaSettings().isAudioEnabled),n._interval=window.setTimeout(r,gr.voiceParams.interval)};n._interval=window.setTimeout(r,gr.voiceParams.interval);var i=function(){var e=t.getStream();e&&n.init(e)};return n.subscribe(t,"SOURCE_CHANGED",(function(e){"audio"===e.kind&&e.mediaSettings.isAudioEnabled&&i()})),i(),n}return or(t,e),t.prototype.init=function(e){this._stopDetector();var t=e.getAudioTracks();t.length&&(this._track=t[0].clone(),this._detector=new wi(new MediaStream([this._track])))},t.prototype._stopDetector=function(){this._detector&&(this._detector.destroy(),this._detector=null),this._track&&(this._track.stop(),this._track=null)},t.prototype.destroy=function(){this.unsubscribe(),this._interval&&(window.clearTimeout(this._interval),this._interval=null),this._stopDetector()},t}(di),Pi=function(e){function t(t,n){var r=e.call(this)||this;return r._batchInterval=3e3,r._batch=[],r._batchTimeout=null,r._api=t,r._externalLogger=n,r}return or(t,e),t.prototype._send=function(e){this._api.log(e)},t.prototype._sendBatch=function(){this._stopTimeout(),this._batch.length>0&&(this._send(this._batch),this._batch=[],this._startTimeout())},t.prototype._startTimeout=function(){var e=this;this._batchTimeout=window.setTimeout((function(){return e._sendBatch()}),this._batchInterval)},t.prototype._stopTimeout=function(){this._batchTimeout&&(clearTimeout(this._batchTimeout),this._batchTimeout=null)},t.prototype._onUnload=function(){this._sendBatch(),this._stopTimeout()},t.prototype.log=function(e,t,n){void 0===n&&(n=!1);var r={type:1,time:0,operation:e,timestamp:Date.now(),custom:{},uid:this._api.getUserId()};void 0!==t&&(r.custom.param=t),this._batch.push(r),!n&&this._batchTimeout||this._sendBatch(),this._externalLogger&&this._externalLogger.log(e,t,n)},t.prototype.destroy=function(){this._sendBatch(),this._stopTimeout(),this._externalLogger&&this._externalLogger.destroy()},t}(ui),Ri=function(e){function t(){var t=e.call(this)||this;return t._stream=null,t._mediaSettings={isAudioEnabled:!0,isVideoEnabled:!0,isDataEnabled:!1,isScreenSharingEnabled:!1,audioBitrateBps:0,videoBitrateBps:0},t._videoStatusOnScreenCapturingEnabled=!1,t._initDeviceChangeListener(),t}return or(t,e),t.prototype.request=function(e){return void 0===e&&(e=!1),ur(this,void 0,void 0,(function(){var t,n;return dr(this,(function(r){switch(r.label){case 0:if(this._stream)return[2,Promise.resolve(this._stream)];if(!ci.isBrowserSupported())throw new Ti(mr.UNSUPPORTED);if(!ci.hasMicrophone()&&!gr.allowMissingMic)throw new Ti(mr.MIC_NOT_FOUND);r.label=1;case 1:return r.trys.push([1,3,,4]),[4,ci.getUserMedia(e)];case 2:return t=r.sent(),e&&0===t.getVideoTracks().length&&Or.warn("Unable to obtain requested local video track"),this._stream=t,this._mediaSettings.isVideoEnabled=e&&t.getVideoTracks().filter((function(e){return e.enabled})).length>0||!1,this._mediaSettings.isAudioEnabled=t.getAudioTracks().filter((function(e){return e.enabled})).length>0||!1,[2,t];case 3:throw n=r.sent(),new Ti(n);case 4:return[2]}}))}))},t.prototype.getStream=function(){return this._stream},t.prototype.getMediaSettings=function(){return this._mediaSettings},t.prototype.changeDevice=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(e){case"videoinput":return[2,this._changeVideoInput()];case"audioinput":return[2,this._changeAudioInput()];case"screen":return[2,this._changeScreen()];default:return[2,Promise.reject()]}}))}))},t.prototype.setVideoStream=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,t?this._changeScreen(e):this._changeVideoInput(e)]}))}))},t.prototype._initDeviceChangeListener=function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.addEventListener){var t=!1,n=!1,r=kr.throttle((function(){n&&e._changeVideoInput().catch((function(){})),t&&e._changeAudioInput().catch((function(){})),t=!1,n=!1}),1e3);navigator.mediaDevices.addEventListener("devicechange",(function(){return ur(e,void 0,void 0,(function(){var e,i,a,o,s,c,l;return dr(this,(function(u){switch(u.label){case 0:return this._stream?(e=this._stream.getAudioTracks()[0],i=e&&e.enabled&&e.getSettings(),a=i&&i.groupId,o=this._stream.getVideoTracks()[0],s=o&&o.enabled&&o.getSettings(),c=s&&s.groupId,a||c?[4,navigator.mediaDevices.enumerateDevices()]:[2]):[2];case 1:return l=u.sent(),!t&&a&&(t=!l.find((function(e){return e.groupId===a}))),!n&&c&&(n=!l.find((function(e){return e.groupId===c}))),r(),[2]}}))}))}))}},t.prototype._changeVideoInput=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i=this;return dr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),(t=e)?[3,2]:[4,ci.getUserVideo()];case 1:t=a.sent(),a.label=2;case 2:return e=t,this._stream?(this._stopLocalTrack("video"),this.log("callDeviceChanged","video"),Or.log("Camera changed"),n=e.getVideoTracks()[0],this._stream.getVideoTracks().forEach((function(e){i._replaceLocalTrack(e,n)})),this._mediaSettings.isVideoEnabled=!0,this._mediaSettings.isScreenSharingEnabled=!1,this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings})):e.getTracks().forEach((function(e){e.stop()})),[3,4];case 3:throw r=a.sent(),this.log("callError","change_video"),Or.warn("Camera change failed",r),r;case 4:return[2]}}))}))},t.prototype._changeAudioInput=function(){return ur(this,void 0,void 0,(function(){var e,t,n,r=this;return dr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,ci.getUserAudio()];case 1:return e=i.sent(),this._stream?(this._stopLocalTrack("audio"),this.log("callDeviceChanged","audio"),Or.debug("Microphone changed"),t=e.getAudioTracks()[0],this._stream.getAudioTracks().forEach((function(e){r._replaceLocalTrack(e,t)})),this._mediaSettings.isAudioEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings})):e.getTracks().forEach((function(e){e.stop()})),[3,3];case 2:throw n=i.sent(),this.log("callError","change_audio"),Or.error("Microphone change failed",n),n;case 3:return[2]}}))}))},t.prototype._changeScreen=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i=this;return dr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),(t=e)?[3,2]:[4,ci.getScreenMedia()];case 1:t=a.sent(),a.label=2;case 2:return(e=t).addEventListener("inactive",(function(){i._mediaSettings.isScreenSharingEnabled&&i.toggleScreenCapturing(!1)}),!1),this._stream?(this._stopLocalTrack("video"),this.log("callDeviceChanged","screen"),Or.log("Screen capturing started"),n=e.getVideoTracks()[0],this._stream.getVideoTracks().forEach((function(e){i._replaceLocalTrack(e,n)})),this._videoStatusOnScreenCapturingEnabled=this._mediaSettings.isVideoEnabled,this._mediaSettings.isVideoEnabled=!0,this._mediaSettings.isScreenSharingEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"screen",mediaSettings:this._mediaSettings})):e.getTracks().forEach((function(e){e.stop()})),[3,4];case 3:throw r=a.sent(),this.log("callError","screen"),Or.warn("Screen capturing failed",r),r;case 4:return[2]}}))}))},t.prototype._replaceLocalTrack=function(e,t){this._stream&&(this._stream.removeTrack(e),this._stream.addTrack(t),this._triggerEvent("TRACK_REPLACED",e,t))},t.prototype._stopLocalTrack=function(e){this._stream&&this._stream.getTracks().forEach((function(t){t.kind===e&&t.stop()}))},t.prototype.destroy=function(){this._stream&&(this._stream.getTracks().forEach((function(e){e.stop()})),this._stream=null)},t.prototype.toggleScreenCapturing=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return e?[2,this.changeDevice("screen")]:this._videoStatusOnScreenCapturingEnabled?[2,this.changeDevice("videoinput")]:[2,this.toggleVideo(!1)]}))}))},t.prototype.toggleVideo=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i=this;return dr(this,(function(a){switch(a.label){case 0:return t=ci.hasCameraPermission()||this._mediaSettings.isScreenSharingEnabled,this._stream&&t?e?[4,ci.getUserVideo()]:[3,2]:[2];case 1:return r=a.sent(),n=r.getVideoTracks()[0],[3,3];case 2:n=ci.getBlackMediaTrack(gr.videoMinWidth,gr.videoMinHeight),a.label=3;case 3:return this._stopLocalTrack("video"),this._stream.getVideoTracks().forEach((function(e){i._replaceLocalTrack(e,n)})),this._mediaSettings.isVideoEnabled=e,e||(this._mediaSettings.isScreenSharingEnabled=!1),this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.toggleAudio=function(e){return ur(this,void 0,void 0,(function(){var t,n,r=this;return dr(this,(function(i){switch(i.label){case 0:return this._stream&&ci.hasMicrophonePermission()?e?[4,ci.getUserAudio()]:[3,2]:[2];case 1:return n=i.sent(),t=n.getAudioTracks()[0],[3,3];case 2:t=ci.getSilentMediaTrack(),i.label=3;case 3:return this._stopLocalTrack("audio"),this._stream.getAudioTracks().forEach((function(e){r._replaceLocalTrack(e,t)})),this._mediaSettings.isAudioEnabled=e,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.setResolution=function(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){if(!this._stream)throw new Error("Local stream not found");if(!(n=this._stream.getVideoTracks()[0]))throw new Error("Local video track not found");return[2,n.applyConstraints({width:{ideal:e},height:{ideal:t}})]}))}))},t.prototype.updateNoiseSuppression=function(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){if(!this._stream)throw new Error("Local stream not found");if(!(e=this._stream.getAudioTracks()[0]))throw new Error("Local audio track not found");return[2,e.applyConstraints({noiseSuppression:gr.noiseSuppression})]}))}))},t}(di),Ai=function(e){function t(t,n){var r=e.call(this)||this;return r._speakerId=null,r._serverAudioActivityAvailable=!1,r.subscribe(t,"VOLUMES_DETECTED",r._onVolumesDetected.bind(r)),r.subscribe(n,"SIGNALLED_SPEAKER_CHANGED",r._onServerSpeakerChanged.bind(r)),r.subscribe(n,"SIGNALLED_ACTIVE_PARTICIPANTS",r._onReceivedServerAudioActivity.bind(r)),r.subscribe(n,"ACTIVE_PARTICIPANTS_NO_SIGNAL",r._onStoppedReceivingServerAudioActivity.bind(r)),r}return or(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.prototype._onVolumesDetected=function(e){if(!this._serverAudioActivityAvailable){var t=0,n=null;if(Object.keys(e).forEach((function(r){var i=e[r].smoothed;i>t&&i>gr.voiceParams.threshold&&(t=i,n=r)})),n&&n!==this._speakerId){var r=this._speakerId&&e.hasOwnProperty(this._speakerId)?e[this._speakerId].smoothed:0;t>r*gr.voiceParams.speakerLevelMultiplier&&(this._speakerId=n,this._triggerEvent("SPEAKER_CHANGED",n))}}},t.prototype._onServerSpeakerChanged=function(e){this._serverAudioActivityAvailable&&this._triggerEvent("SPEAKER_CHANGED",e)},t.prototype._onReceivedServerAudioActivity=function(){this._serverAudioActivityAvailable=!0},t.prototype._onStoppedReceivingServerAudioActivity=function(){this._serverAudioActivityAvailable=!1},t}(di),Ni=function(e){function t(t,n,r){var i=e.call(this)||this;return i._states={},i._volumes={},i._participants={},i._connectionTimeout=0,i._volumeTimeout=0,i._transport=t,i._participants=r,i.subscribe(t,"STATE_CHANGED",i._onTransportStateChanged.bind(i)),i.subscribe(n,"VOLUMES_DETECTED",i._onVolumesDetected.bind(i)),i}return or(t,e),t.prototype.destroy=function(){this.unsubscribe(),this._connectionTimeout&&window.clearTimeout(this._connectionTimeout),this._volumeTimeout&&window.clearTimeout(this._volumeTimeout)},t.prototype.onChangeRemoteMediaSettings=function(e,t){t.isAudioEnabled||(this._volumes[e]=1),t.isAudioEnabled&&(this._volumes[e]=0)},t.prototype._onTransportStateChanged=function(e,t){this._states[e]=t,"OPENED"===t&&(this._connectionTimeout||(this._connectionTimeout=window.setTimeout(this._onConnectionTimeout.bind(this),gr.specListenerParams.connectionTimeout)),this._volumeTimeout||(this._volumeTimeout=window.setTimeout(this._onVolumeTimeout.bind(this),gr.specListenerParams.volumeTimeout))),"FAILED"===t&&this._connectionTimeout&&(Or.warn("Transport failed, send callSpecError"),this.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT"))},t.prototype._onVolumesDetected=function(e){var t=this;Object.keys(e).forEach((function(n){t._volumes[n]=Math.max(e[n].real,t._volumes[n]||0)}))},t.prototype._onConnectionTimeout=function(){Object.values(this._states).filter((function(e){return"CONNECTED"!==e})).length>0&&(Or.warn("There is not connected transport, send callSpecError"),this.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT")),this._connectionTimeout=0},t.prototype._onVolumeTimeout=function(){var e=this,t=[];Object.keys(this._volumes).forEach((function(n){if(!(e._volumes[n]>0)){var r="UNKNOWN",i=e._participants[n];i&&i.platform&&(r=i.platform),t.indexOf(r)<0&&(t.push(r),e.log("callSpecError",e._transport.getTopology()+"_VOLUME_TIMEOUT_"+r))}})),t.length&&Or.warn("There is silent participant, send callSpecError"),this._volumeTimeout=0},t}(di);function ki(e){var t=[];return function e(t,n){t.forEach((function(t){Array.isArray(t)?e(t,n):n.push(t)}))}(e,t),t}function Li(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){for(var n=0,r=e;n<r.length;n++)if((0,r[n])(t))return!0;return!1}}function Di(e,t){return function(n){return n[e]===t}}function Mi(e,t){return t.reduce((function(t,n){return t[n[e]]=n,t}),{})}function ji(e,t){return Object.values(Mi(e,t))}function xi(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return[t,e[t]]})).reduce((function(e,t){return e[t[0]]=function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}(t[1])?xi(t[1]):t[1],e}),{})}function Ui(e){var t=[];return e.forEach((function(e){t.push(e)})),t}function Gi(e){return ur(this,void 0,void 0,(function(){var t,n=this;return dr(this,(function(r){return t=[],RTCRtpReceiver.prototype.getStats?(t.push(e.getReceivers().map((function(e){return ur(n,void 0,void 0,(function(){return dr(this,(function(t){return[2,e.getStats()]}))}))}))),t.push(e.getSenders().map((function(e){return ur(n,void 0,void 0,(function(){return dr(this,(function(t){return[2,e.getStats()]}))}))})))):t.push(e.getStats()),[2,Promise.all(ki(t)).then((i=Ui,function(e){return e.map(i)})).then(ki).then(ji.bind(null,"id"))];var i}))}))}function Vi(e){var t,n=e.filter(Di("type","candidate-pair")).sort((t="priority",function(e,n){return e[t]-n[t]})).find(Li(Di("nominated",!0),Di("selected",!0)));if(!n)return{};var r={totalRoundTripTime:n.totalRoundTripTime,currentRoundTripTime:n.currentRoundTripTime,bytesSent:n.bytesSent,bytesReceived:n.bytesReceived},i=e.find(Di("id",n.remoteCandidateId));i&&(r=Object.assign({},r,{remote:{type:i.candidateType,address:i.ip||i.address,port:i.port,protocol:i.protocol}}));var a=e.find(Di("id",n.localCandidateId));return a&&(r=Object.assign({},r,{local:{type:a.candidateType,address:a.ip||a.address,port:a.port,protocol:a.protocol,relayProtocol:a.relayProtocol,networkType:a.networkType}})),xi(r)}function Bi(e,t){t=t||{};var n=Mi("id",e),r=e.filter(Li(Di("type","inbound-rtp"),Di("type","outbound-rtp")));"Firefox"===ci.browserName()&&(r=Object.values(r.reduce((function(e,t){if(e[t.ssrc]){var n=Object.assign({},e[t.ssrc],t),r=e[t.ssrc].isRemote?t:e[t.ssrc];n.id=r.id,n.type=r.type,delete n.isRemote,delete n.remoteId,e[n.ssrc]=n}else e[t.ssrc]=t;return e}),{})));var i={};return"Safari"===ci.browserName()&&(i=Mi("trackIdentifier",e.filter(Di("type","track")))),r.map((function(e){var r=e.ssrc,a=e.mediaType||e.kind,o=e.trackId,s=e.type,c=e.codecId;if("Safari"===ci.browserName()){var l=/^.+_([\d]+)$/.exec(e.id);if(l&&(r=parseInt(l[1],10)),a=e.id.indexOf("Audio")>0?"audio":"video",t[r]){var u=a+"-"+t[r];i[u]&&(o=i[u].id)}}if(!s||!r||!a)return null;var d={ssrc:r,type:s,kind:a,bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,jitter:e.jitter,packetsLost:e.packetsLost,packetsReceived:e.packetsReceived,packetsSent:e.packetsSent,fractionLost:e.fractionLost,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,userId:t[r]};if(c&&n[c]){var p=n[c];d.clockRate=p.clockRate,d.mimeType=p.mimeType}if(o&&n[o]){var h=n[o];d.frameHeight=h.frameHeight,d.frameWidth=h.frameWidth,d.framesDecoded=h.framesDecoded,d.framesReceived=h.framesReceived,d.framesDropped=h.framesDropped}return xi(d)})).filter((function(e){return!!e}))}function Hi(e,t){if(!t)return e;if(!t.rtps||!e.rtps)return e;var n=Mi("ssrc",e.rtps),r=Mi("ssrc",t.rtps),i=(e.timestamp-t.timestamp)/1e3;return n&&r?(Object.keys(n).forEach((function(e){var t=n[e],a=r[e];t&&a&&(t.bytesReceived&&t.bytesReceived>a.bytesReceived&&(t.bandwidth=Math.round((t.bytesReceived-a.bytesReceived)/i)),t.bytesSent&&t.bytesSent>a.bytesSent&&(t.bandwidth=Math.round((t.bytesSent-a.bytesSent)/i)),t.packetsReceived>a.packetsReceived&&(t.packetLoss=parseFloat((100*(t.packetsLost-a.packetsLost)/(t.packetsReceived-a.packetsReceived)/i).toFixed(2))),t.framesDropped>a.framesDropped&&(t.framesDroppedDelta=parseFloat(((t.framesDropped-a.framesDropped)/i).toFixed(0))))})),e):e}function Fi(e,t,n){return ur(this,void 0,void 0,(function(){var r,i;return dr(this,(function(a){switch(a.label){case 0:return[4,Gi(e)];case 1:return r=a.sent(),i={timestamp:Date.now(),transport:Vi(r),rtps:Bi(r,n)},t?[3,3]:[4,kr.delay(1e3)];case 2:return a.sent(),[2,Fi(e,i,n)];case 3:return[2,Hi(i,t)]}}))}))}var Wi=function(e){function t(t,n,r,i,a){var o=e.call(this)||this;if(o._remoteSDP={},o._remoteCandidates={},o._state="IDLE",o._isOpen=!1,o._remotePeerId=null,o._statInterval=null,o._settingsInterval=null,o._failedOnCreate=null,o._remoteStream=null,o._iceRestartTimeout=null,o._reconnectionTimeout=null,o._reconnectionPrevented=!1,o._fingerprint=null,o._neverConnected=!0,o._prevConsumerSettings={},o._signaling=r,o._mediaSource=i,o._participantId=t,o._isMaster=n,o._serverSettings=a,o.subscribe(o._signaling,"NOTIFICATION",o._onSignalingNotification.bind(o)),o.subscribe(o._mediaSource,"TRACK_REPLACED",o._onReplacedTrack.bind(o)),o.subscribe(o._mediaSource,"SOURCE_CHANGED",o._applySettings.bind(o)),o._pc=new RTCPeerConnection({iceServers:gr.iceServers,iceTransportPolicy:gr.forceRelayPolicy?"relay":"all"},{optional:[{googSuspendBelowMinBitrate:!1}]}),o._pc.onicecandidate=o._handleIceCandidate.bind(o),o._pc.ontrack=o._onAddTrack.bind(o),o._pc.onconnectionstatechange=o._onConnectionStateChange.bind(o),o._pc.onsignalingstatechange=o._onSignalingStateChange.bind(o),o._prevConsumerSettings={},o._isMaster){try{var s=o._mediaSource.getStream();if(!s)throw new Error("No local stream found");o._addTracks(s)}catch(e){return o.log("callError","addTrack-direct"),Or.error("Unable to add media source tracks",e,{participantId:o._participantId}),o._failedOnCreate=e,o}o._createOffer(!1).catch((function(e){"IDLE"===o._state?o._failedOnCreate=e:o.close(e)}))}return o._startSettingsInterval(),o._startStatInterval(),o}return or(t,e),t.prototype.getState=function(){return this._state},t.prototype.open=function(e){return void 0===e&&(e=null),ur(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c;return dr(this,(function(l){switch(l.label){case 0:if(this._isOpen)return Or.warn("Transport is already opened",{participantId:this._participantId}),[2];if(this._failedOnCreate&&this.close(this._failedOnCreate),Or.debug("Open transport",{participantId:this._participantId}),this._isOpen=!0,this._remotePeerId=e,!this._isMaster)try{if(!(t=this._mediaSource.getStream()))throw new Error("No local stream found");this._addTracks(t)}catch(e){this.log("callError","addTrack-direct"),Or.error("Unable to add media source tracks",e,{participantId:this._participantId}),this.close(e)}if(n=e,r=e,e||(i=Object.keys(this._remoteSDP),a=Object.keys(this._remoteCandidates),n=i[i.length-1],r=a[a.length-1]),!n||!this._remoteSDP[n])return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this._setRemoteDescription(n,this._remoteSDP[n])];case 2:return l.sent(),[3,4];case 3:return l.sent(),this.close(),[3,4];case 4:if(!r||!this._remoteCandidates[r])return[3,10];o=0,s=this._remoteCandidates[r].length,l.label=5;case 5:if(!(o<s))return[3,10];c=this._remoteCandidates[r][o],l.label=6;case 6:return l.trys.push([6,8,,9]),[4,this._addIceCandidate(r,c)];case 7:return l.sent(),[3,9];case 8:return l.sent(),this.close(),[3,10];case 9:return o++,[3,5];case 10:return this._remoteSDP={},this._remoteCandidates={},this._setState("OPENED"),this._triggerEvent("ACTIVE_PARTICIPANTS_NO_SIGNAL"),[2]}}))}))},t.prototype.updateSettings=function(e){bi(e,this._serverSettings)||(this._serverSettings=e,this._applySettings())},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.close=function(e){this._isOpen=!1,this._stopReconnection(),this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop()})),this._remoteStream=null),this._stopStatInterval(),this._stopSettingsInterval(),this._pc&&(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.close()),this.unsubscribe(),e?(Or.error("Closed",e,{participantId:this._participantId}),this._setState("FAILED")):(Or.debug("Closed",{participantId:this._participantId}),this._setState("CLOSED"))},t.prototype._addTracks=function(e){var t=this;e.getTracks().forEach((function(n){t._pc&&t._pc.addTrack(n,e)})),this._applySettings()},t.prototype._setState=function(e){this._state!==e&&(Or.debug("State changed to "+e,{participantId:this._participantId}),this._state=e,this._triggerEvent("STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){"transmitted-data"===e.notification&&this._handleTransmittedData(e)},t.prototype._handleTransmittedData=function(e){var t=e.data,n=kr.getPeerIdString(e.peerId);kr.composeMessageId(e)===this._participantId&&(t.candidate&&t.candidate.candidate?this._addIceCandidate(n,t.candidate).catch(this.close.bind(this)):t.sdp&&this._setRemoteDescription(n,t.sdp).catch(this.close.bind(this)))},t.prototype._addIceCandidate=function(e,t){return ur(this,void 0,void 0,(function(){var n=this;return dr(this,(function(r){return Or.debug("Remote ice candidate",{participantId:this._participantId,candidate:t}),this._isOpen&&(!this._remotePeerId||this._remotePeerId===e)&&this._pc&&this._pc.remoteDescription?[2,this._pc.addIceCandidate(new RTCIceCandidate(t)).catch((function(e){throw n.log("callError","addIceCandidate-direct"),Or.error("Unable to add remote ice candidate",e,{participantId:n._participantId,candidate:t}),e}))]:(this._remoteCandidates[e]=this._remoteCandidates[e]||[],this._remoteCandidates[e].push(t),[2,Promise.resolve()])}))}))},t.prototype._setRemoteDescription=function(e,t){return ur(this,void 0,void 0,(function(){var n=this;return dr(this,(function(r){return Or.debug("Remote description",{participantId:this._participantId,sdp:t}),!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc?(this._remoteSDP[e]=t,[2,Promise.resolve()]):(this._calcFingerprint(t.sdp),[2,this._pc.setRemoteDescription(new RTCSessionDescription(t)).catch((function(e){throw n.log("callError","setRemoteDescription-direct"),Or.error("Unable to set remote description",e,{participantId:n._participantId,sdp:t}),e}))])}))}))},t.prototype._onAddTrack=function(e){var t=this;if(Or.debug("Added remote track",{participantId:this._participantId}),!this._remoteStream){var n=e.streams[0];n.onremovetrack=function(e){t._triggerEvent("REMOTE_TRACK_REMOVED",n,e.track)},this._remoteStream=n}this._triggerEvent("REMOTE_TRACK_ADDED",this._remoteStream,e.track)},t.prototype._handleIceCandidate=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return e.candidate?(Or.debug("Local ice candidate",{participantId:this._participantId,candidate:e.candidate}),[4,this._signaling.sendCandidate(this._participantId,e.candidate)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype._onSignalingStateChange=function(){var e=this;switch(Or.debug("Signaling state changed to "+this._pc.signalingState,{participantId:this._participantId}),this._pc.signalingState){case"have-local-offer":var t=this._pc.localDescription;t?this._signaling.sendSdp(this._participantId,t).catch(this.close.bind(this)):this.close(new Error);break;case"have-remote-offer":this._createAnswer().catch(this.close.bind(this)).then((function(t){return ur(e,void 0,void 0,(function(){return dr(this,(function(e){return[2,this._signaling.sendSdp(this._participantId,t)]}))}))})).catch(this.close.bind(this))}},t.prototype._onConnectionStateChange=function(){var e=this;switch(Or.debug("Connection state changed to "+this._pc.connectionState,{participantId:this._participantId}),this.log("callIceConnectionState",this._pc.connectionState),this._pc.connectionState){case"connecting":var t=this.getState();"IDLE"===t||"OPENED"===t?this._setState("CONNECTING"):this._setState("RECONNECTING");break;case"connected":this._neverConnected=!1,this._setState("CONNECTED"),this._stopReconnection(),kr.getPeerConnectionHostInfo(this._pc).then((function(t){t&&e.log("callIceConnectionType",t.type)}));break;case"failed":case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection "+this._pc.connectionState)):(this._setState("RECONNECTING"),this._startReconnection());break;case"closed":this.close(new Error("Ice connection closed"))}},t.prototype._startReconnection=function(){var e=this;this._reconnectionTimeout||this._iceRestartTimeout||(Or.log("Waiting for reconnection...",{participantId:this._participantId}),this._reconnectionTimeout=window.setTimeout((function(){e._reconnectionTimeout=null,e._neverConnected?e._requestTopologySwitch():e._startIceRestart()}),gr.transportConnectionWaitTime))},t.prototype._requestTopologySwitch=function(){this._isMaster&&(Or.log("Switch topology DIRECT to SERVER",{participantId:this._participantId}),this._signaling.switchTopology("SERVER"))},t.prototype._stopReconnection=function(){this._reconnectionTimeout&&(clearTimeout(this._reconnectionTimeout),this._reconnectionTimeout=null),this._iceRestartTimeout&&(clearTimeout(this._iceRestartTimeout),this._iceRestartTimeout=null)},t.prototype._startIceRestart=function(){var e=this;this._isMaster?(this.log("callIceRestart"),Or.log("Ice restart",{participantId:this._participantId}),this._createOffer(!0).catch(this.close.bind(this))):Or.debug("Waiting for ice restart...",{participantId:this._participantId}),this._iceRestartTimeout=window.setTimeout((function(){e._iceRestartTimeout=null,Or.error("Ice restart failed",{participantId:e._participantId}),e.log("callError","iceRestart-direct"),e._requestTopologySwitch()}),gr.iceRestartWaitTime)},t.prototype._createOffer=function(e){return ur(this,void 0,void 0,(function(){var n,r=this;return dr(this,(function(i){return n={iceRestart:e,offerToReceiveAudio:!0,offerToReceiveVideo:!0},Or.debug("Create offer",{participantId:this._participantId,options:n}),[2,this._pc.createOffer(n).catch((function(e){throw Or.error("Unable to create offer",e,{participantId:r._participantId}),r.log("callError","createOffer-direct"),e})).then((function(e){return ur(r,void 0,void 0,(function(){var n=this;return dr(this,(function(r){return Or.debug("Created offer",{participantId:this._participantId,offer:e}),e=t._patchDescription(e),Or.debug("Set local description",{participantId:this._participantId,offer:e}),this._calcFingerprint(e.sdp),[2,this._pc.setLocalDescription(e).then((function(){return n._pc.localDescription}))]}))}))})).catch((function(e){throw Or.error("Unable to set local description",e,{participantId:r._participantId}),r.log("callError","setLocalDescription-direct"),e}))]}))}))},t.prototype._createAnswer=function(){return ur(this,void 0,void 0,(function(){var e=this;return dr(this,(function(n){return Or.debug("Create answer",{participantId:this._participantId}),[2,this._pc.createAnswer().catch((function(t){throw Or.error("Unable to create answer",t,{participantId:e._participantId}),e.log("callError","createAnswer-direct"),t})).then((function(n){return ur(e,void 0,void 0,(function(){return dr(this,(function(e){return Or.debug("Created answer",{participantId:this._participantId,answer:n}),n=t._patchDescription(n),Or.debug("Set local description",{participantId:this._participantId,answer:n}),this._calcFingerprint(n.sdp),[2,this._pc.setLocalDescription(n)]}))}))})).then((function(){return e._pc.localDescription})).catch((function(t){throw Or.error("Unable to set local description",t,{participantId:e._participantId}),e.log("callError","setLocalDescription-direct"),t}))]}))}))},t._patchDescription=function(e){return e.sdp=kr.patchSDP(e.sdp,ci.canPreferH264(),ci.isBrokenH264()),e},t.prototype._onReplacedTrack=function(e,t){var n=this;this._pc&&(this._pc.getSenders().forEach((function(e){e.track&&e.track.kind===t.kind&&(e.track.enabled=t.enabled,e.replaceTrack(t).catch((function(e){Or.error("Unable to replace track",e,{participantId:n._participantId}),n.log("callError","replaceTrack-direct")})))})),this._applySettings())},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._pc?Fi(e._pc,e._lastStat,{}).then((function(n){e._lastStat=n;var r={inbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(t){return"inbound-rtp"===t.type&&(t.userId=e._participantId,!0)}))},outbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(e){return"outbound-rtp"===e.type}))}};e._triggerEvent("REMOTE_DATA_STATS",r),e._statInterval=window.setTimeout(t,gr.statisticsInterval)})):e._stopStatInterval()};this._statInterval=window.setTimeout(t,gr.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null)},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._pc?(e._applySettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._calcFingerprint=function(e){var t=kr.sdpFingerprint(e);null===this._fingerprint?this._fingerprint=t:(br.onFingerprintChange(this._fingerprint.xor(t).toString()),this._fingerprint=null)},t.prototype._applySettings=function(){var e=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;e&&this._pc&&(this._prevConsumerSettings=kr.applySettings(this._pc,e,this._prevConsumerSettings))},t}(di),zi=function(e){function t(t,n){var r=e.call(this)||this;return r._previousTimestamp=0,r._renderDropRate=0,r._signaling=n,r.subscribe(t,"REMOTE_DATA_STATS",r._handleStats.bind(r)),r}return or(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.getEstimatedPerformanceIndex=function(){try{var e=parseInt(localStorage.getItem("videochat-epi")||"",10);return isNaN(e)?0:e}catch(e){return 0}},t.prototype._handleStats=function(e){return ur(this,void 0,void 0,(function(){var t,n,r;return dr(this,(function(i){switch(i.label){case 0:if(!gr.perfStatReportEnabled)return[2];if(!e.inbound||!e.inbound.rtps)return[2];if(t=e.inbound.rtps.filter((function(e){return"video"===e.kind})).map((function(e){return{framesDecoded:e.framesDecoded||0,framesReceived:e.framesReceived||0}})).reduce((function(e,t){return e.framesDecoded+=t.framesDecoded,e.framesReceived+=t.framesReceived,e}),{framesDecoded:0,framesReceived:0}),n=Date.now(),this._renderDropRate&&(t.renderDropRate=this._renderDropRate),this._previousTimestamp+5e3>n)return[2];if(!t.framesDecoded&&!t._renderDropRate)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._signaling.reportPerfStat(t)];case 2:return r=i.sent(),localStorage.setItem("videochat-epi",r.estimatedPerformanceIndex),[3,4];case 3:return i.sent(),[3,4];case 4:return this._previousTimestamp=n,[2]}}))}))},t.prototype._onUIPerformanceStatistics=function(e){if(e.decoded){var t=e.dropped/(e.decoded+e.dropped);this._renderDropRate=.2*t+.8*this._renderDropRate}},t}(di),Ki=function(e){function t(t,n,r){var i=e.call(this)||this;return i._consumer=null,i._producer=null,i._isOpen=!1,i._reconnectionPrevented=!1,i._state={},i._statInterval=null,i._settingsInterval=null,i._statBytes={},i._ssrcMap={},i._producerOfferIsProcessing=!1,i._producerNextOffer=null,i._prevConsumerSettings={},i._signaling=t,i._mediaSource=n,i._state.consumer="IDLE",i._state.producer="IDLE",i._signaling&&i._mediaSource&&(i.subscribe(i._signaling,"NOTIFICATION",i._onSignalingNotification.bind(i)),i.subscribe(i._mediaSource,"TRACK_REPLACED",i._onReplacedTrack.bind(i)),i.subscribe(i._mediaSource,"SOURCE_CHANGED",i._applyConsumerSettings.bind(i))),i._interop=new ir.Interop,i._perfStatReporter=new zi(i,t),i._serverSettings=r,Or.debug("Created"),i}return or(t,e),t.prototype.getState=function(){return this._getState("producer")},t.prototype.getLocalState=function(){return this._getState("consumer")},t.prototype.open=function(){this._isOpen?Or.log("Already opened connections"):(this._isOpen=!0,this._openConnection("producer"),this._openConnection("consumer"))},t.prototype.close=function(e){this._isOpen=!1,this._closeConnection("producer"),this._closeConnection("consumer"),this.unsubscribe(),e?(Or.error("Closed",e),this._setState("FAILED","consumer"),this._setState("FAILED","producer")):(Or.debug("Closed"),this._setState("CLOSED","consumer"),this._setState("CLOSED","producer"))},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.updateSettings=function(e){bi(e,this._serverSettings)||(this._serverSettings=e,this._applyConsumerSettings())},t.prototype._closeConnection=function(e){this._stopStatInterval(),this._stopSettingsInterval(),"producer"===e&&this._producer&&(this._producer.ontrack=null,this._producer.onconnectionstatechange=null,this._producer.onsignalingstatechange=null,this._producer.close(),this._producer=null,this._producerOfferIsProcessing=!1,this._producerNextOffer=null,this._interop=new ir.Interop),"consumer"===e&&this._consumer&&(this._consumer.ontrack=null,this._consumer.onconnectionstatechange=null,this._consumer.onsignalingstatechange=null,this._consumer.close(),this._consumer=null)},t.prototype._openConnection=function(e){var n=this;Or.debug("Open connection for "+e);var r={};if(ci.baseChromeVersion()&&(r.sdpSemantics=t._isUnifiedPlanEnabled()?"unified-plan":"plan-b"),"producer"===e&&(this._producer=new RTCPeerConnection(r,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._producer.ontrack=this._onAddTrack.bind(this,this._producer,"producer"),this._producer.onconnectionstatechange=kr.throttle((function(e){n._producer&&n._onConnectionStateChange(n._producer,"producer",e)}),500),this._producer.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._producer,"producer"),this._setState("OPENED","producer")),"consumer"===e){this._consumer=new RTCPeerConnection(r,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._consumer.ontrack=this._onAddTrack.bind(this,this._consumer,"consumer"),this._consumer.onconnectionstatechange=this._onConnectionStateChange.bind(this,this._consumer,"consumer"),this._consumer.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._consumer,"consumer");try{var i=this._mediaSource.getStream();if(!i)throw new Error("No local stream found");i.getTracks().forEach((function(e){n._consumer&&n._consumer.addTrack(e,i)})),this._prevConsumerSettings={},this._applyConsumerSettings()}catch(e){return Or.error("Unable to add media source tracks",e),this.log("callError","addTrack-consumer"),void this.close(e)}this._allocateConsumer(),this._setState("OPENED","consumer")}this._startStatInterval(),this._startSettingsInterval()},t.prototype._reconnect=function(e){this._setState("RECONNECTING",e),this._closeConnection(e),this._openConnection(e)},t.prototype._signalActiveParticipants=function(e){this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._signalSpeakerChanged=function(e){this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._updateSSRCMap=function(e){var t=this;e&&e.sdp.split("\n").forEach((function(e){var n=/a=ssrc:([0-9]+) label:(audio|video)-([ug]?[\d]+)/.exec(e);n&&(t._ssrcMap[n[1]]=n[3])}))},t.prototype._applyConsumerSettings=function(){var e=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;e&&this._consumer&&(this._prevConsumerSettings=kr.applySettings(this._consumer,e,this._prevConsumerSettings))},t.prototype._setState=function(e,t){this._state[t]!==e&&(this._state[t]=e,"consumer"===t?this._triggerEvent("LOCAL_STATE_CHANGED",e):this._triggerEvent("STATE_CHANGED",e))},t.prototype._getState=function(e){return this._state[e]||"IDLE"},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._producer?(e._collectStat().then((function(t){e._reportStats(t),e._detectStaleTracks(t)})).catch((function(){})),e._statInterval=window.setTimeout(t,gr.statisticsInterval)):e._stopStatInterval()};this._statInterval=window.setTimeout(t,gr.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null),this._statBytes={}},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._consumer?(e._applyConsumerSettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._collectStat=function(){return ur(this,void 0,void 0,(function(){var e,t;return dr(this,(function(n){switch(n.label){case 0:return this._producer&&this._consumer?(e=this,[4,Fi(this._producer,this._producerLastStat,this._ssrcMap)]):[2,Promise.reject()];case 1:return e._producerLastStat=n.sent(),t=this,[4,Fi(this._consumer,this._consumerLastStat,this._ssrcMap)];case 2:return t._consumerLastStat=n.sent(),[2,{producer:this._producerLastStat,consumer:this._consumerLastStat}]}}))}))},t.prototype._reportStats=function(e){var t=e.producer,n=e.consumer;this._triggerEvent("REMOTE_DATA_STATS",{inbound:{topology:"SERVER",transport:t.transport,rtps:t.rtps},outbound:{topology:"SERVER",transport:n.transport,rtps:n.rtps}})},t.prototype._detectStaleTracks=function(e){var t=this,n=e.producer.rtps,r={};this._producer&&this._producer.getReceivers().forEach((function(e){var t=e.track.id.match(/audio-([ug]?[\d]+)/);t&&"ended"!==e.track.readyState&&(r[t[1]]=e.track)})),n.forEach((function(e){if("audio"===e.kind){var n=t._ssrcMap[e.ssrc],i=r[n],a=t._statBytes[n],o=!1;if(a){var s=e.bytesReceived-a.bytesReceived;s>=0&&s<=5&&(o=!0),a.stalled!==o&&i&&t._triggerEvent("REMOTE_STREAM_STALL",i,o)}t._statBytes[n]={bytesReceived:e.bytesReceived,stalled:o}}}))},t.prototype._allocateConsumer=function(){var e=this,t={estimatedPerformanceIndex:zi.getEstimatedPerformanceIndex(),audioMix:"AudioElementMix"===gr.directAudioOutput},n="consumer";Or.debug("["+n+"] create offer"),this._consumer&&this._consumer.createOffer({iceRestart:!1,offerToReceiveAudio:!1,offerToReceiveVideo:!1}).catch((function(t){throw Or.error("["+n+"] unable to create offer",t),e.log("callError","createOffer-"+n),t})).then((function(e){return e.sdp=kr.patchSDP(e.sdp,!1,ci.isBrokenH264()),e})).then((function(t){return ur(e,void 0,void 0,(function(){var e=this;return dr(this,(function(r){if(Or.debug("["+n+"] created offer",{offer:t}),!this._consumer)throw new Error("Interrupt allocation");return[2,this._consumer.setLocalDescription(t).then((function(){if(!e._consumer)throw new Error("Interrupt allocation");return e._consumer.localDescription}))]}))}))})).catch((function(t){throw Or.error("["+n+"] unable to set local offer",t),e.log("callError","setLocalDescription-"+n),t})).then((function(r){return ur(e,void 0,void 0,(function(){return dr(this,(function(e){return Or.debug("["+n+"] transmit local offer"),[2,this._signaling.allocateConsumer(r,t)]}))}))})).catch(this.close.bind(this))},t.prototype._acceptConsumerAnswer=function(e){return ur(this,void 0,void 0,(function(){var t,n,r=this;return dr(this,(function(i){if(!this._consumer)throw new Error("Interrupt allocation");return t="consumer",n=new RTCSessionDescription({type:"answer",sdp:e}),Or.debug("["+t+"] set remote answer",{answer:n}),[2,this._consumer.setRemoteDescription(n).catch((function(e){throw Or.error("["+t+"] unable to set remote answer",e),r.log("callError","setRemoteDescription-"+t),e}))]}))}))},t.prototype._acceptProducer=function(e){return ur(this,void 0,void 0,(function(){var n,r,i=this;return dr(this,(function(a){if(n="producer",r=new RTCSessionDescription({type:"offer",sdp:e}),this._producerOfferIsProcessing)return this._producerNextOffer=e,Or.debug("["+n+"] wait until other remote offer is processed"),[2];if(this._producerOfferIsProcessing=!0,t._isUnifiedPlanEnabled()&&(Or.debug("["+n+"] alter remote offer to 'unified plan'",{offer:r}),r=this._interop.toUnifiedPlan(r)),Or.debug("["+n+"] set remote offer",{offer:r}),!this._producer)throw new Error("Interrupt allocation");return this._producer.setRemoteDescription(r).catch((function(e){throw Or.error("["+n+"] unable to set remote offer",e),i.log("callError","setRemoteDescription-"+n),e})).then((function(){return ur(i,void 0,void 0,(function(){var e=this;return dr(this,(function(t){if(Or.debug("["+n+"] create local answer"),!this._producer)throw new Error("Interrupt allocation");return[2,this._producer.createAnswer().catch((function(t){throw Or.error("["+n+"] unable to create answer",t),e.log("callError","createAnswer-"+n),t}))]}))}))})).then((function(e){return e.sdp=kr.patchSDP(e.sdp,!1,ci.isBrokenH264()),e})).then((function(e){return ur(i,void 0,void 0,(function(){var t=this;return dr(this,(function(r){if(Or.debug("["+n+"] set local answer",{answer:e}),!this._producer)throw new Error("Interrupt allocation");return[2,this._producer.setLocalDescription(e).catch((function(e){throw Or.error("["+n+"] unable to set local answer",e),t.log("callError","setLocalDescription-"+n),e})).then((function(){return e}))]}))}))})).then((function(e){return ur(i,void 0,void 0,(function(){var i;return dr(this,(function(a){return i=e,t._isUnifiedPlanEnabled()&&(Or.log("["+n+"] alter local answer to 'plan b'",{answer:e}),i=this._interop.toPlanB(e)),Or.debug("["+n+"] transmit local answer",{answer:i}),this._updateSSRCMap(r),[2,this._signaling.acceptProducer(i,Object.keys(this._ssrcMap))]}))}))})).then((function(){if(Or.debug("["+n+"] remote offer has been processed"),i._producerOfferIsProcessing=!1,i._producerNextOffer){Or.debug("["+n+"] there is other unprocessed remote offer, process it");var e=i._producerNextOffer;return i._producerNextOffer=null,i._acceptProducer(e)}})).catch(this.close.bind(this)),[2]}))}))},t.prototype._onSignalingNotification=function(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:if(!this._isOpen)return[2];switch(e.notification){case"producer-updated":return[3,1];case"consumer-answered":return[3,3];case"realloc-con":return[3,5];case"audio-activity":return[3,6];case"speaker-changed":return[3,7]}return[3,8];case 1:return[4,this._acceptProducer(e.description)];case 2:return n.sent(),[3,8];case 3:return[4,this._acceptConsumerAnswer(e.description)];case 4:return n.sent(),[3,8];case 5:return(t=e.target?e.target.toLowerCase():null)&&"consumer"!==t||this._reconnect("consumer"),this._reconnect("producer"),[3,8];case 6:return this._signalActiveParticipants(e.activeParticipants),[3,8];case 7:return this._signalSpeakerChanged(e.speaker),[3,8];case 8:return[2]}}))}))},t.prototype._onAddTrack=function(e,t,n){var r=this;Or.debug("["+t+"] remote track (added)",{track:n.track});var i=n.streams[0];i?(i.onremovetrack||(i.onremovetrack=function(e){r._triggerEvent("REMOTE_TRACK_REMOVED",i.id,i,e.track)}),i.getTracks().find((function(e){return e.id===n.track.id}))||i.addTrack(n.track),this._triggerEvent("REMOTE_TRACK_ADDED",i.id,i,n.track)):Or.error("["+t+"] unable to get media stream from track event")},t._onSignalingStateChange=function(e,t,n){Or.debug("["+t+"] signaling state changed",{state:e.signalingState},n)},t.prototype._onConnectionStateChange=function(e,t,n){var r=this;switch(Or.debug("["+t+"] connection state changed",{state:e.connectionState},n),this.log("callIceConnectionState",e.connectionState),e.connectionState){case"failed":this._reconnectionPrevented?this.close(new Error("Ice connection failed")):this._signaling.requestRealloc(t);break;case"connecting":var i=this._getState(t);"IDLE"===i||"OPENED"===i?this._setState("CONNECTING",t):"checking"===e.iceConnectionState&&this._setState("RECONNECTING",t);break;case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection disconnected")):this._setState("RECONNECTING",t);break;case"connected":this._setState("CONNECTED",t),kr.getPeerConnectionHostInfo(e).then((function(e){e&&r.log("callIceConnectionType",e.type)}))}},t.prototype._onReplacedTrack=function(e,t){var n=this;this._consumer&&this._consumer.getSenders().forEach((function(e){e.track&&e.track.kind===t.kind&&(e.track.enabled=t.enabled,e.replaceTrack(t).catch((function(e){Or.error("Unable to replace track",e),n.log("callError","replaceTrack-consumer")})))})),this._applyConsumerSettings()},t._isUnifiedPlanEnabled=function(){var e=ci.browserVersion(),t=ci.baseChromeVersion()?"Chrome":ci.browserName();return gr.isUnifiedPlan(t,e)},t}(di),Ji=function(e){function t(t,n,r,i){var a=e.call(this)||this;return a._allocated=[],a._opened=[],a._directTransports={},a._serverTransport=null,a._dtListeners={},a._stListeners=[],a._states={},a._localState="IDLE",a._signaling=n,a._mediaSource=r,a._topology=t,a._serverSettings=i,a.subscribe(a._signaling,"NOTIFICATION",a._onSignalingNotification.bind(a)),a}return or(t,e),t.prototype.updateSettings=function(e){var t;this._serverSettings=e;for(var n=0,r=Object.keys(this._directTransports);n<r.length;n++)t=r[n],this._directTransports[t].updateSettings(e);this._serverTransport&&this._serverTransport.updateSettings(e)},t.prototype.allocate=function(e,t){void 0===t&&(t=!1),-1===this._allocated.indexOf(e)?(this._allocated.push(e),"DIRECT"===this._topology&&(this._directTransports[e]=this._createDirectTransport(e,t)),"SERVER"!==this._topology||this._serverTransport||(this._serverTransport=this._createServerTransport())):Or.warn("The participant ["+e+"] has already had allocated transport")},t.prototype.open=function(e,t){if(void 0===t&&(t=null),-1===this._opened.indexOf(e))if(-1!==this._allocated.indexOf(e)){if(this._opened.push(e),"DIRECT"===this._topology){if(!this._directTransports[e])return void Or.warn("Cannot find allocated direct transport for the participant ["+e+"]");this._directTransports[e].open(t)}"SERVER"===this._topology&&this._serverTransport&&(this._serverTransport.open(),this._setState(e,this._serverTransport.getState()),this._setLocalState(this._serverTransport.getLocalState())),Or.debug("The participant ["+e+"] transport opened")}else Or.warn("The participant ["+e+"] has no allocated transport");else Or.warn("The participant ["+e+"] has already had opened transport")},t.prototype.close=function(e){var t=this._allocated.indexOf(e),n=this._opened.indexOf(e);if(t<0&&Or.warn("The participant ["+e+"] transport has already deallocated"),"DIRECT"===this._topology){if(!this._directTransports[e])return void Or.warn("Cannot find allocated direct transport for the participant ["+e+"]");this._directTransports[e].close(),delete this._directTransports[e]}"SERVER"===this._topology&&(this._setState(e,"CLOSED"),this._setLocalState("CLOSED")),n>=0&&this._opened.splice(n,1),t>=0&&this._allocated.splice(t,1)},t.prototype.destroy=function(){var e;this.unsubscribe();for(var t=0,n=Object.values(this._dtListeners);t<n.length;t++)n[t].forEach((function(e){e.dispose()}));this._stListeners&&this._stListeners.forEach((function(e){e.dispose()}));for(var r=0,i=Object.keys(this._directTransports);r<i.length;r++)e=i[r],this._directTransports[e].close(),delete this._directTransports[e];this._directTransports={},this._serverTransport&&(this._serverTransport.close(),this._serverTransport=null),this._allocated=[],this._opened=[]},t.prototype.getTopology=function(){return this._topology},t.prototype.isAllocated=function(e){return this._allocated.indexOf(e)>=0},t.prototype.allocated=function(){return this._allocated.slice()},t.prototype.opened=function(){return this._opened.slice()},t.prototype._setStates=function(e,t){var n=this;e.forEach((function(e){n._setState(e,t)}))},t.prototype._setState=function(e,t){this._states[e]!==t&&(this._states[e]=t,this._triggerEvent("STATE_CHANGED",e,t))},t.prototype._setLocalState=function(e){this._localState!==e&&(this._localState=e,this._triggerEvent("LOCAL_STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){if("topology-changed"===e.notification)return this._onTopologyChanged(e)},t.prototype._onTopologyChanged=function(e){var t=this;if(e.topology!==this._topology){if(Or.log("Topology changed "+this._topology+" -> "+e.topology),this.log("callTopologyChangeRequested",e.topology),this._topology=e.topology,"SERVER"===this._topology)if(this._serverTransport)this._serverTransport.allowRestart();else if(this._serverTransport=this._createServerTransport(),this._opened.length>0){for(var n=0,r=Object.values(this._directTransports);n<r.length;n++)r[n].preventRestart();this._serverTransport&&this._serverTransport.open()}if("DIRECT"===this._topology){var i=(e.offerTo||[]).map(String);this._allocated&&0!==this._allocated.length||Or.warn("Topology changed to DIRECT, but the list of allocated participants is empty"),this._serverTransport&&this._serverTransport.preventRestart(),this._allocated.forEach((function(e){var n=i.indexOf(e)>=0;t._directTransports[e]?t._directTransports[e].allowRestart():t._directTransports[e]=t._createDirectTransport(e,n)})),this._opened.forEach((function(e){t._directTransports[e]?t._directTransports[e].open():Or.warn("There is opened but not allocated transport ["+e+"]")}))}}},t.prototype._createDirectTransport=function(e,t){void 0===t&&(t=!1);var n=new Wi(e,t,this._signaling,this._mediaSource,this._serverSettings);return this._setLocalNoiseSuppression(!0),this._dtListeners[e]&&this._dtListeners[e].length>0&&Or.warn("The list of direct listeners for the participant ["+e+"] is not empty"),this._dtListeners[e]=[],this._dtListeners[e].push(n.addEventListener("REMOTE_TRACK_ADDED",this._onDirectRemoteTrackAdded.bind(this,e)),n.addEventListener("REMOTE_TRACK_REMOVED",this._onDirectRemoteTrackRemoved.bind(this,e)),n.addEventListener("REMOTE_DATA_STATS",this._onDirectRemoteDataStats.bind(this)),n.addEventListener("STATE_CHANGED",this._onDirectTransportChanged.bind(this,e)),n.addEventListener(this.EVENT_LOG,this._onTransportLog.bind(this))),n},t.prototype._createServerTransport=function(){var e=new Ki(this._signaling,this._mediaSource,this._serverSettings);return this._setLocalNoiseSuppression(!1),this._stListeners&&this._stListeners.length>0&&Or.warn("The list of server transport listeners is not empty"),this._stListeners=[],this._stListeners.push(e.addEventListener("REMOTE_TRACK_ADDED",this._onServerRemoteTrackAdded.bind(this)),e.addEventListener("REMOTE_TRACK_REMOVED",this._onServerRemoteTrackRemoved.bind(this)),e.addEventListener("REMOTE_STREAM_STALL",this._onServerRemoteStreamStall.bind(this)),e.addEventListener("REMOTE_DATA_STATS",this._onServerRemoteDataStats.bind(this)),e.addEventListener("STATE_CHANGED",this._onServerTransportChanged.bind(this)),e.addEventListener("LOCAL_STATE_CHANGED",this._onServerTransportLocalChanged.bind(this)),e.addEventListener("ACTIVE_PARTICIPANTS_NO_SIGNAL",this._onTransportActiveParticipantsNoSignal.bind(this)),e.addEventListener("SIGNALLED_ACTIVE_PARTICIPANTS",this._onTransportActiveParticipants.bind(this)),e.addEventListener("SIGNALLED_SPEAKER_CHANGED",this._onTransportSpeakerChanged.bind(this)),e.addEventListener(this.EVENT_LOG,this._onTransportLog.bind(this))),e},t.prototype._releaseAllDirectTransports=function(e){for(var t=0,n=Object.keys(this._directTransports);t<n.length;t++){var r=n[t];this._releaseDirectTransport(r,e)}},t.prototype._releaseDirectTransport=function(e,t){this._directTransports[e]&&(t&&this._directTransports[e].close(),delete this._directTransports[e]),this._dtListeners[e]&&this._dtListeners[e].forEach((function(e){e.dispose()})),delete this._dtListeners[e]},t.prototype._releaseServerTransport=function(e){this._serverTransport&&(e&&this._serverTransport.close(),this._serverTransport=null),this._stListeners&&(this._stListeners.forEach((function(e){e.dispose()})),this._stListeners=[])},t.prototype._setLocalNoiseSuppression=function(e){var t;gr.noiseSuppression!==e&&(gr.noiseSuppression=e,null===(t=this._mediaSource)||void 0===t||t.updateNoiseSuppression())},t.prototype._onDirectTransportChanged=function(e,t){if("CONNECTED"===t&&"DIRECT"===this._topology&&this._releaseServerTransport(!0),("CLOSED"===t||"FAILED"===t)&&(this._releaseDirectTransport(e,!1),"DIRECT"===this._topology)){var n=this._opened.indexOf(e);n>=0&&this._opened.splice(n,1);var r=this._allocated.indexOf(e);r>=0&&this._allocated.splice(r,1)}"DIRECT"===this._topology&&(this._setState(e,t),this._setLocalState(t))},t.prototype._onServerTransportChanged=function(e){var t=this._opened.slice();"CONNECTED"===e&&"SERVER"===this._topology&&this._releaseAllDirectTransports(!0),"CLOSED"!==e&&"FAILED"!==e||(this._releaseServerTransport(!1),"SERVER"===this._topology&&(this._allocated=[],this._opened=[])),"SERVER"===this._topology&&this._setStates(t,e)},t.prototype._onServerTransportLocalChanged=function(e){"SERVER"===this._topology&&this._setLocalState(e)},t.prototype._onTransportActiveParticipantsNoSignal=function(){this._triggerEvent("ACTIVE_PARTICIPANTS_NO_SIGNAL")},t.prototype._onTransportActiveParticipants=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._onTransportSpeakerChanged=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._onServerRemoteStreamStall=function(e,t){this._triggerEvent("REMOTE_STREAM_STALL",e,t)},t.prototype._onServerRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onDirectRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onDirectRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype._onDirectRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onServerRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onServerRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype._onTransportLog=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.log.apply(this,pr([e],t))},t}(di),qi=function(e){function t(t){var n=e.call(this)||this;return n._detectors={},n._interval=null,n.subscribe(t,"REMOTE_TRACK_ADDED",n._onRemoteTrackAdded.bind(n)),n.subscribe(t,"REMOTE_TRACK_REMOVED",n._onRemoteTrackRemoved.bind(n)),n.subscribe(t,"SIGNALLED_ACTIVE_PARTICIPANTS",n._onSignalledActiveParticipants.bind(n)),n.subscribe(t,"ACTIVE_PARTICIPANTS_NO_SIGNAL",n._onActiveParticipantsNoSignal.bind(n)),n}return or(t,e),t.prototype.destroy=function(){for(var e in this._interval&&(window.clearTimeout(this._interval),this._interval=null),this.unsubscribe(),this._detectors)this._detectors.hasOwnProperty(e)&&this._detectors[e].destroy();this._detectors={}},t.prototype._onRemoteTrackAdded=function(e,t,n){var r=this;if("audio"===n.kind&&(this._detectors[e]&&this._detectors[e].destroy(),this._detectors[e]=new wi(t),!this._interval)){var i=function(){r._collectVolumes(),r._interval=window.setTimeout(i,gr.voiceParams.interval)};this._interval=window.setTimeout(i,gr.voiceParams.interval)}},t.prototype._onRemoteTrackRemoved=function(e,t,n){if("audio"===n.kind){var r=this._detectors[e];r&&r.stream===t&&(r.destroy(),delete this._detectors[e])}},t.prototype._collectVolumes=function(){var e={};for(var t in this._detectors)this._detectors.hasOwnProperty(t)&&"msid-audio-mix"!==t&&(e[t]=this._detectors[t].getLevel());if(this._activeParticipants&&this._detectors.hasOwnProperty("msid-audio-mix"))for(var n=this._detectors["msid-audio-mix"].getLevel(),r=0,i=this._activeParticipants;r<i.length;r++)e[t=i[r]]=n;this._triggerEvent("VOLUMES_DETECTED",e)},t.prototype._onSignalledActiveParticipants=function(e){this._activeParticipants=e},t.prototype._onActiveParticipantsNoSignal=function(){this._activeParticipants=null},t}(di),Yi=function(e){function t(t,n,r){var i=e.call(this)||this;return i._mediaSource=null,i._conversation=null,i._state="IDLE",i._participantState="CALLED",i._participants={},i._transport=null,i._debugInfo=null,i._volumesDetector=null,i._speakerDetector=null,i._localVolumeDetector=null,i._specListener=null,i._activeSpeakerId=null,i._lastSignalledActiveSpeakerId=null,i._serverSettings={camera:null,screenSharing:null},i._api=t,i._signaling=n,i._logger=new Pi(t,r),i._logFn=i._logger.log.bind(i._logger),i._onUnload=function(){i._conversation&&i._api&&i._api.hangupConversation(i._conversation.id),i._logger&&i._logger.destroy()},window.addEventListener("unload",i._onUnload),i.onLog(i._signaling,i._logFn),i._audioOutput=new Ci,i}return or(t,e),t.current=function(){return t._current},t.prototype.onStart=function(e,n,r,i,a){return void 0===i&&(i=""),void 0===a&&(a=!1),ur(this,void 0,void 0,(function(){var o,s,c,l,u;return dr(this,(function(d){switch(d.label){case 0:if(t._activationMutex)return Or.warn("Conversation: there is already running activation"),[2];t._activationMutex=!0,d.label=1;case 1:return d.trys.push([1,8,,9]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(r)];case 2:return d.sent(),o=this._mediaSource.getMediaSettings().isVideoEnabled,n===fi.CHAT||e.length>1?this._logger.log("callStartMultiparty",o?"video":"audio"):this._logger.log("callStart",o?"video":"audio"),[4,this._startConversation(e,n,"OUTGOING",o,i,a)];case 3:if(d.sent(),!this._conversation||!this._signaling)throw new Ti(vi.UNKNOWN_ERROR);return[4,this._registerParticipants()];case 4:if(d.sent(),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),Or.debug("Outgoing call",{opponentIds:e,opponentType:n,withVideo:o}),br.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),br.onConversation(this._conversation.externalId),br.onLocalStatus(hr.WAITING),this._toggleJoinAvailability(),this._changeFeatureSet(),this._changeNeedRate(),this._participantState="ACCEPTED",t._current=this,this._conversation.concurrent)return[3,5];for(s=0,c=Object.values(this._participants);s<c.length;s++)l=c[s],br.onParticipantStatus(l.externalId,hr.WAITING);return[3,7];case 5:return[4,this._acceptConcurrent(o)];case 6:d.sent(),d.label=7;case 7:return t._activationMutex=!1,[2,this._conversation];case 8:throw u=d.sent(),t._activationMutex=!1,this._close(u,"Unable to start conversation"),u;case 9:return[2]}}))}))},t.prototype.onJoin=function(e){return ur(this,void 0,void 0,(function(){var n,r,i,a,o;return dr(this,(function(s){switch(s.label){case 0:if(t._activationMutex)throw Or.warn("Conversation: there is already running activation"),new Ti(vi.FAILED);t._activationMutex=!0,s.label=1;case 1:return s.trys.push([1,5,,6]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(e.needVideo)];case 2:return s.sent(),n=this._mediaSource.getMediaSettings().isVideoEnabled,this._logger.log("callJoinConversation",n?"video":"audio"),[4,this._joinConversation(e)];case 3:if(s.sent(),!this._conversation||!this._signaling)throw new Ti(vi.UNKNOWN_ERROR);return[4,this._registerParticipants()];case 4:for(s.sent(),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),br.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),br.onConversation(this._conversation.externalId),br.onLocalStatus(hr.WAITING),this._toggleJoinAvailability(),this._changeNeedRate(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t._current=this,r=0,i=Object.values(this._participants);r<i.length;r++)a=i[r],br.onParticipantStatus(a.externalId,hr.WAITING),"CALLED"!==a.state&&"ACCEPTED"!==a.state||this._transport&&!this._transport.isAllocated(a.id)&&this._transport.allocate(a.id,!1),this._transport&&"ACCEPTED"===a.state&&this._transport.open(a.id,null);return t._activationMutex=!1,[2,this._conversation];case 5:throw o=s.sent(),t._activationMutex=!1,this._close(o,"Unable to join conversation"),o;case 6:return[2]}}))}))},t.prototype.onPush=function(e,n,r){return void 0===n&&(n="USER"),ur(this,void 0,void 0,(function(){var i,a,o=this;return dr(this,(function(s){switch(s.label){case 0:if(t._activationMutex)throw Or.warn("Conversation: there is already running activation"),new Ti(vi.REJECTED);t._activationMutex=!0,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,this._prepareConversation(e,n,r)];case 2:if(s.sent(),this._mediaSource=this._createMediaSource(),!this._conversation||!this._signaling)throw new Ti(vi.UNKNOWN_ERROR);if(!this._conversation.participants.find((function(e){return o._conversation&&"CALLED"===e.state&&e.id===o._conversation.userId})))throw Or.log("Push rejected (there is an active call)"),this._logger.log("callPush","rejected"),new Ti(vi.REJECTED);return[4,this._registerParticipants()];case 3:return s.sent(),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),br.onConversation(this._conversation.externalId),i=this._mediaSource.getMediaSettings().isVideoEnabled,this._logger.log("callPush","accepted"),this._logger.log("callAcceptedOutgoing",i?"video":"audio"),t._current=this,t._activationMutex=!1,[3,5];case 4:throw a=s.sent(),t._activationMutex=!1,this._close(a,"Unable to handle inbound call push"),a;case 5:return[2]}}))}))},t.prototype._acceptConcurrent=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i;return dr(this,(function(a){switch(a.label){case 0:if(!this._mediaSource||!this._signaling||!this._conversation)throw new Ti(vi.UNKNOWN_ERROR);this._logger.log("callAcceptConcurrent",e?"video":"audio"),Or.debug("Concurrent call",{conversationId:this._conversation.id}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 2:for(a.sent(),br.onCallAccepted(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id);return[3,4];case 3:return i=a.sent(),this._close(i,"Unable to accept concurrent call"),[3,4];case 4:return[2]}}))}))},t.prototype.accept=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i;return dr(this,(function(a){switch(a.label){case 0:if(this._logger.log("callAcceptIncoming",e?"video":"audio"),Or.debug("Accept incoming call",{withVideo:e}),!this._mediaSource||!this._signaling||!this._conversation)throw new Ti(vi.UNKNOWN_ERROR);a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this._mediaSource.request(e)];case 2:return a.sent(),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 3:for(a.sent(),br.onCallAccepted(),br.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),br.onConversation(this._conversation.externalId),br.onLocalStatus(hr.WAITING),this._toggleJoinAvailability(),this._changeNeedRate(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id),br.onParticipantStatus(r.externalId,hr.WAITING);return[2,this._conversation];case 4:throw i=a.sent(),this._close(i,"Unable to accept call"),i;case 5:return[2]}}))}))},t.prototype.decline=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){switch(e.label){case 0:return Or.debug("Decline incoming call"),this._logger.log("callDeclineIncoming",this._mediaSource&&this._mediaSource.getMediaSettings().isVideoEnabled?"video":"audio"),this._participantState="HUNGUP",this._signaling?[4,this._signaling.hangup(vi.REJECTED)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._close(new Ti(vi.REJECTED)),[2]}}))}))},t.prototype.hangup=function(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){switch(t.label){case 0:return Or.debug("Hangup"),e="ACTIVE"===this._state?vi.HUNGUP:vi.CANCELED,this._logger.log("callHangup",e),this._signaling?[4,this._signaling.hangup(e)]:[3,2];case 1:return t.sent(),this._close(new Ti(e)),[3,3];case 2:br.onHangup(new Ti(vi.HUNGUP),this._conversation&&this._conversation.id),t.label=3;case 3:return[2]}}))}))},t.prototype.addParticipant=function(e,t){return ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return this._signaling?[4,this._signaling.addParticipant(e,t)]:(this._close(new Ti(vi.UNKNOWN_ERROR),"Unable to add participant"),[2]);case 1:return n=i.sent(),r=null,"error"===n.type&&(r="call-unfeasible"===n.error?n.status:vi.UNKNOWN_ERROR),[4,this._onAddParticipant(e,r)];case 2:return i.sent(),[2]}}))}))},t.prototype.removeParticipant=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return this._signaling?[4,this._signaling.removeParticipant(e)]:[3,2];case 1:t.sent(),this._onRemoveParticipant(e),t.label=2;case 2:return[2]}}))}))},t.prototype.setVolume=function(e){this._audioOutput.volume=e},t.prototype._close=function(e,n){n&&Or.error(n,e),Or.debug("Close conversation",e),e.error?this._signaling&&this._signaling.hangup(vi.FAILED):this._logger.log("callError",e.hangup),t._activationMutex=!1;var r=this._conversation&&this._conversation.id;return-1!==[vi.CANCELED,vi.NOT_FRIENDS,vi.CALLEE_IS_OFFLINE,vi.CALLER_IS_BLOCKED].indexOf(e.hangup)||e.hangup===vi.REJECTED&&!e.remote?(br.onHangup(e,r),void this.destroy()):(e.hangup!==vi.HUNGUP||e.remote&&"CALLED"!==this._participantState)&&(e.hangup!==vi.MISSED||e.remote)?e.hangup!==vi.BUSY||e.remote?(this._state="CLOSE",this._participantState="HUNGUP",this._changeFeatureSet(),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._conversation=null,t._current=null,void br.onHangup(e||new Ti(vi.UNKNOWN_ERROR),r)):(this._cleanupSignaling(),void this._cleanupMediaSource()):(br.onHangup(e,r),void this.destroy())},t.prototype.destroy=function(){var e=this._conversation&&this._conversation.id;Or.debug("Destroy conversation",{conversationId:e}),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._cleanupListeners(),this._logger.destroy(),this._conversation=null,t._current=null},t.prototype._getConversationParams=function(){return ur(this,void 0,void 0,(function(){var e,t,n,r,i;return dr(this,(function(a){switch(a.label){case 0:return[4,this._api.getConversationParams()];case 1:return e=a.sent(),Or.debug("Api.getConversationParams",e),t=[],n=e.turn_server,(r=e.stun_server)&&t.push(r),n&&((i=n.urls.filter((function(e,t,n){return n.indexOf(e)===t}))).forEach((function(e){return i.push(e+"?transport=tcp")})),n.urls=i,t.push(n)),gr.iceServers=t,gr.wssBase=e.endpoint,gr.wssToken=e.token,e.client_type&&(gr.clientType=e.client_type),[2]}}))}))},t.prototype._startConversation=function(e,t,n,r,i,a){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===a&&(a=!1),ur(this,void 0,void 0,(function(){var o,s,c;return dr(this,(function(l){switch(l.label){case 0:return o=kr.uuid(),Or.debug("Conversation: start",{conversationId:o,opponentIds:e,opponentType:t,direction:n,withVideo:r}),[4,this._api.startConversation(o,e,t,r,i,a)];case 1:return s=l.sent(),Or.debug("Api.startConversation",s),[4,this._getConversationParams()];case 2:return l.sent(),[4,this._connectSignaling(yi.START,s)];case 3:return c=l.sent(),[4,this._setConversation(s,c,n)];case 4:return l.sent(),[2]}}))}))},t.prototype._joinConversation=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return dr(this,(function(c){switch(c.label){case 0:return t=e.conversationId,n=e.needVideo,r=void 0!==n&&n,i=e.chatId,a=e.joinLink,Or.debug("Conversation: join",{conversationId:t,joinLink:a,needVideo:r}),t?[4,this._api.joinConversation(t,r,i)]:[3,2];case 1:return o=c.sent(),[3,5];case 2:return a?[4,this._api.joinConversationByLink(a,r)]:[3,4];case 3:return o=c.sent(),[3,5];case 4:throw new Ti(vi.UNKNOWN_ERROR);case 5:return Or.debug("Api.joinConversation",o),[4,this._getConversationParams()];case 6:return c.sent(),[4,this._connectSignaling(yi.JOIN,o)];case 7:return s=c.sent(),[4,this._setConversation(o,s,"JOINING")];case 8:return c.sent(),[2]}}))}))},t.prototype._prepareConversation=function(e,n,r){return void 0===n&&(n="USER"),ur(this,void 0,void 0,(function(){var i,a,o;return dr(this,(function(s){switch(s.label){case 0:return Or.debug("Conversation: push",{conversationId:e,type:n,peerId:r}),[4,this._getConversationParams()];case 1:if(s.sent(),!(i=this._api.getUserId()))throw new Ti(vi.UNKNOWN_ERROR);return a={id:e,peerId:r,endpoint:gr.wssBase+"?userId="+i+"&entityType="+n+"&conversationId="+e+"&token="+gr.wssToken,is_concurrent:!1},[4,this._connectSignaling(yi.ACCEPT,a)];case 2:return o=s.sent(),t._current&&"ACCEPTED"===t._current._participantState?(Or.log("Push rejected (busy)"),this._logger.log("callPush","busy"),this._signaling&&this._signaling.hangup(vi.BUSY),[2,Promise.reject({hangup:vi.BUSY})]):(t._current&&(t._current.destroy(),t._current=null),[4,this._setConversation(a,o,"INCOMING",n)]);case 3:return s.sent(),[2]}}))}))},t.prototype._createParticipant=function(e){return ur(this,void 0,void 0,(function(){var t,n;return dr(this,(function(r){switch(r.label){case 0:return t=Object.assign({id:null,externalId:null,mediaSettings:null,participantState:null,state:null,remoteStream:null,remoteVideoTrack:null,remoteAudioTrack:null,mediaSource:null,platform:null,clientType:null,roles:[]},e),n=t,[4,this._api.userId(t.id)];case 1:return n.externalId=r.sent(),[2,t]}}))}))},t.prototype._setConversation=function(e,t,n,r){var i,a;return void 0===r&&(r="USER"),ur(this,void 0,void 0,(function(){var o,s,c,l;return dr(this,(function(u){switch(u.label){case 0:if(!(o=this._api.getUserId())){if(!(s=null===(a=null===(i=t.conversation)||void 0===i?void 0:i.participants)||void 0===a?void 0:a.find((function(e){return e.peerId&&e.peerId.id===t.peerId.id&&e.peerId.type===t.peerId.type}))))throw new Ti(vi.UNKNOWN_ERROR);o=String(s.id),r=s.idType,this._api.setUserId(o)}return c=kr.composeId(o,r),[4,this._api.userId(c)];case 1:return l=u.sent(),this._conversation={userId:o,compositeUserId:c,externalId:l,acceptTime:t.conversation.acceptTime,features:t.conversation.features||[],id:t.conversation.id||e.id,participants:(t.conversation.participants||[]).map((function(e){return e.id=String(e.id),e})),participantsLimit:t.conversation.participantsLimit||30,topology:t.conversation.topology||"DIRECT",direction:n,concurrent:t.isConcurrent||e.is_concurrent||!1,needRate:!1,chatId:t.conversation.multichatId,permissions:[],roles:[],recordInfo:null,joinLink:e.join_link,conferenceMode:!1,pinnedParticipantId:null},t.conversation.conferenceMode&&this._onConferenceMode(t.conversation.conferenceMode),t.conversation.pinnedParticipantId&&this._onPinParticipant(t.conversation.pinnedParticipantId),this._onRecordInfo(t.conversation.recordInfo),this._signaling.setConversationId(e.id),this._changeFeatureSet(),this._logDevices(),[2]}}))}))},t.prototype._createMediaSource=function(){var e=new Ri;return this.subscribe(e,"SOURCE_CHANGED",this._onLocalMediaStreamChanged.bind(this)),this.onLog(e,this._logFn),e},t.prototype._connectSignaling=function(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){switch(r.label){case 0:return this._signaling.setEndpoint(t.endpoint),this.subscribe(this._signaling,"NOTIFICATION",this._onSignalingNotification.bind(this)),this.subscribe(this._signaling,"FAILED",this._onSignalingFailed.bind(this)),this.subscribe(this._signaling,"RECONNECT",this._onSignalingReconnect.bind(this)),[4,this._signaling.connect(e,t)];case 1:return n=r.sent(),Or.debug("Signaling connected",n),[2,n]}}))}))},t.prototype._registerParticipants=function(){var e;return ur(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return dr(this,(function(c){switch(c.label){case 0:return this._conversation?(t=this._conversation.participants.map((function(e){return e.id})),[4,this._api.prepareUserIds(t)]):[2];case 1:c.sent(),n=0,r=this._conversation.participants,c.label=2;case 2:return n<r.length?(i=r[n],a=kr.composeParticipantId(i),this._conversation&&a===this._conversation.compositeUserId?(this._conversation.permissions=i.permissions,br.onUserPermissions(i.permissions),this._conversation.roles=i.roles||[],this._conversation.roles.length&&(Or.debug("Local roles changed: "+i.roles),br.onLocalRolesChanged(i.roles)),[3,4]):"HUNGUP"===i.state||"REJECTED"===i.state?(this._removeParticipant(i,vi.HUNGUP),[3,4]):(o=this._participants,s=a,[4,this._createParticipant({id:a,mediaSettings:i.mediaSettings,participantState:null===(e=i.participantState)||void 0===e?void 0:e.state,state:i.state,roles:i.roles||[]})])):[3,5];case 3:o[s]=c.sent(),i.roles&&i.roles.length&&(Or.debug("Roles for participant ["+a+"] changed: "+i.roles),br.onRolesChanged(i.externalId,i.roles)),c.label=4;case 4:return n++,[3,2];case 5:return[2]}}))}))},t.prototype._allocateTransport=function(){if(this._conversation&&this._signaling&&this._mediaSource){this._transport=new Ji(this._conversation.topology,this._signaling,this._mediaSource,this._serverSettings),this._debugInfo=new Oi,this.subscribe(this._transport,"STATE_CHANGED",this._onTransportStateChanged.bind(this)),this.subscribe(this._transport,"LOCAL_STATE_CHANGED",this._onTransportLocalStateChanged.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_ADDED",this._onRemoteTrackAdded.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_REMOVED",this._onRemoteTrackRemoved.bind(this)),this.subscribe(this._transport,"REMOTE_STREAM_STALL",this._onRemoteStreamStall.bind(this)),this.subscribe(this._transport,"REMOTE_DATA_STATS",this._onRemoteDataStats.bind(this)),this.onLog(this._transport,this._logFn),this.onLog(this._debugInfo,this._logFn);for(var e="OUTGOING"===this._conversation.direction&&!this._conversation.concurrent,t=0,n=Object.values(this._participants);t<n.length;t++){var r=n[t];"ACCEPTED"!==r.state&&"CALLED"!==r.state||this._transport.allocate(r.id,e)}}},t.prototype._createSpeakerDetector=function(){this._transport&&(this._volumesDetector=new qi(this._transport),this.subscribe(this._volumesDetector,"VOLUMES_DETECTED",this._onVolumesDetected.bind(this)),this._speakerDetector=new Ai(this._volumesDetector,this._transport),this.subscribe(this._speakerDetector,"SPEAKER_CHANGED",this._onSpeakerChanged.bind(this)),this._localVolumeDetector=new Ii(this._mediaSource))},t.prototype._createSpecListener=function(){this._transport&&this._volumesDetector&&(this._specListener=new Ni(this._transport,this._volumesDetector,this._participants),this.onLog(this._specListener,this._logFn))},t.prototype._logDevices=function(){var e=ci.getCameras().length,t=ci.getMicrophones().length;Or.debug("Cameras: "+e+(ci.hasCameraPermission()?"✔":"✖")+", Microphones: "+t+(ci.hasMicrophonePermission()?"✔":"✖")),this._logger.log("callDevices",e+"_"+t)},t.prototype._removeParticipant=function(e,t){var n,r;"CALLED"!==e.state&&"ACCEPTED"!==e.state&&"CLOSE"!==this._state&&this._participants[e.id]&&(t===vi.HUNGUP?br.onParticipantStatus(e.externalId,hr.HANGUP):br.onParticipantStatus(e.externalId,hr.ERROR,t),null===(n=e.mediaSource)||void 0===n||n.disconnect(),null===(r=e.remoteAudioTrack)||void 0===r||r.stop(),delete this._participants[e.id],br.onRemoteRemoved(e.externalId))},t.prototype._cleanupListeners=function(){this.unsubscribe(),window.removeEventListener("unload",this._onUnload)},t.prototype._cleanupMediaSource=function(){this._mediaSource&&(this._mediaSource.destroy(),this._mediaSource=null)},t.prototype._cleanupParticipants=function(){Object.values(this._participants).forEach((function(e){var t,n,r,i;null===(t=e.remoteStream)||void 0===t||t.getTracks().forEach((function(e){e.stop()})),null===(n=e.remoteAudioTrack)||void 0===n||n.stop(),null===(r=e.remoteVideoTrack)||void 0===r||r.stop(),null===(i=e.mediaSource)||void 0===i||i.disconnect()})),this._participants={},this._audioOutput&&this._audioOutput.destroy()},t.prototype._cleanupTransport=function(){this._transport&&(this._transport.destroy(),this._transport=null),this._debugInfo&&(this._debugInfo=null)},t.prototype._cleanupSpeakerDetector=function(){this._speakerDetector&&(this._speakerDetector.destroy(),this._speakerDetector=null),this._volumesDetector&&(this._volumesDetector.destroy(),this._volumesDetector=null),this._localVolumeDetector&&(this._localVolumeDetector.destroy(),this._localVolumeDetector=null)},t.prototype._cleanupSpecListener=function(){this._specListener&&(this._specListener.destroy(),this._specListener=null)},t.prototype._cleanupSignaling=function(){this._signaling&&this._signaling.close()},t.prototype._onAddParticipant=function(e,t){return ur(this,void 0,void 0,(function(){var n,r,i;return dr(this,(function(a){switch(a.label){case 0:return Or.debug("Add new participant ["+e+"]"),!(n=this._participants[e])||"ACCEPTED"!==n.state&&"CALLED"!==n.state?n?[3,2]:(r=this._participants,i=e,[4,this._createParticipant({id:e})]):(Or.warn("Participant ["+n.id+":"+n.state+"] is already in conversation"),[2]);case 1:r[i]=a.sent(),n=this._participants[e],a.label=2;case 2:return br.onParticipantStatus(n.externalId,hr.WAITING),t?(n.state="HUNGUP",this._removeParticipant(n,t)):this._transport&&(n.state="CALLED",this._transport.allocate(n.id,!0),this._logger.log("callAddParticipant")),[2]}}))}))},t.prototype._onRemoveParticipant=function(e){Or.debug("Remove participant ["+e+"]");var t=this._participants[e];t?(this._transport&&this._transport.close(t.id),this._logger.log("callRemoveParticipant")):Or.warn("Participant ["+e+"] isn't in conversation")},t.prototype.changeDevice=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return this._mediaSource?[2,this._mediaSource.changeDevice(e)]:[2,Promise.reject(mr.UNKNOWN)]}))}))},t.prototype.toggleScreenCapturing=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return this._mediaSource?[2,this._mediaSource.toggleScreenCapturing(e)]:[2,Promise.reject(mr.UNKNOWN)]}))}))},t.prototype.setVideoStream=function(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(n){return this._mediaSource?[2,this._mediaSource.setVideoStream(e,t)]:[2]}))}))},t.prototype.toggleLocalVideo=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return this._mediaSource?(this._logger.log("callMediaStatus",e?"video_1":"video_0"),[2,this._mediaSource.toggleVideo(e)]):[2]}))}))},t.prototype.toggleLocalAudio=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return this._mediaSource?(this._logger.log("callMediaStatus",e?"audio_1":"audio_0"),[2,this._mediaSource.toggleAudio(e)]):[2]}))}))},t.prototype.changePriorities=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,l,u;return dr(this,(function(d){switch(d.label){case 0:if(e.length<2||!this._signaling)return[2];for(t={},n={},r=0,i=e;r<i.length;r++)a=i[r],o="object"==typeof a.uid?a.uid:_i.fromId(a.uid),u=_i.toString(o),n[u]=a.priority;for(s=0,c=Object.values(this._participants);s<c.length;s++)l=c[s],u=_i.toString(l.externalId),n.hasOwnProperty(u)&&(t[l.id]=n[u]);return[4,this._signaling.changePriorities(t)];case 1:return d.sent(),[2]}}))}))},t.prototype.changeParticipantState=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i,a;return dr(this,(function(o){switch(o.label){case 0:for(t=0,n=Object.entries(e);t<n.length;t++)if(r=n[t],i=r[0],a=r[1],i.length>5||a.length>5)throw new Error("key/value max length is 5 chars, mappings with empty values (null or empty string) are discarded");return[4,this._signaling.changeParticipantState(e)];case 1:return o.sent(),[2]}}))}))},t.prototype.updateDisplayLayout=function(e){return ur(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,l,u,d;return dr(this,(function(p){switch(p.label){case 0:if(e.length<1||!this._signaling)return[2];for(n={},r={},i=0,a=e;i<a.length;i++)o=a[i],s="object"==typeof o.uid?o.uid:_i.fromId(o.uid),d=_i.toString(s),r[d]=t._layoutToString(o);for(c=0,l=Object.values(this._participants);c<l.length;c++)u=l[c],d=_i.toString(u.externalId),r.hasOwnProperty(d)&&(n[u.id]=r[d]);return[4,this._signaling.updateDisplayLayout(n)];case 1:return p.sent(),[2]}}))}))},t.prototype._checkConferenceAdmin=function(){if(this._conversation&&!kr.includesOneOf(this._conversation.roles,["ADMIN","CREATOR"]))throw new Error("You don't have the required permission")},t.prototype._checkMutePermission=function(){if(this._conversation&&!kr.includesOneOf(this._conversation.permissions,"MUTE_PARTICIPANTS"))throw new Error("You don't have the required permission")},t.prototype.switchConference=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){switch(n.label){case 0:return this._checkConferenceAdmin(),[4,this._signaling.switchConference(e,t)];case 1:return n.sent(),br.onConferenceMode(e),[2]}}))}))},t.prototype.grantRoles=function(e,t,n){return ur(this,void 0,void 0,(function(){return dr(this,(function(r){switch(r.label){case 0:return this._checkConferenceAdmin(),[4,this._signaling.grantRoles(e,t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.switchParticipantDevice=function(e,t,n){return void 0===e&&(e=null),ur(this,void 0,void 0,(function(){return dr(this,(function(r){switch(r.label){case 0:if(!this._conversation||!this._signaling)return[2];if(!e&&n)throw new Error("Forbidden to turn on devices for all participants");if(!this._conversation.conferenceMode&&"VIDEO"===t)throw new Error("Camera switching is allowed only in conference mode");return this._conversation.conferenceMode?(this._checkConferenceAdmin(),n?[4,this._signaling.unmuteParticipant(e,[t])]:[3,2]):[3,5];case 1:return r.sent(),[3,4];case 2:return[4,this._signaling.muteParticipant(e,[t])];case 3:r.sent(),r.label=4;case 4:return[3,7];case 5:return this._checkMutePermission(),[4,this._signaling.switchParticipantMic(e,n)];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))},t.prototype.pinParticipant=function(e,t){var n;return ur(this,void 0,void 0,(function(){return dr(this,(function(r){switch(r.label){case 0:return(null===(n=this._conversation)||void 0===n?void 0:n.conferenceMode)?(this._checkConferenceAdmin(),[4,this._signaling.pinParticipant(e,t)]):[2];case 1:return r.sent(),[2]}}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){return dr(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.chatMessage(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.chatHistory=function(e){return ur(this,void 0,void 0,(function(){var t,n,r;return dr(this,(function(i){switch(i.label){case 0:return this._signaling?[4,this._signaling.chatHistory(e)]:[3,5];case 1:t=i.sent(),n=t.messages.length-1,i.label=2;case 2:return n>=0?(r=t.messages[n],[4,this._onChatMessage(r)]):[3,5];case 3:i.sent(),i.label=4;case 4:return n--,[3,2];case 5:return[2]}}))}))},t.prototype.customData=function(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){return dr(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.customData(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.createJoinLink=function(){return ur(this,void 0,void 0,(function(){var e,t;return dr(this,(function(n){switch(n.label){case 0:return this._conversation?[4,this._api.createJoinLink(this._conversation.id)]:[3,2];case 1:if(e=n.sent(),t=e.join_link)return this._conversation.joinLink=t,[2,t];n.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.removeJoinLink=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){switch(e.label){case 0:return this._conversation?[4,this._api.removeJoinLink(this._conversation.id)]:[3,2];case 1:if(e.sent().success)return delete this._conversation.joinLink,[2];e.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.startStream=function(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),ur(this,void 0,void 0,(function(){var a,o;return dr(this,(function(s){switch(s.label){case 0:return a={movieId:n,name:t,privacy:r,groupId:i,streamMovie:!e},[4,this._signaling.startStream(a)];case 1:return(o=s.sent()).error?[2,Promise.reject()]:[2,o]}}))}))},t.prototype.stopStream=function(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){switch(t.label){case 0:return[4,this._signaling.stopStream()];case 1:return(e=t.sent()).error?[2,Promise.reject()]:[2,e]}}))}))},t.prototype.getStreamInfo=function(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){switch(t.label){case 0:return[4,this._signaling.getRecordStatus()];case 1:return[2,{movieId:(e=t.sent()).recordMovieId,preview:e.recordMoviePreviewUrl}]}}))}))},t.prototype.setLocalResolution=function(e,t){var n;return ur(this,void 0,void 0,(function(){return dr(this,(function(r){if(e<gr.videoMinWidth||t<gr.videoMinHeight)throw new Error("Sizes received are less than the `videoMinWidth` or `videoMinHeight`");return gr.videoMaxWidth=e,gr.videoMaxHeight=t,[2,null===(n=this._mediaSource)||void 0===n?void 0:n.setResolution(e,t)]}))}))},t.prototype._onLocalMediaStreamChanged=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return Or.debug("Local media stream changed",e.mediaSettings),br.onLocalStreamUpdate(e.mediaSettings,e.kind),this._signaling?[4,this._signaling.changeMediaSettings(e.mediaSettings)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t._layoutToString=function(e){var t="";return void 0!==e.priority&&(t+="p="+e.priority),void 0!==e.width&&void 0!==e.height&&(""!==t&&(t+=":"),t+="sz="+Math.round(e.width)+"x"+Math.round(e.height)),void 0!==e.fit&&(""!==t&&(t+=":"),t+="fit="+e.fit),t},t.prototype._changeRemoteMediaSettings=function(e,t){Or.debug("Remote media settings changed ["+e+"]",t);var n=this._participants[e];n&&(n.mediaSettings=t,n.remoteStream&&n.remoteVideoTrack&&t.isVideoEnabled&&(n.remoteStream.addTrack(n.remoteVideoTrack),n.remoteVideoTrack=null),"ACTIVE"===this._state&&br.onRemoteMediaSettings(n.externalId,t),this._specListener&&this._specListener.onChangeRemoteMediaSettings(e,t))},t.prototype._changeRemoteParticipantState=function(e,t){Or.debug("Remote participant state changed ["+e+"]",t);var n=this._participants[e];n&&(n.participantState=t||{},"ACTIVE"===this._state&&br.onRemoteParticipantState(n.externalId,n.participantState))},t.prototype._onSignalingNotification=function(e){switch(e.notification){case"accepted-call":return this._onAcceptedCall(e);case"hungup":return this._onHungup(e);case"participant-added":return this._onAddedParticipant(e);case"participant-joined":return this._onJoinedParticipant(e);case"closed-conversation":return this._onClosedConversation(e);case"media-settings-changed":return this._onMediaSettingsChanged(e);case"participant-state-changed":return this._onParticipantStateChanged(e);case"rate-call-data":return this._onNeedRate();case"feature-set-changed":return this._onFeatureSetChanged(e);case"multiparty-chat-created":return this._onMultipartyChatCreated(e);case"force-media-settings-change":return this._onForceMediaSettingsChange(e);case"settings-update":return this._onSettingsUpdate(e);case"registered-peer":return this._onPeerRegistered(e);case"switch-micro":return this._onMicSwitched(e);case"chat-message":return this._onChatMessage(e);case"custom-data":return this._onCustomData(e);case"record-started":return this._onRecordInfo(e.recordInfo);case"record-stopped":return this._onRecordInfo(null);case"switch-conference":return this._onConferenceMode(e.conferenceMode);case"roles-changed":return this._onRolesChanged(e.participantId,e.roles);case"unmute-participant":return this._onUnmuteParticipant(e);case"mute-participant":return this._onMuteParticipant(e);case"pin-participant":return this._onPinParticipant(e.participantId,e.unpin)}},t.prototype._onSignalingReconnect=function(e){var t,n;return ur(this,void 0,void 0,(function(){var r,i,a,o,s,c,l,u,d,p,h,f;return dr(this,(function(m){switch(m.label){case 0:if(!this._conversation)return[2];if(e.conversation.acceptTime&&(this._conversation.acceptTime=e.conversation.acceptTime),e.conversation.participantsLimit&&(this._conversation.participantsLimit=e.conversation.participantsLimit),e.conversation.features&&(this._conversation.features=e.conversation.features,this._changeFeatureSet()),e.conversation.conferenceMode!==this._conversation.conferenceMode&&this._onConferenceMode(e.conversation.conferenceMode),e.conversation.pinnedParticipantId!==this._conversation.pinnedParticipantId&&(e.conversation.pinnedParticipantId?this._onPinParticipant(e.conversation.pinnedParticipantId,!1):this._conversation.pinnedParticipantId&&this._onPinParticipant(this._conversation.pinnedParticipantId,!0)),e.conversation.topology,e.conversation.state,!e.conversation.participants)return[3,6];r=Object.keys(this._participants),i=[],a=0,o=e.conversation.participants,m.label=1;case 1:return a<o.length?(s=o[a],(c=kr.composeParticipantId(s))===this._conversation.compositeUserId?(Ei(this._conversation.roles,s.roles)||this._onRolesChanged(c,s.roles),[3,4]):(i.push(c),(l=this._participants[c])?[3,3]:[4,this._onJoinedParticipant({participantId:s.id,participantType:s.idType,mediaSettings:s.mediaSettings,participantState:null===(t=s.participantState)||void 0===t?void 0:t.state,state:s.state,roles:s.roles})])):[3,5];case 2:return m.sent(),[3,4];case 3:v=s.mediaSettings,g=l.mediaSettings,(v.isAudioEnabled!==g.isAudioEnabled||v.isVideoEnabled!==g.isVideoEnabled||v.isScreenSharingEnabled!==g.isScreenSharingEnabled||v.isDataEnabled!==g.isDataEnabled)&&this._changeRemoteMediaSettings(c,s.mediaSettings),u=(null===(n=s.participantState)||void 0===n?void 0:n.state)||{},d=l.participantState||{},kr.comparePlainObjects(u,d)||this._changeRemoteParticipantState(c,u),Ei(s.roles,l.roles)||this._onRolesChanged(l.id,s.roles),m.label=4;case 4:return a++,[3,1];case 5:for(p=0,h=r;p<h.length;p++)f=h[p],i.indexOf(f)<0&&this._removeParticipant(this._participants[f],vi.HUNGUP);m.label=6;case 6:return this._onRecordInfo(e.conversation.recordInfo),[2]}var v,g}))}))},t.prototype._onSignalingFailed=function(e){Or.error("Signaling failed",e),this._close(e)},t.prototype._onAcceptedCall=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i,a;return dr(this,(function(o){switch(o.label){case 0:return t=kr.composeMessageId(e),n=kr.getPeerIdString(e.peerId),Or.debug("Participant accepted call ["+t+"]"),this._conversation&&t===this._conversation.compositeUserId?(this._close(new Ti(vi.MISSED),"Call accepted on other device"),[2]):(r=this._participants[t])?[3,2]:(i=this._participants,a=t,[4,this._createParticipant({id:t})]);case 1:i[a]=o.sent(),r=this._participants[t],o.label=2;case 2:return r.state="ACCEPTED",r.mediaSettings=e.mediaSettings,this._conversation&&"OUTGOING"===this._conversation.direction&&"IDLE"===this._state&&(this._state="ACTIVE",this._changeFeatureSet()),"ACTIVE"===this._state&&this._transport&&this._transport.open(r.id,n),this._changeRemoteMediaSettings(t,e.mediaSettings),this._changeRemoteParticipantState(t,null),[2]}}))}))},t.prototype._onHungup=function(e){Or.debug("Participant hungup ["+e.participantId+"]",{reason:e.reason});var t=kr.composeMessageId(e);if(this._conversation&&this._conversation.compositeUserId===t)this._close(new Ti(e.reason));else{var n=this._participants[t];n?(this._transport&&this._transport.close(t),n.state=e.reason===vi.REJECTED?"REJECTED":"HUNGUP","IDLE"!==this._state&&"ACTIVE"!==this._state||this._removeParticipant(n,vi.HUNGUP)):Or.warn("Participant ["+t+"] isn't in conversation")}},t.prototype._onAddedParticipant=function(e){var t,n,r,i;return ur(this,void 0,void 0,(function(){var a,o,s,c;return dr(this,(function(l){switch(l.label){case 0:return Or.debug("Participant added ["+e.participantId+"]"),a=kr.composeMessageId(e),(o=this._participants[a])&&"HUNGUP"!==o.state&&"REJECTED"!==o.state?(Or.debug("Participant ["+a+"] is already in conversation and is active"),[2]):o?[3,2]:(s=this._participants,c=a,[4,this._createParticipant({id:a})]);case 1:s[c]=l.sent(),o=this._participants[a],l.label=2;case 2:return o.state="CALLED",o.mediaSettings=null===(t=e.participant)||void 0===t?void 0:t.mediaSettings,o.participantState=null===(r=null===(n=e.participant)||void 0===n?void 0:n.participantState)||void 0===r?void 0:r.state,o.roles=null===(i=e.participant)||void 0===i?void 0:i.roles,br.onParticipantStatus(o.externalId,hr.WAITING),"ACTIVE"===this._state&&this._transport&&this._transport.allocate(o.id,!0),this._changeRemoteMediaSettings(a,o.mediaSettings),this._changeRemoteParticipantState(a,o.participantState),[2]}}))}))},t.prototype._onJoinedParticipant=function(e){var t,n,r;return ur(this,void 0,void 0,(function(){var i,a,o,s;return dr(this,(function(c){switch(c.label){case 0:return Or.debug("Participant joined ["+e.participantId+"]"),i=kr.composeMessageId(e),(a=this._participants[i])&&"ACCEPTED"===a.state?(Or.warn("Participant ["+i+"] is already in conversation and is active"),[2]):a?[3,2]:(o=this._participants,s=i,[4,this._createParticipant({id:i})]);case 1:o[s]=c.sent(),a=this._participants[i],c.label=2;case 2:return this._conversation&&"OUTGOING"===this._conversation.direction&&"IDLE"===this._state&&(this._state="ACTIVE",this._changeFeatureSet()),a.state="ACCEPTED",a.mediaSettings=e.mediaSettings,a.participantState=null===(n=null===(t=e.participant)||void 0===t?void 0:t.participantState)||void 0===n?void 0:n.state,a.roles=null===(r=e.participant)||void 0===r?void 0:r.roles,this._transport&&this._transport.isAllocated(a.id)?br.onParticipantStatus(a.externalId,hr.CONNECTED):br.onParticipantStatus(a.externalId,hr.WAITING),"ACTIVE"===this._state&&this._transport&&!this._transport.isAllocated(a.id)&&(this._transport.allocate(a.id,!0),this._transport.open(a.id)),this._changeRemoteMediaSettings(i,a.mediaSettings),this._changeRemoteParticipantState(i,a.participantState),[2]}}))}))},t.prototype._onClosedConversation=function(e){this._toggleJoinAvailability(),this._close(new Ti(e.reason,{remote:!0}))},t.prototype._onMediaSettingsChanged=function(e){var t=kr.composeMessageId(e);this._changeRemoteMediaSettings(t,e.mediaSettings)},t.prototype._onParticipantStateChanged=function(e){var t,n=kr.composeMessageId(e);this._changeRemoteParticipantState(n,null===(t=e.participantState)||void 0===t?void 0:t.state)},t.prototype._onNeedRate=function(){this._conversation&&(this._conversation.needRate=!0,this._changeNeedRate())},t.prototype._onFeatureSetChanged=function(e){this._conversation&&(this._conversation.features=e.features,this._changeFeatureSet())},t.prototype._onMultipartyChatCreated=function(e){this._conversation&&(this._conversation.chatId=e.chatId,this._toggleJoinAvailability(),br.onMultipartyChatCreated(this._conversation))},t.prototype._onForceMediaSettingsChange=function(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return this._mediaSource?(t=this._mediaSource.getMediaSettings()).isAudioEnabled===e.mediaSettings.isAudioEnabled?[3,2]:[4,this._mediaSource.toggleAudio(e.mediaSettings.isAudioEnabled)]:[2];case 1:n.sent(),n.label=2;case 2:return t.isVideoEnabled===e.mediaSettings.isVideoEnabled?[3,4]:[4,this._mediaSource.toggleVideo(e.mediaSettings.isVideoEnabled)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype._onSettingsUpdate=function(e){var t,n,r={camera:e.camera,screenSharing:e.screenSharing};t=this._serverSettings,(n=r).camera&&(t.camera=n.camera),n.screenSharing&&(t.screenSharing=n.screenSharing),this._transport&&this._transport.updateSettings(this._serverSettings)},t.prototype._onPeerRegistered=function(e){var t=kr.composeMessageId(e);this._participants[t]&&(this._participants[t].clientType=e.clientType,this._participants[t].platform=e.platform)},t.prototype._onMicSwitched=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return br.onDeviceSwitched("AUDIO",!e.mute),[4,this.toggleLocalAudio(!e.mute)];case 1:return t.sent(),[2]}}))}))},t.prototype._onChatMessage=function(e){return ur(this,void 0,void 0,(function(){var t,n;return dr(this,(function(r){switch(r.label){case 0:return t=kr.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._api.userId(t)];case 2:n=r.sent(),r.label=3;case 3:return br.onChatMessage(e.message,n,e.direct),[2]}}))}))},t.prototype._onCustomData=function(e){return ur(this,void 0,void 0,(function(){var t,n;return dr(this,(function(r){switch(r.label){case 0:return t=kr.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._api.userId(t)];case 2:n=r.sent(),r.label=3;case 3:return br.onCustomData(e.data,n,e.direct),[2]}}))}))},t.prototype._onRecordInfo=function(e){return ur(this,void 0,void 0,(function(){var t,n;return dr(this,(function(r){switch(r.label){case 0:return this._conversation?(t=!1,!this._conversation.recordInfo!=!e?t=!0:this._conversation.recordInfo&&e&&(t=this._conversation.recordInfo.recordMovieId!==e.recordMovieId),t?e?[4,this._api.userId(e.initiator)]:[3,2]:[3,3]):[2];case 1:return n=r.sent(),br.onRecordStarted(n,e.recordMovieId,e.recordStartTime,e.recordType),[3,3];case 2:br.onRecordStopped(),r.label=3;case 3:return this._conversation.recordInfo=e,[2]}}))}))},t.prototype._onConferenceMode=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return this._conversation&&(this._conversation.conferenceMode!==e&&br.onConferenceMode(e),this._conversation.conferenceMode=e),e?[4,this.toggleLocalAudio(!1)]:[3,3];case 1:return t.sent(),[4,this.toggleLocalVideo(!1)];case 2:t.sent(),br.onDeviceSwitched("AUDIO",!1),br.onDeviceSwitched("VIDEO",!1),t.label=3;case 3:return[2]}}))}))},t.prototype._onRolesChanged=function(e,t){var n=this._participants[e];n&&!Ei(n.roles,t)&&(Or.debug("Roles for participant ["+e+"] changed: "+t),n.roles=t,br.onRolesChanged(n.externalId,t)),this._conversation&&e===this._conversation.compositeUserId&&(Or.debug("Local roles changed: "+t),this._conversation.roles=t,br.onLocalRolesChanged(t))},t.prototype._onUnmuteParticipant=function(e){for(var t=0,n=e.mediaOptions;t<n.length;t++){var r=n[t];br.onUnmuteRequest(r,e.timeout)}},t.prototype._onMuteParticipant=function(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=e.mediaOptions||[]).includes("AUDIO")?(br.onDeviceSwitched("AUDIO",!1),[4,this.toggleLocalAudio(!1)]):[3,2];case 1:n.sent(),n.label=2;case 2:return t.includes("VIDEO")?(br.onDeviceSwitched("VIDEO",!1),[4,this.toggleLocalVideo(!1)]):[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype._onPinParticipant=function(e,t){if(void 0===t&&(t=!1),this._conversation){var n=this._conversation.pinnedParticipantId;n&&n!==e&&this._participants[n]&&br.onPinnedParticipant(this._participants[n].externalId,!0),this._participants[e]&&br.onPinnedParticipant(this._participants[e].externalId,t),this._conversation.pinnedParticipantId=t?null:e}},t.prototype._changeFeatureSet=function(){if(this._conversation){var e="ACTIVE"===this._state,t=this._conversation.features.includes("ADD_PARTICIPANT");br.onCallState(e,t,this._conversation)}},t.prototype._changeNeedRate=function(){this._conversation&&this._conversation.needRate&&br.onRateNeeded()},t.prototype._onVolumesDetected=function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n],a=i[0],o=i[1],s=this._participants[a];s&&s.externalId&&t.push({uid:s.externalId,volume:o.real})}br.onVolumesDetected(t)},t.prototype._onSpeakerChanged=function(e){this._activeSpeakerId=e,this._participants[e]&&this._lastSignalledActiveSpeakerId!==e&&(br.onSpeakerChanged(this._participants[e].externalId),this._lastSignalledActiveSpeakerId=e)},t.prototype._onTransportStateChanged=function(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){switch(r.label){case 0:return(n=this._participants[e])?(Or.debug("Transport state for participant ["+e+"] has changed: "+t),"CONNECTED"===t&&br.onParticipantStatus(n.externalId,hr.CONNECTED),"CONNECTING"===t&&br.onParticipantStatus(n.externalId,hr.CONNECTING),"RECONNECTING"===t&&br.onParticipantStatus(n.externalId,hr.RECONNECT),"FAILED"!==t?[3,3]:this._transport&&0===this._transport.allocated().length?this._signaling?[4,this._signaling.hangup(vi.FAILED)]:[3,2]:[3,3]):(Or.warn("Participant ["+e+"] isn't in conversation"),[2]);case 1:r.sent(),r.label=2;case 2:return this._close(new Ti(vi.FAILED),"Transport failed"),[3,3];case 3:return[2]}}))}))},t.prototype._onTransportLocalStateChanged=function(e){Or.debug("Local transport state has changed: "+e),"CONNECTED"===e&&br.onLocalStatus(hr.CONNECTED),"CONNECTING"===e&&br.onLocalStatus(hr.CONNECTING),"RECONNECTING"===e&&br.onLocalStatus(hr.RECONNECT)},t.prototype._onRemoteTrackAdded=function(e,t,n){return ur(this,void 0,void 0,(function(){var r,i,a;return dr(this,(function(o){switch(o.label){case 0:return e.endsWith("audio-mix")?(Or.debug("Remote audio mix track added"),this._audioOutput.addMix(n),[3,4]):[3,1];case 1:return Or.debug("Remote track added on the participant ["+e+"]",{kind:n.kind}),(r=this._participants[e])?[3,3]:(Or.warn("Conversation: track added before participant ["+e+"]"),i=this._participants,a=e,[4,this._createParticipant({id:e,state:"CALLED"})]);case 2:i[a]=o.sent(),r=this._participants[e],br.onParticipantStatus(r.externalId,hr.WAITING),this._activeSpeakerId===e&&this._lastSignalledActiveSpeakerId!==e&&(br.onSpeakerChanged(r.externalId),this._lastSignalledActiveSpeakerId=e),o.label=3;case 3:this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!1),r.remoteStream!==t&&(r.remoteStream=t,br.onRemoteStream(r.externalId,t)),"audio"===n.kind&&this._audioOutput.add(e,n),r.mediaSettings&&(n&&!r.mediaSettings.isVideoEnabled&&"video"===n.kind&&(r.remoteVideoTrack=n,r.remoteStream.removeTrack(n)),this._changeRemoteMediaSettings(e,r.mediaSettings)),this._changeRemoteParticipantState(e,r.participantState),o.label=4;case 4:return[2]}}))}))},t.prototype._onRemoteTrackRemoved=function(e,t,n){if("audio"===n.kind)if("audio-mix"===e)this._audioOutput.removeMix();else{var r=this._participants[e];if(!r)return;if(r.remoteStream&&r.remoteStream!==t)return;this._audioOutput.remove(e)}},t.prototype._onRemoteStreamStall=function(e,t){Object.values(this._participants).forEach((function(n){n.remoteStream&&"HUNGUP"!==n.state&&n.remoteStream.getAudioTracks().forEach((function(r){r.id===e.id&&(t?br.onParticipantStatus(n.externalId,hr.RECONNECT):br.onParticipantStatus(n.externalId,hr.CONNECTED))}))}))},t.prototype._onRemoteDataStats=function(e){var t;this._debugInfo&&this._debugInfo.onRemoteDataStats(e,this._participants,null===(t=this._mediaSource)||void 0===t?void 0:t.getMediaSettings());var n=e.outbound.rtps.find((function(e){return"audio"===e.kind}));this._mediaSource&&n&&!n.bandwidth&&ci.hasMicrophone()&&this._mediaSource.getMediaSettings().isAudioEnabled&&(this._logger.log("callError","audio_device_recover"),this._mediaSource.toggleAudio(!0))},t.prototype._toggleJoinAvailability=function(){var e=this._conversation&&this._conversation.chatId,t=e&&"CLOSE"!==this._state||!1;e&&(Or.debug("Toggle join availability",{available:t,chatId:e}),br.onJoinStatus(t,e))},t}(di);function Xi(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!1),window.Blob&&window.navigator.sendBeacon){var r=Qi(e,t,n),i=new window.Blob([r],{type:"application/x-www-form-urlencoded"});window.navigator.sendBeacon(gr.apiEnv.api+"fb.do",i)}}function Zi(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(r){return[2,$i(Qi(e,t,n))]}))}))}function $i(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,new Promise((function(t,n){var r=new XMLHttpRequest;r.open("POST",gr.apiEnv.api+"fb.do",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){var e;try{e=JSON.parse(r.responseText)}catch(t){e={result:r.responseText}}200!==r.status||e.hasOwnProperty("error_msg")?n(e):t(e)}},r.send(e)}))]}))}))}function Qi(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1),t.method=e,t.format="JSON",t.application_key||(t.application_key=gr.apiKey),n||(vr.sessionKey?t.session_key=vr.sessionKey:vr.accessToken&&(t.access_token=vr.accessToken));for(var r=0,i=Object.entries(t);r<i.length;r++){var a=i[r],o=a[0];"object"==typeof(d=a[1])&&(t[o]=JSON.stringify(d))}for(var s="",c=0,l=Object.entries(t);c<l.length;c++){var u=l[c],d=(o=u[0],u[1]);s&&(s+="&"),s+=o+"="+encodeURIComponent(d)}return s}var ea,ta=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._userId=null,t._externalUidsCache={},t}return or(t,e),t.prototype._callUnsafe=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),ur(this,void 0,void 0,(function(){var r,i=this;return dr(this,(function(a){return[2,(r=function(a){return ur(i,void 0,void 0,(function(){var i;return dr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,5]),[4,Zi(e,t,n)];case 1:return[2,o.sent()];case 2:return(i=o.sent()).hasOwnProperty("error_msg")?[3,4]:(a++,Or.debug(e+" network error, attempt "+a+"..."),a<5?[4,kr.delay(700*a)]:[3,4]);case 3:return o.sent(),[2,r(a)];case 4:throw Or.warn(e,"error",i),i;case 5:return[2]}}))}))})(0)]}))}))},t.prototype._call=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),ur(this,void 0,void 0,(function(){var r,i;return dr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,10]),[4,this._callUnsafe(e,t,n)];case 1:return[2,a.sent()];case 2:switch(r=a.sent(),i=mr.API,r.error_code){case 102:case 103:case 104:return[3,3];case 1101:return[3,5];case 1102:return[3,6];case 1103:return[3,7];case 1104:case 1106:return[3,8]}return[3,9];case 3:return[4,this.authorize()];case 4:return a.sent(),[2,this._callUnsafe(e,t,n)];case 5:return i=vi.SERVICE_DISABLED,[3,9];case 6:return i=vi.CALLEE_IS_OFFLINE,[3,9];case 7:return i=vi.NOT_FRIENDS,[3,9];case 8:return i=vi.EXTERNAL_API_ERROR,[3,9];case 9:throw new Ti(i,{message:r.error_msg,code:r.error_code});case 10:return[2]}}))}))},t.prototype._getCurrentUser=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,this._call("users.getCurrentUser")]}))}))},t.prototype.userId=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i;return dr(this,(function(a){switch(a.label){case 0:return t=kr.decomposeId(e).id,vr.isEmpty()?[2,_i.fromId(t)]:this._externalUidsCache.hasOwnProperty(t)?[3,2]:(r=(n=Object).assign,i=[this._externalUidsCache],[4,this._getExternalIdsByOkIds([t])]);case 1:r.apply(n,i.concat([a.sent()])),a.label=2;case 2:return[2,_i.fromString(this._externalUidsCache[t])]}}))}))},t.prototype.prepareUserIds=function(e){return ur(this,void 0,void 0,(function(){var t,n,r;return dr(this,(function(i){switch(i.label){case 0:return vr.isEmpty()?[3,2]:(n=(t=Object).assign,r=[this._externalUidsCache],[4,this._getExternalIdsByOkIds(e)]);case 1:n.apply(t,r.concat([i.sent()])),i.label=2;case 2:return[2]}}))}))},t.prototype.authorize=function(){return ur(this,void 0,void 0,(function(){var e,t,n=this;return dr(this,(function(r){return this._uuid||((e=Ir.get("uuid"))||(e=kr.uuid(),Ir.set("uuid",e)),this._uuid=String(e)),t={session_data:{version:2,device_id:this._uuid,client_version:gr.appVersion,client_type:"SDK_JS"}},gr.authToken&&(t.session_data.auth_token=gr.authToken,t.session_data.version=3),[2,this._callUnsafe("auth.anonymLogin",t,!0).then((function(e){e.uid&&(n._userId=String(e.uid)),vr.sessionKey=e.session_key,vr.sessionSecretKey=e.session_secret_key})).catch((function(e){throw 401===e.error_code&&br.onTokenExpired(),new Ti(mr.AUTH,{message:e.error_msg,code:e.error_code})}))]}))}))},t.prototype.log=function(e){Xi("log.externalLog",{collector:"ok.mobile.apps.video",data:JSON.stringify({application:gr.appName+":2.1.17-beta.2",platform:gr.platform,items:e})})},t.prototype.init=function(){!function(){if(!gr.apiAppId||!gr.apiKey)throw new Ti(mr.API,{message:"Required arguments apiAppId/apiAppKey not passed"})}()},t.prototype.joinConversation=function(e,t,n){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){var r;return dr(this,(function(i){return r={conversationId:e,isVideo:t},n&&(r.chatId=n),[2,this._call("vchat.joinConversation",r)]}))}))},t.prototype.createConversation=function(e,t){return void 0===t&&(t=""),ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){return n={conversationId:e,createJoinLink:!0,isVideo:!1},t&&(n.payload=t),gr.domain&&(n.domainId=gr.domain),[2,this._startConversation(n)]}))}))},t.prototype.startConversation=function(e,t,n,r,i,a){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===a&&(a=!1),ur(this,void 0,void 0,(function(){var o;return dr(this,(function(s){if(o={conversationId:e,isVideo:r},t&&t.length)switch(n){case fi.USER:o.uids=t.join(",");break;case fi.GROUP:o.gid=t[0];break;case fi.CHAT:o.chatId=t[0]}return a&&(o.createJoinLink=!0),i&&(o.payload=i),gr.domain&&(o.domainId=gr.domain),[2,this._startConversation(o)]}))}))},t.prototype._startConversation=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._call("vchat.startConversation",e)]}))}))},t.prototype.createJoinLink=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._call("vchat.createJoinLink",{conversationId:e})]}))}))},t.prototype.removeJoinLink=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._call("vchat.removeJoinLink",{conversationId:e})]}))}))},t.prototype.getAnonymTokenByLink=function(e,t){return ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return n={joinLink:e},t&&(n.anonymName=t),[4,this._call("vchat.getAnonymTokenByLink",n)];case 1:return r=i.sent(),this._userId=String(r.uid),[2,r.token]}}))}))},t.prototype.joinConversationByLink=function(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){return n={joinLink:e,isVideo:t},gr.anonymToken&&(n.anonymToken=gr.anonymToken),[2,this._call("vchat.joinConversationByLink",n)]}))}))},t.prototype.getOkIdsByExternalIds=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,l,u,d,p=this;return dr(this,(function(h){switch(h.label){case 0:for(t=_i.fromIds(e),n=[],r={methods:[]},i=[],a=Object.keys(this._externalUidsCache),o=Object.values(this._externalUidsCache),s=0,c=t;s<c.length;s++)l=c[s],u=_i.toString(l),(d=o.indexOf(u))>-1?n.push(a[d]):(i.push(u),r.methods.push({"vchat.getOkIdByExternalId":{params:{externalId:l.id,anonym:l.type===gi.ANONYM},onError:"SKIP"}}));return r.methods.length?[4,this._call("batch.executeV2",r)]:[2,n];case 1:return h.sent().forEach((function(e,t){if(e.ok){var r=String(e.ok.ok_id);p._externalUidsCache[r]=i[t],n.push(r)}})),[2,n]}}))}))},t.prototype.getConversationParams=function(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return e={},gr.anonymToken&&(e.anonymToken=gr.anonymToken),[2,this._call("vchat.getConversationParams",e)]}))}))},t.prototype.getUserId=function(){return this._userId},t.prototype.setUserId=function(e){this._userId=e},t.prototype.hangupConversation=function(e){var t={conversationId:e,reason:vi.HUNGUP};gr.anonymToken&&(t.anonymToken=gr.anonymToken),Xi("vchat.hangupConversation",t)},t.prototype._getExternalIdsByOkIds=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,l,u;return dr(this,(function(d){switch(d.label){case 0:t={},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this._call("vchat.getExternalIdsByOkIds",{uids:e.join(",")})];case 2:if((n=d.sent()).external_ids)for(r=0,i=Object.entries(n.external_ids);r<i.length;r++)a=i[r],l=a[0],u=a[1],t[l]=_i.fromIdToString(u,gi.USER);if(n.anonym_ids)for(o=0,s=Object.entries(n.anonym_ids);o<s.length;o++)c=s[o],l=c[0],u=c[1],t[l]=_i.fromIdToString(u,gi.ANONYM);return[2,t];case 3:return d.sent(),[2,t];case 4:return[2]}}))}))},t}(li);!function(e){e.RECOVER="recover",e.ACCEPT_CALL="accept-call",e.ADD_PARTICIPANT="add-participant",e.REMOVE_PARTICIPANT="remove-participant",e.HANGUP="hangup",e.TRANSMIT_DATA="transmit-data",e.ACCEPT_PRODUCER="accept-producer",e.ALLOCATE_CONSUMER="allocate-consumer",e.CHANGE_MEDIA_SETTINGS="change-media-settings",e.CHANGE_PARTICIPANT_STATE="change-participant-state",e.CHANGE_STREAM_PRIORITIES="change-streams-priorities",e.UPDATE_DISPLAY_LAYOUT="update-display-layout",e.REPORT_PERF_STAT="report-perf-stat",e.RECORD_START="record-start",e.RECORD_STOP="record-stop",e.RECORD_GET_STATUS="record-get-status",e.SWITCH_MICRO="switch-micro",e.SWITCH_TOPOLOGY="switch-topology",e.REQUEST_REALLOC="request-realloc",e.CHAT_MESSAGE="chat-message",e.CHAT_HISTORY="chat-history",e.CUSTOM_DATA="custom-data",e.SWITCH_CONFERENCE="switch-conference",e.GRANT_ROLES="grant-roles",e.UNMUTE_PARTICIPANT="unmute-participant",e.MUTE_PARTICIPANT="mute-participant",e.PIN_PARTICIPANT="pin-participant"}(ea||(ea={}));var na,ra,ia=ea,aa=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.socket=null,t.sequence=1,t.lastStamp=0,t.commandsQueue=[],t.incomingCache=[],t.responseHandlers={},t.reconnectCount=0,t.conversationResolve=null,t.conversationReject=null,t.connected=!1,t.listenersReady=!1,t.postfix="&platform="+gr.platform+"&appVersion="+gr.appVersion+"&version="+gr.protocolVersion+"&device="+gr.device,t.peerId=null,t.conversationId=null,t.reconnectTimer=0,t.connectionMessageWaitTimer=0,t.doctorTimer=0,t}return or(t,e),t.prototype.setEndpoint=function(e){this.endpoint=e},t.prototype.setConversationId=function(e){this.conversationId=e},t.prototype.connect=function(e){return ur(this,void 0,void 0,(function(){var t=this;return dr(this,(function(n){return this.postfix+="&clientType="+gr.clientType,[2,new Promise((function(n,r){if(t.socket&&t.socket.readyState<WebSocket.CLOSING)return t.log("callSocketAction","already_opened"),void r(Error("Socket already opened"));t.conversationResolve=function(e){n(e),t.conversationResolve=null,t.conversationReject=null},t.conversationReject=function(e){r(e),t.conversationResolve=null,t.conversationReject=null},t._connect(e)}))]}))}))},t.prototype._send=function(e,t){return void 0===t&&(t={}),ur(this,void 0,void 0,(function(){var n,r=this;return dr(this,(function(i){return t.participantId&&(n=kr.decomposeId(t.participantId),t=Object.assign({},t,{participantId:n.id,participantType:n.type})),[2,new Promise((function(n,i){if(!r.socket)return r.log("callSocketAction","not_opened"),Or.warn("Socket not opened"),void i(new Error("Socket not opened"));r.socket.readyState>WebSocket.OPEN&&(r.log("callSocketAction","invalid_state"),Or.warn("Invalid state "+r.socket.readyState)),r.commandsQueue.push({sequence:r.sequence++,name:e,params:t,responseTimer:0,resolve:n,reject:i}),r.socket.readyState===WebSocket.OPEN&&r._handleCommandsQueue()}))]}))}))},t.prototype.hangup=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.HANGUP,{reason:e}).catch((function(){}))]}))}))},t.prototype.sendCandidate=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.TRANSMIT_DATA,{participantId:e,data:{candidate:t}})]}))}))},t.prototype.sendSdp=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.TRANSMIT_DATA,{participantId:e,data:{sdp:t}})]}))}))},t.prototype.acceptCall=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.ACCEPT_CALL,{mediaSettings:e})]}))}))},t.prototype.changeMediaSettings=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.CHANGE_MEDIA_SETTINGS,{mediaSettings:e})]}))}))},t.prototype.changeParticipantState=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.CHANGE_PARTICIPANT_STATE,{participantState:{state:e}})]}))}))},t.prototype.addParticipant=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.ADD_PARTICIPANT,lr({participantId:e},t))]}))}))},t.prototype.removeParticipant=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.REMOVE_PARTICIPANT,{participantId:e})]}))}))},t.prototype.allocateConsumer=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.ALLOCATE_CONSUMER,{description:e.sdp,capabilities:t})]}))}))},t.prototype.acceptProducer=function(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){return n={description:e.sdp},t&&(n.ssrcs=t),[2,this._send(ia.ACCEPT_PRODUCER,n)]}))}))},t.prototype.changePriorities=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.CHANGE_STREAM_PRIORITIES,{typedPriorities:e}).catch((function(){}))]}))}))},t.prototype.updateDisplayLayout=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.UPDATE_DISPLAY_LAYOUT,{layouts:e}).catch((function(){}))]}))}))},t.prototype.startStream=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.RECORD_START,e)]}))}))},t.prototype.stopStream=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,this._send(ia.RECORD_STOP)]}))}))},t.prototype.getRecordStatus=function(){return ur(this,void 0,void 0,(function(){return dr(this,(function(e){return[2,this._send(ia.RECORD_GET_STATUS)]}))}))},t.prototype.switchParticipantMic=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.SWITCH_MICRO,{eId:e,all:null===e,muteTarget:!t})]}))}))},t.prototype.switchTopology=function(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.SWITCH_TOPOLOGY,{topology:e,force:t})]}))}))},t.prototype.requestRealloc=function(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){return t={},e&&(t.target=e.toUpperCase()),[2,this._send(ia.REQUEST_REALLOC,t)]}))}))},t.prototype.reportPerfStat=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.REPORT_PERF_STAT,{report:e})]}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.CHAT_MESSAGE,{message:e,participantId:t})]}))}))},t.prototype.chatHistory=function(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,this._send(ia.CHAT_HISTORY,{count:e})]}))}))},t.prototype.customData=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.CUSTOM_DATA,{data:e,participantId:t})]}))}))},t.prototype.switchConference=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.SWITCH_CONFERENCE,{conferenceMode:e,maxUnmutedParticipants:t})]}))}))},t.prototype.grantRoles=function(e,t,n){return ur(this,void 0,void 0,(function(){var r;return dr(this,(function(i){return r={participantId:e,roles:t},n&&(r.revoke=!0),[2,this._send(ia.GRANT_ROLES,r)]}))}))},t.prototype.unmuteParticipant=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.UNMUTE_PARTICIPANT,{participantId:e,mediaOptions:t})]}))}))},t.prototype.muteParticipant=function(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,this._send(ia.MUTE_PARTICIPANT,{participantId:e,mediaOptions:t})]}))}))},t.prototype.pinParticipant=function(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){return n={participantId:e},t&&(n.unpin=!0),[2,this._send(ia.PIN_PARTICIPANT,n)]}))}))},t.prototype.close=function(){this.socket&&this.socket.readyState<WebSocket.CLOSING&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close(),this.socket=null),this._stopWaitConnectionMessage(),this._stopDoctor(),clearTimeout(this.reconnectTimer)},t.prototype.readyToSend=function(){this.listenersReady=!0,this._handleCachedMessages()},t.prototype._connect=function(e){if(!(this.socket&&this.socket.readyState<WebSocket.CLOSING)){var t=e?"&tgt="+e:"";Or.debug("Connecting to "+this.endpoint+this.postfix+t),this.socket=new WebSocket(this.endpoint+this.postfix+t),this.socket.onopen=this._onOpen.bind(this),this.socket.onmessage=this._onMessage.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this._startDoctor()}},t.prototype._recover=function(){var e=this;new Promise((function(n,r){if(!e.socket||e.socket.readyState!==WebSocket.OPEN)return Or.warn("Socket not opened"),void r(new Error("Socket not opened"));var i={sequence:e.sequence++,name:"recover",params:{stamp:e.lastStamp},responseTimer:0,resolve:n,reject:r},a=Object.assign({command:i.name,sequence:i.sequence},i.params);i.responseTimer=window.setTimeout(e._handleCommandResponse.bind(e,!1,a),t.WAIT_RESPONSE_DELAY),e.responseHandlers[i.sequence]=i,e.socket.send(JSON.stringify(a))})).then((function(t){t.error||t.messages.forEach(e._handleMessage.bind(e)),e._handleCommandsQueue()}))},t.prototype._onOpen=function(){this.log("callSocketAction","opened"),this._waitConnectionMessage(),this._startDoctor()},t.prototype._onMessage=function(e){if(this._startDoctor(),"ping"!==e.data)try{this._handleMessage(JSON.parse(e.data))}catch(t){this.log("callSocketAction","parse_error"),Or.error("Unable to parse message",t,e.data)}else this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send("pong")},t.prototype._handleMessage=function(e){"notification"===e.type?"connection"===e.notification?(this.connected=!0,this.reconnectCount=0,this.endpoint=e.endpoint,e.peerId&&this.peerId!==e.peerId.id&&(this.postfix+="&peerId="+e.peerId.id,this.peerId=e.peerId.id),this._stopWaitConnectionMessage(),this.conversationResolve?this.conversationResolve(e):this._triggerEvent("RECONNECT",e),this.lastStamp?(this._handleCachedMessages(),this._recover()):this._handleCommandsQueue()):this.connected&&this.listenersReady?this._triggerEvent("NOTIFICATION",e):this.incomingCache.push(e):"response"!==e.type&&"error"!==e.type||!this.responseHandlers[e.sequence]?"error"===e.type?"service-unavailable"===e.error&&e.recoverable?(this.log("callSocketAction","service-unavailable"),this._reconnect()):e.sequence&&e.recoverable||(this.connected||"invalid-token"===e.error?(this.log("callSocketAction","error-"+e.error),this._throwError(new Error("Signaling error: "+e.error))):"conversation-ended"===e.error?this._triggerEvent("NOTIFICATION",{notification:"closed-conversation",reason:e.reason}):(this.conversationReject&&this.conversationReject(new Ti(mr.SIGNALING_FAILED,{message:"Unable to connect to the signaling: "+e.error})),this.close())):(this.log("callSocketAction","unknown_message"),Or.warn("Unhandled message",e)):this._handleCommandResponse(!0,e),this.lastStamp=e.stamp||this.lastStamp},t.prototype._handleCachedMessages=function(){for(;this.incomingCache.length>0;){var e=this.incomingCache.pop();this._handleMessage(e)}},t.prototype._throwError=function(e){this._triggerEvent("FAILED",e)},t.prototype._onError=function(e){this.log("callSocketAction","error"),Or.error("Error",e)},t.prototype._onClose=function(e){this.log("callSocketAction","closed"),Or.debug("Connection closed",{code:e.code,reason:e.reason}),this.connected=!1,this._stopDoctor(),this.socket&&this.reconnectCount++<t.RECONNECT_MAX_COUNT?this._reconnect():this.socket&&(Object.values(this.responseHandlers).forEach((function(e){window.clearTimeout(e.responseTimer),e.reject(new Error("Connection closed"))})),this.commandsQueue=[],this.responseHandlers={},this.socket=null,this.lastStamp=0,this.listenersReady=!1,this._throwError(new Error("Connection closed")))},t.prototype._reconnect=function(){var e=Math.min(t.RECONNECT_MAX_DELAY,t.RECONNECT_DELAY*Math.pow(2,this.reconnectCount-1));Or.log("Reconnect websocket after "+e+"ms ("+this.reconnectCount+")"),this.log("callSocketAction","reconnect"),this.reconnectTimer=window.setTimeout(this._connect.bind(this,yi.RETRY),e)},t.prototype._handleCommandResponse=function(e,t){if(this.responseHandlers.hasOwnProperty(t.sequence)){var n=this.responseHandlers[t.sequence];window.clearTimeout(n.responseTimer),e?n.resolve(t):(this.log("callSocketAction","response-timeout"),n.reject(new Error("Response timeout ["+n.name+"]"))),delete this.responseHandlers[t.sequence]}},t.prototype._handleCommandsQueue=function(){for(;this.commandsQueue.length>0;){var e=this.commandsQueue.shift();if(this.socket&&this.socket.readyState===WebSocket.OPEN){var n=Object.assign({command:e.name,sequence:e.sequence},e.params);e.responseTimer=window.setTimeout(this._handleCommandResponse.bind(this,!1,n),t.WAIT_RESPONSE_DELAY),this.responseHandlers[e.sequence]=e,this.socket.send(JSON.stringify(n))}else e.reject(new Error("Invalid state or socket already closed"))}},t.prototype._waitConnectionMessage=function(){var e=this;this.connectionMessageWaitTimer=window.setTimeout((function(){e.conversationReject&&e.conversationReject(new Ti(mr.SIGNALING_FAILED,{message:"Unable to connect to the signaling: connection timeout"}))}),t.WAIT_CONNECTION_DELAY)},t.prototype._stopWaitConnectionMessage=function(){window.clearTimeout(this.connectionMessageWaitTimer),this.connectionMessageWaitTimer=0},t.prototype._startDoctor=function(){var e=this;this._stopDoctor(),this.doctorTimer=window.setTimeout((function(){Or.warn("Socket is dead, trying to reconnect"),e.close(),e._connect(yi.RETRY)}),t.WAIT_MESSAGE_DELAY)},t.prototype._stopDoctor=function(){window.clearTimeout(this.doctorTimer),this.doctorTimer=0},t.RECONNECT_DELAY=gr.signalingReconnectDelay,t.RECONNECT_MAX_DELAY=gr.signalingReconnectMaxDelay,t.RECONNECT_MAX_COUNT=gr.signalingReconnectMaxCount,t.WAIT_CONNECTION_DELAY=gr.waitConnectionDelay,t.WAIT_RESPONSE_DELAY=gr.waitResponseDelay,t.WAIT_MESSAGE_DELAY=gr.waitMessageDelay,t}(pi),oa=null,sa={getCameras:ci.getCameras,getMicrophones:ci.getMicrophones,getOutput:ci.getOutput,hasCamera:ci.hasCamera,hasMicrophone:ci.hasMicrophone,getSavedCamera:ci.getSavedCamera,getSavedMicrophone:ci.getSavedMicrophone,getSavedOutput:ci.getSavedOutput,hasCameraPermission:ci.hasCameraPermission,hasMicrophonePermission:ci.hasMicrophonePermission,hasPermissions:ci.hasPermissions,getUserMedia:ci.getUserMedia,getUserVideo:ci.getUserVideo,getUserAudio:ci.getUserAudio,saveDeviceId:ci.saveDeviceId,isBrowserSupported:ci.isBrowserSupported,isScreenCapturingSupported:ci.isScreenCapturingSupported,os:ci.os,isMobile:ci.isMobile,browserName:ci.browserName,browserVersion:ci.browserVersion,baseChromeVersion:ci.baseChromeVersion,getAudioContext:ci.getAudioContext};function ca(e){ra=e}function la(e){na=e}function ua(e){oa=e}function da(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return gr.set(e),ra||ca(new ta),na||la((function(){return new aa})),[4,ci.init()];case 1:if(t.sent(),!ci.isBrowserSupported())throw new Ti(mr.UNSUPPORTED);if(!ci.hasMicrophone()&&!gr.allowMissingMic)throw new Ti(mr.MIC_NOT_FOUND);return ra.init(),[2]}}))}))}function pa(e,t,n,r){return void 0===t&&(t=!1),void 0===n&&(n=""),void 0===r&&(r=!1),ur(this,void 0,void 0,(function(){var i,a;return dr(this,(function(o){switch(o.label){case 0:return i=[],a=[],Array.isArray(e)?i=e.length?e:[]:e&&(i=[e]),i.length?[4,ra.getOkIdsByExternalIds(i)]:[3,2];case 1:if(!(a=o.sent()).length)throw new Ti(vi.CALLEE_IS_OFFLINE);o.label=2;case 2:return[2,ha(a,fi.USER,t,n,r)]}}))}))}function ha(e,t,n,r,i){return void 0===t&&(t=fi.USER),void 0===n&&(n=!1),void 0===r&&(r=""),void 0===i&&(i=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(a){return[2,new Yi(ra,na(),oa).onStart(e,t,n,r,i)]}))}))}function fa(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return[2,ma(e)]}))}))}function ma(e,t,n){return void 0===t&&(t="USER"),ur(this,void 0,void 0,(function(){return dr(this,(function(r){return[2,new Yi(ra,na(),oa).onPush(e,t,n)]}))}))}function va(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){return e&&(gr.authToken=e),[2,ra.authorize()]}))}))}function ga(e){return void 0===e&&(e=!1),ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){return(t=Yi.current())?[2,t.accept(e)]:[2]}))}))}function _a(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return(e=Yi.current())?[2,e.decline()]:[2]}))}))}function ya(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,Ea(e,t)]}))}))}function Ea(e,t,n){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(r){return[2,new Yi(ra,na(),oa).onJoin({conversationId:e,needVideo:t,chatId:n})]}))}))}function Sa(e,t,n){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(r){return n&&(gr.anonymToken=n),[2,new Yi(ra,na(),oa).onJoin({joinLink:e,needVideo:t})]}))}))}function ba(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return(e=Yi.current())?[2,e.hangup()]:[2]}))}))}function Ca(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return[4,ra.getOkIdsByExternalIds([e])];case 1:if(!(t=n.sent()).length)throw new Error("User not found");return[2,Oa(t[0])]}}))}))}function Oa(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){switch(r.label){case 0:return(n=Yi.current())?[4,n.addParticipant(kr.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function Ta(e){return ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return[4,ra.getOkIdsByExternalIds([e])];case 1:return[2,wa(t.sent()[0])]}}))}))}function wa(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=Yi.current())?[4,t.removeParticipant(kr.composeId(e,"USER"))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Ia(e,t){return ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return[4,ci.saveDeviceId(e,t)];case 1:return n=i.sent(),r=Yi.current(),n&&r?[2,r.changeDevice(e)]:[2,Promise.reject()]}}))}))}function Pa(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){return(t=Yi.current())?[2,t.toggleScreenCapturing(e)]:[2,Promise.reject()]}))}))}function Ra(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){switch(r.label){case 0:return(n=Yi.current())?[4,n.setVideoStream(e,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function Aa(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=Yi.current())?[4,t.toggleLocalVideo(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Na(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=Yi.current())?[4,t.toggleLocalAudio(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function ka(e,t){return ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){return(n=Yi.current())?[2,n.setLocalResolution(e,t)]:[2]}))}))}function La(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=Yi.current())?[4,t.changePriorities(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Da(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=Yi.current())?[4,t.changeParticipantState(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Ma(e){return ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){switch(n.label){case 0:return(t=Yi.current())?[4,t.updateDisplayLayout(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function ja(e,t){return void 0===t&&(t=1),ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){switch(r.label){case 0:return(n=Yi.current())?[4,n.switchConference(e,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function xa(e,t,n){return void 0===n&&(n=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(r){switch(r.label){case 0:return[4,ra.getOkIdsByExternalIds([e])];case 1:return[2,Ua(r.sent()[0],t,n)]}}))}))}function Ua(e,t,n){return void 0===n&&(n=!1),ur(this,void 0,void 0,(function(){var r;return dr(this,(function(i){switch(i.label){case 0:return(r=Yi.current())?[4,r.grantRoles(kr.composeId(e,"USER"),t,n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function Ga(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=!0),void 0===n&&(n="AUDIO"),ur(this,void 0,void 0,(function(){var r,i;return dr(this,(function(a){switch(a.label){case 0:return r=null,e?[4,ra.getOkIdsByExternalIds([e])]:[3,2];case 1:i=a.sent(),r=i[0],a.label=2;case 2:return[2,Va(r,t,n)]}}))}))}function Va(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=!0),void 0===n&&(n="AUDIO"),ur(this,void 0,void 0,(function(){var r,i;return dr(this,(function(a){switch(a.label){case 0:return(r=Yi.current())?(i=e?kr.composeId(e,"USER"):null,[4,r.switchParticipantDevice(i,n,!t)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))}function Ba(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){return dr(this,(function(n){switch(n.label){case 0:return[4,ra.getOkIdsByExternalIds([e])];case 1:return[2,Ha(n.sent()[0],t)]}}))}))}function Ha(e,t){return void 0===t&&(t=!1),ur(this,void 0,void 0,(function(){var n;return dr(this,(function(r){switch(r.label){case 0:return(n=Yi.current())?[4,n.pinParticipant(kr.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function Fa(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return n=null,t?[4,ra.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Wa(e,n)]}}))}))}function Wa(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return(n=Yi.current())?(r=t?kr.composeId(t,"USER"):null,[4,n.chatMessage(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function za(e){return void 0===e&&(e=10),ur(this,void 0,void 0,(function(){var t;return dr(this,(function(n){return(t=Yi.current())?[2,t.chatHistory(e)]:[2]}))}))}function Ka(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return n=null,t?[4,ra.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Ja(e,n)]}}))}))}function Ja(e,t){return void 0===t&&(t=null),ur(this,void 0,void 0,(function(){var n,r;return dr(this,(function(i){switch(i.label){case 0:return(n=Yi.current())?(r=t?kr.composeId(t,"USER"):null,[4,n.customData(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function qa(e){return void 0===e&&(e=""),ur(this,void 0,void 0,(function(){return dr(this,(function(t){switch(t.label){case 0:return[4,ra.createConversation(kr.uuid(),e)];case 1:return[2,t.sent().join_link]}}))}))}function Ya(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return(e=Yi.current())?[2,e.createJoinLink()]:[2,Promise.reject()]}))}))}function Xa(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return(e=Yi.current())?[2,e.removeJoinLink()]:[2,Promise.reject()]}))}))}function Za(e,t){return ur(this,void 0,void 0,(function(){return dr(this,(function(n){return[2,ra.getAnonymTokenByLink(e,t)]}))}))}function $a(e){var t=Yi.current();t&&t.setVolume(e)}function Qa(e){gr.forceRelayPolicy=e}function eo(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),ur(this,void 0,void 0,(function(){var a;return dr(this,(function(o){return(a=Yi.current())?[2,a.startStream(e,t,n,r,i)]:[2,Promise.reject()]}))}))}function to(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return(e=Yi.current())?[2,e.stopStream()]:[2,Promise.reject()]}))}))}function no(){return ur(this,void 0,void 0,(function(){var e;return dr(this,(function(t){return(e=Yi.current())?[2,e.getStreamInfo()]:[2,Promise.reject()]}))}))}function ro(e){Or.toggle(e)}var io=function(e){return e<0},ao=function(e){return e.isAnonym?{id:e.peerId.toString(),type:gi.ANONYM}:e.peerId.toString()},oo=function(e,t,n,r,i){var a,o,s;void 0===i&&(i=!1);var c=r.peerId===e.me,l=io(r.peerId)||r.isAnonym,u=!!(null===(o=null===(a=e.callData)||void 0===a?void 0:a.permissions)||void 0===o?void 0:o.MUTE_PARTICIPANTS),d=ue(e.peer),h=[];return c||!i||l||h.push({href:r.link,text:Object(q.getLang)("calls_go_to_profile")}),c||l||io(e.me)||h.push({text:Object(q.getLang)("calls_go_to_chat_with_participant"),onClick:function(){n({type:p.CHANGE_UI_MODE,mode:p.UIMode.COLLAPSED}),n({type:p.MANAGEMENT,isOpen:!1}),ie(r.peerId)}}),c||!d||io(e.me)||h.push({text:Object(q.getLang)("calls_participant_menu_kick"),onClick:function(){return t.removeParticipant(ao(r))}}),!c&&d&&(null===(s=r.mediaSettings)||void 0===s?void 0:s.isAudioEnabled)&&u&&!io(e.me)&&h.push({text:Object(q.getLang)("calls_participant_menu_mute"),onClick:function(){return t.muteParticipant(ao(r))}}),h},so=function(e,t){var n=e.participants[t];return n&&(n.peerId===e.me||!!n.status)};function co(e,t){var n,r,i,a=e.pinnedParticipant||e.orator;if(a)return e.participants[a];for(var o=0,s=Object.values(e.participants);o<s.length;o++){var c=s[o];if(c.peerId!==e.me&&c.wasConnected&&(i||(i=c),!t||(null===(n=c.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)))return c}var l=e.participants[e.me];return!i&&t&&(null===(r=l.mediaSettings)||void 0===r?void 0:r.isVideoEnabled)?l:i}function lo(e,t){return Object.values(e.participants).reduce((function(n,r){return(void 0===t||t(r))&&r.peerId!==e.me&&r.status&&n.push(r),n}),[e.participants[e.me]])}function uo(e){var t=e.participants,n=0;for(var r in t)t.hasOwnProperty(r)&&po(e,t[r])&&n++;return n}function po(e,t){return t.peerId===e.me||t.status}var ho=function(){return(ho=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},fo=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},mo=function(e){var t=e.children,n=e.className,r=fo(e,["children","className"]),i=Object(O.classNames)("ActivityIndicator",n);return u.a.createElement("span",ho({},r,{className:i}),t)};mo.propTypes={className:U.a.string,children:U.a.node};var vo=mo,go=function(e){var t=e.participant,n=t.status,r=t.wasConnected;switch(n){case p.CallStatus.WAITING:return r?u.a.createElement(vo,null,Object(q.getLang)("calls_status_waiting")):u.a.createElement(Fe,{isInverted:!0});case p.CallStatus.CONNECTING:case p.CallStatus.RECONNECT:return u.a.createElement(vo,null,Object(q.getLang)("calls_status_connecting"));case p.CallStatus.ERROR:return Object(q.getLang)("global_error");case p.CallStatus.HANGUP:return u.a.createElement(vo,null,Object(q.getLang)("calls_status_hangup"));case p.CallStatus.PERMISSIONS:return Object(q.getLang)("calls_status_no_permissions");case p.CallStatus.CONNECTED:default:return null}},_o=function(e){var t=e.duration;return u.a.createElement("div",{className:"CallTimer","aria-label":t,"data-duration":t})},yo=function(e){var t=e.state,n=u.a.useRef(t);u.a.useEffect((function(){n.current=t}),[t]);var r=t.peer,i=ue(r)?t.callData.conversation:t.participants[r],a=u.a.useState(),o=a[0],s=a[1],c=u.a.useState(""),l=c[0],d=c[1];return(null==i?void 0:i.status)!==o&&(d(Eo(n)),s(null==i?void 0:i.status)),u.a.useEffect((function(){d(Eo(n));var e=setInterval((function(){return d(Eo(n))}),1e3);return function(){return clearInterval(e)}}),[t]),u.a.createElement(u.a.Fragment,null,l)};function Eo(e){var t=e.current;if(!t)return"";var n=t.peer;return ue(n)?bo(t)||So():function(e){if(e.hangupType)switch(e.hangupType){case p.HANGUP_TYPE_BUSY:return Object(q.getLang)("calls_busy");case p.HANGUP_TYPE_CALLEE_IS_OFFLINE:return Object(q.getLang)("calls_callee_is_offline");case p.HANGUP_TYPE_REJECTED:return Object(q.getLang)("calls_rejected_status");case p.HANGUP_TYPE_CANCELED:case p.HANGUP_TYPE_MISSED:case p.HANGUP_TYPE_HUNGUP:case p.HANGUP_TYPE_REMOVED:return null;case p.HANGUP_TYPE_CALLER_IS_BLOCKED:case p.HANGUP_TYPE_EXTERNAL_API_ERROR:case p.HANGUP_TYPE_FAILED:case p.HANGUP_TYPE_NOT_FRIENDS:case p.HANGUP_TYPE_OLD_VERSION:case p.HANGUP_TYPE_SERVICE_DISABLED:case p.HANGUP_TYPE_UNKNOWN_ERROR:case p.HANGUP_TYPE_UNSUPPORTED:return Object(q.getLang)("global_error")}return null}(t)||function(e,t){var n=e.participants[t];return n&&n.status!==p.CallStatus.CONNECTED?u.a.createElement(go,{participant:n}):null}(t,n)||bo(t)||So()}function So(){return u.a.createElement(vo,null,Object(q.getLang)("calls_status_waiting"))}function bo(e){var t=e.callData.ts;return t?u.a.createElement(_o,{duration:ke(t)}):null}var Co=function(e){var t=e.isGroupCall,n=e.callStatus,r=e.participantCount,i=e.speakers,a=Object(O.classNames)("CallInfo",{"CallInfo--full":t});return u.a.createElement("div",{className:a},u.a.createElement("div",{className:"CallInfo__status"},n,t&&u.a.createElement(u.a.Fragment,null,u.a.createElement("span",{className:"CallInfo__dot"}," · "),Object(q.getLang)("calls_participants_plural",r))),t&&i&&u.a.createElement("div",{className:"CallInfo__speakers"},i))};function Oo(e){var t=e.state,n=ue(t.peer),r=Object(l.useState)(0),i=r[0],a=r[1],o=Object(l.useState)(null),s=o[0],c=o[1];return Object(l.useEffect)((function(){a(uo(t))}),[t]),Object(l.useEffect)((function(){if(n){var e=t.speakersInHeader.reduce((function(e,n){return t.participants[n]&&e.push(t.participants[n]),e}),[]);c(e.length>0?Object(q.getLang)("calls_participants_speak",e.length).replace("{names}",Ue(e,e.slice(0,3))):null)}}),[t.participants,t.speakersInHeader]),u.a.createElement(Co,{isGroupCall:n,callStatus:u.a.createElement(yo,{state:t}),participantCount:i,speakers:s})}var To=function(){return(To=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function wo(e){var t,n,r,i,a,o,s,c,l,d,h,f=e.SDK,m=e.state,v=e.dispatch,g=m.peer,_=ue(g),y=_?m.callData.conversation:m.participants[g],E=m.participants[m.me],S=E.mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},b=lo(m),C=b.length>1,O=C||S.isVideoEnabled,T=_||b.length>2,w=T&&O&&!m.isOratorMode,I=T&&O&&m.isOratorMode,P=m.uiMode===p.UIMode.FULLSCREEN,R=u.a.useMemo((function(){return f.browser.isScreenCapturingSupported()}),[]),A=null===(t=m.callData)||void 0===t?void 0:t.canFinishCall,N=u.a.useCallback((function(){v({type:p.CHANGE_UI_MODE,mode:p.UIMode.COLLAPSED})}),[]),k=u.a.useCallback((function(){v({type:p.TOGGLE_ORATOR_MODE,isOratorMode:!m.isOratorMode})}),[m.isOratorMode]),L=u.a.useCallback((function(){v({type:p.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!m.isShownParticipantsAside})}),[m.isShownParticipantsAside]),D=u.a.useCallback((function(e,t){v({type:p.SET_PINNED_PARTICIPANT,pinnedParticipant:m.pinnedParticipant===t?null:t})}),[m.pinnedParticipant]),M=u.a.useCallback((function(){v({type:p.MANAGEMENT,isOpen:!0})}),[]),j=u.a.useCallback((function(){var e=!S.isVideoEnabled||S.isScreenSharingEnabled;(e?de(f,!0,!1):Promise.resolve()).then((function(){S.isScreenSharingEnabled&&f.captureScreen(!1),f.toggleLocalVideo(e)})),me.logEvent({call_event_type:e?p.CallActionEventType.VIDEO_ENABLED:p.CallActionEventType.VIDEO_DISABLED,session_id:m.callData.callId,peer_id:m.peer,is_group_call:ue(m.peer),reason:e?void 0:"manual"})}),[S]),x=u.a.useCallback((function(){f.captureScreen(!S.isScreenSharingEnabled),me.logEvent({call_event_type:S.isScreenSharingEnabled?p.CallActionEventType.SCREEN_SHARING_STOPPED:p.CallActionEventType.SCREEN_SHARING_STARTED,session_id:m.callData.callId,peer_id:m.peer,is_group_call:ue(m.peer)})}),[S.isScreenSharingEnabled,m.screenSharers]),U=u.a.useCallback((function(){v({type:p.CHANGE_UI_MODE,mode:p.UIMode.COLLAPSED}),ie(m.peer)}),[m.peer]),G=u.a.useCallback((function(){var e,t,n=!(null===(e=E.statusData)||void 0===e?void 0:e.hand);f.changeParticipantState({hand:n?p.SdkHandType.RAISED:p.SdkHandType.LOWERED}),v({type:p.CHANGE_PARTICIPANT_STATE,participantId:E.peerId,data:To(To({},E.statusData),{hand:!(null===(t=E.statusData)||void 0===t?void 0:t.hand)})}),me.logEvent({call_event_type:n?p.CallActionEventType.HAND_RAISED:p.CallActionEventType.HAND_LOWERED,session_id:m.callData.callId,peer_id:m.peer,is_group_call:ue(m.peer)})}),[null===(n=E.statusData)||void 0===n?void 0:n.hand]),V=u.a.useCallback((function(){v({type:p.TOGGLE_POPUP,data:p.POPUP_EXIT})}),[]),H=function(){f.hangup(),me.logEvent({call_event_type:p.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:m.callData.callId,peer_id:m.peer,is_group_call:ue(m.peer),reason:"none",group_call_users_count:uo(m)})},F=u.a.useCallback((function(){v({type:p.CHANGE_UI_MODE,mode:P?p.UIMode.DEFAULT:p.UIMode.FULLSCREEN}),v({type:p.SET_TOOLTIP,tooltips:null})}),[m.uiMode]),W=u.a.useCallback((function(e,t){var n;v({type:p.SET_TOOLTIP,tooltips:(n={},n[e]=t,n)})}),[]),z=u.a.useCallback((function(){v({type:p.SET_TOOLTIP,tooltips:null})}),[]),K=[{text:Object(q.getLang)("calls_call_menu_settings"),key:"settings",onClick:function(){de(f,!0,!0).then((function(){v({type:p.TOGGLE_POPUP,data:p.POPUP_SETTINGS})}))}}];return u.a.useEffect((function(){return function(){v({type:p.SET_TOOLTIP,tooltips:null})}}),[]),(null===(r=m.callData.permissions)||void 0===r?void 0:r.MUTE_PARTICIPANTS)&&C&&K.push({text:Object(q.getLang)("calls_call_menu_mute_all"),key:"muteAll",onClick:function(){f.muteParticipant(),me.logEvent({call_event_type:p.CallActionEventType.ALL_MICS_DISABLED,session_id:m.callData.callId,peer_id:m.peer,is_group_call:ue(m.peer)})}}),u.a.createElement(ce,{onClose:H,isCautionBoxShown:!0,onBackdropClick:N},u.a.createElement(Ft,{id:g,photo:y&&y.photo||"",disablePhoto:O,info:u.a.createElement(Oo,{state:m}),callMenuActions:K,isVideoEnabled:S.isVideoEnabled&&!S.isScreenSharingEnabled,isAudioEnabled:S.isAudioEnabled,isScreenSharingEnabled:S.isScreenSharingEnabled,isOratorMode:m.isOratorMode,isFullScreen:P,onToggleVideo:j,onToggleAudio:function(){var e=!S.isAudioEnabled;(e?de(f,!1,!0):Promise.resolve()).then((function(){var t;(null===(t=m.notification)||void 0===t?void 0:t.type)===p.NotificationType.SPEAKING_ON_MUTE&&v({type:p.CALL_NOTIFICATION,notification:null}),f.toggleLocalAudio(e)}))},onToggleScreenShare:x,onLeaveCall:A?V:H,onCollapseCall:N,onToggleOratorMode:k,onFullScreenToggle:F,onTooltipChange:W,onHidePanel:z,onChat:U,onHandClick:G,isParticipantControlActive:m.isManagementOpen,isLayoutSwitchShown:_&&C,isHandRaised:null===(i=E.statusData)||void 0===i?void 0:i.hand,isHandControlShown:_,isChatControlShown:!!g,isScreenShareControlShown:R,onParticipantsClick:M,chatUnreadCount:m.chatUnreadCount,notification:u.a.createElement(Xt,{state:m,dispatch:v}),tooltips:m.tooltips,amISpeaking:!!m.speakers[m.me]},!T&&u.a.createElement(nt,To({},(a=m.participants,o=m.me,s=m.peer,c=a[o],l=a[s],d=c.mediaSettings,h=l.mediaSettings,{hasAudio:!!(null==d?void 0:d.isAudioEnabled),hasVideo:!!(null==d?void 0:d.isVideoEnabled),isSharingScreen:!!(null==d?void 0:d.isScreenSharingEnabled),stream:c.stream,id:o,name:Object(q.getLang)("calls_own_label"),wasConnected:!!c.wasConnected,opponentHasAudio:!!(null==h?void 0:h.isAudioEnabled),opponentHasVideo:!!(null==h?void 0:h.isVideoEnabled),opponentIsSharingScreen:!!(null==h?void 0:h.isScreenSharingEnabled),opponentStream:l.stream,opponentPhoto:l.photo,opponentId:s,opponentName:l.name||s.toString(),opponentWasConnected:!!l.wasConnected}))),w&&u.a.createElement(Wt,{limit:m.participantLimit},b.map((function(e,t,n){var r,i=e.mediaSettings||{},a=i.isVideoEnabled,o=i.isAudioEnabled,s=i.isScreenSharingEnabled,c=e.peerId===m.me?Object(q.getLang)("calls_own_label"):e.shortName?e.shortName:e.name;return u.a.createElement(tt,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:e.peerId===m.me,isHandRaised:null===(r=e.statusData)||void 0===r?void 0:r.hand,hasVideo:!!a,hasAudio:!!o,isSharingScreen:!!s,isSpeaking:!!m.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:n.length<=8||P?"s":"xs",name:c,status:e.status,wasConnected:e.wasConnected,actions:oo(m,f,v,e,!0)})}))),I&&u.a.createElement(zt,{orator:Io(m),onToggleParticipantsAside:L,isShownParticipantsAside:m.isShownParticipantsAside},b.map((function(e){var t,n=e.mediaSettings||{},r=n.isVideoEnabled,i=n.isAudioEnabled,a=n.isScreenSharingEnabled,o=e.peerId===m.me,s=o?Object(q.getLang)("calls_own_label"):e.shortName?e.shortName:e.name;return u.a.createElement(tt,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:o,isPinned:e.peerId===m.pinnedParticipant,isHandRaised:null===(t=e.statusData)||void 0===t?void 0:t.hand,hasVideo:!!r,hasAudio:!!i,isSharingScreen:!!a,isSpeaking:!!m.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:"xxs",name:s,status:e.status,wasConnected:e.wasConnected,onClickParticipant:D,actions:oo(m,f,v,e,!0)})}))),T&&!O&&u.a.createElement(He.default,null,u.a.createElement(B,{id:g,photo:y&&y.photo||"",size:"l",waves:!0,alt:y&&y.tab||""}))))}function Io(e){var t=e.participants[e.pinnedParticipant||e.orator||e.me],n=t.mediaSettings||{},r=n.isVideoEnabled,i=n.isAudioEnabled,a=n.isScreenSharingEnabled,o=t.peerId===e.me;return u.a.createElement(tt,{id:t.peerId,key:t.peerId,isInfoShown:!0,isMe:o,hasVideo:!!r,hasAudio:!!i,isSharingScreen:!!a,stream:t.stream,photo:t.photo,photoSize:"l",name:o?Object(q.getLang)("calls_own_label"):t.name,status:t.status,wasConnected:t.wasConnected,allowContain:!0})}var Po=function(e){var t=e.children;return u.a.createElement("div",{className:"CollapsedCall"},t)},Ro=function(e){var t=e.id,n=e.photo,r=e.title,i=e.status,a=e.isIncoming,o=e.onClick,s=e.children;return u.a.createElement("div",{className:"CallWidget",onClick:o},u.a.createElement(G,{id:t,photo:n,className:"CallWidget__background"}),u.a.createElement(B,{id:t,photo:n,size:"xs",waves:a,alt:r||""}),u.a.createElement("h1",{className:"CallWidget__name"},u.a.createElement(H.default,{className:""},r)),u.a.createElement("div",{className:"CallWidget__status"},i),s)},Ao=function(e){var t=e.localVideoStream,n=e.isLocalAudioEnabled,r=e.isLocalScreenSharing,i=e.participantId,a=e.isMe,o=e.isWithVideo,s=e.isWithAudio,c=e.isScreenSharing,d=e.stream,p=e.photo,h=e.name,f=e.onRestoreCall,m=e.onToggleAudio,v=e.children,g=Object(l.useState)(!1),_=g[0],y=g[1];Object(l.useEffect)((function(){t||y(!1)}),[t,_]);var E=Object(l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),f()}),[f]),S=Object(l.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),m()}),[m]);return u.a.createElement("div",{className:"CallVideoWidget",onClick:f},t&&u.a.createElement(Be,{stream:t,hasVideo:!0,isMe:!0,isVideoVisible:_,isScreenShareStream:r,setVideoVisibility:y,className:"CallVideoWidget__local",allowContain:!0}),u.a.createElement(tt,{id:i,hasVideo:o,hasAudio:s,isSharingScreen:c,isMe:a,stream:d,photo:p,name:h,photoSize:"s"}),v,u.a.createElement(at,{alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},u.a.createElement(J.default,{position:"t",align:"left",marginTop:6,text:Object(q.getLang)(n?"calls_mute":"calls_unmute")},u.a.createElement(K,{type:n?"mute":"unmute",onClick:S}))),u.a.createElement(at,{alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},u.a.createElement(J.default,{position:"t",align:"right",text:Object(q.getLang)("calls_restore"),marginTop:6},u.a.createElement(K,{type:"restore",onClick:E}))))},No=function(){return(No=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ko=function(e){var t,n,r,i=e.state,a=e.dispatch,o=e.SDK,s=i.peer,c=Ne(i),d=ue(s)?i.callData.conversation:i.participants[s],h=i.participants[i.me],f=co(i,c),m=(null===(t=h.mediaSettings)||void 0===t?void 0:t.isVideoEnabled)&&f&&f.peerId!==i.me,v=Object(l.useCallback)((function(){a({type:p.CHANGE_UI_MODE,mode:p.UIMode.DEFAULT})}),[]),g=Object(l.useCallback)((function(){var e;o.toggleLocalAudio(!(null===(e=h.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[i]);return u.a.createElement(Po,null,i.mode===p.Mode.INCOMING&&u.a.createElement(Ro,{id:s,title:(null==d?void 0:d.tab)||"",photo:(null==d?void 0:d.photo)||"",status:Object(q.getLang)("calls_incoming_collapsed"),isIncoming:!0,onClick:v}),i.mode===p.Mode.CALL&&!c&&u.a.createElement(Ro,{id:(f?f.peerId:null==d?void 0:d.peerId)||0,title:(null==d?void 0:d.tab)||"",photo:(f?f.photo:null==d?void 0:d.photo)||"",status:u.a.createElement(yo,{state:i}),onClick:v}),i.mode===p.Mode.CALL&&c&&u.a.createElement(Ao,No({localVideoStream:m?h.stream:void 0,isLocalAudioEnabled:!!(null===(n=h.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalScreenSharing:!!(null===(r=h.mediaSettings)||void 0===r?void 0:r.isScreenSharingEnabled)},function(e,t,n){var r,i,a;return e?{participantId:e.peerId,isMe:e.peerId===n,isWithVideo:!!(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled),isWithAudio:!!(null===(i=e.mediaSettings)||void 0===i?void 0:i.isAudioEnabled),isScreenSharing:!!(null===(a=e.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled),stream:e.stream,photo:e.photo,name:e.name}:{participantId:t&&t.peerId||0,isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:t&&t.photo||"",name:t&&t.tab||""}}(f,d,i.me),{onRestoreCall:v,onToggleAudio:g})))};var Lo=function(){return(Lo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Do(e){var t,n=e.onBeforeCallStart,r=e.onAfterCallFinish,i=e.state,a=Object(l.useRef)(),o=((t={}).incoming=Object(l.useRef)(null),t.outgoing=Object(l.useRef)(null),t.connecting=Object(l.useRef)(null),t.connected=Object(l.useRef)(null),t.end=Object(l.useRef)(null),t),s={controls:!1,preload:"auto"},c=Object(l.useCallback)((function(e){var t=o[e].current;t&&t.paused&&t.play().catch((function(){}))}),[]),d=Object(l.useCallback)((function(e){var t=o[e].current;t&&!t.paused&&(t.pause(),t.currentTime=0)}),[]),h=Object(l.useCallback)((function(){Object.keys(o).forEach(d)}),[]),f=Object(l.useCallback)((function(e){var t=o[e].current;if(t){var n=t.volume;t.volume=0,t.play().catch((function(){})),t.pause(),t.currentTime=0,t.volume=n}}),[]),m=Object(l.useCallback)((function(){n&&n()}),[n]),v=Object(l.useCallback)((function(){r&&r()}),[r]);return Object(l.useEffect)((function(){return ye.browser.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(o).forEach(f),document.body.removeEventListener("mousedown",e)})),function(){h(),v()}}),[]),Object(l.useEffect)((function(){var e=a.current||i,t=i;e.mode!==t.mode&&(e.mode!==p.Mode.READY||t.mode!==p.Mode.INCOMING&&t.mode!==p.Mode.CALL||m(),e.mode===p.Mode.INCOMING&&d("incoming"),t.mode===p.Mode.INCOMING&&c("incoming"),t.mode!==p.Mode.READY||e.mode!==p.Mode.INCOMING&&e.mode!==p.Mode.CALL||(h(),c("end"),v()));var n=t.me,r=e.participants,o=t.participants,s=r[n].status,l=o[n].status;s!==l&&(s===p.CallStatus.CONNECTING&&d("connecting"),l===p.CallStatus.CONNECTING&&c("connecting"));var u=Object.keys(o).some((function(e){return r[e]&&r[e].status===p.CallStatus.CONNECTED})),f=Object.keys(o).some((function(e){var t=r[e],n=o[e];return t&&t.status!==n.status&&n.status===p.CallStatus.CONNECTED}));!u&&f&&c("connected"),t.mode===p.Mode.CALL&&(!function(e,t,n){for(var r=!1,i=0,a=Object.values(e);i<a.length;i++){var o=a[i];if(o.peerId!==t){if(o.status===p.CallStatus.CONNECTED)return!1;o.status===p.CallStatus.WAITING&&n.has(o.peerId)&&(r=!0)}}return r}(o,n,t.participantsAddedByMe)?d("outgoing"):c("outgoing")),a.current=i}),[i]),u.a.createElement(u.a.Fragment,null,u.a.createElement("audio",Lo({src:"/mp3/call_incoming.mp3",ref:o.incoming,loop:!0},s)),u.a.createElement("audio",Lo({src:"/mp3/call_outgoing.mp3",ref:o.outgoing,loop:!0},s)),u.a.createElement("audio",Lo({src:"/mp3/call_connected.mp3",ref:o.connected,loop:!1},s)),u.a.createElement("audio",Lo({src:"/mp3/call_connecting.mp3",ref:o.connecting,loop:!0},s)),u.a.createElement("audio",Lo({src:"/mp3/call_end.mp3",ref:o.end,loop:!1},s)))}var Mo=n("Ht+d"),jo=n("Xq7/"),xo=n("7ZXl"),Uo=function(e){var t=e.title,n=e.onCloseModal,r=e.hint,i=e.actionButtons,a=e.isWithBackButton,o=e.onBackClick,s=e.children;return u.a.createElement(X.default,{className:"CallManagementModal",disableBodyScroll:!0,onClose:n},u.a.createElement(jo.ModalHeader,{title:t,onClose:n,appearance:"blue",backText:a?Object(q.getLang)("global_back"):void 0,onBack:o}),u.a.createElement("div",{className:"CallManagementModal__content"},u.a.Children.toArray(s).map((function(e,t){return u.a.createElement("div",{className:"CallManagementModal__section",key:t},e)}))),(i||r)&&u.a.createElement(xo.ModalFooter,{actionButtons:i||[],hint:r}))},Go=n("FABD"),Vo=function(e){var t=e.tokens,n=e.onRemoveToken,r=e.value,i=e.onChange,a=e.onSelect,o=e.renderSuggest,s=e.data;return u.a.createElement(Go.default,{className:"CallsMultiSelect",tokens:t,removeTokenPlaceholder:Object(q.getLang)("calls_remove_token"),onRemoveToken:n,placeholder:Object(q.getLang)("calls_search_participants_placeholder"),value:r,onChange:i,onSelect:a,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:function(){},notFoundText:Object(q.getLang)("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:o,data:s})},Bo=n("t7n3"),Ho=function(e){var t=e.headingElement,n=void 0===t?"h3":t,r=e.extra,i=e.className,a=e.children,o=n;return u.a.createElement("header",{className:Object(O.classNames)("ListHeader",i)},u.a.createElement(o,{className:"ListHeader__text"},a),u.a.createElement("span",{className:"ListHeader__extra"},r))},Fo=n("xGYt"),Wo=n("NsuH");function zo(e){var t=e.member,n=e.selected,r=e.disabled,i=Object(O.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":n,"ParticipantSuggest--disabled":r});return l.createElement("div",{className:i,"data-id":t.id},l.createElement(Wo.default,{size:"34",title:t.name,photo:t.photo}))}zo.defaultProps={selected:!1,disabled:!1};var Ko=function(){return(Ko=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Jo=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},qo=function(e){var t=e.children,n=e.className,r=Jo(e,["children","className"]);return u.a.createElement("button",Ko({className:Object(O.classNames)("ListMore",n)},r),t)},Yo=function(){return(Yo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Xo=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Zo=function(e){var t=Xo(e,[]);return u.a.createElement("svg",Yo({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),u.a.createElement("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"}))},$o=function(e){var t=e.data,n=e.onClick,r=e.selected,i=e.disabled;if("type"in t)switch(t.type){case p.SearchResultType.HEADER:return u.a.createElement(Ho,{className:"CallsSearchResult CallsSearchResult--header",extra:t.count},t.text);case p.SearchResultType.CALL_ALL_IN_CHAT:return u.a.createElement("div",{className:"CallsSearchResult CallsSearchResult--select"},u.a.createElement(Mo.default,{appearance:"secondary",wide:!0,onClick:n},u.a.createElement("span",{className:"CallsSearchResult__icon"},u.a.createElement(Zo,null)),t.text));case p.SearchResultType.MEMBERS_MORE:case p.SearchResultType.FRIENDS_MORE:return u.a.createElement(qo,{onClick:n},t.text)}return u.a.createElement(Fo.default,{"data-id":t.peerId,onClick:n,selectable:!i},u.a.createElement(zo,{member:t,selected:r,disabled:i}))},Qo=function(){return(Qo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},es=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r},ts=function(e){var t=e.state,n=e.onChange,r=e.onClickCallAll,i=(t.preselectedIds||[]).filter((function(e){return!io(e)})),a=Object(l.useState)(i),o=a[0],s=a[1],c=Object(l.useState)(""),d=c[0],h=c[1],f=Object(l.useState)({}),m=f[0],v=f[1],g=Object(l.useState)(!1),_=g[0],y=g[1],E=Object(l.useState)(!1),S=E[0],b=E[1],C=Object(l.useState)(function(e,t){var n=e.reduce((function(e,t){return e[t.id]=!0,e}),{});return t.filter((function(e){return!n[e.id]}))}(t.chatMembers,t.friends))[0],O=Object(l.useState)(function(e,t){return[].concat(t,e).reduce((function(e,t){return e[t.id]=t,e}),{})}(t.chatMembers,C))[0],T=Object(l.useCallback)((function(e){return e.name}),[]),w=Object(l.useCallback)((function(e){return e.peerId}),[]),I=se(es(t.chatMembers,C),T,w),P=Object(l.useCallback)((function(e){return e?I.search(e):function(e,t,n,r,i){var a={type:p.SearchResultType.MEMBERS_MORE,text:Object(q.getLang)("calls_show_all_members")},o={type:p.SearchResultType.FRIENDS_MORE,text:Object(q.getLang)("calls_show_all_friends")},s={type:p.SearchResultType.HEADER,text:Object(q.getLang)("calls_chat_members"),count:e.length},c={type:p.SearchResultType.HEADER,text:Object(q.getLang)("calls_friends")},l={type:p.SearchResultType.CALL_ALL_IN_CHAT,text:Object(q.getLang)("calls_call_all")},u=[];if(e.length>0)if(u.push(s),e.length<=i&&u.push(l),n||e.length<=5)u.push.apply(u,e);else{for(var d=0;d<5;d++)u.push(e[d]);u.push(a)}if(u.push(c),r||t.length<=10)u.push.apply(u,t);else{for(d=0;d<10;d++)u.push(t[d]);u.push(o)}return u}(t.chatMembers,C,_,S,t.participantLimit)}),[t,_,S]),R=Object(l.useState)(P(d)),A=R[0],N=R[1],k=function(e){s(e),n(e)},L=Object(l.useCallback)((function(e){return k(es(o,[+e]))}),[o]),D=Object(l.useCallback)((function(e){return k(o.filter((function(t){return t!==+e})))}),[o]),M=lo(t).map((function(e){return{id:e.peerId.toString(),text:Object(Bo.unclean)(e.name),locked:!0}})).concat(o.map((function(e){return{text:Object(Bo.unclean)(O[e].name),id:e.toString(),locked:!1}})));Object(l.useEffect)((function(){v(o.reduce((function(e,t){return e[t]=!0,e}),{}))}),[]),Object(l.useEffect)((function(){N(P(d))}),[o,_,S]);var j=Object(l.useCallback)((function(e){h(e.target.value),N(P(e.target.value))}),[]),x=Object(l.useCallback)((function(e){var t;return D(e),v(Qo(Qo({},m),((t={})[e]=!1,t))),Promise.resolve()}),[m]),U=Object(l.useCallback)((function(e){var n,r;return ns(e,t,m)?(D(e),v(Qo(Qo({},m),((n={})[e]=!1,n)))):rs(e,t,M,m)||(L(e),v(Qo(Qo({},m),((r={})[e]=!0,r))),h(""),N(P(""))),Promise.resolve()}),[o,t,m]),G=Object(l.useCallback)((function(){var e=lo(t).reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=t.chatMembers.reduce((function(n,r){var i=r.peerId;return e[i]||rs(i||0,t,M,m)||n.push(i),n}),[]);r(n)}),[t,o,m]),V=Object(l.useCallback)((function(e,t){if(!("type"in e))return t;switch(e.type){case p.SearchResultType.CALL_ALL_IN_CHAT:return function(){return G()};case p.SearchResultType.MEMBERS_MORE:return function(){return y(!0)};case p.SearchResultType.FRIENDS_MORE:return function(){return b(!0)};default:return function(){}}}),[G]);return u.a.createElement(Vo,{tokens:M,onRemoveToken:x,value:d,onChange:j,onSelect:U,renderSuggest:function(e,n){return u.a.createElement($o,{data:e,onClick:V(e,n),selected:ns(e.peerId||0,t,m),disabled:rs(e.peerId||0,t,M,m),key:e.peerId||e.text})},data:A})};function ns(e,t,n){return n&&n[e]||so(t,e)}function rs(e,t,n,r){return!!so(t,e)||!ns(e,t,r)&&(n.length>=t.participantLimit||!Object(le.isUserPeer)(e))}var is=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r},as=function(e){var t=e.SDK,n=e.state,r=e.dispatch,i=e.isWithBackButton,a=e.onBackClick,o=Object(l.useState)(n.preselectedIds||[]),s=o[0],c=o[1],d=Object(l.useState)(uo(n))[0]+s.length,h=function(){r({type:p.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),r({type:p.MANAGEMENT,isOpen:!1})},f=0===s.length,m=function(e){h(),r({type:p.MANUAL_ADD_PARTICIPANTS,participants:e}),e.forEach(t.addParticipant);var i=we(function(e,t){var n=e.chatData||e.callData.conversation,r=t.reduce((function(t,n){return e.participants[n]||t.set(n,!0),t}),new Map);if(0===r.size)return[n,[]];var i=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,a=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,o=i.reduce((function(e,t){return r.get(t.id)&&(e.smallerListData.push(t),e.smallerListMap.set(t.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),s=o.smallerListData,c=o.smallerListMap;if(s.length===r.size)return[n,s];var l=a.filter((function(e){return!c.get(e.id)&&r.get(e.id)}));return[n,is(s,l)]}(n,e)),a=i[0],o=i[1];r({type:p.LOAD_PEERS,conversation:a,members:o}),me.logEvent({call_event_type:p.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:n.callData.callId,peer_id:n.peer.toString(),is_group_call:ue(n.peer),group_call_users_count:s.length})},v=Object(l.useCallback)((function(){m(s)}),[s]);return u.a.createElement(Uo,{title:Object(q.getLang)("calls_add_participants_to_call"),onCloseModal:h,actionButtons:u.a.createElement(Mo.default,{key:"add",disabled:f,onClick:v},Object(q.getLang)("global_add")),hint:os(d,n.participantLimit),isWithBackButton:i,onBackClick:i?a:function(){}},u.a.createElement(ts,{state:n,onChange:c,onClickCallAll:function(e){m(e)}}))};function os(e,t){return e<2?Object(q.getLang)("calls_management_add_warning"):Object(q.getLang)("calls_selected").replace("{selected}",e).replace("{limit}",t)}var ss=n("aFGQ"),cs=function(){return(cs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ls=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},us=function(e){var t=e.isSingleLine,n=e.className,r=e.children,i=ls(e,["isSingleLine","className","children"]),a=Object(O.classNames)("InputStub",n,{"InputStub--singleLine":t});return u.a.createElement("div",cs({className:a},i),r)};function ds(){return(ds=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var ps=l.useRef,hs=l.useEffect;function fs(e){var t=e.cameras,n=e.mics,r=e.currentCamId,i=e.currentMicId,a=e.isCamAvailable,o=e.isMicAvailable,s=e.onCameraChange,c=e.onMicChange,u=ps(null),d=ps(null),p=ps(null),h=ps(null),f={controls:!1,crossOrigin:"anonymous",playsInline:"playsinline"};return vs({kind:"video",mediaElRef:u,streamRef:p,deviceId:r,isActive:a}),vs({kind:"audio",mediaElRef:d,streamRef:h,deviceId:i,isActive:o}),l.createElement("div",{className:"CallSettings"},l.createElement("div",{className:"CallSettings__camera"},a?l.createElement("video",ds({ref:u},f,{className:"CallSettings__cameraStream CallSettings__cameraContent"})):l.createElement("div",{className:"CallSettings__cameraStub CallSettings__cameraContent"},Object(q.getLang)("calls_no_camera"))),o&&l.createElement("audio",ds({ref:d},f)),l.createElement("div",{className:"CallSettings__block"},l.createElement("div",{className:"CallSettings__label"},l.createElement("span",{className:"CallSettings__labelContent"},Object(q.getLang)("calls_settings_camera"))),a?l.createElement(ss.default,{options:t.map(ms),value:r,onChange:e=>{var t=e.selected;return s(t.value)},appearance:"secondary",className:"CallSettings__field"}):l.createElement(us,{className:"CallSettings__field"},Object(q.getLang)("calls_settings_no_camera"))),l.createElement("div",{className:"CallSettings__block"},l.createElement("div",{className:"CallSettings__label"},l.createElement("span",{className:"CallSettings__labelContent"},Object(q.getLang)("calls_settings_mic"))),o?l.createElement(ss.default,{options:n.map(ms),value:i,onChange:e=>{var t=e.selected;return c(t.value)},appearance:"secondary",className:"CallSettings__field"}):l.createElement(us,{className:"CallSettings__field"},Object(q.getLang)("calls_settings_no_mic"))))}function ms(e){return{value:e.deviceId,label:e.label}}function vs(e){var t=e.kind,n=e.mediaElRef,r=e.streamRef,i=e.deviceId,a=e.isActive,o={video:!1,audio:!1};hs(()=>{a&&navigator.mediaDevices.getUserMedia(ds({},o,{[t]:{deviceId:i}})).then(e=>{var t=r.current;t&&t.getTracks().forEach(e=>e.stop());var i=n.current;i&&(r.current=e,i.srcObject=e,i.volume=0,i.play(),De(n))}).catch(e=>{console.error("Error occurred: "+e)})},[i,a]),hs(()=>()=>{var e=r.current;e&&e.getTracks().forEach(e=>e.stop());var t=n.current;t&&(t.srcObject=null)},[])}fs.defaultProps={cameras:[],mics:[],currentCamId:"",currentMicId:"",isCamAvailable:!1,isMicAvailable:!1};var gs=n("0toi");function _s(e){var t=e.onClose,n=e.onSubmit,r=e.children;return l.createElement(gs.default,{onClose:t,title:Object(q.getLang)("calls_settings"),appearance:"blue",actionButtons:l.createElement(l.Fragment,null,l.createElement(Mo.default,{onClick:t,appearance:"tertiary"},Object(q.getLang)("global_cancel")),l.createElement(Mo.default,{onClick:n},Object(q.getLang)("global_save"))),className:"CallSettingsModal"},r)}var ys=u.a.useState;function Es(e){var t=e.SDK,n=e.state,r=e.dispatch,i=t.browser.getCameras(),a=t.browser.getMicrophones(),o=t.browser.hasCamera()&&t.browser.hasCameraPermission(),s=t.browser.hasMicrophone()&&t.browser.hasMicrophonePermission(),c=t.browser.getSavedCamera(),l=t.browser.getSavedMicrophone(),d=o&&(c&&c.deviceId||i[0].deviceId),h=s&&(l&&l.deviceId||a[0].deviceId),f=ys(d),m=f[0],v=f[1],g=ys(h),_=g[0],y=g[1];return u.a.createElement(_s,{onClose:function(){r({type:p.TOGGLE_POPUP})},onSubmit:function(){var e,i=[Promise.resolve()],a=!!(null===(e=n.participants[n.me].mediaSettings)||void 0===e?void 0:e.isVideoEnabled);!c&&d===m&&n.mode!==p.Mode.READY&&!a||c&&c.deviceId===m||i.push(t.changeDevice("videoinput",m)),l&&l.deviceId===_||i.push(t.changeDevice("audioinput",_)),Promise.all(i).then((function(){r({type:p.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),r({type:p.TOGGLE_POPUP})}))}},u.a.createElement(fs,{mics:a,cameras:i,currentCamId:m,currentMicId:_,isCamAvailable:o,isMicAvailable:s,onCameraChange:function(e){return v(e)},onMicChange:function(e){return y(e)}}))}class Ss extends l.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){switch(this.props.state.mode){case p.Mode.CALL:this.props.SDK.hangup();break;case p.Mode.INCOMING:this.props.SDK.declineCall()}this.props.dispatch({type:p.CHANGE_MODE,mode:p.Mode.READY}),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)}render(){return this.state.hasError?null:this.props.children}}var bs,Cs=n("enZq");!function(e){e.BLUE="blue",e.GREEN="green",e.GRAY="gray",e.RED="red"}(bs||(bs={}));var Os=function(e){var t=e.icon,n=e.color;return u.a.createElement("div",{className:Object(O.classNames)("ListIcon","ListIcon--"+n)},t)},Ts=function(){return(Ts=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ws=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Is=function(e){var t=ws(e,[]);return u.a.createElement("svg",Ts({width:"14",height:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{"aria-hidden":"true"}),u.a.createElement("path",{d:"M6.022 9.184a.837.837 0 01-1.187-.001 3.861 3.861 0 010-5.419l2.618-2.643a3.772 3.772 0 015.366 0c1.261 1.274 1.557 3.033.67 4.508-.296.49-.947.47-1.325.09-.275-.276-.254-.707-.077-1.019.465-.817.24-1.683-.456-2.379a2.094 2.094 0 00-2.997 0L6.023 4.956a2.143 2.143 0 00-.001 3.025.83.83 0 010 1.202zm1.95-3.166c.833.835.832 2.19-.001 3.025L5.36 11.68a2.094 2.094 0 01-2.998 0c-.695-.696-.91-1.555-.446-2.371.178-.313.199-.744-.076-1.019-.379-.38-1.03-.4-1.325.09-.888 1.474-.602 3.226.659 4.5a3.772 3.772 0 005.367 0l2.617-2.643a3.861 3.861 0 000-5.419.837.837 0 00-1.187 0 .83.83 0 000 1.2z"}))},Ps=function(e){var t=e.text,n=e.onCopyDone,r=e.children,i=Object(l.useRef)(null),a=Object(l.useCallback)((function(e){i.current&&(i.current.focus(),i.current.select(),document.execCommand("copy"),e.preventDefault(),e.stopPropagation(),n&&n())}),[n]);return u.a.createElement("div",{className:"CopyText",onClick:a},u.a.createElement("input",{type:"text",readOnly:!0,value:t||"",ref:i,className:"CopyText__input"}),r)},Rs=n("754W"),As=n("XTb9"),Ns=function(e){var t=e.value,n=e.copyText,r=e.doneText,i=e.className,a=Object(l.useState)(!1),o=a[0],s=a[1],c=Object(l.useCallback)((function(){s(!0)}),[]),d=Object(l.useCallback)((function(){s(!1)}),[]),p=Object(O.classNames)("ListCopyControl",i,{"ListCopyControl--copied":o});return u.a.createElement("div",{className:p},u.a.createElement(Ps,{text:t,onCopyDone:c},u.a.createElement(Rs.default,{className:"ListCopyControl__copyButton"},n)),u.a.createElement(As.default,{shown:o,callback:d,className:"ListCopyControl__copyDone"},r))},ks=function(e){var t=e.isLinkBlockShown,n=e.onLinkBlockClick,r=e.callUrlLink;return u.a.createElement(Cs.default,null,t&&u.a.createElement(Fo.default,{onClick:n,chevron:!0,icon:u.a.createElement(Os,{icon:u.a.createElement(Is,null),color:bs.GREEN})},Object(q.getLang)("calls_menu_link"),r&&u.a.createElement(Ns,{value:r,copyText:Object(q.getLang)("calls_menu_link_copy"),doneText:Object(q.getLang)("calls_menu_link_copied")})))},Ls=n("dLHM"),Ds=n("Q3mP"),Ms=function(e){var t=e.link,n=void 0===t?"":t,r=e.isLinkLoading,i=Object(l.useState)(!1),a=i[0],o=i[1],s=Object(l.useCallback)((function(){return o(!0)}),[]),c=Object(l.useCallback)((function(){return o(!1)}),[]);return u.a.createElement("div",{className:"CallLink"},u.a.createElement("p",{className:"CallLink__info"},Object(q.getLang)("calls_management_link_info")),r?u.a.createElement(us,{className:"CallLink__input"},u.a.createElement(Ds.default,null)):u.a.createElement(Ls.default,{readOnly:"readonly",className:"CallLink__input",value:n}),u.a.createElement(Ps,{text:n,onCopyDone:s},u.a.createElement(Mo.default,{disabled:r},Object(q.getLang)("calls_link_copy"))),u.a.createElement(As.default,{className:"CallLink__copied",shown:a,callback:c},Object(q.getLang)("calls_link_copied")))},js=n("grKM"),xs=function(e){var t=e.searchQuery,n=e.onSearchChange,r=e.length,i=e.children;return u.a.createElement("div",{className:"CallParticipantList"},u.a.createElement(js.BlockSearchInput,{value:t,placeholder:Object(q.getLang)("calls_search_participants_placeholder"),onChange:n,onInput:n,onPaste:n,className:"CallParticipantList__input"}),u.a.createElement(Ho,{extra:r||""},Object(q.getLang)("calls_participant_list_header")),u.a.createElement(Cs.default,{border:!1,className:"CallParticipantList__list"},i))},Us=function(){return(Us=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Gs=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Vs=function(e){var t=e.element,n=void 0===t?"span":t,r=e.alt,i=e.className,a=Gs(e,["element","alt","className"]),o=n,s=Object(O.classNames)("ListActionsControl",i);return u.a.createElement(o,Us({"aria-label":r,className:s},a),u.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"5",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},u.a.createElement("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"})))},Bs=n("As6E"),Hs=function(e){var t=e.state,n=e.SDK,r=e.dispatch,i=e.participant,a=oo(t,n,r,i);return a.length>0?u.a.createElement(Bs.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:a},u.a.createElement(Vs,null)):null},Fs=function(){return(Fs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ws=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},zs=function(e){var t=Ws(e,[]);return u.a.createElement("svg",Fs({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},t),u.a.createElement("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"}))},Ks=function(){return(Ks=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Js=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},qs=function(e){var t=Js(e,[]);return u.a.createElement("svg",Ks({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),u.a.createElement("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"}))},Ys=function(){return u.a.createElement("div",{className:"VolumeMeterAnimation"})},Xs=function(e){var t=e.showSpeaking,n=e.showAudioDisabled,r=e.showRaisedHand,i=e.showConnecting;return u.a.createElement("span",{className:"ParticipantIndicators"},t&&u.a.createElement("span",{className:"ParticipantIndicators__item"},u.a.createElement(Ys,null)),n&&u.a.createElement("span",{className:"ParticipantIndicators__item"},u.a.createElement(zs,{className:"ParticipantIndicators__muted"})),r&&u.a.createElement("span",{className:"ParticipantIndicators__item"},u.a.createElement(qs,{className:"ParticipantIndicators__hand"})),i&&u.a.createElement("span",{className:"ParticipantIndicators__item"},u.a.createElement(Fe,null)))},Zs=function(){return(Zs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},$s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Qs=function(e){var t=e.className,n=e.children,r=$s(e,["className","children"]),i=Object(O.classNames)("ListAddControl",t);return u.a.createElement("button",Zs({className:i},r),u.a.createElement("span",{className:"ListAddControl__icon"},u.a.createElement("svg",{height:"16",viewBox:"0 0 16 16",width:"16",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0},u.a.createElement("path",{d:"M9 7h6c.552 0 1 .448 1 1s-.448 1-1 1h-6v6c0 .552-.448 1-1 1s-1-.448-1-1v-6h-6c-.552 0-1-.448-1-1s.448-1 1-1h6v-6c0-.552.448-1 1-1s1 .448 1 1z",fill:"currentColor"}))),n)},ec=function(e){var t=e.state,n=e.SDK,r=e.dispatch,i=e.onAddClick,a=function(e){return Object.values(e.participants).reduce((function(t,n){return(n.peerId===e.me||n.status)&&(t[0].push(n),n.name&&t[1].push(n)),t}),[[],[]])}(t),o=a[0],s=a[1],c=Object(l.useState)(""),d=c[0],h=c[1],f=Object(l.useCallback)((function(e){return e.name}),[]),m=Object(l.useCallback)((function(e){return e.peerId}),[]),v=se(s,f,m),g=d?v.search(d):o,_=Object(l.useCallback)((function(e){h(e.target.value)}),[]),y=!io(t.me);return u.a.createElement(xs,{searchQuery:d,onSearchChange:_,length:g.length},!d&&y&&u.a.createElement(Fo.default,{selectable:!1,border:!1,key:"add"},u.a.createElement(Qs,{onClick:i},Object(q.getLang)("calls_add_participants"))),g.length>0&&g.map((function(e){var i,a,o=e.peerId!==t.me&&e.status===p.CallStatus.WAITING,s=!o&&!(null===(i=e.mediaSettings)||void 0===i?void 0:i.isAudioEnabled),c=!o&&!!(null===(a=e.statusData)||void 0===a?void 0:a.hand),l=!!t.speakers[e.peerId],d=o||s||c||l;return u.a.createElement(Fo.default,{selectable:!1,border:!1,key:e.peerId,aside:u.a.createElement(u.a.Fragment,null,d&&u.a.createElement(Xs,{showSpeaking:l,showRaisedHand:c,showAudioDisabled:s,showConnecting:o,key:"indicators"}),u.a.createElement(Hs,{state:t,SDK:n,dispatch:r,participant:e,key:"menu"}))},u.a.createElement(Wo.default,{photo:u.a.createElement(B,{id:e.peerId,photo:e.photo,alt:e.name||"",size:"xxxs"}),title:e.name,href:e.link,target:"_blank"}))})),d&&0===g.length&&u.a.createElement(He.default,null,Object(q.getLang)("calls_participants_not_found")))};function tc(e,t){return[function(){return nc(e).imHash},function(e){return t({type:p.UPDATE_HASH,hash:e}),e}]}function nc(e){return"current"in e?e.current:e}var rc,ic=n("BxOC"),ac=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(ic.post)(_e.CONTROLLER,{act:"a_load_call_peers",peerId:+t,memberIds:n,hash:e,anonymId:r})},oc=(e,t)=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_chat_members",chat:t,hash:e}),sc=e=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_calls_token",hash:e}),cc=(e,t)=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_call_link",hash:e,callId:t}),lc=e=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_friends",hash:e}),uc=(e,t)=>Object(ic.post)(_e.CONTROLLER,{act:"a_force_call_finish",hash:e,callId:t}),dc=(e,t,n)=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_active_call_data",peer_id:t,hash:e,userId:n,get_chat_counters:!0}),pc=(e,t,n,r,i)=>Object(ic.post)(_e.CONTROLLER,{act:"a_load_call_participants",callId:t,peerIds:n,userId:r,hash:e,withConversation:i.withConversation,withChatMembers:i.withChatMembers,withCallParticipants:i.withCallParticipants}),hc=function(e){var t=e.id;return{peerId:t,id:t,name:e.name,link:e.link,photo:e.photo,sex:e.sex,firstName:e.first_name,lastName:e.last_name}},fc=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r};function mc(e,t){var n=tc(e,t),r=n[0],i=n[1];return nc(e).friends.length>0?Promise.resolve():(window.curFastChat&&window.curFastChat.friends?Promise.resolve([window.curFastChat.friends]):Me(lc,xe.bind(null,r,i))()).then((function(e){var n=e[0],r=Object.entries(n).map((function(e){var t=e[0],n=e[1],r=n[0],i=n[1],a=n[2],o=n[4],s=n[5];return{id:parseInt(t),peerId:parseInt(t),name:r,photo:i,firstName:a,link:s,sex:o}}));t({type:p.SET_FRIENDS,data:r})}))}function vc(e,t,n,r){var i=tc(e,t),a=i[0],o=i[1];return Me(oc,xe.bind(null,a,o))(n).then((function(n){var i=n[0][2];t({type:p.SET_CHAT_INFO,data:i.map(hc).sort((function(t,n){var r=nc(e).me;return t.peerId===r?-1:n.peerId===r?1:0})),conversation:r})}))}function gc(e,t,n,r){var i=tc(e,t),a=i[0],o=i[1];return Me(ac,(function(e){return xe(a,o,e)}))(n,r).then(te).then((function(e){var r=Ie(e),i=r[0],a=r[1];t({type:p.LOAD_PEERS,conversation:i,members:a,peerId:n})}))}function _c(e,t,n){if(!n)return Promise.resolve();var r=tc(e,t),i=r[0],a=r[1],o=nc(e).me,s=o<0?o:void 0;return Me(dc,(function(e){return xe(i,a,e)}))(n,s).then((function(e){var n=e[0];n&&(t({type:p.CALL_STATE,callData:{canFinishCall:n.can_finish_call,hasUrlLink:n.has_link}}),(n.chat_unread_count||n.chat_up_to_msg_id)&&t({type:p.SET_UNREAD_COUNT,chatUnreadCount:n.chat_unread_count,chatUpToMsgId:n.chat_up_to_msg_id}))}))}function yc(e,t,n,r,i){var a=tc(e,t),o=a[0],s=a[1],c=nc(e).me,l=c<0?c:void 0;return Me(pc,(function(e){return xe(o,s,e)}))(n,r,l,i).then((function(e){var t=e[0],n=t.conversation,r=t.anonyms,a=t.profiles,o=fc(Object.values(r),Object.values(a)),s=te([n||{},o]);return i.awaitImages?s.then((function(){return[n,o]})):[n,o]})).then((function(e){var n=e[0],r=e[1];t({type:p.LOAD_PEERS,conversation:n,members:r})})).catch((function(e){return console.error(e)}))}function Ec(e,t,n){var r=t.callData.callId,i=function(){return t.imHash},a=function(e){return n({type:p.UPDATE_HASH,hash:e}),e};n({type:p.SHOW_LOADER,isLoaderVisible:!0}),Me(uc,(function(e){return xe(i,a,e)}))(r).catch((function(e){console.error(e),n({type:p.ERROR,text:Object($.getLang)("calls_error_force_call_finish")})})).finally((function(){n({type:p.SHOW_LOADER,isLoaderVisible:!1})}))}!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS"}(rc||(rc={}));var Sc=function(e){var t,n,r=e.SDK,i=e.state,a=e.dispatch,o=Object(l.useState)(i.callData.callUrlLink||""),s=o[0],c=o[1],d=Object(l.useState)(rc.MAIN),h=d[0],f=d[1],m=Object(l.useState)(!1),v=m[0],g=m[1],_=!!(null===(t=i.callData.conversation)||void 0===t?void 0:t.canAddMembers),y=null===(n=i.callData)||void 0===n?void 0:n.canFinishCall,E=Object(l.useCallback)((function(){a({type:p.MANAGEMENT,isOpen:!1})}),[]),S=Object(l.useCallback)((function(){f(rc.MAIN)}),[]),b=Object(l.useCallback)((function(){if(f(rc.CALL_LINK),!s){var e=i.callData.callId||"";g(!0),function(e,t,n){var r=tc(e,t),i=r[0],a=r[1];return Me(cc,(function(e){return xe(i,a,e)}))(n).then((function(e){var n=e[0];return t({type:p.CALL_STATE,callData:{callUrlLink:n}}),n}))}(i,a,e).then((function(e){c(e),g(!1)})).catch((function(e){console.error(e),g(!1),ne(Object(q.getLang)("calls_get_url_link_error_text")),f(rc.MAIN)}))}}),[i.callData.callId,s]),C=Object(l.useCallback)((function(){a({type:p.SHOW_LOADER,isLoaderVisible:!0});var e=[mc(i,a)].concat(Object(le.isChatPeer)(i.peer)?[vc(i,a,i.peer,i.callData.conversation)]:[]);return Promise.all(e).then((function(){a({type:p.SHOW_LOADER,isLoaderVisible:!1}),f(rc.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),a({type:p.SHOW_LOADER,isLoaderVisible:!1})}))}),[i.peer,i.callData]),O=Object(l.useCallback)((function(){a({type:p.TOGGLE_POPUP}),Ec(0,i,a)}),[i.callData.callId,i.imHash]);return u.a.createElement(u.a.Fragment,null,h===rc.MAIN&&u.a.createElement(Uo,{title:Object(q.getLang)("calls_management_participants"),actionButtons:(y?[u.a.createElement(Mo.default,{onClick:O,key:"forceCallFinish",appearance:"secondary"},Object(q.getLang)("calls_force_call_finish"))]:[]).concat([u.a.createElement(Mo.default,{onClick:r.hangup,key:"leave"},Object(q.getLang)("calls_leave_call"))]),onCloseModal:E},u.a.createElement(ks,{isLinkBlockShown:_,onLinkBlockClick:b,callUrlLink:s}),u.a.createElement(ec,{state:i,SDK:r,dispatch:a,onAddClick:C})),h===rc.CALL_LINK&&u.a.createElement(Uo,{title:Object(q.getLang)("calls_management_link"),hint:Object(q.getLang)("calls_management_add_warning"),onCloseModal:E,isWithBackButton:!0,onBackClick:S},u.a.createElement(Ms,{link:s,isLinkLoading:v})),h===rc.ADD_PARTICIPANTS&&u.a.createElement(as,{state:i,SDK:r,dispatch:a,isWithBackButton:!0,onBackClick:S}))},bc=function(e){var t=e.children;return u.a.createElement("h2",{className:"JoinHeader"},t)},Cc=function(e){var t=e.children;return u.a.createElement("div",{className:"VisuallyHidden"},t)},Oc=function(e){var t=e.items;return u.a.createElement("figure",{className:"AvatarsStack"},u.a.createElement(Cc,null,u.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},u.a.createElement("defs",null,u.a.createElement("clipPath",{id:"users-mask"},u.a.createElement("path",{d:"M43.56 8.25a25 25 0 100 33.5A27.88 27.88 0 0138 25c0-6.28 2.07-12.08 5.56-16.75z"}))))),t.map((function(e,t){return"src"in e?u.a.createElement("img",{src:e.src,className:"AvatarsStack__item",alt:e.alt,key:e.key||t}):u.a.createElement(V.ConversationNoPhoto,{text:e.text,id:e.id,size:"50",className:"AvatarsStack__item",key:e.key||t})})))},Tc=function(){return(Tc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},wc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Ic=function(e){var t=wc(e,[]);return u.a.createElement("svg",Tc({width:"16",height:"16",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),u.a.createElement("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"}))},Pc=function(e){var t=e.isAnonym,n=e.title,r=e.label,i=e.items,a=e.onChangeName,o=e.name,s=e.namePlaceholder,c=e.joinWithVideoText,l=e.joinWithAudioText,d=e.onJoinWithVideo,p=e.onJoinWithAudio,h=e.disabled,f=e.inputDisabled;return u.a.createElement("div",{className:Object(O.classNames)("JoinScreen",{"JoinScreen--anonym":t})},u.a.createElement(bc,null,u.a.createElement(H.default,{className:""},n)),u.a.createElement("div",{className:"JoinScreen__members"},u.a.createElement(Oc,{items:i}),u.a.createElement("div",{className:"JoinScreen__membersLabel"},r)),u.a.createElement("footer",{className:"JoinScreen__footer"},t&&u.a.createElement(Ls.default,{onChange:a,className:"JoinScreen__input",value:o,placeholder:s,disabled:f,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&d()}}),u.a.createElement(Mo.default,{appearance:"primary",onClick:d,disabled:h,type:"submit"},u.a.createElement(Ic,{className:"JoinScreen__icon"}),u.a.createElement("span",null,c)),u.a.createElement(Mo.default,{appearance:"primary",title:l,"aria-label":l,onClick:p,disabled:h},u.a.createElement(Zo,{className:"JoinScreen__icon"}))))},Rc=n("yqpO"),Ac=n("S6+Z"),Nc=function(e){var t=e.ownerId,n=e.isAnonym,r=e.joinLink,i=e.vkJoinLink,a=e.title,o=e.members,s=e.conversationData,c=e.withPopup,d=e.onBeforeCallStart,p=e.onAfterCallFinish,h=e.onClose,f=e.bridge,m=e.entryPoint,v=e.tabIsMaster,g=e.tabIsIdle,_=Object(l.useState)(""),y=_[0],E=_[1],S=Object(l.useState)(null),b=S[0],C=S[1],O=Object(l.useState)(!1),T=O[0],w=O[1],I=o?o.slice(0,3).map((function(e){return e.photo_100?{src:e.photo_100,alt:e.firstName,key:e.peerId}:{id:e.peerId,text:e.firstName.slice(0,1)}})):[],P=Object(l.useCallback)((function(e){E(e.target.value)}),[]),R=Object(l.useCallback)((function(e){if(n)return function(e,t,n,r,i){if(e)return Promise.resolve(e);return((e,t,n)=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_anonym_call_token",join_link:e,user_id:t,name:n}))(n,r,i).then((function(e){var n=e[0];return t(n),Promise.resolve(n)}))}(b,C,i,t,y).then((function(e){return function(e){var t=e.bridge,n=e.inited,r=e.setInited,i=e.data,a=e.onBeforeCallStart,o=e.onAfterCallFinish,s=e.tabIsMaster,c=e.tabIsIdle;if(n)return Promise.resolve();var l=i.callsCredentials,u=i.participantLimit,d=i.imHash,p=i.callsUseDirectAudioMix,h=i.callsOkStaging;return t.init({callsCredentials:l,imHash:d,participantLimit:u,callsUseDirectAudioMix:p,callsOkStaging:h,onBeforeCallStart:a,onAfterCallFinish:o,tabIsMaster:s,tabIsIdle:c}).then((function(){return r(!0)}))}({bridge:f,inited:T,setInited:w,data:e,onBeforeCallStart:d,onAfterCallFinish:p,tabIsMaster:v,tabIsIdle:g})})).then((function(){return f.joinCallByLink(0,r,null,e,m)})).catch((function(e){ne("string"==typeof e?e:Object(q.getLang)("global_unknow_error"))}));if(h&&h(),!s)throw Error("no peer_id to join");f.joinCallByLink(s.peerId,r,[s,o],e,m)}),[r,h,y,b,T]),A=Object(l.useCallback)((function(){h&&h()}),[h]),N=Object(l.useMemo)((function(){var e=Object(Bo.clean)(Object(Se.decodeHTMLEntities)(a)),t=Object(Ac.emojiRegex)();return e.replace(t,Rc.emojiReplace)}),[a]),k=u.a.createElement(Pc,{isAnonym:n,name:y,onChangeName:P,namePlaceholder:Object(q.getLang)("calls_name_placeholder"),title:N,label:Ue(o||[],I),items:I,joinWithVideoText:Object(q.getLang)("calls_join_with_video"),joinWithAudioText:Object(q.getLang)("calls_join_with_audio"),onJoinWithVideo:function(){return R(!0)},onJoinWithAudio:function(){return R(!1)},disabled:n&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(y),inputDisabled:!!b});return c?u.a.createElement(X.default,{onClose:A},u.a.createElement(jo.ModalHeader,{appearance:"blue",title:Object(q.getLang)("calls_invite"),onClose:A}),k):k};var kc,Lc=function(e){var t=e.children;return u.a.createElement("div",{className:"ErrorPopupText"},t)},Dc=function(e){var t=e.title,n=e.text,r=e.onClose;return u.a.createElement(gs.default,{appearance:"blue",title:t||Object(q.getLang)("calls_oops"),onClose:r,actionButtons:u.a.createElement(Mo.default,{onClick:r},Object(q.getLang)("global_close"))},u.a.createElement(Lc,null,n||Object(q.getLang)("global_error")))},Mc=function(e){var t=e.onClose,n=e.actionButtons;return u.a.createElement(gs.default,{onClose:t,title:Object(q.getLang)("calls_exit_menu"),appearance:"blue",actionButtons:n,className:"CallExitModal"},u.a.createElement("div",{className:"CallExitModal__text"},Object(q.getLang)("calls_sure_leave_call")))},jc=function(e){var t=e.SDK,n=e.state,r=e.dispatch,i=function(){return me.logEvent({call_event_type:p.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:n.callData.callId,peer_id:n.peer,is_group_call:ue(n.peer),reason:"none",group_call_users_count:uo(n)})},a=Object(l.useCallback)((function(){r({type:p.TOGGLE_POPUP})}),[]);return u.a.createElement(Mc,{onClose:a,actionButtons:[u.a.createElement(Mo.default,{onClick:function(){r({type:p.TOGGLE_POPUP}),i(),Ec(0,n,r)},key:"forceCallFinish",appearance:"secondary"},Object(q.getLang)("calls_force_call_finish")),u.a.createElement(Mo.default,{onClick:function(){return r({type:p.TOGGLE_POPUP}),i(),t.hangup()},key:"leave"},Object(q.getLang)("calls_leave_call"))]})};!function(e){e.CONTAIN="cn",e.COVER="cv"}(kc||(kc={}));function xc(e,t,n){return e.uiMode===p.UIMode.COLLAPSED?function(e){var t=Ne(e),n=co(e,t);return lo(e).reduce((function(e,t){var r=t.peerId,i=t.mediaSettings;return r===(null==n?void 0:n.peerId)&&(null==i?void 0:i.isVideoEnabled)?e.set(t.peerId,{fit:kc.CONTAIN,width:265,height:200,priority:2,uid:ao(n)}):e.set(t.peerId,{fit:kc.CONTAIN,width:0,height:0,priority:-1,uid:ao(t)}),e}),new Map)}(e):e.isOratorMode?function(e,t,n){var r=e.pinnedParticipant||e.orator||e.me;return lo(e).reduce((function(i,a){var o=a.peerId,s=a.mediaSettings;if(r===o&&(null==s?void 0:s.isVideoEnabled)){var c=e.uiMode===p.UIMode.FULLSCREEN;i.set(a.peerId,{fit:kc.CONTAIN,width:c?t:900,height:c?n:504,priority:3,uid:ao(a)})}else(null==s?void 0:s.isVideoEnabled)?i.set(a.peerId,{fit:(null==s?void 0:s.isScreenSharingEnabled)?kc.CONTAIN:kc.COVER,width:140,height:140,priority:1,uid:ao(a)}):i.set(a.peerId,{fit:kc.COVER,width:0,height:0,priority:-1,uid:ao(a)});return i}),new Map)}(e,t,n):function(e,t,n){var r=e.uiMode===p.UIMode.FULLSCREEN,i=r?t:900,a=r?n:504,o=lo(e),s=function(e,t,n){switch(n){case 1:return t;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(t/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(t/3);default:return Math.round(e/6)}}(i,a,o.length),c=s<200?1:2;return o.reduce((function(e,t){var n;return(null===(n=t.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)?e.set(t.peerId,{fit:kc.COVER,width:s,height:s,priority:c,uid:ao(t)}):e.set(t.peerId,{fit:kc.COVER,width:0,height:0,priority:-1,uid:ao(t)}),e}),new Map)}(e,t,n)}var Uc=function(e,t){var n=Object(l.useState)([0,0]),r=n[0],i=r[0],a=r[1],o=n[1],s=Object(l.useCallback)(Object(St.throttle)(Gc,1e3),[]),c=Object(l.useRef)(new Map),u=Object(l.useRef)([]);Object(l.useEffect)((function(){var e=function(){return o([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(l.useEffect)((function(){if(t.mode===p.Mode.CALL){var n=xc(t,i,a),r=function(e,t){var n=[];return t.forEach((function(t,r){var i,a,o=e.get(r);o&&(a=t,(i=o).fit===a.fit&&i.width===a.width&&i.height==i.height&&i.priority===a.priority)||n.push(t)})),n}(c.current,n);r.length>0&&s(e,t,r,c,n,u)}}),[i,a,t])};function Gc(e,t,n,r,i,a){if(t.mode!==p.Mode.CALL)return r.current=new Map,void(a.current=[]);a.current=n,r.current=i,e.updateDisplayLayout(n)}var Vc=n("yAhi");function Bc(){return(Bc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Hc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wc(e){var t=e.SDK,n=e.bridge,r=e.useLongpoll,i=e.useSDK,a=e.imHash,o=e.participantLimit,s=e.me,c=e.onBeforeCallStart,u=e.onAfterCallFinish,d=e.tabIsMaster,h=Hc(l.useReducer(S,f(s,a,{participantLimit:o})),2),m=h[0],v=h[1],g=l.useRef(m),_=l.useCallback(()=>{v({type:p.CHANGE_MODE,mode:p.Mode.READY})},[]);return l.useEffect(()=>{g.current=m},[m]),l.useEffect(()=>{i(g,v),r(g,v)},[]),function(e,t,n,r){void 0===r&&(r=[]);var i=window.document,a=i.documentElement,o=a.requestFullscreen||a.webkitRequestFullscreen;if(o){var s=!a.requestFullscreen,c=s?i.webkitExitFullscreen:i.exitFullscreen,u=s?"webkitfullscreenchange":"fullscreenchange",d=s?"webkitFullscreenElement":"fullscreenElement";Object(l.useEffect)((function(){var e=function(){i.fullscreenElement?t&&t():n&&n()};return i.addEventListener(u,e),function(){return i.removeEventListener(u,e)}}),[]),Object(l.useEffect)((function(){e&&!i[d]?o.call(i.documentElement):!e&&i[d]&&c.call(i)}),r)}}(m.uiMode===p.UIMode.FULLSCREEN&&m.mode===p.Mode.CALL,()=>{},()=>{g.current.uiMode===p.UIMode.FULLSCREEN&&v({type:p.CHANGE_UI_MODE,mode:p.UIMode.DEFAULT})},[m.uiMode,m.mode]),Uc(t,m),l.createElement(Ss,{SDK:t,state:m,dispatch:v},d()&&l.createElement(Do,{state:m,onBeforeCallStart:c,onAfterCallFinish:u}),m.mode===p.Mode.CALL&&m.uiMode!==p.UIMode.COLLAPSED&&l.createElement(wo,{SDK:t,state:m,dispatch:v}),m.mode===p.Mode.INCOMING&&m.uiMode!==p.UIMode.COLLAPSED&&l.createElement(ve,{SDK:t,state:m,dispatch:v}),m.mode!==p.Mode.READY&&m.uiMode===p.UIMode.COLLAPSED&&l.createElement(ko,{SDK:t,state:m,dispatch:v}),m.mode===p.Mode.JOIN&&l.createElement(Nc,Bc({},m.join,{bridge:n,withPopup:!0,onClose:_})),m.mode===p.Mode.ERROR&&l.createElement(Dc,{title:m.error.title,text:m.error.text,onClose:_}),m.groupCallSetup&&l.createElement(as,{SDK:t,state:m,dispatch:v}),m.isManagementOpen&&l.createElement(Sc,{SDK:t,state:m,dispatch:v}),m.popup===p.POPUP_SETTINGS&&l.createElement(Es,{SDK:t,state:m,dispatch:v}),m.popup===p.POPUP_EXIT&&l.createElement(jc,{SDK:t,state:m,dispatch:v}),m.isLoaderVisible&&l.createElement(Vc.default,null))}n("OEbY");var zc=n("f01n"),Kc=function(){return(Kc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Jc={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function qc(e){switch(e){case p.CallStatus.WAITING:return 1;case p.CallStatus.CONNECTING:return 2;case p.CallStatus.CONNECTED:return 3;default:return 0}}var Yc=function(){return Jc},Xc=function(e){var t,n;Jc=Kc(Kc(Kc({},Jc),e),{connectionStep:(t=e.connectionStep,n=Jc.connectionStep,t&&qc(t)&&qc(t)>qc(n)?t:n)})},Zc=function(){Jc={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}},$c=n("MhhX");function Qc(){return(Qc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function el(e,t,n,r,i,a){void 0!==window.Notifier&&Notifier.getLpInstance().onData((function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];var l=i.current;tl(l,a,s,n).then(()=>{s.forEach(r=>{switch(r.type){case zc.INCOMING_CALL:if(nl(l,r,n))t.processPush(r.payload.call_id).then(()=>{var e=JSON.parse(Object(Bo.decodeHtml)(r.payload.payload)),t=e.is_video?p.CallType.VIDEO:p.CallType.AUDIO;a({type:p.CHANGE_MODE,mode:p.Mode.INCOMING,peerId:Pe(r.payload),data:Qc({},r.payload,{type:t,payload:e})}),Xc({timeStart:Date.now(),startType:t}),me.logEvent({call_event_type:p.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:r.payload.call_id,peer_id:Pe(r.payload),is_group_call:Re(r),reason:e.is_video?p.CallType.VIDEO:p.CallType.AUDIO})}).catch(t=>{if(e.debug)if("object"==typeof t){var n=t.hangup,r=t.message;console.error("Push process error",n,r)}else console.error("Push process error",t)});else if(r.type===zc.INCOMING_CALL){var o=t=>{e.debug&&console.warn("Incoming push skipped:",t,r)};switch(!0){case!r.payload.call_id:o("old lib call");break;case!n():o("not master tab");break;case l.mode===p.Mode.CALL||l.mode===p.Mode.INCOMING:o("already in a call")}}break;case zc.ADD_MESSAGE:var s=i.current,c=Object(le.isChatPeer)(s.peer),u=s.callData.callId;if(s.peer!==r.peerId||r.flags&zc.FLAG_OUTBOUND||s.me===r.userId||a({type:p.SET_UNREAD_COUNT,chatUnreadCount:s.chatUnreadCount?s.chatUnreadCount+1:1}),c||!Object($c.isActiveGroupCallMessage)(r))return;var d=r.peerId;if(u===r.kludges.attach1_call_id)return gc(i,a,d);break;case zc.READ_INBOUND:null!==r.chatUnreadCount&&i.current.peer===r.peerId&&a({type:p.SET_UNREAD_COUNT,chatUnreadCount:r.unread,chatUpToMsgId:r.upToId});break;case zc.SET_FLAGS:var h=i.current;h.peer===r.peerId&&null!==h.chatUpToMsgId&&r.messageId>h.chatUpToMsgId&&!(r.flags&zc.FLAG_OUTBOUND)&&(r.flags&zc.FLAG_DELETED||r.flags&zc.FLAG_SPAM)&&a({type:p.SET_UNREAD_COUNT,chatUnreadCount:h.chatUnreadCount?h.chatUnreadCount-1:0});break;case zc.DELETE_DIALOG:i.current.peer===r.peerId&&a({type:p.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case zc.EDIT_MESSAGE:case zc.REPLACE_MESSAGE:var f=i.current;f.peer===r.peerId&&null!==f.chatUpToMsgId&&r.messageId>f.chatUpToMsgId&&r.kludges.is_expired&&a({type:p.SET_UNREAD_COUNT,chatUnreadCount:f.chatUnreadCount?f.chatUnreadCount-1:0});break;case zc.CONVERSATION_UPDATED:var m=r.peerId,v=r.updateType;if(i.current.peer!==m)return;if(v!==zc.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==i.current.callData.canFinishCall&&i.current.callData.hasUrlLink||_c(i,a,m)}})}).catch(i=>{e.debug&&console.error("Resource loading error",i),s.forEach(i=>{switch(i.type){case zc.INCOMING_CALL:if(!nl(l,i,n)||r())return;re(()=>{t.processPush(i.payload.call_id).then(()=>{t.declineCall()}).catch(t=>{e.debug&&console.error("Delayed by error push process error",t)})})}})})}))}function tl(e,t,n,r){var i=n.reduce((n,i)=>{switch(i.type){case zc.INCOMING_CALL:if(!nl(e,i,r)){n.push(Promise.resolve());break}var a=Re(i),o=(l=i.payload,u=l.caller_info,d=u.first_name+" "+u.last_name,{peerId:+u.user_id,name:d,tab:d,photo:u.photo_400});if(a){var s=function(e){var t=e.chat_info;return{peerId:2e9+t.chat_id,tab:t.title,name:t.title,photo:t.photo_400}}(i.payload);t({type:p.LOAD_PEERS,conversation:s,members:[o],peerId:s.peerId}),s.photo&&n.push(ee(s.photo));var c=function(e,t,n){var r=tc(e,t),i=r[0],a=r[1];return Me(ac,xe.bind(null,i,a))(n).then((function(e){var n=e[0],r=e[1];te([n,r]).catch(console.error),t({type:p.LOAD_PEERS,conversation:n,members:r})}))}(e,t,s.peerId);n.push(c)}else t({type:p.LOAD_PEERS,conversation:o,members:[o],peerId:o.peerId});o.photo&&n.push(ee(o.photo))}var l,u,d;return n},[]);return Promise.all(i)}function nl(e,t,n){return function(e){return!!e.payload.call_id}(t)&&e.mode!==p.Mode.INCOMING&&e.mode!==p.Mode.CALL&&n()}function rl(e){var t=e.onVolumeLevelReached,n=e.needCheckMicEnabled,r=e.vectorLength,i=e.volumeLevelDetection,a=e.callbackFactorStep,o=e.sensitivityCoefficient,s=e.onVolumeLevelUpdated,c=e.debugCallback,l=function(e){var t=[],n=0;return function(r){if(t.push(r),n+=r,t.length>e){var i=t.shift();n-=i||0}return n/t.length}}(r),u=0,d=!1;return function(e,r){c&&c(arguments);var p=e>i;d!==p&&s&&s(p),d=p,0!==u&&r&&(u=0);var h=l(e);n&&r||e/h>(1+u)/o&&e>i&&(u+=a,t())}}function il(e,t){var n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every((function(e){return t[e]}))}function al(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}var ol=n("tGJf");function sl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ll(e){ol.vkLocalStorage.setItem("calls_token",e)}function ul(){return ol.vkLocalStorage.getItem("calls_token")}var dl=n("Bj12");function pl(e,t,n,r){var i,a,o,s=Yc(),c=s.startType,l=s.entryPoint,u=s.timeStart,d=s.isGroupCall,h=s.hadVideoEnabled,f=s.isOutgoingCall,m=!e||e===p.HANGUP_TYPE_HUNGUP&&!n,v={type:c&&function(e,t,n){var r;r=e===p.CallType.VIDEO?t?p.CallStatReachedType.GROUP_VIDEO:p.CallStatReachedType.VIDEO:n?t?p.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:p.CallStatReachedType.AUDIO_TO_VIDEO:t?p.CallStatReachedType.GROUP_AUDIO:p.CallStatReachedType.AUDIO;return r}(c,d,h),result:m?p.CallStatResult.SUCCESS:p.CallStatResult.FAIL,failReason:m?null:hl(e,n),callSource:l,totalDuration:u?Date.now()-u:0};f&&(r&&console.log(v),i=t,o=[(a=v).type||"",a.result,a.failReason||"",a.callSource||"",a.totalDuration],Object(dl.saveStatlogEvents)({name:"call_stats",value:i,keys:o}))}function hl(e,t){var n=Yc().isOutgoingCall,r=Yc().connectionStep;switch(!0){case t:return p.CallStatFailReason.CONNECTION_LOST;case e===p.HANGUP_TYPE_CANCELED:return p.CallStatFailReason.LOCAL_DECLINE;case e===p.HANGUP_TYPE_REJECTED:return p.CallStatFailReason.REMOTE_DECLINE;case e===p.HANGUP_TYPE_BUSY:return p.CallStatFailReason.REMOTE_BUSY;case e===p.HANGUP_TYPE_MISSED:return n?p.CallStatFailReason.REMOTE_TIMEOUT:null;case r===p.CallStatus.CONNECTING:return p.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!r:return p.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}function fl(){return(fl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ml(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gl(e,t,n,r,i,a,o,s,c){var l,u,d,h,f,m,v,g,_=s.current.me,E=p.BAD_CONNECTION_DISABLED_CAMERA_LEVEL,S=!1,b={apiKey:i.key,apiEnv:i.is_dev?"VIDEOTEST":"PROD",anonymToken:i.is_anonym&&i.token,voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},directAudioOutput:a?"AudioElementMix":"AudioElement",allowMissingMic:!0,domain:o?"vk_corp":null,onLocalStream:(t,n)=>{e.debug&&console.warn("onLocalStream",t,n),y(c,_,{stream:t,mediaSettings:n}),Xc({hadVideoEnabled:n.isVideoEnabled})},onLocalStreamUpdate:(t,n)=>{e.debug&&console.warn("onLocalStreamUpdate",t,n);var r=s.current,i=s.current.participants[_].mediaSettings;y(c,_,{mediaSettings:t}),t.isScreenSharingEnabled!==i.isScreenSharingEnabled&&Ol(r,c,t.isScreenSharingEnabled,_),Xc({hadVideoEnabled:t.isVideoEnabled})},onRemoteStream:(t,n)=>{e.debug&&console.warn("onRemoteStream",t.id,n),y(c,t.id,{stream:n})},onConversation:t=>{if(e.debug&&console.warn("onConversation",t),!s.current.callData.ts){var n=Date.now();c({type:p.TIME_START,data:n})}e.isInActiveCall=!0,_c(s,c,s.current.peer)},onRemoteMediaSettings:(t,n)=>{var r,i;e.debug&&console.warn("onRemoteMediaSettings",t.id,n);var a=+t.id,o=s.current,l=!!(null===(r=o.participants[a])||void 0===r||null===(i=r.mediaSettings)||void 0===i?void 0:i.isScreenSharingEnabled);n.isScreenSharingEnabled!==l&&Ol(o,c,n.isScreenSharingEnabled,a,!0),y(c,a,{mediaSettings:n}),Xc({hadVideoEnabled:n.isVideoEnabled})},onParticipantStatus:(t,n,r)=>{var i=+t.id,a=s.current;if(e.debug&&console.warn("onParticipantStatus",i,n,r),!a.participants[i]){c({type:p.LOAD_PEERS,members:[{peerId:i,mediaSettings:{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},isAnonym:"ANONYM"===t.type}]});var o="ANONYM"===t.type?[-Math.abs(i)]:[i],l=a.callData.callId,u={withConversation:!s.current.callData.conversation,awaitImages:!0};yc(s,c,l,o,u)}y(c,i,{status:n,statusData:r}),Xc({connectionStep:n}),i===a.peer&&n===p.CallStatus.CONNECTED&&me.logEvent({call_event_type:p.CallActionEventType.CALL_CONNECTED,session_id:a.callData.callId,peer_id:a.peer,is_group_call:!1})},onUserPermissions:t=>{e.debug&&console.warn("onUserPermissions",t),c({type:p.CALL_STATE,callData:{permissions:t.reduce((e,t)=>(e[t]=!0,e),{})}})},onPermissionsError:t=>{var n,r,i,a;e.debug&&console.warn("onPermissionsError",t),s.current.mode===p.Mode.CALL&&(n=t,i={[p.MediaError.CAMERA_PERMISSION]:Object($.getLang)("calls_error_no_cam"),[p.MediaError.MIC_PERMISSION]:Object($.getLang)("calls_error_no_mic"),[p.MediaError.CAMERA_ACCESS]:Object($.getLang)("calls_error_cameralock"),[p.MediaError.MIC_ACCESS]:Object($.getLang)("calls_error_miclock"),[p.MediaError.MIC_NOT_FOUND]:Object($.getLang)("calls_error_nomic"),[p.MediaError.SCREEN_PERMISSION]:Object($.getLang)("calls_error_screenpermission"),[p.MediaError.SCREEN_ACCESS]:Object($.getLang)("calls_error_screenlock")}[n],a=Object(Z.showFastBox)(Object($.getLang)("global_error"),i,Object($.getLang)("global_close"),()=>{a.hide(),r&&r()}))},onPermissionsRequested:()=>{e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:t=>{e.debug&&console.warn("onRemoteRemoved",t.id),c({type:p.REMOVE_USER,participantId:+t.id})},onCallState:(t,n,r)=>{e.debug&&console.warn("onCallState",t,n,r);var i=r.id,a=r.direction;i&&s.current.callData.callId||(c({type:p.CALL_STATE,callData:{callId:i}}),s.current.peer||yc(s,c,i,[],{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!0}),!ue(s.current.peer||0)||"JOINING"!==a&&"OUTGOING"!==a||me.logEvent({call_event_type:p.CallActionEventType.CALL_CONNECTED,session_id:i,peer_id:s.current.peer||0,is_group_call:!0}))},onRateNeeded:()=>{e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:t=>{var n=t.id;e.debug&&console.warn("onSpeakerChanged",n),c({type:p.SET_ORATOR,orator:+n})},onJoinStatus:(t,n)=>{e.debug&&console.warn("onJoinStatus",t,n)},onHangup:(t,n)=>{var r=t.hangup;e.debug&&console.warn("onHangup",r,n);var i=r&&-1===[p.HANGUP_TYPE_CANCELED,p.HANGUP_TYPE_MISSED,p.HANGUP_TYPE_HUNGUP,p.HANGUP_TYPE_REMOVED].indexOf(r);s.current.mode===p.Mode.CALL&&i?(c({type:p.HANGUP,data:r}),Object(ge.pause)(p.HANGUP_DELAY).then(()=>{c({type:p.CHANGE_MODE,mode:p.Mode.READY})})):c({type:p.CHANGE_MODE,mode:p.Mode.READY}),e.isInActiveCall=!1,pl(r,n,function(e){return!!Object.values(e.participants).find(e=>e.status===p.CallStatus.RECONNECT)}(s.current),e.debug),Zc()},onCallAccepted:()=>{e.debug&&console.warn("onCallAccepted"),ue(s.current.peer)&&me.logEvent({call_event_type:p.CallActionEventType.CALL_CONNECTED,session_id:s.current.callData.callId,peer_id:s.current.peer,is_group_call:ue(s.current.peer)})},onTokenExpired:()=>{e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(!function(e,t,n,r){var i=()=>n.current.imHash,a=e=>(r({type:p.UPDATE_HASH,hash:e}),e);(function(e,t){var n=ul();return n?e.authorize(n).then(()=>t.authorized=!0):Promise.reject()})(e,t).catch(()=>function(e,t,n,r){return Me(sc,xe.bind(null,n,r),je)().then(n=>{var r=ml(n,1)[0];return e.authorize(r).then(()=>ll(r)).then(()=>t.authorized=!0)})}(e,t,i,a)).catch(e=>console.log("Could not authorize with token request",e))}(t,e,s,c),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:()=>{e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:()=>{e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:t=>{e.debug&&console.warn("onFingerprintChange",t)},onVolumesDetected:(l={onUpdate(e){c({type:p.SET_SPEAKERS,data:e})},volumeLevelDetection:p.VOLUME_LEVEL_DETECTION,debugCallback:()=>{e.debug}},u=l.onUpdate,d=l.volumeLevelDetection,h=l.debugCallback,f={},m=[],v={},g=[],function(e){h&&h(arguments),v=Object.keys(v).reduce((function(e,t){return v[t]-1>0&&(e[t]=v[t]-1),e}),{});var t=e.reduce((function(e,t){var n=t.uid.id;return t.volume>d&&(e[n]=!0,v[n]=3),e}),{});g=Object.keys(v);var n=!1,r={speakers:null,speakersInHeader:null};il(f,t)||(r.speakers=t,f=t,n=!0),al(m,g)||(r.speakersInHeader=g,m=g,n=!0),n&&u(r)}),onLocalVolume:rl({onVolumeLevelReached:()=>{var e=s.current;c({type:p.CALL_NOTIFICATION,notification:{type:p.NotificationType.SPEAKING_ON_MUTE}}),me.logEvent({call_event_type:p.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:ue(e.peer)})},onVolumeLevelUpdated(e){var t=s.current.participants[_].mediaSettings.isAudioEnabled,n=Object.assign({},s.current.speakers);e&&t?n[_]=!0:e||delete n[_],c({type:p.SET_SPEAKERS,data:n})},needCheckMicEnabled:!0,volumeLevelDetection:p.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:()=>{e.debug}}),onChatMessage:(t,n,r)=>{e.debug&&console.warn("onChatMessage",t,n,r)},onCustomData:(t,n)=>{e.debug&&console.warn("onCustomData",t,n)},onNetworkStatus:n=>{var r=s.current;if(e.debug&&console.warn("onNetworkStatus",n),!n){var i=s.current.participants[_].mediaSettings,a=!!(null==i?void 0:i.isScreenSharingEnabled),o=!!(null==i?void 0:i.isVideoEnabled);S||!o||a||E--,E>0||S||a||!o?c({type:p.CALL_NOTIFICATION,notification:{type:p.NotificationType.BAD_NETWORK_CONNECTION}}):(S=!0,t.toggleLocalVideo(!1).catch(console.error),c({type:p.CALL_NOTIFICATION,notification:{type:p.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA}}),me.logEvent({call_event_type:p.CallActionEventType.VIDEO_DISABLED,session_id:r.callData.callId,peer_id:r.peer,is_group_call:ue(r.peer),reason:"lowBandwidth"}),me.logEvent({call_event_type:p.CallActionEventType.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT,session_id:r.callData.callId,peer_id:r.peer,is_group_call:ue(r.peer)}))}},onDebugMessage:function(t){if(e.debug){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];console.warn("onDebugMessage",t,...r)}},onRemoteParticipantState:(t,n)=>{var r,i,a;e.debug&&console.warn("onRemoteParticipantState",t,n);var o=function(e){return e.hand?fl({},e,{hand:e.hand===p.SdkHandType.RAISED}):e}(n),l=t.id,u=!!(null===(r=s.current.participants[l])||void 0===r||null===(i=r.statusData)||void 0===i?void 0:i.hand),d=!!(null===(a=s.current.participants[l])||void 0===a?void 0:a.name);y(c,l,{statusData:o}),o.hand&&!u&&d&&c({type:p.CALL_NOTIFICATION,notification:{type:p.NotificationType.RAISED_HAND,data:l}})}};e.authorized=!1,e.call=function(e,t,n,r){return(i,a,o,s)=>e.isInActiveCall?Promise.reject():Promise.resolve().then(()=>_l(e)).then(()=>de(t,a)).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!0})}).then(()=>El(n,r,i,o)).then(e=>Promise.all([te(e),yl(t,n,a,i)])).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),r({type:p.CHANGE_MODE,mode:p.Mode.CALL,peerId:i}),Xc({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:s,startType:a?p.CallType.VIDEO:p.CallType.AUDIO}),me.logEvent({call_event_type:a?p.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:p.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:n.current.callData.callId,peer_id:i,is_group_call:!1,source:s,group_call_users_count:2}),Sl(n,r,i,o)}).catch(n=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),Cl(n,t,e,ue(i),a)})}(e,t,s,c),e.startGroupCall=function(e,t,n,r){return(i,a,o,s,c)=>{var l=o.filter(le.isUserPeer);return e.debug&&o.length!==l.length&&console.warn("Some ids cannot get into the call.",o.filter(e=>!Object(le.isUserPeer)(e))),e.isInActiveCall?Promise.reject():Promise.resolve().then(()=>_l(e)).then(()=>de(t,s)).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!0})}).then(()=>El(n,r,i,a)).then(e=>Promise.all([vc(n.current,r,i,e[0]),mc(n.current,r)])).then(()=>yl(t,n,s,i)).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),r({type:p.CHANGE_MODE,mode:p.Mode.CALL,peerId:i}),l&&l.length?r({type:p.GROUP_CALL_SETUP,open:!0,peerId:i,preselectedIds:l}):r({type:p.MANAGEMENT,isOpen:!0}),Sl(n,r,i,a),Xc({timeStart:Date.now(),isOutgoingCall:!0,startType:s?p.CallType.VIDEO:p.CallType.AUDIO,entryPoint:c,isGroupCall:!0}),me.logEvent({call_event_type:s?p.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:p.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:n.current.callData.callId,peer_id:i,is_group_call:!0,source:c,group_call_users_count:1})}).catch(n=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),Cl(n,t,e,ue(i),s)})}}(e,t,s,c),e.startCall=function(e,t,n,r){return(i,a)=>{if(e.isInActiveCall)return Promise.reject();var o={peerId:0,canAddMembers:!0,tab:Object($.getLang)("calls_new_call_title"),photo:"/images/call_convo_stub.png"};return Promise.resolve().then(()=>_l(e)).then(()=>de(t,i)).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!0})}).then(()=>Promise.all([yl(t,n,i),te([o])])).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),r({type:p.LOAD_PEERS,conversation:o,members:[],peerId:0}),r({type:p.CHANGE_MODE,mode:p.Mode.CALL}),r({type:p.MANAGEMENT,isOpen:!0}),Xc({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:a,startType:i?p.CallType.VIDEO:p.CallType.AUDIO,isGroupCall:!0}),me.logEvent({call_event_type:i?p.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:p.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:n.current.callData.callId,peer_id:0,is_group_call:!0,source:a,group_call_users_count:1})}).catch(n=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),Cl(n,t,e,!0,i)})}}(e,t,s,c),e.joinCallByLink=function(e,t,n,r){return function(i,a,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0;return e.isInActiveCall?Promise.reject():Promise.resolve().then(()=>_l(e)).then(()=>de(t,s)).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!0})}).then(()=>io(n.current.me)?t.joinCallByLink(a,s).then(e=>{var t=e.id;return yc(n,r,t,[],{withConversation:!0,withCallParticipants:!0})}):El(n,r,i,o).then(e=>Promise.all([te(e),t.joinCallByLink(a,s)]))).then(()=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),r({type:p.CHANGE_MODE,mode:p.Mode.CALL,peerId:i}),Sl(n,r,i,o),me.logEvent({call_event_type:p.CallActionEventType.GROUP_CALL_JOINED,session_id:n.current.callData.callId,peer_id:i,is_group_call:!0,source:c,group_call_users_count:Ae(n.current).length})}).catch(n=>{r({type:p.SHOW_LOADER,isLoaderVisible:!1}),Cl(n,t,e,ue(i),s)})}}(e,t,s,c),e.showJoinPopup=function(e,t,n){return(e,r)=>{var i=t.current.mode;return i===p.Mode.CALL||i===p.Mode.INCOMING?Promise.reject().catch(()=>ne(Object($.getLang)("calls_already_in_call_error"))):(n({type:p.SHOW_LOADER,isLoaderVisible:!0}),(e=>Object(ic.post)(_e.CONTROLLER,{act:"a_get_call_preview",join_link:e}))(e).then(e=>{var t=ml(e,1)[0];n({type:p.SHOW_LOADER,isLoaderVisible:!1}),n({type:p.JOIN,data:fl({},t,{entryPoint:r})})}).catch(()=>{n({type:p.SHOW_LOADER,isLoaderVisible:!1}),n({type:p.ERROR,text:Object($.getLang)("calls_join_error_text")})}))}}(0,s,c);var C,O,T;return(i.token?Promise.resolve(i.token):(C=()=>s.current.imHash,O=e=>(c({type:p.UPDATE_HASH,hash:e}),e),(T=ul())?Promise.resolve(T):Me(sc,xe.bind(null,C,O),je)().then(e=>sl(e,1)[0]))).then(i=>{t.init(b).then(()=>io(s.current.me)?Promise.resolve():t.authorize(i).then(()=>ll(i)).then(()=>e.authorized=!0)).then(n).catch(e=>{r(e)})}),t}function _l(e){return e.authorized||io(e.id)?Promise.resolve():Promise.reject(p.CLIENT_ERROR_NOT_AUTHORIZED)}function yl(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=Le(r,n);return r?ue(r)?e.call(i.filter(e=>Object(le.isUserPeer)(e)&&e!==t.current.me),n,a,!0):e.call(r,n,a):e.call(void 0,n,a,!0)}function El(e,t,n,r){var i=!!r;return i||n?(i?Promise.resolve(we(r)):Me(ac,xe.bind(null,()=>e.current.imHash,e=>(t({type:p.UPDATE_HASH,hash:e}),e)))(n).then(Ie)).then(e=>{var r=ml(e,2),i=r[0],a=r[1];return t({type:p.LOAD_PEERS,conversation:i,members:a,peerId:n}),e}):Promise.reject("Cannot load data")}function Sl(e,t,n,r){if(!!!r||!n)return Promise.resolve();return Me(ac,xe.bind(null,()=>e.current.imHash,e=>(t({type:p.UPDATE_HASH,hash:e}),e)))(n).then(te).then(e=>{var n=ml(Ie(e),2),r=n[0],i=n[1];t({type:p.LOAD_PEERS,conversation:r,members:i})})}function bl(e,t){switch(!0){case(e=>{var t=e||{},n=t.hangup,r=t.message;return n&&r&&n===p.HANGUP_TYPE_EXTERNAL_API_ERROR})(e):return function(e,t){var n=Ce(e.split(" : "),2),r=n[0],i=n[1];if("VCHAT_EXTERNAL_API_ERROR"!==r||!i)return Object($.getLang)("global_sorry_error");switch(+i){case p.SERVER_ERROR_PRIVACY:return Object($.getLang)("calls_privacy_error");case p.SERVER_ERROR_BUSY:return t?Object($.getLang)("calls_chat_busy_error"):Object($.getLang)("calls_busy_error");case p.SERVER_ERROR_FLOOD_CONTROL:return Object($.getLang)("calls_flood_error");case p.SERVER_ERROR_UNKNOWN:case p.SERVER_ERROR_INVALID_REQUEST:case p.SERVER_ERROR_INTERNAL:case p.SERVER_ERROR_OLD_RECEIVER_APP:default:return Object($.getLang)("calls_start_error")}}(e.message,t);case(e=>"number"==typeof e)(e):case(e=>!!e)(e):default:return Object($.getLang)("global_sorry_error")}}function Cl(e,t,n,r,i){var a=bl(e,r);t.hangup(),n.debug&&e&&console.error(e),ne(a)}function Ol(e,t,n,r,i){0===Object.keys(e.screenSharers).filter(t=>e.screenSharers[t]).length&&n&&(t({type:p.TOGGLE_ORATOR_MODE,isOratorMode:!0}),t({type:p.SET_PINNED_PARTICIPANT,pinnedParticipant:r})),t({type:p.SET_SCREEN_SHARER,participantId:r,isScreenSharingEnabled:n}),n&&i&&t({type:p.CALL_NOTIFICATION,notification:{type:p.NotificationType.SCREEN_SHARING_STARTED,data:r}})}function Tl(){return(Tl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}window.Calls||(window.Calls={init(e){var t=e.callsCredentials,n=e.imHash,r=e.participantLimit,i=e.callsUseDirectAudioMix,a=e.callsOkStaging,o=e.tabIsMaster,s=e.tabIsIdle,u=e.onBeforeCallStart,p=e.onAfterCallFinish;if(!sa.isBrowserSupported()){var h=()=>ne(Object($.getLang)("calls_unsupported_browser_error"));return this.call=h,this.startGroupCall=h,this.startCall=h,this.joinCallByLink=h,void(this.showJoinPopup=h)}this.id=window.vk.id||t.me.peerId;var f=o||(()=>!0),m=s||(()=>!1);return new Promise((e,o)=>{var s=function(e){var t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}("calls");d.render(l.createElement(Wc,{bridge:this,SDK:c,useLongpoll:el.bind(null,this,c,f,m),useSDK:gl.bind(null,this,c,e,o,t,i,a),me:t.me,imHash:n,participantLimit:r,tabIsMaster:f,onBeforeCallStart:u,onAfterCallFinish:p}),s)}).catch(e=>{console.error("Could not init calls",e.error,e)})},showJoinScreen(e,t,n){if(!sa.isBrowserSupported())return ne(Object($.getLang)("calls_unsupported_browser_error"));var r=document.querySelector(t);d.render(l.createElement(Nc,Tl({},e,{withPopup:!1,bridge:this,entryPoint:n})),r)},debug:!1,setDebug(e){this.debug=e,ro(e)}});try{window.stManager.done(window.jsc("web/calls.js"))}catch(e){}},"8D0k":function(e,t,n){"use strict";var r=n("KCt4");function i(e,t,n,i,a){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":a||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var a=r(e.parameters.apt,n),o=r(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(r){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!i(r,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,n,r,i){var a=new Event("track");a.track=n,a.receiver=r,a.transceiver={receiver:r},a.streams=i,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var u=function(n){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=a[e].bind(a)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},u.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},u.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},u.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},u.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},u.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},u.prototype._gather=function(t,n){var i=this,a=this.transceivers[n].iceGatherer;if(!a.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),a.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),s.component=1,s.ufrag=a.getLocalParameters().usernameFragment;var l=r.writeCandidate(s);o.candidate=Object.assign(o.candidate,r.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=r.getMediaSections(i._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+u.join("");var d=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",o),d&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){a.onlocalcandidate(e)}))}),0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,n,i){var o=a(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},u.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],c=o.iceGatherer,l=o.iceTransport,u=o.dtlsTransport,d=o.localCapabilities,p=o.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var h=r.getIceParameters(e,n),f=r.getDtlsParameters(e,n);s&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===l.state&&l.start(c,h,s?"controlling":"controlled"),"new"===u.state&&u.start(f));var m=a(d,p);i._transceive(o,m.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var u=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!o("setRemoteDescription",i.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+u.signalingState));var d={};u.remoteStreams.forEach((function(e){d[e.id]=e}));var p=[],h=r.splitSections(i.sdp),f=h.shift(),m=r.matchPrefix(f,"a=ice-lite").length>0,v=r.matchPrefix(f,"a=group:BUNDLE ").length>0;u.usingBundle=v;var g=r.matchPrefix(f,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,h.forEach((function(o,c){var l=r.splitLines(o),h=r.getKind(o),g=r.isRejected(o)&&0===r.matchPrefix(o,"a=bundle-only").length,_=l[0].substr(2).split(" ")[2],y=r.getDirection(o,f),E=r.parseMsid(o),S=r.getMid(o)||r.generateIdentifier();if(g||"application"===h&&("DTLS/SCTP"===_||"UDP/DTLS/SCTP"===_))u.transceivers[c]={mid:S,kind:h,protocol:_,rejected:!0};else{var b,C,O,T,w,I,P,R,A;!g&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(h,!0));var N,k,L=r.parseRtpParameters(o);g||(N=r.getIceParameters(o,f),(k=r.getDtlsParameters(o,f)).role="client"),P=r.parseRtpEncodingParameters(o);var D=r.parseRtcpParameters(o),M=r.matchPrefix(o,"a=end-of-candidates",f).length>0,j=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!g&&v&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==i.type||g){if("answer"===i.type&&!g){C=(b=u.transceivers[c]).iceGatherer,O=b.iceTransport,T=b.dtlsTransport,w=b.rtpReceiver,I=b.sendEncodingParameters,R=b.localCapabilities,u.transceivers[c].recvEncodingParameters=P,u.transceivers[c].remoteCapabilities=L,u.transceivers[c].rtcpParameters=D,j.length&&"new"===O.state&&(!m&&!M||v&&0!==c?j.forEach((function(e){s(b.iceTransport,e)})):O.setRemoteCandidates(j)),v&&0!==c||("new"===O.state&&O.start(C,N,"controlling"),"new"===T.state&&T.start(k)),!a(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,u._transceive(b,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!w||"sendrecv"!==y&&"sendonly"!==y?delete b.rtpReceiver:(A=w.track,E?(d[E.stream]||(d[E.stream]=new e.MediaStream),n(A,d[E.stream]),p.push([A,w,d[E.stream]])):(d.default||(d.default=new e.MediaStream),n(A,d.default),p.push([A,w,d.default])))}}else{(b=u.transceivers[c]||u._createTransceiver(h)).mid=S,b.iceGatherer||(b.iceGatherer=u._createIceGatherer(c,v)),j.length&&"new"===b.iceTransport.state&&(!M||v&&0!==c?j.forEach((function(e){s(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(j)),R=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(R.codecs=R.codecs.filter((function(e){return"rtx"!==e.name}))),I=b.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var x,U=!1;if("sendrecv"===y||"sendonly"===y){if(U=!b.rtpReceiver,w=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,h),U)A=w.track,E&&"-"===E.stream||(E?(d[E.stream]||(d[E.stream]=new e.MediaStream,Object.defineProperty(d[E.stream],"id",{get:function(){return E.stream}})),Object.defineProperty(A,"id",{get:function(){return E.track}}),x=d[E.stream]):(d.default||(d.default=new e.MediaStream),x=d.default)),x&&(n(A,x),b.associatedRemoteMediaStreams.push(x)),p.push([A,w,x])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=R,b.remoteCapabilities=L,b.rtpReceiver=w,b.rtcpParameters=D,b.sendEncodingParameters=I,b.recvEncodingParameters=P,u._transceive(u.transceivers[c],!1,U)}}})),void 0===u._dtlsRole&&(u._dtlsRole="offer"===i.type?"active":"passive"),u._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(d).forEach((function(t){var n=d[t];if(n.getTracks().length){if(-1===u.remoteStreams.indexOf(n)){u.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){u._dispatchEvent("addstream",r)}))}p.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&l(u,t,r,[n])}))}})),p.forEach((function(e){e[2]||l(u,e[0],e[1],[])})),e.setTimeout((function(){u&&u.transceivers&&u.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},u.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var a=n.transceivers.filter((function(e){return"audio"===e.kind})).length,o=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(a=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(o=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));a>0||o>0;)a>0&&(n._createTransceiver("audio"),a--),o>0&&(n._createTransceiver("video"),o--);var l=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,a){var o=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(a,n.usingBundle));var l=e.RTCRtpSender.getCapabilities(s);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=i.sendEncodingParameters||[{ssrc:1001*(2*a+1)}];o&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=l,i.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(l+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){l+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var u=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(u)},u.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var o=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var l=a(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=i(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(l)},u.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,a){if(!n._remoteDescription)return a(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<n.transceivers.length;l++)if(n.transceivers[l].mid===e.sdpMid){o=l;break}var u=n.transceivers[o];if(!u)return a(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var d=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return i();if(d.component&&1!==d.component)return i();if((0===o||o>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,d))return a(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(d.type?p:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var h=0;h<n.transceivers.length&&(n.transceivers[h].rejected||(n.transceivers[h].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[h]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));h++);i()}))},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var d=["createOffer","createAnswer"];return d.forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),u}},"8Lyy":function(e,t,n){var r=n("O6qx"),i=/%[sdv%]/g,a=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,(function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?r.push(n[t.name][o]):r.push(n[t.names[i]])}else r.push(n[t.name]);return a.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||s,i=t.innerOrder||c,a=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(o(t,n,e))}))}))})),e.media.forEach((function(e){a.push(o("m",r.m[0],e)),i.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?a.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){a.push(o(t,n,e))}))}))}))})),a.join("\r\n")+"\r\n"}},"9XzT":function(e,t,n){t.Interop=n("/oKx")},KCt4:function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=r.parseRtpMap(o),c=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),a&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var a=r.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var a=r.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var o=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=r},LQSR:function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},O6qx:function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},UlUB:function(e,t,n){"use strict";function r(e,t){var n,r,i=!1;return function a(){if(i)return n=arguments,void(r=this);e.apply(this,arguments),i=!0,setTimeout((function(){i=!1,n&&(a.apply(r,n),n=r=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return r}))},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},clTp:function(e,t,n){"use strict";function r(e){var t=e.getBoundingClientRect(),n=document.body,r=document.documentElement,i=window.pageYOffset||r.scrollTop||n.scrollTop,a=window.pageXOffset||r.scrollLeft||n.scrollLeft,o=r.clientTop||n.clientTop||0,s=r.clientLeft||n.clientLeft||0;return{top:Math.round(t.top+i-o),left:Math.round(t.left+a-s),width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"default",(function(){return r}))},dAlA:function(e,t,n){(function(e){var r,i=function(e){"use strict";var t=1e7,n=9007199254740992,r=d(n),a="function"==typeof BigInt;function o(e,t,n,r){return void 0===e?o[0]:void 0!==t&&(10!=+t||n)?V(e,t,n,r):z(e)}function s(e,t){this.value=e,this.sign=t,this.isSmall=!1}function c(e){this.value=e,this.sign=e<0,this.isSmall=!0}function l(e){this.value=e}function u(e){return-n<e&&e<n}function d(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function p(e){h(e);var n=e.length;if(n<4&&P(e,r)<0)switch(n){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*t;default:return e[0]+(e[1]+e[2]*t)*t}return e}function h(e){for(var t=e.length;0===e[--t];);e.length=t+1}function f(e){for(var t=new Array(e),n=-1;++n<e;)t[n]=0;return t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}function v(e,n){var r,i,a=e.length,o=n.length,s=new Array(a),c=0,l=t;for(i=0;i<o;i++)c=(r=e[i]+n[i]+c)>=l?1:0,s[i]=r-c*l;for(;i<a;)c=(r=e[i]+c)===l?1:0,s[i++]=r-c*l;return c>0&&s.push(c),s}function g(e,t){return e.length>=t.length?v(e,t):v(t,e)}function _(e,n){var r,i,a=e.length,o=new Array(a),s=t;for(i=0;i<a;i++)r=e[i]-s+n,n=Math.floor(r/s),o[i]=r-n*s,n+=1;for(;n>0;)o[i++]=n%s,n=Math.floor(n/s);return o}function y(e,t){var n,r,i=e.length,a=t.length,o=new Array(i),s=0;for(n=0;n<a;n++)(r=e[n]-s-t[n])<0?(r+=1e7,s=1):s=0,o[n]=r;for(n=a;n<i;n++){if(!((r=e[n]-s)<0)){o[n++]=r;break}r+=1e7,o[n]=r}for(;n<i;n++)o[n]=e[n];return h(o),o}function E(e,t,n){var r,i,a=e.length,o=new Array(a),l=-t;for(r=0;r<a;r++)i=e[r]+l,l=Math.floor(i/1e7),i%=1e7,o[r]=i<0?i+1e7:i;return"number"==typeof(o=p(o))?(n&&(o=-o),new c(o)):new s(o,n)}function S(e,t){var n,r,i,a,o=e.length,s=t.length,c=f(o+s);for(i=0;i<o;++i){a=e[i];for(var l=0;l<s;++l)n=a*t[l]+c[i+l],r=Math.floor(n/1e7),c[i+l]=n-1e7*r,c[i+l+1]+=r}return h(c),c}function b(e,n){var r,i,a=e.length,o=new Array(a),s=t,c=0;for(i=0;i<a;i++)r=e[i]*n+c,c=Math.floor(r/s),o[i]=r-c*s;for(;c>0;)o[i++]=c%s,c=Math.floor(c/s);return o}function C(e,t){for(var n=[];t-- >0;)n.push(0);return n.concat(e)}function O(e,n,r){return new s(e<t?b(n,e):S(n,d(e)),r)}function T(e){var t,n,r,i,a=e.length,o=f(a+a);for(r=0;r<a;r++){n=0-(i=e[r])*i;for(var s=r;s<a;s++)t=i*e[s]*2+o[r+s]+n,n=Math.floor(t/1e7),o[r+s]=t-1e7*n;o[r+a]=n}return h(o),o}function w(e,t){var n,r,i,a,o=e.length,s=f(o);for(i=0,n=o-1;n>=0;--n)i=(a=1e7*i+e[n])-(r=m(a/t))*t,s[n]=0|r;return[s,0|i]}function I(e,n){var r,i=z(n);if(a)return[new l(e.value/i.value),new l(e.value%i.value)];var u,v=e.value,g=i.value;if(0===g)throw new Error("Cannot divide by zero");if(e.isSmall)return i.isSmall?[new c(m(v/g)),new c(v%g)]:[o[0],e];if(i.isSmall){if(1===g)return[e,o[0]];if(-1==g)return[e.negate(),o[0]];var _=Math.abs(g);if(_<t){u=p((r=w(v,_))[0]);var E=r[1];return e.sign&&(E=-E),"number"==typeof u?(e.sign!==i.sign&&(u=-u),[new c(u),new c(E)]):[new s(u,e.sign!==i.sign),new c(E)]}g=d(_)}var S=P(v,g);if(-1===S)return[o[0],e];if(0===S)return[o[e.sign===i.sign?1:-1],o[0]];u=(r=v.length+g.length<=200?function(e,n){var r,i,a,o,s,c,l,u=e.length,d=n.length,h=t,m=f(n.length),v=n[d-1],g=Math.ceil(h/(2*v)),_=b(e,g),y=b(n,g);for(_.length<=u&&_.push(0),y.push(0),v=y[d-1],i=u-d;i>=0;i--){for(r=h-1,_[i+d]!==v&&(r=Math.floor((_[i+d]*h+_[i+d-1])/v)),a=0,o=0,c=y.length,s=0;s<c;s++)a+=r*y[s],l=Math.floor(a/h),o+=_[i+s]-(a-l*h),a=l,o<0?(_[i+s]=o+h,o=-1):(_[i+s]=o,o=0);for(;0!==o;){for(r-=1,a=0,s=0;s<c;s++)(a+=_[i+s]-h+y[s])<0?(_[i+s]=a+h,a=0):(_[i+s]=a,a=1);o+=a}m[i]=r}return _=w(_,g)[0],[p(m),p(_)]}(v,g):function(e,t){for(var n,r,i,a,o,s=e.length,c=t.length,l=[],u=[];s;)if(u.unshift(e[--s]),h(u),P(u,t)<0)l.push(0);else{i=1e7*u[(r=u.length)-1]+u[r-2],a=1e7*t[c-1]+t[c-2],r>c&&(i=1e7*(i+1)),n=Math.ceil(i/a);do{if(P(o=b(t,n),u)<=0)break;n--}while(n);l.push(n),u=y(u,o)}return l.reverse(),[p(l),p(u)]}(v,g))[0];var C=e.sign!==i.sign,O=r[1],T=e.sign;return"number"==typeof u?(C&&(u=-u),u=new c(u)):u=new s(u,C),"number"==typeof O?(T&&(O=-O),O=new c(O)):O=new s(O,T),[u,O]}function P(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return e[n]>t[n]?1:-1;return 0}function R(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function A(e,t){for(var n,r,a,o=e.prev(),s=o,c=0;s.isEven();)s=s.divide(2),c++;e:for(r=0;r<t.length;r++)if(!e.lesser(t[r])&&!(a=i(t[r]).modPow(s,e)).isUnit()&&!a.equals(o)){for(n=c-1;0!=n;n--){if((a=a.square().mod(e)).isUnit())return!1;if(a.equals(o))continue e}return!1}return!0}s.prototype=Object.create(o.prototype),c.prototype=Object.create(o.prototype),l.prototype=Object.create(o.prototype),s.prototype.add=function(e){var t=z(e);if(this.sign!==t.sign)return this.subtract(t.negate());var n=this.value,r=t.value;return t.isSmall?new s(_(n,Math.abs(r)),this.sign):new s(g(n,r),this.sign)},s.prototype.plus=s.prototype.add,c.prototype.add=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.subtract(t.negate());var r=t.value;if(t.isSmall){if(u(n+r))return new c(n+r);r=d(Math.abs(r))}return new s(_(r,Math.abs(n)),n<0)},c.prototype.plus=c.prototype.add,l.prototype.add=function(e){return new l(this.value+z(e).value)},l.prototype.plus=l.prototype.add,s.prototype.subtract=function(e){var t=z(e);if(this.sign!==t.sign)return this.add(t.negate());var n=this.value,r=t.value;return t.isSmall?E(n,Math.abs(r),this.sign):function(e,t,n){var r;return P(e,t)>=0?r=y(e,t):(r=y(t,e),n=!n),"number"==typeof(r=p(r))?(n&&(r=-r),new c(r)):new s(r,n)}(n,r,this.sign)},s.prototype.minus=s.prototype.subtract,c.prototype.subtract=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.add(t.negate());var r=t.value;return t.isSmall?new c(n-r):E(r,Math.abs(n),n>=0)},c.prototype.minus=c.prototype.subtract,l.prototype.subtract=function(e){return new l(this.value-z(e).value)},l.prototype.minus=l.prototype.subtract,s.prototype.negate=function(){return new s(this.value,!this.sign)},c.prototype.negate=function(){var e=this.sign,t=new c(-this.value);return t.sign=!e,t},l.prototype.negate=function(){return new l(-this.value)},s.prototype.abs=function(){return new s(this.value,!1)},c.prototype.abs=function(){return new c(Math.abs(this.value))},l.prototype.abs=function(){return new l(this.value>=0?this.value:-this.value)},s.prototype.multiply=function(e){var n,r,i,a=z(e),c=this.value,l=a.value,u=this.sign!==a.sign;if(a.isSmall){if(0===l)return o[0];if(1===l)return this;if(-1===l)return this.negate();if((n=Math.abs(l))<t)return new s(b(c,n),u);l=d(n)}return r=c.length,i=l.length,new s(-.012*r-.012*i+15e-6*r*i>0?function e(t,n){var r=Math.max(t.length,n.length);if(r<=30)return S(t,n);r=Math.ceil(r/2);var i=t.slice(r),a=t.slice(0,r),o=n.slice(r),s=n.slice(0,r),c=e(a,s),l=e(i,o),u=e(g(a,i),g(s,o)),d=g(g(c,C(y(y(u,c),l),r)),C(l,2*r));return h(d),d}(c,l):S(c,l),u)},s.prototype.times=s.prototype.multiply,c.prototype._multiplyBySmall=function(e){return u(e.value*this.value)?new c(e.value*this.value):O(Math.abs(e.value),d(Math.abs(this.value)),this.sign!==e.sign)},s.prototype._multiplyBySmall=function(e){return 0===e.value?o[0]:1===e.value?this:-1===e.value?this.negate():O(Math.abs(e.value),this.value,this.sign!==e.sign)},c.prototype.multiply=function(e){return z(e)._multiplyBySmall(this)},c.prototype.times=c.prototype.multiply,l.prototype.multiply=function(e){return new l(this.value*z(e).value)},l.prototype.times=l.prototype.multiply,s.prototype.square=function(){return new s(T(this.value),!1)},c.prototype.square=function(){var e=this.value*this.value;return u(e)?new c(e):new s(T(d(Math.abs(this.value))),!1)},l.prototype.square=function(e){return new l(this.value*this.value)},s.prototype.divmod=function(e){var t=I(this,e);return{quotient:t[0],remainder:t[1]}},l.prototype.divmod=c.prototype.divmod=s.prototype.divmod,s.prototype.divide=function(e){return I(this,e)[0]},l.prototype.over=l.prototype.divide=function(e){return new l(this.value/z(e).value)},c.prototype.over=c.prototype.divide=s.prototype.over=s.prototype.divide,s.prototype.mod=function(e){return I(this,e)[1]},l.prototype.mod=l.prototype.remainder=function(e){return new l(this.value%z(e).value)},c.prototype.remainder=c.prototype.mod=s.prototype.remainder=s.prototype.mod,s.prototype.pow=function(e){var t,n,r,i=z(e),a=this.value,s=i.value;if(0===s)return o[1];if(0===a)return o[0];if(1===a)return o[1];if(-1===a)return i.isEven()?o[1]:o[-1];if(i.sign)return o[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&u(t=Math.pow(a,s)))return new c(m(t));for(n=this,r=o[1];!0&s&&(r=r.times(n),--s),0!==s;)s/=2,n=n.square();return r},c.prototype.pow=s.prototype.pow,l.prototype.pow=function(e){var t=z(e),n=this.value,r=t.value,i=BigInt(0),a=BigInt(1),s=BigInt(2);if(r===i)return o[1];if(n===i)return o[0];if(n===a)return o[1];if(n===BigInt(-1))return t.isEven()?o[1]:o[-1];if(t.isNegative())return new l(i);for(var c=this,u=o[1];(r&a)===a&&(u=u.times(c),--r),r!==i;)r/=s,c=c.square();return u},s.prototype.modPow=function(e,t){if(e=z(e),(t=z(t)).isZero())throw new Error("Cannot take modPow with modulus 0");var n=o[1],r=this.mod(t);for(e.isNegative()&&(e=e.multiply(o[-1]),r=r.modInv(t));e.isPositive();){if(r.isZero())return o[0];e.isOdd()&&(n=n.multiply(r).mod(t)),e=e.divide(2),r=r.square().mod(t)}return n},l.prototype.modPow=c.prototype.modPow=s.prototype.modPow,s.prototype.compareAbs=function(e){var t=z(e),n=this.value,r=t.value;return t.isSmall?1:P(n,r)},c.prototype.compareAbs=function(e){var t=z(e),n=Math.abs(this.value),r=t.value;return t.isSmall?n===(r=Math.abs(r))?0:n>r?1:-1:-1},l.prototype.compareAbs=function(e){var t=this.value,n=z(e).value;return(t=t>=0?t:-t)===(n=n>=0?n:-n)?0:t>n?1:-1},s.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:P(n,r)*(this.sign?-1:1)},s.prototype.compareTo=s.prototype.compare,c.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return t.isSmall?n==r?0:n>r?1:-1:n<0!==t.sign?n<0?-1:1:n<0?1:-1},c.prototype.compareTo=c.prototype.compare,l.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=this.value,n=z(e).value;return t===n?0:t>n?1:-1},l.prototype.compareTo=l.prototype.compare,s.prototype.equals=function(e){return 0===this.compare(e)},l.prototype.eq=l.prototype.equals=c.prototype.eq=c.prototype.equals=s.prototype.eq=s.prototype.equals,s.prototype.notEquals=function(e){return 0!==this.compare(e)},l.prototype.neq=l.prototype.notEquals=c.prototype.neq=c.prototype.notEquals=s.prototype.neq=s.prototype.notEquals,s.prototype.greater=function(e){return this.compare(e)>0},l.prototype.gt=l.prototype.greater=c.prototype.gt=c.prototype.greater=s.prototype.gt=s.prototype.greater,s.prototype.lesser=function(e){return this.compare(e)<0},l.prototype.lt=l.prototype.lesser=c.prototype.lt=c.prototype.lesser=s.prototype.lt=s.prototype.lesser,s.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},l.prototype.geq=l.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals=s.prototype.geq=s.prototype.greaterOrEquals,s.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},l.prototype.leq=l.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals=s.prototype.leq=s.prototype.lesserOrEquals,s.prototype.isEven=function(){return 0==(1&this.value[0])},c.prototype.isEven=function(){return 0==(1&this.value)},l.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},s.prototype.isOdd=function(){return 1==(1&this.value[0])},c.prototype.isOdd=function(){return 1==(1&this.value)},l.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},s.prototype.isPositive=function(){return!this.sign},c.prototype.isPositive=function(){return this.value>0},l.prototype.isPositive=c.prototype.isPositive,s.prototype.isNegative=function(){return this.sign},c.prototype.isNegative=function(){return this.value<0},l.prototype.isNegative=c.prototype.isNegative,s.prototype.isUnit=function(){return!1},c.prototype.isUnit=function(){return 1===Math.abs(this.value)},l.prototype.isUnit=function(){return this.abs().value===BigInt(1)},s.prototype.isZero=function(){return!1},c.prototype.isZero=function(){return 0===this.value},l.prototype.isZero=function(){return this.value===BigInt(0)},s.prototype.isDivisibleBy=function(e){var t=z(e);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},l.prototype.isDivisibleBy=c.prototype.isDivisibleBy=s.prototype.isDivisibleBy,s.prototype.isPrime=function(e){var t=R(this);if(void 0!==t)return t;var n=this.abs(),r=n.bitLength();if(r<=64)return A(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var a=Math.log(2)*r.toJSNumber(),o=Math.ceil(!0===e?2*Math.pow(a,2):a),s=[],c=0;c<o;c++)s.push(i(c+2));return A(n,s)},l.prototype.isPrime=c.prototype.isPrime=s.prototype.isPrime,s.prototype.isProbablePrime=function(e,t){var n=R(this);if(void 0!==n)return n;for(var r=this.abs(),a=void 0===e?5:e,o=[],s=0;s<a;s++)o.push(i.randBetween(2,r.minus(2),t));return A(r,o)},l.prototype.isProbablePrime=c.prototype.isProbablePrime=s.prototype.isProbablePrime,s.prototype.modInv=function(e){for(var t,n,r,a=i.zero,o=i.one,s=z(e),c=this.abs();!c.isZero();)t=s.divide(c),n=a,r=s,a=o,s=c,o=n.subtract(t.multiply(o)),c=r.subtract(t.multiply(c));if(!s.isUnit())throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===a.compare(0)&&(a=a.add(e)),this.isNegative()?a.negate():a},l.prototype.modInv=c.prototype.modInv=s.prototype.modInv,s.prototype.next=function(){var e=this.value;return this.sign?E(e,1,this.sign):new s(_(e,1),this.sign)},c.prototype.next=function(){var e=this.value;return e+1<n?new c(e+1):new s(r,!1)},l.prototype.next=function(){return new l(this.value+BigInt(1))},s.prototype.prev=function(){var e=this.value;return this.sign?new s(_(e,1),!0):E(e,1,this.sign)},c.prototype.prev=function(){var e=this.value;return e-1>-n?new c(e-1):new s(r,!0)},l.prototype.prev=function(){return new l(this.value-BigInt(1))};for(var N=[1];2*N[N.length-1]<=t;)N.push(2*N[N.length-1]);var k=N.length,L=N[k-1];function D(e){return Math.abs(e)<=t}function M(e,t,n){t=z(t);for(var r=e.isNegative(),a=t.isNegative(),o=r?e.not():e,s=a?t.not():t,c=0,l=0,u=null,d=null,p=[];!o.isZero()||!s.isZero();)c=(u=I(o,L))[1].toJSNumber(),r&&(c=L-1-c),l=(d=I(s,L))[1].toJSNumber(),a&&(l=L-1-l),o=u[0],s=d[0],p.push(n(c,l));for(var h=0!==n(r?1:0,a?1:0)?i(-1):i(0),f=p.length-1;f>=0;f-=1)h=h.multiply(L).add(i(p[f]));return h}s.prototype.shiftLeft=function(e){var t=z(e).toJSNumber();if(!D(t))throw new Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var n=this;if(n.isZero())return n;for(;t>=k;)n=n.multiply(L),t-=k-1;return n.multiply(N[t])},l.prototype.shiftLeft=c.prototype.shiftLeft=s.prototype.shiftLeft,s.prototype.shiftRight=function(e){var t,n=z(e).toJSNumber();if(!D(n))throw new Error(String(n)+" is too large for shifting.");if(n<0)return this.shiftLeft(-n);for(var r=this;n>=k;){if(r.isZero()||r.isNegative()&&r.isUnit())return r;r=(t=I(r,L))[1].isNegative()?t[0].prev():t[0],n-=k-1}return(t=I(r,N[n]))[1].isNegative()?t[0].prev():t[0]},l.prototype.shiftRight=c.prototype.shiftRight=s.prototype.shiftRight,s.prototype.not=function(){return this.negate().prev()},l.prototype.not=c.prototype.not=s.prototype.not,s.prototype.and=function(e){return M(this,e,(function(e,t){return e&t}))},l.prototype.and=c.prototype.and=s.prototype.and,s.prototype.or=function(e){return M(this,e,(function(e,t){return e|t}))},l.prototype.or=c.prototype.or=s.prototype.or,s.prototype.xor=function(e){return M(this,e,(function(e,t){return e^t}))},l.prototype.xor=c.prototype.xor=s.prototype.xor;function j(e){var n=e.value,r="number"==typeof n?n|1<<30:"bigint"==typeof n?n|BigInt(1<<30):n[0]+n[1]*t|1073758208;return r&-r}function x(e,t){return e=z(e),t=z(t),e.greater(t)?e:t}function U(e,t){return e=z(e),t=z(t),e.lesser(t)?e:t}function G(e,t){if(e=z(e).abs(),t=z(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var n,r,i=o[1];e.isEven()&&t.isEven();)n=U(j(e),j(t)),e=e.divide(n),t=t.divide(n),i=i.multiply(n);for(;e.isEven();)e=e.divide(j(e));do{for(;t.isEven();)t=t.divide(j(t));e.greater(t)&&(r=t,t=e,e=r),t=t.subtract(e)}while(!t.isZero());return i.isUnit()?e:e.multiply(i)}s.prototype.bitLength=function(){var e=this;return e.compareTo(i(0))<0&&(e=e.negate().subtract(i(1))),0===e.compareTo(i(0))?i(0):i(function e(t,n){if(n.compareTo(t)<=0){var r=e(t,n.square(n)),a=r.p,o=r.e,s=a.multiply(n);return s.compareTo(t)<=0?{p:s,e:2*o+1}:{p:a,e:2*o}}return{p:i(1),e:0}}(e,i(2)).e).add(i(1))},l.prototype.bitLength=c.prototype.bitLength=s.prototype.bitLength;var V=function(e,t,n,r){n=n||"0123456789abcdefghijklmnopqrstuvwxyz",e=String(e),r||(e=e.toLowerCase(),n=n.toLowerCase());var i,a=e.length,o=Math.abs(t),s={};for(i=0;i<n.length;i++)s[n[i]]=i;for(i=0;i<a;i++){if("-"!==(u=e[i])&&(u in s&&s[u]>=o)){if("1"===u&&1===o)continue;throw new Error(u+" is not a valid digit in base "+t+".")}}t=z(t);var c=[],l="-"===e[0];for(i=l?1:0;i<e.length;i++){var u;if((u=e[i])in s)c.push(z(s[u]));else{if("<"!==u)throw new Error(u+" is not a valid character");var d=i;do{i++}while(">"!==e[i]&&i<e.length);c.push(z(e.slice(d+1,i)))}}return B(c,t,l)};function B(e,t,n){var r,i=o[0],a=o[1];for(r=e.length-1;r>=0;r--)i=i.add(e[r].times(a)),a=a.times(t);return n?i.negate():i}function H(e,t){if((t=i(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var n=Array.apply(null,Array(e.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return n.unshift([1]),{value:[].concat.apply([],n),isNegative:!1}}var r=!1;if(e.isNegative()&&t.isPositive()&&(r=!0,e=e.abs()),t.isUnit())return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(e.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:r};for(var a,o=[],s=e;s.isNegative()||s.compareAbs(t)>=0;){a=s.divmod(t),s=a.quotient;var c=a.remainder;c.isNegative()&&(c=t.minus(c).abs(),s=s.next()),o.push(c.toJSNumber())}return o.push(s.toJSNumber()),{value:o.reverse(),isNegative:r}}function F(e,t,n){var r=H(e,t);return(r.isNegative?"-":"")+r.value.map((function(e){return function(e,t){return e<(t=t||"0123456789abcdefghijklmnopqrstuvwxyz").length?t[e]:"<"+e+">"}(e,n)})).join("")}function W(e){if(u(+e)){var t=+e;if(t===m(t))return a?new l(BigInt(t)):new c(t);throw new Error("Invalid integer: "+e)}var n="-"===e[0];n&&(e=e.slice(1));var r=e.split(/e/i);if(r.length>2)throw new Error("Invalid integer: "+r.join("e"));if(2===r.length){var i=r[1];if("+"===i[0]&&(i=i.slice(1)),(i=+i)!==m(i)||!u(i))throw new Error("Invalid integer: "+i+" is not a valid exponent.");var o=r[0],d=o.indexOf(".");if(d>=0&&(i-=o.length-d-1,o=o.slice(0,d)+o.slice(d+1)),i<0)throw new Error("Cannot include negative exponent part for integers");e=o+=new Array(i+1).join("0")}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);if(a)return new l(BigInt(n?"-"+e:e));for(var p=[],f=e.length,v=f-7;f>0;)p.push(+e.slice(v,f)),(v-=7)<0&&(v=0),f-=7;return h(p),new s(p,n)}function z(e){return"number"==typeof e?function(e){if(a)return new l(BigInt(e));if(u(e)){if(e!==m(e))throw new Error(e+" is not an integer.");return new c(e)}return W(e.toString())}(e):"string"==typeof e?W(e):"bigint"==typeof e?new l(e):e}s.prototype.toArray=function(e){return H(this,e)},c.prototype.toArray=function(e){return H(this,e)},l.prototype.toArray=function(e){return H(this,e)},s.prototype.toString=function(e,t){if(void 0===e&&(e=10),10!==e)return F(this,e,t);for(var n,r=this.value,i=r.length,a=String(r[--i]);--i>=0;)n=String(r[i]),a+="0000000".slice(n.length)+n;return(this.sign?"-":"")+a},c.prototype.toString=function(e,t){return void 0===e&&(e=10),10!=e?F(this,e,t):String(this.value)},l.prototype.toString=c.prototype.toString,l.prototype.toJSON=s.prototype.toJSON=c.prototype.toJSON=function(){return this.toString()},s.prototype.valueOf=function(){return parseInt(this.toString(),10)},s.prototype.toJSNumber=s.prototype.valueOf,c.prototype.valueOf=function(){return this.value},c.prototype.toJSNumber=c.prototype.valueOf,l.prototype.valueOf=l.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var K=0;K<1e3;K++)o[K]=z(K),K>0&&(o[-K]=z(-K));return o.one=o[1],o.zero=o[0],o.minusOne=o[-1],o.max=x,o.min=U,o.gcd=G,o.lcm=function(e,t){return e=z(e).abs(),t=z(t).abs(),e.divide(G(e,t)).multiply(t)},o.isInstance=function(e){return e instanceof s||e instanceof c||e instanceof l},o.randBetween=function(e,n,r){e=z(e),n=z(n);var i=r||Math.random,a=U(e,n),s=x(e,n).subtract(a).add(1);if(s.isSmall)return a.add(Math.floor(i()*s));for(var c=H(s,t).value,l=[],u=!0,d=0;d<c.length;d++){var p=u?c[d]:t,h=m(i()*p);l.push(h),h<p&&(u=!1)}return a.add(o.fromArray(l,t,!1))},o.fromArray=function(e,t,n){return B(e.map(z),z(t||10),n)},o}();e.hasOwnProperty("exports")&&(e.exports=i),void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)}).call(this,n("YuTi")(e))},k76L:function(e,t,n){var r=n("leix"),i=n("8Lyy");t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},leix:function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(t[n[a]]=r(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=n("O6qx"),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,r,o)}})),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},zMZw:function(e,t,n){var r=n("k76L");t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach((function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach((function(t){var n=e.sources[t];Object.keys(n).forEach((function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})}))})),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))}))})),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach((function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))})),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach((function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value})),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))}))})),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach((function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))})),t}}});