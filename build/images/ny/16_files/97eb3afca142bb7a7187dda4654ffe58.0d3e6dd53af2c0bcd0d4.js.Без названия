(window.webpackJsonp=window.webpackJsonp||[]).push([["97eb3afca142bb7a7187dda4654ffe58"],{"/eGY":function(e,t,n){"use strict";n.r(t),n.d(t,"VKPAY_APP_ID",(function(){return d})),n.d(t,"BUTTON_TYPE_TEXT",(function(){return l})),n.d(t,"BUTTON_TYPE_VKPAY",(function(){return _})),n.d(t,"BUTTON_TYPE_LOCATION",(function(){return g})),n.d(t,"BUTTON_TYPE_OPEN_APP",(function(){return f})),n.d(t,"BUTTON_TYPE_OPEN_LINK",(function(){return m})),n.d(t,"BUTTON_COLOR_DEFAULT",(function(){return p})),n.d(t,"BUTTON_COLOR_SECONDARY",(function(){return h})),n.d(t,"BUTTON_COLOR_PRIMARY",(function(){return b})),n.d(t,"BUTTON_COLOR_NEGATIVE",(function(){return v})),n.d(t,"BUTTON_COLOR_POSITIVE",(function(){return O})),n.d(t,"handleButtonClick",(function(){return T})),n.d(t,"getButtonAppearance",(function(){return C})),n.d(t,"getButtonLabel",(function(){return A})),n.d(t,"getActionObjectFromElement",(function(){return y})),n.d(t,"getAttributesFromActionObject",(function(){return j}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("/8Fb"),n("pIFo");var r=n("t7n3"),a=n("nAFc"),i=n("/PiP"),s=n("EasH"),o=n("N4ZS");function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=6217559,l="text",_="vkpay",g="location",f="open_app",m="open_link",p="default",h="secondary",b="primary",v="negative",O="positive",E=["app-id","owner-id","type","payload","hash","label"];function T(e,t,n,r){var a=e.app_id,o=e.owner_id,c=e.type,u=e.payload,p=e.hash,h=void 0===p?"":p;switch(c){case m:break;case _:case f:var b="app"+(c===_?d:a)+(o?"_"+o:"");Object(i.showWiki)({w:b+encodeURIComponent("#"+h),from_keyboard:1,app_hash:n});break;case g:cur.sendLocation=function(e,n){n(),t({keyboardAuthorId:r,action:{label:"",attaches:[e],payload:u}})},Object(s.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case l:t({action:e,appHash:n,keyboardAuthorId:r});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:c,payload:e.payload}),t({action:e,appHash:n,keyboardAuthorId:r})}}function C(e){return I(e)?b:e.color.toLowerCase().replace(p,h)}function A(e){var t=e.action,n=t.label;return t.type===g?getLang("mail_keyboard_label_location"):I(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(a.decodeHTMLEntities)(t||""),t=Object(r.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(n)}function I(e){var t=e.action,n=t.app_id,r=t.type;return r===_||r===f&&n===d}function y(e){return E.reduce((t,n)=>(t[n.replace("-","_")]=e.getAttribute("data-"+n)||void 0,t),{})}function j(e){var t=Object.entries(e).reduce((e,t)=>{var n=c(t,2),a=n[0],i=n[1];return e+` data-${a.replace("_","-")}="${Object(r.clean)(""+i)}"`},"");e.type===m&&(t+=` href="${Object(o.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return t}},"1y80":function(e,t,n){"use strict";function r(e,t,n,r,a){return window.statlogsValueEvent(e,t,n,r,a)}function a(e){return Math.random()<e}function i(e,t,n,i,s,o){a(e)&&r(t,n,i,s,o)}n.r(t),n.d(t,"statlogsValueEvent",(function(){return r})),n.d(t,"randEnabled",(function(){return a})),n.d(t,"statlogsProbValueEvent",(function(){return i}))},"83Q7":function(e,t,n){"use strict";var r,a,i,s,o;n.r(t),n.d(t,"ErrorHandleType",(function(){return a})),n.d(t,"MediaError",(function(){return i})),n.d(t,"SearchResultType",(function(){return s})),n.d(t,"Mode",(function(){return o})),n.d(t,"LOAD_PEERS",(function(){return g})),n.d(t,"CHANGE_MODE",(function(){return f})),n.d(t,"CALL_STATE",(function(){return m})),n.d(t,"REMOVE_USER",(function(){return p})),n.d(t,"TIME_START",(function(){return h})),n.d(t,"HANGUP",(function(){return b})),n.d(t,"SET_CHAT_INFO",(function(){return v})),n.d(t,"GROUP_CALL_SETUP",(function(){return O})),n.d(t,"TOGGLE_POPUP",(function(){return E})),n.d(t,"UPDATE_HASH",(function(){return T})),n.d(t,"CHANGE_UI_MODE",(function(){return C})),n.d(t,"SET_ORATOR",(function(){return A})),n.d(t,"TOGGLE_ORATOR_MODE",(function(){return I})),n.d(t,"TOGGLE_PARTICIPANTS_ASIDE",(function(){return y})),n.d(t,"SET_PINNED_PARTICIPANT",(function(){return j})),n.d(t,"MANAGEMENT",(function(){return S})),n.d(t,"CALL_NOTIFICATION",(function(){return L})),n.d(t,"JOIN",(function(){return M})),n.d(t,"ERROR",(function(){return P})),n.d(t,"CHANGE_PARTICIPANT_STATE",(function(){return N})),n.d(t,"SET_SCREEN_SHARER",(function(){return k})),n.d(t,"SET_FRIENDS",(function(){return R})),n.d(t,"SET_SPEAKERS",(function(){return D})),n.d(t,"UPDATE_PARTICIPANTS_BATCH",(function(){return w})),n.d(t,"SET_UNREAD_COUNT",(function(){return U})),n.d(t,"SHOW_CAUTION_BOX",(function(){return H})),n.d(t,"SHOW_LOADER",(function(){return x})),n.d(t,"SET_TOOLTIP",(function(){return F})),n.d(t,"MANUAL_ADD_PARTICIPANTS",(function(){return G})),n.d(t,"CallType",(function(){return c})),n.d(t,"UIMode",(function(){return u})),n.d(t,"CallStatus",(function(){return d})),n.d(t,"NotificationType",(function(){return l})),n.d(t,"SdkHandType",(function(){return _})),n.d(t,"defaultNotificationLifeSpan",(function(){return $})),n.d(t,"VOLUME_LEVEL_DETECTION",(function(){return W})),n.d(t,"BAD_CONNECTION_DISABLED_CAMERA_LEVEL",(function(){return Q})),n.d(t,"HANGUP_DELAY",(function(){return J})),n.d(t,"CLIENT_ERROR_NOT_AUTHORIZED",(function(){return X})),n.d(t,"SERVER_ERROR_UNKNOWN",(function(){return z})),n.d(t,"SERVER_ERROR_INVALID_REQUEST",(function(){return Z})),n.d(t,"SERVER_ERROR_FLOOD_CONTROL",(function(){return ee})),n.d(t,"SERVER_ERROR_INTERNAL",(function(){return te})),n.d(t,"SERVER_ERROR_OLD_RECEIVER_APP",(function(){return ne})),n.d(t,"SERVER_ERROR_PRIVACY",(function(){return re})),n.d(t,"SERVER_ERROR_BUSY",(function(){return ae})),n.d(t,"POPUP_SETTINGS",(function(){return ie})),n.d(t,"POPUP_EXIT",(function(){return se})),n.d(t,"CallStatReachedType",(function(){return B})),n.d(t,"CallStatResult",(function(){return V})),n.d(t,"CallStatFailReason",(function(){return Y})),n.d(t,"CallStatSource",(function(){return K})),n.d(t,"CallActionEventType",(function(){return q})),n.d(t,"HANGUP_TYPE_BUSY",(function(){return oe})),n.d(t,"HANGUP_TYPE_CALLEE_IS_OFFLINE",(function(){return ce})),n.d(t,"HANGUP_TYPE_CALLER_IS_BLOCKED",(function(){return ue})),n.d(t,"HANGUP_TYPE_CANCELED",(function(){return de})),n.d(t,"HANGUP_TYPE_EXTERNAL_API_ERROR",(function(){return le})),n.d(t,"HANGUP_TYPE_FAILED",(function(){return _e})),n.d(t,"HANGUP_TYPE_HUNGUP",(function(){return ge})),n.d(t,"HANGUP_TYPE_MISSED",(function(){return fe})),n.d(t,"HANGUP_TYPE_NOT_FRIENDS",(function(){return me})),n.d(t,"HANGUP_TYPE_OLD_VERSION",(function(){return pe})),n.d(t,"HANGUP_TYPE_REJECTED",(function(){return he})),n.d(t,"HANGUP_TYPE_REMOVED",(function(){return be})),n.d(t,"HANGUP_TYPE_SERVICE_DISABLED",(function(){return ve})),n.d(t,"HANGUP_TYPE_UNKNOWN_ERROR",(function(){return Oe})),n.d(t,"HANGUP_TYPE_UNSUPPORTED",(function(){return Ee})),function(e){e.BUSY="BUSY",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.CANCELED="CANCELED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.FAILED="FAILED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.NOT_FRIENDS="NOT_FRIENDS",e.OLD_VERSION="OLD_VERSION",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.SERVICE_DISABLED="SERVICE_DISABLED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED"}(r||(r={})),function(e){e[e.DECLINE=0]="DECLINE",e[e.PROCESS=1]="PROCESS",e[e.FATAL=2]="FATAL"}(a||(a={})),function(e){e.MIC_CAMERA_PERMISSION="mic_camera",e.CAMERA_PERMISSION="camera",e.MIC_PERMISSION="mic",e.CAMERA_ACCESS="cameralock",e.MIC_ACCESS="miclock",e.MIC_NOT_FOUND="nomic",e.SCREEN_PERMISSION="screenpermission",e.SCREEN_ACCESS="screenlock"}(i||(i={})),function(e){e[e.HEADER=0]="HEADER",e[e.CALL_ALL_IN_CHAT=1]="CALL_ALL_IN_CHAT",e[e.MEMBERS_MORE=2]="MEMBERS_MORE",e[e.FRIENDS_MORE=3]="FRIENDS_MORE"}(s||(s={})),function(e){e[e.READY=0]="READY",e[e.CALL=1]="CALL",e[e.INCOMING=2]="INCOMING",e[e.JOIN=3]="JOIN",e[e.ERROR=4]="ERROR"}(o||(o={}));var c,u,d,l,_,g="load_peer",f="change_mode",m="call_state",p="remove_user",h="time_start",b="hangup",v="set_chat_info",O="group_call_setup",E="toggle_popup",T="update_hash",C="change_ui_mode",A="set_orator",I="toggle_orator_mode",y="toggle_participants_aside",j="set_pinned_participant",S="management",L="call_notification",M="join",P="error",N="change_participant_state",k="set_screen_sharer",R="set_friends",D="set_speakers",w="update_participants_batch",U="set_unread_count",H="show_caution_box",x="show_loader",F="set_tooltip",G="manual_add_participants";!function(e){e.AUDIO="audio",e.VIDEO="video"}(c||(c={})),function(e){e.DEFAULT="default",e.COLLAPSED="collapsed",e.FULLSCREEN="fullscreen"}(u||(u={})),function(e){e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(d||(d={})),function(e){e.SPEAKING_ON_MUTE="SPEAKING_ON_MUTE",e.RAISED_HAND="RAISED_HAND",e.SCREEN_SHARING_STARTED="SCREEN_SHARING_STARTED",e.BAD_NETWORK_CONNECTION="BAD_NETWORK_CONNECTION",e.BAD_NETWORK_CONNECTION_DISABLE_CAMERA="BAD_NETWORK_CONNECTION_DISABLE_CAMERA"}(l||(l={})),function(e){e.LOWERED="0",e.RAISED="1"}(_||(_={}));var B,V,Y,K,q,$=5e3,W=.25,Q=3,J=2,X=-1,z=1,Z=8,ee=9,te=10,ne=923,re=928,ae=948,ie="settings",se="exit";!function(e){e.AUDIO="ok_audio",e.AUDIO_TO_VIDEO="ok_video",e.VIDEO="ok_started_as_video",e.GROUP_AUDIO="group_audio",e.GROUP_AUDIO_TO_VIDEO="group_video",e.GROUP_VIDEO="group_started_as_video"}(B||(B={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(V||(V={})),function(e){e.REMOTE_NO_CONNECT="push_not_delivered",e.REMOTE_FAILED_ACCEPT="cant_connect",e.REMOTE_DECLINE="declined_remote",e.LOCAL_DECLINE="declined_local",e.REMOTE_TIMEOUT="declined_timeout",e.REMOTE_BUSY="busy",e.CONNECTION_LOST="lost_connection"}(Y||(Y={})),function(e){e.CONVO_HEADER="im_header",e.CONVO_SNIPPET="im_message",e.CONVO_LIST="im_create",e.CONVO_JOIN_SNIPPET="im_join_message",e.CONVO_JOIN_HEADER="im_join_header",e.CONVO_JOIN_BANNER="im_join_header",e.LINK_JOIN_SNIPPET="join_deeplink",e.LINK_JOIN_PAGE="join_deeplink"}(K||(K={})),function(e){e.OUTGOING_CALL_STARTED_VIDEO="OutgoingCallStartedVideo",e.OUTGOING_CALL_STARTED_AUDIO="OutgoingCallStartedAudio",e.OUTGOING_CALL_ADD_PARTICIPANTS_SENT="OutgoingCallAddParticipantsSent",e.OUTGOING_CALL_REMOTE_RINGING="OutgoingCallRemoteRinging",e.OUTGOING_CALL_ACCEPTED_REMOTELY="OutgoingCallAcceptedRemotely",e.OUTGOING_CALL_FAILED="OutgoingCallFailed",e.OUTGOING_CALL_COMPLETED="OutgoingCallCompleted",e.INCOMING_CALL_RECEIVED="IncomingCallReceived",e.INCOMING_CALL_ACCEPTED="IncomingCallAccepted",e.CALL_DECLINED_OR_HANGED_LOCALLY="CallDeclinedOrHangedLocally",e.CALL_DECLINED_OR_HANGED_REMOTELY="CallDeclinedOrHangedRemotely",e.CALL_CONNECTED="CallConnected",e.CALL_DISCONNECTED="CallDisconnected",e.VIDEO_ENABLED="VideoEnabled",e.VIDEO_DISABLED="VideoDisabled",e.RELAY_CONNECTION_ESTABLISHED="RelayConnectionEstablished",e.USER_FEEDBACK_RECEIVED="UserFeedbackReceived",e.SYSTEM_STAT="SystemStat",e.GROUP_CALL_JOINED="GroupCallJoined",e.HAND_RAISED="HandRaised",e.HAND_LOWERED="HandLowered",e.SCREEN_SHARING_STARTED="ScreenSharingStarted",e.SCREEN_SHARING_STOPPED="ScreenSharingStopped",e.ALL_MICS_DISABLED="AllMicsDisabled",e.MIC_OFF_WHILE_TALKING_ALERT="MicOffWhileTalkingAlert",e.MIC_OFF_WHILE_TALKING_ENABLE_CLICK="MicOffWhileTalkingEnableClick",e.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT="VideoDisabledDueToBadConnectionAlert"}(q||(q={}));var oe=r.BUSY,ce=r.CALLEE_IS_OFFLINE,ue=r.CALLER_IS_BLOCKED,de=r.CANCELED,le=r.EXTERNAL_API_ERROR,_e=r.FAILED,ge=r.HUNGUP,fe=r.MISSED,me=r.NOT_FRIENDS,pe=r.OLD_VERSION,he=r.REJECTED,be=r.REMOVED,ve=r.SERVICE_DISABLED,Oe=r.UNKNOWN_ERROR,Ee=r.UNSUPPORTED},"86+7":function(e,t,n){"use strict";n.r(t),n.d(t,"oCacheExists",(function(){return a})),n.d(t,"oCacheGet",(function(){return i})),n.d(t,"oCacheAdd",(function(){return s}));n("KKXr");var r=n("aong");function a(e,t){return t in Object(r.unpackStore)(e).oCache}function i(e,t){var n=Object(r.unpackStore)(e).oCache[t];return n&&!n._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(n),n._n=1),n}function s(e,t){var n=Object(r.unpackStore)(e);n.oCache||(n.oCache={}),t.id&&(n.oCache[t.id]=t)}},BxOC:function(e,t,n){"use strict";n.r(t),n.d(t,"post",(function(){return a})),n.d(t,"plainget",(function(){return i})),n.d(t,"plaingetCancelable",(function(){return s}));n("VRzm"),n("Btvt");var r=n("cGUQ");function a(e,t,n){return t&&(t.im_v=3),new Promise((r,a)=>{ajax.post(e,t,{timeout:n,onDone(){r.apply(null,[[...arguments]])},onFail(){return a.apply(null,arguments),!0}})})}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s(e,t,n),a=r.request;return a}function s(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function i(){n.abort()}n=window.XDomainRequest?new XDomainRequest:ajax._getreq();var s=new Promise((i,s)=>{var o,c=Date.now(),u=a.timeout||60,d=Object(r.toQueryString)(t);if(window.XDomainRequest)n.open("get",`${e}?${d}`),n.ontimeout=function(e){s([e,{}])},n.onerror=function(e){s([e,{}])},n.onload=function(){i([n.responseText,{}])},setTimeout((function(){n.send()}),0);else{n.onreadystatechange=function(){4==n.readyState&&(clearInterval(o),n.status>=200&&n.status<300?i([n.responseText,n]):s([n.responseText,n]))};try{n.open("GET",`${e}?${d}`,!0)}catch(e){return s([e,n])}n.send()}o=setInterval((function(){Date.now()-c>1e3*u&&(window.browser.safari&&n.abort(),s(["",{}]),clearInterval(o))}),1e3)});return{request:s,cancel:i}}},ERyv:function(e,t,n){"use strict";n.r(t),n.d(t,"isWeirdLogging",(function(){return u})),n.d(t,"imWeirdLog",(function(){return d})),n.d(t,"imWeirdCatch",(function(){return l})),n.d(t,"startLoggingAllUnhandled",(function(){return _})),n.d(t,"stopLoggingAllUnhandled",(function(){return g}));n("VRzm"),n("Btvt");var r,a=n("BxOC"),i=n("DM26"),s=1;function o(e,t,n,a,i){if("Script error."!==e){var s=i?i.stack||i.message:null;d("unhandled_error",s?{err:e,stack:s}:{err:e})}r&&r.apply(this,arguments)}function c(e){e.preventDefault()}function u(){return!!window.imwl}function d(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];u()&&(n&&window.console&&(console.error(e,t),console.trace&&console.trace()),Object(i.retryFn)(a.post,3,()=>2)("al_im.php",{act:"a_weird_log",kind:e,data:JSON.stringify(extend({errIdx:s++,ua:navigator.userAgent},t))}))}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,extend({err:t&&t.message||t},n)),Promise.reject(t)}function _(){r=window.onerror,window.onerror=o,window.addEventListener("unhandledrejection",c)}function g(){window.onerror=r,r=void 0,window.removeEventListener("unhandledrejection",c)}},MhhX:function(e,t,n){"use strict";n.r(t),n.d(t,"isUnread",(function(){return i})),n.d(t,"isServiceMsg",(function(){return s})),n.d(t,"isCallMessage",(function(){return o})),n.d(t,"isActiveGroupCallMessage",(function(){return c})),n.d(t,"isOut",(function(){return u})),n.d(t,"hasReply",(function(){return d})),n.d(t,"isGraffiti",(function(){return _})),n.d(t,"isAudioMsg",(function(){return g})),n.d(t,"isSticker",(function(){return f})),n.d(t,"isGift",(function(){return m})),n.d(t,"isMoney",(function(){return p})),n.d(t,"isMoneyRequest",(function(){return h})),n.d(t,"isVKPay",(function(){return b})),n.d(t,"isImportant",(function(){return v})),n.d(t,"getUserId",(function(){return O})),n.d(t,"getAuthorId",(function(){return E})),n.d(t,"getAdminId",(function(){return T})),n.d(t,"wasEdited",(function(){return C})),n.d(t,"isMessageSelected",(function(){return A})),n.d(t,"isCasperMessage",(function(){return I})),n.d(t,"isMessageToBlockedCommunity",(function(){return y})),n.d(t,"hasPrivateStory",(function(){return j})),n.d(t,"isMessageEmpty",(function(){return S})),n.d(t,"getMessageTTL",(function(){return L})),n.d(t,"isExpiredCasperMessage",(function(){return M})),n.d(t,"MARKED_TYPE_MENTIONS",(function(){return P})),n.d(t,"MARKED_TYPE_CASPER",(function(){return N})),n.d(t,"getFromMessageMarkedDataByType",(function(){return k})),n.d(t,"getMentionsFromMessage",(function(){return R})),n.d(t,"hasUserMentions",(function(){return D}));n("OEbY");var r=n("f01n"),a=n("aong");function i(e,t){return"number"!=typeof t.messageId||(u(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function s(e){return e.kludges&&void 0!==e.kludges.source_act}function o(e){return!(!e.kludges||"call"!==e.kludges.attach1_type)}function c(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function u(e){return e.flags&r.FLAG_OUTBOUND}function d(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&r.FLAG_HAS_REPLY&&t}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.attaches[0];return r&&(r.type===t||r.type===n)}function _(e){return l(e,"doc")&&"graffiti"===e.attaches[0].kind}function g(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function f(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function m(e){return l(e,"gift")}function p(e){return l(e,"money_transfer","money_request")}function h(e){return l(e,"money_request")}function b(e){return l(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function v(e){return e.flags&r.FLAG_IMPORTANT}function O(e){return u(e)?vk.id:e.userId}function E(e,t){var n=Object(a.unpackStore)(e);return u(t)?n.id:t.userId}function T(e,t){var n=Object(a.unpackStore)(e);return n.gid&&u(t)?+t.kludges.from_admin||-n.gid:0}function C(e){return e.update_time>0}function A(e,t){return(e.get().selectedMessages||[]).indexOf(t)>=0}function I(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&r.FLAG_DELETE_BY_TTL)}function y(e,t){return!(!e.blocked_community||!u(t))}function j(e){return!(!e||!e.kludges.has_private_story)}function S(e){return e.messageId<=0}function L(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function M(e){return!(!e.kludges||!e.kludges.is_expired)}var P=1,N=2;function k(e,t){var n=e.kludges&&e.kludges.marked_users,r=n&&n.find(e=>e[0]===t);return r?r[1]:void 0}function R(e){if(!e.kludges&&!e.kludges.marked_users)return[];var t=k(e,P);return t?Array.isArray(t)?t:[t]:[]}function D(e,t){if(!e.kludges&&!e.kludges.mentions&&!e.kludges.marked_users)return!1;var n=e.kludges.marked_users?R(e):e.kludges.mentions;return!!n&&n.findIndex(e=>e===t||"all"===e)>-1}},N4ZS:function(e,t,n){"use strict";function r(e){return"https://vk.com/web/away.php?to="+e}function a(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return r})),n.d(t,"wrapAwayIfExternal",(function(){return a}))},O8ze:function(e,t,n){"use strict";n.r(t),n.d(t,"statlogsForwardEvent",(function(){return g})),n.d(t,"statlogsForwardFromCommunityEvent",(function(){return f})),n.d(t,"statlogsCommunityTemplatesClickEvent",(function(){return m})),n.d(t,"statlogsForwardFromChannel",(function(){return p})),n.d(t,"statlogsSendingTime",(function(){return b})),n.d(t,"statlogsSendingTimeStart",(function(){return v})),n.d(t,"statlogsSendingTimeEnd",(function(){return O})),n.d(t,"statlogsSendingError",(function(){return E})),n.d(t,"statlogsSendingQueueLength",(function(){return A})),n.d(t,"statlogsSendingRetry",(function(){return I})),n.d(t,"statlogsBrowserNotificationsUser",(function(){return y})),n.d(t,"statlogsBrowserNotificationsOn",(function(){return j})),n.d(t,"statlogsBrowserNotificationsOff",(function(){return S}));n("pIFo");var r,a=n("1y80"),i=n("Bj12"),s=n("HLtZ"),o=function(){function e(){}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.getBaseEvent=function(){return{id:this.getIntId(),timestamp:this.getCurrentTime()}},e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(i.saveCustomStats)(e):Object(s.logError)(new Error("CustomStatCollector: invalid event."))},e.MAX_INT32=2147483647,e}();!function(e){e.TYPE_DEV_NULL_ITEM="type_dev_null_item"}(r||(r={}));var c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u=function(){function e(e){this.customStatCollector=e}return e.prototype.logEvent=function(e){var t,n=c(c({},this.customStatCollector.getBaseEvent()),((t={type:r.TYPE_DEV_NULL_ITEM})[r.TYPE_DEV_NULL_ITEM]=e,t));this.customStatCollector.logEvent(n)},e}(),d=n("aong"),l=new u(new o),_={};function g(e){Object(a.statlogsProbValueEvent)(.1,"im_forward_stat",h(e),!!e.get().gid)}function f(e,t){Object(a.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",h(e),!!e.get().gid,+t)}function m(){Object(a.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function p(){Object(a.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function h(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function b(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=1;if(!Object(a.randEnabled)(s))return()=>{};var o=+new Date,c=T(e),u=C(e)?"sse":"longpoll";return function(){var e=+new Date-o;Object(i.saveStatlogEvents)({name:"messages_send_time_web",value:e,keys:[t,n,c,r,u]}),"opt_to_lp"===n&&l.logEvent({key:"messages_send_time_web",value_str:u,value:e})}}function v(e,t,n,r){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var a=[t.messageId.replace("rid",""),n,r].join("_"),i=t.attaches.length>0;_[a]=b(e,n,r,i)}}function O(e,t,n,r){var a=[t.randomId,n,r].join("_"),i=_[a];i&&(i(),delete _[a])}function E(e,t,n,r){var i=T(e),s=""===t?"network":"unknown";Object(a.randEnabled)(1)&&Object(a.statlogsValueEvent)("messages_send_errors_web",s,n,r,i)}function T(e){var t=Object(d.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function C(e){var t=Object(d.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isSSE)}function A(e){var t=Object(d.unpackStore)(e),n=t.imQueue(t.peer).length;Object(a.randEnabled)(1)&&Object(a.statlogsValueEvent)("messages_send_queue_size",n)}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=1;Object(a.randEnabled)(n)&&Object(a.statlogsValueEvent)("messages_send_retry",1,t,e)}function y(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(a.statlogsValueEvent)(e,1))}function j(){Object(a.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)}function S(){Object(a.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}},P13b:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return s.getFirstUnread})),n.d(t,"isSearchShown",(function(){return s.isSearchShown})),n.d(t,"getPeer",(function(){return s.getPeer})),n.d(t,"getCurrentKeyboard",(function(){return s.getCurrentKeyboard})),n.d(t,"getKeyboard",(function(){return s.getKeyboard})),n.d(t,"getTab",(function(){return s.getTab})),n.d(t,"getCurrentTab",(function(){return s.getCurrentTab})),n.d(t,"getSelectedMessages",(function(){return s.getSelectedMessages})),n.d(t,"getMessageRangeFromSelection",(function(){return s.getMessageRangeFromSelection})),n.d(t,"countUnread",(function(){return s.countUnread})),n.d(t,"getMessageByRid",(function(){return s.getMessageByRid})),n.d(t,"isRidExist",(function(){return s.isRidExist})),n.d(t,"getLocalId",(function(){return s.getLocalId})),n.d(t,"getLastMessage",(function(){return s.getLastMessage})),n.d(t,"parserMessage",(function(){return s.parserMessage})),n.d(t,"getAuthorFullName",(function(){return s.getAuthorFullName})),n.d(t,"getMessage",(function(){return s.getMessage})),n.d(t,"getPreviousMessage",(function(){return s.getPreviousMessage})),n.d(t,"isClassicInterface",(function(){return s.isClassicInterface})),n.d(t,"isLocksAvailable",(function(){return s.isLocksAvailable})),n.d(t,"isFoldersAvailable",(function(){return s.isFoldersAvailable})),n.d(t,"isCommunityInterface",(function(){return s.isCommunityInterface})),n.d(t,"isChannelPeer",(function(){return s.isChannelPeer})),n.d(t,"getBareTab",(function(){return s.getBareTab})),n.d(t,"isReversedDialogs",(function(){return s.isReversedDialogs})),n.d(t,"isFullyLoadedTab",(function(){return s.isFullyLoadedTab})),n.d(t,"makeTabNotFullyLoaded",(function(){return s.makeTabNotFullyLoaded})),n.d(t,"isGoToEndVisible",(function(){return s.isGoToEndVisible})),n.d(t,"isGoToMentionVisible",(function(){return s.isGoToMentionVisible})),n.d(t,"getUnreadScrollBottom",(function(){return s.getUnreadScrollBottom})),n.d(t,"isSendingAvailable",(function(){return s.isSendingAvailable})),n.d(t,"isCommunityPeer",(function(){return s.isCommunityPeer})),n.d(t,"isCommunityBlocked",(function(){return s.isCommunityBlocked})),n.d(t,"checkVoiceMessageAvailable",(function(){return s.checkVoiceMessageAvailable})),n.d(t,"isSearching",(function(){return s.isSearching})),n.d(t,"getSearchText",(function(){return s.getSearchText})),n.d(t,"isSearchingValue",(function(){return s.isSearchingValue})),n.d(t,"isRecentSearchesActive",(function(){return s.isRecentSearchesActive})),n.d(t,"getPinnedMessage",(function(){return s.getPinnedMessage})),n.d(t,"doPopularSuggExist",(function(){return s.doPopularSuggExist})),n.d(t,"isAnyMessageBeingEdited",(function(){return s.isAnyMessageBeingEdited})),n.d(t,"getGroupId",(function(){return s.getGroupId})),n.d(t,"getTabDraft",(function(){return s.getTabDraft})),n.d(t,"getTemplates",(function(){return s.getTemplates})),n.d(t,"tabIsMessageRequest",(function(){return s.tabIsMessageRequest})),n.d(t,"tabIsRejectedMessageRequest",(function(){return s.tabIsRejectedMessageRequest})),n.d(t,"tabIsMessageRequestToChat",(function(){return s.tabIsMessageRequestToChat})),n.d(t,"removeMessageRequestFolderFlags",(function(){return s.removeMessageRequestFolderFlags})),n.d(t,"isMessageRequestFolder",(function(){return s.isMessageRequestFolder})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return s.tabIsOutgoingMessageRequest})),n.d(t,"existsIncomingMessageRequest",(function(){return s.existsIncomingMessageRequest})),n.d(t,"isMessageRequestChangedEvent",(function(){return s.isMessageRequestChangedEvent})),n.d(t,"isCommunityChat",(function(){return s.isCommunityChat})),n.d(t,"isCommunityChatDeleted",(function(){return s.isCommunityChatDeleted})),n.d(t,"isClosedChat",(function(){return s.isClosedChat})),n.d(t,"isCasperChat",(function(){return s.isCasperChat})),n.d(t,"isServiceChatTab",(function(){return s.isServiceChatTab})),n.d(t,"isCasperChatTab",(function(){return s.isCasperChatTab})),n.d(t,"isChatActive",(function(){return s.isChatActive})),n.d(t,"isTabMarkedUnread",(function(){return s.isTabMarkedUnread})),n.d(t,"SENDING_CLASS",(function(){return G})),n.d(t,"FAILED_CLASS",(function(){return B})),n.d(t,"ORIGINAL_CLASS",(function(){return V})),n.d(t,"RESTORE_CLASS",(function(){return Y})),n.d(t,"TYPING_CLASS",(function(){return K})),n.d(t,"MESSAGE_KEYBOARD_BUTTON_CLASS",(function(){return q})),n.d(t,"MESSAGE_STACK_CLASS",(function(){return $})),n.d(t,"MESSAGE_CLASS",(function(){return W})),n.d(t,"CREATE_CHAT_ACTION",(function(){return Q})),n.d(t,"CHAT_TITLE_ACTION",(function(){return J})),n.d(t,"CHAT_INVITE_USER",(function(){return X})),n.d(t,"CHAT_KICK_USER",(function(){return z})),n.d(t,"CHAT_PHOTO_UPDATE",(function(){return Z})),n.d(t,"CHAT_PHOTO_REMOVE",(function(){return ee})),n.d(t,"CHAT_PIN_MESSAGE",(function(){return te})),n.d(t,"CHAT_UNPIN_MESSAGE",(function(){return ne})),n.d(t,"CHAT_INVITE_BY_LINK",(function(){return ae})),n.d(t,"CHAT_SCREENSHOT",(function(){return ie})),n.d(t,"CHAT_GROUP_CALL_STARTED",(function(){return oe})),n.d(t,"CHAT_INVITE_TO_CALL",(function(){return ce})),n.d(t,"CHAT_INVITE_BY_CALL_LINK",(function(){return ue})),n.d(t,"ACCEPTED_MESSAGE_REQUEST",(function(){return de})),n.d(t,"DESELECT_ALL_CLASS",(function(){return le})),n.d(t,"HIDE_TOP_NOTICE_CLASS",(function(){return _e})),n.d(t,"HIDE_ASIDE_NOTICE_CLASS",(function(){return fe})),n.d(t,"HIDE_ASIDE_PROMO_BLOCK_CLASS",(function(){return me})),n.d(t,"INSTALL_VKADMIN_LINK",(function(){return pe})),n.d(t,"CLEAR_RECENT_CLASS",(function(){return he})),n.d(t,"TOGGLE_MR_TAB",(function(){return be})),n.d(t,"MESSAGE_SEARCH_CLASS",(function(){return ve})),n.d(t,"PINNED_CONTAINER_CLASS",(function(){return Oe})),n.d(t,"getClassicChatHeight",(function(){return Ee})),n.d(t,"setClassicChatHeight",(function(){return Te})),n.d(t,"applyInnerHtml",(function(){return Ce})),n.d(t,"compensateHistoryHeightChange",(function(){return Ae})),n.d(t,"renderSticker",(function(){return Ie})),n.d(t,"isAlreadyDeleted",(function(){return ye})),n.d(t,"replaceMessageAttrs",(function(){return je})),n.d(t,"isVoiceMessageAvailable",(function(){return Se})),n.d(t,"getAvailableMicrophones",(function(){return Le})),n.d(t,"renderAttach",(function(){return Me})),n.d(t,"dayFromVal",(function(){return Pe})),n.d(t,"formatPhoneNumber",(function(){return Ne})),n.d(t,"getUserInitials",(function(){return ke})),n.d(t,"prepareContactName",(function(){return Re})),n.d(t,"showInvisibleBar",(function(){return De})),n.d(t,"updateMessageInCache",(function(){return we})),n.d(t,"editAndReplaceMessage",(function(){return Ue})),n.d(t,"setCasperMessageExpiringStatusDOM",(function(){return He})),n.d(t,"renderMessage",(function(){return xe})),n.d(t,"renderMessageMedia",(function(){return Fe})),n.d(t,"ensureDomHasActions",(function(){return Ge})),n.d(t,"secondsToHuman",(function(){return Be})),n.d(t,"renderCallMessage",(function(){return Ve})),n.d(t,"renderCallUserList",(function(){return Ye})),n.d(t,"appendToHistory",(function(){return Ke})),n.d(t,"restoreQueue",(function(){return qe})),n.d(t,"markMessagesAsRead",(function(){return $e})),n.d(t,"replaceAttaches",(function(){return We})),n.d(t,"MSG_NEW",(function(){return Qe})),n.d(t,"MSG_DUPLICATE",(function(){return Je})),n.d(t,"MSG_LOCAL_DUPLICATE",(function(){return Xe})),n.d(t,"getMessageStoreStatus",(function(){return ze})),n.d(t,"isChatPeer",(function(){return d.isChatPeer})),n.d(t,"isUserPeer",(function(){return d.isUserPeer})),n.d(t,"isReservedPeer",(function(){return d.isReservedPeer})),n.d(t,"isContactPeer",(function(){return et})),n.d(t,"isEmailPeer",(function(){return Ze})),n.d(t,"isPeerActive",(function(){return tt})),n.d(t,"isFvkcomgroup",(function(){return nt})),n.d(t,"isTabLoaded",(function(){return rt})),n.d(t,"isTabLoadedWithMessage",(function(){return at})),n.d(t,"parseMessage",(function(){return ot})),n.d(t,"convertPeerToUrl",(function(){return ct})),n.d(t,"unUrlPeer",(function(){return ut})),n.d(t,"simplifyCounter",(function(){return dt})),n.d(t,"chatActions",(function(){return lt})),n.d(t,"renderPhotos",(function(){return ft})),n.d(t,"renderPhotosFromTab",(function(){return mt})),n.d(t,"renderBtnSearchOnlyMessages",(function(){return pt})),n.d(t,"renderMessagesSep",(function(){return ht})),n.d(t,"renderConversationsSep",(function(){return bt})),n.d(t,"renderPopularSuggSep",(function(){return vt})),n.d(t,"renderClearRecent",(function(){return Ot})),n.d(t,"renderPopularSuggestions",(function(){return Et})),n.d(t,"setMessageError",(function(){return Tt})),n.d(t,"startResendMessage",(function(){return Ct})),n.d(t,"removeMessages",(function(){return At})),n.d(t,"removeExpiredMessagesStub",(function(){return It})),n.d(t,"removeStartingFromMessage",(function(){return jt})),n.d(t,"removeMessagesWithRestore",(function(){return St})),n.d(t,"restoreMessage",(function(){return Lt})),n.d(t,"formatTyper",(function(){return Mt})),n.d(t,"loadSummaryActivityType",(function(){return Pt})),n.d(t,"renderEmptySearch",(function(){return kt})),n.d(t,"serviceLink",(function(){return Rt})),n.d(t,"renderServiceMsg",(function(){return Dt})),n.d(t,"addChatPhotoToUpdate",(function(){return wt})),n.d(t,"replaceSpecialSymbols",(function(){return Ut})),n.d(t,"isSelfMessage",(function(){return Ht})),n.d(t,"showVerifiedTooltip",(function(){return xt})),n.d(t,"wrapLoading",(function(){return Ft})),n.d(t,"tabFromIds",(function(){return Gt})),n.d(t,"checkSelectClick",(function(){return Bt})),n.d(t,"renderGoTo",(function(){return Vt})),n.d(t,"showFlushChat",(function(){return Yt})),n.d(t,"showLeaveDialog",(function(){return Kt})),n.d(t,"showUnpinDialog",(function(){return qt})),n.d(t,"showMsgDeleteDialog",(function(){return $t})),n.d(t,"cleanHistory",(function(){return Wt})),n.d(t,"inviteUser",(function(){return Qt})),n.d(t,"toggleMessageRequestsTab",(function(){return Jt})),n.d(t,"showUnreadOnly",(function(){return Xt})),n.d(t,"changeTab",(function(){return zt})),n.d(t,"isImportant",(function(){return Zt})),n.d(t,"isUnrespond",(function(){return en})),n.d(t,"isPeerBlocked",(function(){return tn})),n.d(t,"isPendingForward",(function(){return nn})),n.d(t,"isPeerBlockedByMe",(function(){return rn})),n.d(t,"blockLatencyCompensation",(function(){return an})),n.d(t,"showSpamLayer",(function(){return sn})),n.d(t,"getLastSeenTextInHeader",(function(){return on})),n.d(t,"getLastSeenText",(function(){return cn})),n.d(t,"showBlacklistBoxUser",(function(){return dn})),n.d(t,"showBlacklistBox",(function(){return ln})),n.d(t,"getBaseLink",(function(){return _n})),n.d(t,"showFavvedBox",(function(){return gn})),n.d(t,"isEditableFocused",(function(){return fn})),n.d(t,"updateStar",(function(){return mn})),n.d(t,"removewNewUnreadBarAndMerge",(function(){return pn})),n.d(t,"isMessagesVisible",(function(){return hn})),n.d(t,"hideTopNotice",(function(){return bn})),n.d(t,"hideAsideNotice",(function(){return vn})),n.d(t,"hideAsidePromoBlock",(function(){return On})),n.d(t,"installVKAdminApp",(function(){return En})),n.d(t,"renderShortText",(function(){return Cn})),n.d(t,"attachToText",(function(){return An})),n.d(t,"lockButton",(function(){return In})),n.d(t,"unlockButton",(function(){return yn})),n.d(t,"renderPinnedMessage",(function(){return jn})),n.d(t,"renderPinnedMedia",(function(){return Sn})),n.d(t,"showMessageInfoTooltip",(function(){return Ln})),n.d(t,"showEditTimeTooltip",(function(){return Mn})),n.d(t,"showCasperExpiringTooltip",(function(){return Pn})),n.d(t,"getHistoryTopIndent",(function(){return Nn})),n.d(t,"getPinnedMessageHeight",(function(){return kn})),n.d(t,"boxHandleMessagesLabelsTooltips",(function(){return Rn})),n.d(t,"showPinnedBox",(function(){return Dn})),n.d(t,"isLastMsgDebugEnabled",(function(){return wn})),n.d(t,"showDebugAlert",(function(){return Un})),n.d(t,"showRepliedBox",(function(){return Hn})),n.d(t,"isUserAliveInChat",(function(){return xn})),n.d(t,"getAliveMembersCount",(function(){return Fn})),n.d(t,"normalizeTab",(function(){return Gn})),n.d(t,"normalizeTabsGotFromServer",(function(){return Bn})),n.d(t,"splitMessageToParts",(function(){return Vn})),n.d(t,"isMessageTooLong",(function(){return Yn})),n.d(t,"showInvitationBox",(function(){return Kn})),n.d(t,"showWaitUntilUploadedBox",(function(){return $n})),n.d(t,"canMessageBeDeletedForAll",(function(){return Wn})),n.d(t,"getTopChatMembers",(function(){return Qn})),n.d(t,"getChatMembersByIds",(function(){return Jn})),n.d(t,"getChatMembers",(function(){return Xn})),n.d(t,"formatTimespan",(function(){return zn})),n.d(t,"focusOnMessage",(function(){return Zn})),n.d(t,"getNowEditingMessage",(function(){return er})),n.d(t,"checkMessageRequestsTab",(function(){return tr})),n.d(t,"updateMessageRequestsCounterInDOM",(function(){return nr})),n.d(t,"hideAllBoxes",(function(){return rr})),n.d(t,"getMessageRequestDateText",(function(){return ar})),n.d(t,"canPinMessage",(function(){return ir})),n.d(t,"canForwardMessages",(function(){return sr})),n.d(t,"canMarkImportant",(function(){return or})),n.d(t,"removeExpiredMessageIfNeed",(function(){return cr})),n.d(t,"isPeerCurrentUser",(function(){return ur})),n.d(t,"isGiftOptionAvailableForPeer",(function(){return dr})),n.d(t,"isMoneyOptionAvailableForPeer",(function(){return lr})),n.d(t,"replaceExpiredMessageWithPlaceholder",(function(){return _r})),n.d(t,"replaceExpiredRepliedMessageWithPlaceholder",(function(){return pr})),n.d(t,"getChatMemberCount",(function(){return hr})),n.d(t,"CALL_ENTRY_POINT_SNIPPET",(function(){return br})),n.d(t,"CALL_ENTRY_POINT_HEADER",(function(){return vr})),n.d(t,"CALL_ENTRY_POINT_LIST",(function(){return Or})),n.d(t,"CALL_ENTRY_POINT_JOIN_SNIPPET",(function(){return Er})),n.d(t,"CALL_ENTRY_POINT_JOIN_HEADER",(function(){return Tr})),n.d(t,"CALL_ENTRY_POINT_JOIN_BANNER",(function(){return Cr})),n.d(t,"startCallFromIm",(function(){return Ar})),n.d(t,"handleCallLinkClick",(function(){return Ir})),n.d(t,"isCallToPeerAvailable",(function(){return yr})),n.d(t,"joinCallFromIm",(function(){return jr})),n.d(t,"getConvoLocation",(function(){return Sr})),n.d(t,"showGroupCallsOnboardingBox",(function(){return Lr}));n("rE2o"),n("ioFf"),n("HEwt"),n("Vd3H"),n("a1Th"),n("91GP"),n("rGqo"),n("pIFo"),n("SRfc"),n("KKXr"),n("VRzm"),n("Btvt");var r=n("f01n"),a=n("h++7"),i=n("bIHZ"),s=n("rHUl"),o=n("MhhX"),c=n("S2bU"),u=n("jE6c"),d=n("rudk"),l=n("ZxpX"),_=n("yqpO"),g=n("FWc3"),f=n("EasH"),m=n("Egk5"),p=n("1BRX"),h=n("v+DW"),b=n("vT4u"),v=n("ofcU");function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function C(e,t,n){var a=Object(v.createModule)({handlers:(a,i)=>{i(e,"click","_im_join_chat",e=>function(e,t){var n=domData(t,"chat-id"),a=domData(t,"hash"),i=domData(t,"chat-link");return Object(h.lockButton)(t),Object(b.joinChat)(n,a,i,e.get()).then(n=>{var a=O(n,1)[0];Object(h.unlockButton)(t);var i=e.get();i.longpoll.push([Object(r.changePeer)(a)]),i.onJoinChat&&i.onJoinChat(a)}).catch(e=>{Object(f.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(h.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_accept_mr",e=>function(e,t){var n=T(t);return Object(h.lockButton)(t),e.set(b.acceptMessageRequest.bind(null,n)).then(()=>{Object(h.unlockButton)(t),e.get().longpoll.push([Object(r.changePeer)(n)])}).catch(e=>{rr(),Object(f.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(h.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_reject_mr",e=>function(e,t,n){var r=T(n);return Object(h.lockButton)(n),e.set(b.rejectMessageRequest.bind(null,r)).then(()=>{t.updateMenu(),t.updateList(),Object(h.unlockButton)(n),rr()}).catch(e=>{rr(),Object(f.showFastBox)(getLang("mail_error"),e),Object(h.unlockButton)(n)})}(t,n,e.target))}});return{unmount(){Object(v.destroyModule)(a)}}}var A=n("83Q7"),I=n("aong"),y=n("86+7"),j=n("Wu9C"),S=n("wSs/"),L=n("ERyv"),M=n("lJdi"),P=n("t7n3");var N=n("/eGY"),k=n("ambf"),R=n("Syd7"),D=n("nAFc"),w=n("S6+Z"),U=n("zxIV");function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var G="_im_mess_sending",B="_im_mess_failed",V="_im_mess_original",Y="_im_mess_restore",K="_im_typing",q="_im_mess_btn",$="_im_mess_stack",W="_im_mess",Q="chat_create",J="chat_title_update",X="chat_invite_user",z="chat_kick_user",Z="chat_photo_update",ee="chat_photo_remove",te="chat_pin_message",ne="chat_unpin_message",ae="chat_invite_user_by_link",ie="chat_screenshot",oe="chat_group_call_started",ce="chat_invite_user_by_call",ue="chat_invite_user_by_call_join_link",de="accepted_message_request",le="_im_deselect_all",_e="_im_top_notice_hide",fe="_im_aside_notice_hide",me="_im_aside_promo_block_hide",pe="_im_vkadmin_promo_link",he="_im_clear_recent",be="_im_toggle_mr_tab",ve="_im_mess_search",Oe="_im_pinned";function Ee(){return ls.get("chatPosition")||0}function Te(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function Ce(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function Ae(e,t,n,r){var a=t&&!n?1:!t&&n?-1:0;a&&!Object(s.isClassicInterface)(e)&&r().compensateHistoryHeightChange(a)}function Ie(e,t,n,r){var a=window.devicePixelRatio>=2?"256":"128",i="animation"===n,s="im_gift";i&&(s+=" sticker_img");var o=`<img height="128" class="${s}" src="${Stickers.getStickerUrl(intval(e),a)}"/>`;if(i){var c="animatedSticker"+r;o=`<div id="${c}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${r}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${o}</div>`;var u=!1;browser.msie?(0^r)===r&&(u=!0):u=Number.isInteger(r),u&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(c,10)}return t&&(o=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${o}</a>`),o=`<div class="im_sticker_row">${o}</div>`}function ye(e,t,n){var r=e.get?e.get():e;if(rt(r,t)){var a=r.tabs[t].deleted||[];return inArray(n,a)}return!1}function je(e,t,n){var r=n.randomId,a=geByClass1("_im_mess_rid"+r,t);return a&&(t=Ke(e,n,t=yt([a],t),!0,!1)),t}function Se(e){var t=Object(s.checkVoiceMessageAvailable)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):Le().then(e=>e.length>0).catch(e=>!1)}function Le(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0;n<e.length;n++)"audioinput"==e[n].kind&&t.push(e[n]);return t})):Promise.reject(new Error("NotSupported"))}function Me(e){return Object(P.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function Pe(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function Ne(e){var t=(""+e).replace(/\D/g,"").match(/^(\d+)(\d{3})(\d{3})(\d{2})(\d{2})$/);return t?`+${t[1]} (${t[2]}) ${t[3]}-${t[4]}-${t[5]}`:""}function ke(e){var t=Object(D.decodeHTMLEntities)(e),n=Object(w.emojiRegex)().exec(t);return n?0===n.index?Object(_.emojiReplace)(n[0]):t[0]:t.split(/\s/).reduce((e,t)=>e+t.slice(0,1),"").slice(0,2)}function Re(e){var t=Object(u.replaceEntities)(e);return Object(_.emojiToHTML)(Object(P.clean)(t),!0)}function De(e){var t=geByClass1("_im_invisible_bar",e);t&&(removeClass(t,"_im_invisible_bar"),removeClass(t,"im-page--history-new-bar_hide"))}function we(e,t,n){var r=domData(n,"msgid"),a=geByClass1("_im_mess_"+r,t),i=n.cloneNode(!0);return a&&(a.parentNode.replaceChild(i,a),Ge(t)),t}function Ue(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){var a=se(xe(e,t));r.classList.contains("im-mess_is_editing")&&a.classList.add("im-mess_is_editing"),r.parentNode.replaceChild(a,r),Ge(n)}return n}function He(e,t,n){var r=geByClass1("_im_mess_"+n,e);if(r){var a=r.closest("._im_mess_stack"),i=a&&a.querySelector(".im-mess-stack--bomb");i&&i.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function xe(e,t){var n=[],r=Object(o.isUnread)(e.tabs[t.peerId],t),a=Object(o.isCallMessage)(t)||Object(o.isActiveGroupCallMessage)(t),i=Object(s.getPinnedMessage)(e),u=Object(o.hasReply)(t)?Object(P.getTemplate)("im_message_media",{type:"reply",messageId:t.messageId,attaches:Me("reply"),text:""}):"";a||n.push("_im_mess"),Object(o.isOut)(t)&&r&&!a&&n.push("im-mess_unread _im_mess_unread"),Object(o.isOut)(t)&&!a&&n.push("im-mess_out"),Object(o.wasEdited)(t)&&n.push("im-mess_was_edited"),Object(S.canMessageBeEdited)(e,t)&&n.push("im-mess_editable"),Object(o.isImportant)(t)&&n.push("im-mess_fav"),-1!==(e.selectedMessages||[]).indexOf(t.messageId)&&n.push("im-mess_selected"),i&&i.messageId===t.messageId&&n.push("_im_mess_pinned");var l=Date.now()-1e3*t.date>1e3;t.local&&l&&n.push("im-mess_sending"),t.local&&n.push(""+G),t.local&&Object(o.wasEdited)(t)&&!r&&n.push("im-mess_unread im-mess_nobg"),t.failed&&n.push("im-mess_failed "+B),Object(o.isGift)(t)&&n.push("im-mess_gift"),a&&n.push("_im_mess_callsnippet"),Object(o.isCasperMessage)(t)&&n.push("im-mess_casper");var _=Fe(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons;return[].concat(Object(P.getTemplate)("sImMessageKeyboard",{content:t.map(e=>Object(P.getTemplate)("sImMessageKeyboardRow",{content:e.map(e=>Object(P.getTemplate)("sImMessageKeyboardButton",{label:Object(N.getButtonLabel)(e),appearance:Object(N.getButtonAppearance)(e),type:e.action.type,modifier:e.action.type.replace("_","-"),attributes:Object(N.getAttributesFromActionObject)(e.action),tagName:e.action.type===N.BUTTON_TYPE_OPEN_LINK?"a":"button"})).join("")})).join("")}))}return[]}(t)),g=function(e,t){var n="",r=Object(I.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(o.wasEdited)(t)&&(n+=Object(P.getTemplate)("sImLblWasEdited",{update_time:t.update_time}));if(Object(s.isCommunityInterface)(e)&&r){var a=t.kludges.ref_source,i={};try{(i=JSON.parse(Object(P.unclean)(a))).link&&i.info&&(i.link=Object(c.replaceHyperLinks)(Object(P.clean)(i.link),c.linksReplacer.bind(null,!1)),i=Object(P.clean)(langStr(getLang("mail_source_info"),"link",i.link,"info",Object(P.clean)(i.info))),n+=Object(P.getTemplate)("sImLblWasSourceInfo",{source:i}))}catch(e){}}return n}(e,t),f=u+ot(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(d.isChatPeer)(t.peerId)&&(f=Object(P.getTemplate)("im_topic",{topic:t.subject})+f);var m=Object(o.isGift)(t)?`<div class="im-mess--gift-lbl">${f}</div>`:"",p=_.length>0?Object(P.getTemplate)("im_message_media",{type:"media",messageId:t.messageId,attaches:_.join(""),text:m}):"";if(Object(o.isGift)(t)||(p=f+p),Object(o.isCallMessage)(t)){var h=Ve(t,!1,!0,e);p+=Object(P.getTemplate)("sImCallSnippet",h)}return p+=g,Object(P.getTemplate)("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${getLang("mail_send_message_error")}" role="link"`:"",unread_params:r?`aria-label="${getLang("mail_unread_message")}"`:"",cls:n.join(" ")}).replace("%text%",()=>p)}function Fe(e){return e.attaches.reduce((t,n)=>!Object(o.hasReply)(e)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?e.messageId?t.push(Ie(n.id,n.productId,n.kind,e.messageId)):t.push(Ie(n.id,n.productId)):t.push(Me(n.type))),t):t,[])}function Ge(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),n=t.length;n--;)hasClass(t[n],"im-mess_fwd")||t[n].insertAdjacentHTML("afterbegin",Object(P.getTemplate)("sImHistoryRowActions")),removeClass(t[n],"_im_mess_noa")}function Be(e){var t=Math.floor(e/3600),n=Math.floor(e/60)-60*t,r=!1,a=!1;return[t,n,e-3600*t-60*n].reduce((e,t)=>{if(0===t&&!a)return a=!0,e;r&&(t=t<10?"0"+t:t);var n=`${e}${""!==e?":":""}${t}`;return r=!0,a=!0,n},"")}function Ve(e,t,n,r){var a=vk.id,i=e.attaches[0],s=i.initiatorId,o=i.state,c=a===s,u=Boolean(e.kludges.attach1_call_video),d=e.kludges.attach1_call_participants&&JSON.parse(e.kludges.attach1_call_participants)||{},l="group_call"===e.kludges.attach1_kind,_={title:"",description:"",modifier:""},g=u?getLang("mail_call_snippet_outgoing_video"):getLang("mail_call_snippet_outgoing"),f=u?getLang("mail_call_snippet_incoming_video"):getLang("mail_call_snippet_incoming");switch(o){case"reached":var m=t?"":Be(i.duration);_.title=c?g:f,_.description=`${getLang("mail_call_snippet_finished")} · ${m}`;break;case"canceled_by_initiator":_=c?{title:g,description:getLang("mail_call_snippet_canceled")}:{title:f,description:getLang("mail_call_snippet_missed")};break;case"canceled_by_receiver":if(c){if(t)return getLang("mail_call_declined");_={title:g,description:getLang("mail_call_snippet_declined")}}else _={title:f,description:getLang("mail_call_snippet_canceled")};break;default:_.title=getLang("mail_added_call")}l&&(_.title=getLang("mail_call_snippet_group"));var p=Object.keys(d);return _.user_list=Ye(r,p),_.button="",_.classes="im-mess--call-snippet CallSnippet--interactive _im-call-snippet",_.attributes=`data-participants="${p.join(",")}"`,_}function Ye(e,t){if(!t.length)return"";var n=t.slice(0,3).reduce((t,n)=>{var r=Object(y.oCacheGet)(e,n);return r&&(t+=Object(P.getTemplate)("sImCallUser",{url:r.photo,name:r.name})),t},"");return Object(P.getTemplate)("sImCallUsers",{users:n})}function Ke(e,t,n){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Date.now()-1e3*t.date>1e3,c=e.tabs[t.peerId];if(!n||geByClass1("_im_mess",n)||geByClass1("_im_bar_date",n)||(n.innerHTML=""),c.skipped>0)return n;var u=[];t.local||(u=e.imQueue(t.peerId,r)),u.length>0&&yt(u.map(e=>geByClass1("_im_mess_rid"+e.rid,n),n).filter(e=>e));var l=xe(e,t),_=domLC(n);hasClass(_,"_im_mess_stack")||(_=domClosestSibling(_,"._im_mess_stack",-1));for(var g=Object(s.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&g&&!geByClass1("_im_mess_"+g.messageId);)g=Object(s.getLastMessage)(e,t.peerId,g.messageId);var f=geByClass1("_im_unread_bar_row",n),m=g?it(g.date,e):0,h=Object(d.isChatPeer)(t.peerId)&&Object(s.isCasperChat)(e,t.peerId);if(!g||st(c,g,t,e,a)){var b="",v=!1;if(f&&Object(o.isOut)(t)&&pn(e,n,t.peerId),1===c.unread&&!Object(o.isOut)(t)&&a&&(b+=Object(P.getTemplate)("im_mess_bar",{}),v=!0,pn(e,n,t.peerId)),!Object(p.isToday)(new Date(m))&&!h){var O=new Date,E=v?"im-page--history-new-bar_hide _im_invisible_bar":"";b+=Object(P.getTemplate)("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,getLang("months_of","raw"),!0),date:t.date,day_class:O.getDate()+O.getMonth()+O.getFullYear()+" "+E})}if(Object(o.isServiceMsg)(t))b+=Object(P.getTemplate)("im_service_row",{text:Dt(e,t,c),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var T=mr(e,t);b+=Object(P.getTemplate)("im_mess_stack",Object.assign(T,{messages:l}))}Object(I.toArray)(sech(b)).forEach(e=>n&&n.appendChild(e))}else f&&e.peer===t.peerId&&!c.inplaceSearch&&Object(o.isOut)(t)&&pn(e,n,t.peerId),geByClass1("_im_stack_messages",_).appendChild(se(l));return Object(o.isOut)(t)&&!i&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,n);hasClass(e,G)&&addClass(e,"im-mess_sending")},500),u=u.filter(e=>e.rid!==t.randomId),Ge(n),qe(u,e,n)}function qe(e,t,n){var r;return(r="object"==typeof e?e:t.imQueue(e,!1)).length>0&&r.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(s.getMessage)(t,e.peerId,e.messageId)).forEach(e=>Ke(t,e,n,!1)),n}function $e(e,t,n){var r=e.tabs[t];return Object(I.toArray)(geByClass("_im_mess_unread",n)).forEach(e=>{var t,n=intval(domData(e,"msgid"));n>0&&r.out_up_to>=n&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),n}function We(e,t,n){var r=t.peerId,a=t.messageId,i=geByClass1("_im_msg_reply"+a,e),s=geByClass1("_im_msg_media"+a,e),o=n.tabs[r].mediacontent[a][0];return i&&(i.innerHTML=o[0]),s&&(s.innerHTML=o[1]),e}var Qe=0,Je=1,Xe=2;function ze(e,t){if(!Object(s.isFullyLoadedTab)(t,e.peerId))return Qe;var n=t.tabs[e.peerId];return n.msgs[e.messageId]?Je:n.msgs["rid"+e.randomId]?Xe:Qe}function Ze(e){return e<-2e9}function et(e){return e>19e8&&e<2e9}function tt(e,t){return e===t.peer}function nt(e,t){return Object(M.doesChatTabHaveFlag)(Object(s.getTab)(e,t),1024)}function rt(e,t){return!!e.tabs[t]}function at(e,t){return!!rt(e,t)&&null!==e.tabs[t].lastmsg}function it(e,t){return 1e3*e+1e3*t.timeshift}function st(e,t,n,r,a){if(Object(o.getUserId)(t)!==Object(o.getUserId)(n))return!0;var i=it(t.date,r),c=it(n.date,r);if(!isSameDate(i,c))return!0;if(Object(s.isCommunityInterface)(r)&&intval(t.kludges.from_admin)!==intval(n.kludges.from_admin))return!0;if(n.date-t.date>300)return!0;if(Object(o.isServiceMsg)(t)||Object(o.isServiceMsg)(n))return!0;var u=Object(o.isCasperMessage)(t),d=Object(o.isCasperMessage)(n);if(u!==d)return!0;var l=t.kludges.is_expired,_=n.kludges.is_expired;return!(!u||!d||l===_)||(!(!u||!d||l||_)||!(u&&d&&l&&_)&&(!(!Object(o.isCallMessage)(n)&&!Object(o.isCallMessage)(t))||(!(!Object(o.isActiveGroupCallMessage)(n)&&!Object(o.isActiveGroupCallMessage)(t))||(!(!Object(o.isGift)(t)&&!Object(o.isGift)(n))||(!(!Object(o.isGraffiti)(t)&&!Object(o.isGraffiti)(n))||(!!Object(o.hasReply)(n)||!(Object(o.isUnread)(e,t)===Object(o.isUnread)(e,n)||!a||Object(o.isOut)(n)||Ht(n.peerId,r.gid))))))))}function ot(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Math.round(1e9*Math.random()).toString(16),o={},u=0;return t=(t=Object(c.replaceHyperLinks)(t||"",c.linksReplacer.bind(null,r))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${u}_${i}!`;return o[t]=e,u++,t}),t=Object(c.replaceMentions)(t),e.isMassMentionsMessageAllowed&&(t=Object(c.replaceMassMentions)(t)),t=Object(c.replaceEmailLinks)(t),t=Object(c.replaceHashtags)(t,t=>{var n=Object(s.getGroupId)(e);return`<a href="/${n?"gim"+n:"im"}?sel=${a||Object(s.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(o).forEach(e=>{t=t.replace(e,()=>o[e])}),n.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function ct(e){return Object(d.isChatPeer)(e)?"c"+(e-2e9):Ze(e)?"e"+Math.abs(e+2e9):et(e)?"mr"+(e-19e8):e}function ut(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function dt(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function lt(e,t){return{[b.CHAT_ACTION_SEARCH]:{name:getLang("mail_im_peer_search"),icon:"search"},[b.CHAT_ACTION_BLOCK_COMMUNITY]:{icon:"block",name:getLang("mail_block_comm_messages")},[b.CHAT_ACTION_BLOCK_NOTIFY]:{icon:"block",name:getLang("mail_block_notify_messages")},[b.CHAT_ACTION_ALLOW_COMMUNITY]:{icon:"unblock",name:getLang("mail_allow_comm_messages")},[b.CHAT_ACTION_CLEAR]:{name:Ze(e.peer)?getLang("mail_im_delete_email_contact"):getLang("mail_im_delete_all_history"),icon:"clear"},[b.CHAT_ACTION_MUTE]:{name:getLang("mail_im_mute"),icon:"mute"},[b.CHAT_ACTION_UNMUTE]:{name:getLang("mail_im_unmute"),icon:"unmute"},[b.CHAT_ACTION_MEDIA]:{name:Object(s.isCommunityInterface)(e)?getLang("mail_im_show_media_history_group"):getLang("mail_im_show_media_history"),icon:"media"},[b.CHAT_ACTION_BLOCK]:{icon:"block",name:getLang("mail_block_user")},[b.CHAT_ACTION_INVITE]:{icon:"invite",name:getLang("mail_im_create_chat_with")},[b.CHAT_ACTION_LEAVE]:{icon:"leave",name:t?getLang("mail_leave_channel"):getLang("mail_leave_chat")},[b.CHAT_ACTION_RETURN]:{icon:"return",name:t?getLang("mail_return_to_vkcomgroup"):getLang("mail_return_to_chat")},[b.CHAT_ACTION_PIN_HIDE]:{icon:"pin_hide",name:getLang("mail_menu_pin_hide")},[b.CHAT_ACTION_PIN_UNHIDE]:{icon:"pin_unhide",name:getLang("mail_menu_pin_show")},[b.CHAT_ACTION_UNPIN]:{icon:"unpin",name:getLang("mail_menu_unpin")},[b.CHAT_ACTION_SETTINGS]:{icon:"settings",name:t?getLang("mail_vkcomgroup_settings"):getLang("mail_settings")},[b.CHAT_ACTION_CALL_AUDIO]:{icon:"call_audio",name:getLang("mail_im_call_audio")},[b.CHAT_ACTION_CALL_VIDEO]:{icon:"call_video",name:getLang("mail_im_call_video")},[b.CHAT_ACTION_UNREAD]:{icon:"unread",name:getLang("mail_menu_mark_unread")}}}function _t(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(n=Object(P.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${n}\n    </div>\n  </div>`}function gt(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(n=Object(P.getTemplate)("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${n}\n    </div>\n  </div>`}function ft(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return`<div class="im_grid"><img src="${e}" alt=""/></div>`;switch(e.length){case 1:return`<div class="im_grid"><img src="${e[0]}" alt=""/></div>`;case 2:return e.map((e,n)=>_t(e,t[n])).join("");case 3:return _t(e[0],t[0])+e.slice(1).map((e,n)=>gt(e,t[n+1])).join("");case 4:return e.map((e,n)=>gt(e,t[n])).join("")}}function mt(e,t,n){if(et(t.peerId))return`<div class="nim-peer--contact-avatar nim-peer--contact-avatar_30">${ke(t.tab)}</div>`;if("string"==typeof t.photo&&t.photo)return`<div class="im_grid"><img src="${t.photo}" alt=""></div>`;if(Object(d.isChatPeer)(t.peerId)&&t.membersCount<2)return`<div class="im_grid"><img src="${e.get().default_chat_photo}" alt=""></div>`;if(Array.isArray(t.photo))return ft(t.photo);var r=t.data.active.slice(0,4).map(y.oCacheGet.bind(null,e)).filter(e=>!!e);return ft(r.map(e=>e.photo),n?[]:r.map(e=>e.link))}function pt(e){var t=e.get().gid?getLang("mail_search_only_messages_comm"):getLang("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${ve}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function ht(){return`<li class="im-search-results-head">${getLang("mail_search_messages")}</li>`}function bt(){return`<li class="im-search-results-head">${getLang("mail_search_conversations_sep")}</li>`}function vt(){return`<li class="im-search-results-head">${getLang("mail_search_dialogs_sep")}</li>`}function Ot(){return`<li class="im-search-results-head _im_recent_bar">\n    ${getLang("mail_recent_searches")}\n    <button type="button" class="${he} im-page--clear-recent">${getLang("mail_clear_recent")}</button>\n  </li>`}function Et(e){var t=e.get().popular_sugg,n=Object(s.isClassicInterface)(e)?8:5;return t.length>n&&(t=t.slice(0,n)),'<li class="im-popular clear_fix">'+t.map(t=>{var n=t.peerId,r=Object(y.oCacheGet)(e,n)||t,a=e.get().tabs[n]||t,i=(e.get().mutedPeers||[]).indexOf(n)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+n,a.unread>0&&"sugg-is_unread",i&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${n}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(a.online)}" href="${r.link}"><img class="im-popular--avatar" src="${r.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${r.link}">${r.first_name||r.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${dt(a.unread)}</span>\n</div>`}).join("")+"</li>"}function Tt(e,t,n){var r=geByClass1("_im_mess_"+t.messageId,n);if(r){attr(r,"aria-hidden","false"),addClass(r,"im-mess_failed "+B);var a=geByClass1("_im_mess_marker",r);attr(a,"aria-label",getLang("mail_send_message_error")),attr(a,"role","link")}return n}function Ct(e,t,n){var r=geByClass1("_im_mess_"+t,n);if(r){removeClass(r,"im-mess_failed"),attr(r,"aria-hidden","true"),removeClass(r,B);var a=geByClass1("_im_mess_marker",r);attr(a,"aria-label",""),attr(a,"role","")}return n}function At(e,t){return yt(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function It(e,t){var n=t||document,r=[];return e.forEach(e=>{var t=n.querySelector("._im_expired_message_"+e);if(t){var a=+t.dataset.count;if(t.dataset.count=a-1,t.classList.remove("_im_expired_message_"+e),1===a)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else r.includes(t)||r.push(t)}}),r.length&&r.forEach(e=>{var t=+e.dataset.count;if(t>0){var n=gr(t),r=se(n);r.classList.add(...e.classList),e.replaceWith(r)}}),t}function yt(e,t){var n=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{hasClass(e,"im-mess_srv")?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode&&e.parentNode.removeChild(e)}),n.filter(e=>0===domChildren(e).length).map(e=>Object(U.gpeByClass)("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function jt(e){for(var t=e;t;){var n=t;if(null===(t=t.previousElementSibling)){hasClass(n,"mess_srv")&&(t=n.parentNode);var r=Object(U.gpeByClass)("_im_mess_stack",n);r&&(t=r.previousElementSibling,1===domChildren(n.parentNode).length&&r.parentNode.removeChild(r))}hasClass(n,"_im_unread_bar_row")||n.parentNode.removeChild(n)}}function St(e,t,n,r){return e.map(e=>geByClass1("_im_mess_"+e,r)).filter(e=>e).forEach(e=>{val(e,function(e,t,n){var r=t.innerHTML;return`<div class="im-mess--text">\n    ${getLang("delete"===n?"mail_deleted_stop":"mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${Y} im-mess--btn">${getLang("mail_restore")}</button>\n    <div class="${V} im-mess--original">${r}</div>\n  </div>`}(t,e,n)),addClass(e,"im-mess_light")}),r}function Lt(e,t,n){var r=geByClass1("_im_mess_"+e,n);if(r){var a=geByClass1(V,r);val(r,a.innerHTML),removeClass(r,"im-mess_light")}return n}function Mt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i)return Nt(e,t,n,r,!0,a);var s=60,o=Nt(e,t,n,r,!1,a);return o.length>s?Nt(e,t,n,r,!0,a):o}function Pt(e){var t={[b.ACTIVITY_TYPE_TYPING]:1,[b.ACTIVITY_TYPE_RECORDING_AUDIO]:2},n=Object.keys(e).sort((e,n)=>t[n]-t[e]),r={},a=n.reduce((t,n)=>{var a=(e[n]||{}).userIds;return(void 0===a?[]:a).forEach(e=>{r[e]||(r[e]=!0,t[n]=!0)}),t},{}),i=n.filter(e=>!!a[e]);return i.length>1?"":i[0]}function Nt(e,t,n,r,a,i){var o=function(e,t,n){var r=[],a={};return Object.keys(t).map(n=>{((t[n]||{}).userIds||[]).forEach(t=>{Object(y.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(a[t]=n):r.push(t)})}),r.length&&Object(b.loadChatMember)({[n]:r},e),Object.keys(a).sort((e,n)=>t[a[e]].ts-t[a[n]].ts)}(r,e,t);if(0===o.length)return"";var c=Object(d.isUserPeer)(t)||Object(s.isCommunityPeer)(t)?"first_name":a?"short_name":"name",u=Pt(e),l="";u===b.ACTIVITY_TYPE_RECORDING_AUDIO?l=getLang("mail_recording_audio_several",o.length):u===b.ACTIVITY_TYPE_TYPING&&(l=getLang("mail_typing_several",o.length));var _=o.slice(0,Math.min(o.length-1,i)),g=_.map(e=>Object(y.oCacheGet)(r,e)[c]).join(", ");if(o.length>i+1){var f=function(e){var t={};return Object.keys(e).forEach(n=>{var r=e[n].userIds;(void 0===r?[]:r).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);g+=" "+getLang("mail_and_peer").replace("{count}",f-i).replace("{typing}",l)}else{if(o.length>1&&(g+=" "+getLang("mail_and_peer_one")),!Object(d.isChatPeer)(t)&&n)g+=" "+l;else g+=` ${Object(y.oCacheGet)(r,o[_.length])[c]} ${l}`}return g.trim()}function kt(){return`<div class="im-page--chat-search-empty">\n    ${getLang("mail_im_search_empty")}\n  </div>`}function Rt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n?`<a class="im_srv_lnk ${r}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${r}">${t}</span>`}function Dt(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.kludges,i=a.source_act,s=intval(a.source_mid),o=intval(Object(d.isChatPeer)(n.peerId)?a.from:t.userId),c=o===s,u=Object(y.oCacheGet)(e,o),l="";switch(i){case Q:l="mail_im_chat_created";break;case J:l=a.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case X:l=c?"mail_im_returned_to_chat":"mail_im_invited";break;case z:l=c?"mail_im_left":"mail_im_kicked_from_chat";break;case Z:l="mail_im_photo_set";break;case ee:l=a.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case te:l=a.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case ne:l=a.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case ae:l="mail_im_invite_by_link";break;case ie:l=Object(I.unpackStore)(e).id===s?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;case oe:l="mail_im_start_group_call";break;case ce:l="mail_im_invited_to_call";break;case ue:l="mail_im_invite_by_call_link";break;case de:l=u.contact_name?"mail_im_accepted_message_request":"mail_im_accepted_message_request_no_name";break;default:return"mail_no_support"}if(l=(l=(l=langSex(u.sex,getLang(l,"raw"))).replace("{from}",Rt(u.link,u.name,r))).replace("{contact}",u.contact_name),s&&!c){var _=a.source_email;if(_)l=l.replace("{user}",Rt("/im?email="+encodeURIComponent(_),"email",r));else{var g=Object(y.oCacheGet)(e,s),f=i===z?g.inv_name:g.kick_name;l=l.replace("{user}",Rt(g.link,f,r))}}if(a.source_text){var m=a.source_old_text?`«<b class="im_srv_lnk">${a.source_old_text}</b>» &rarr; `:"";l=l.replace("{title}",m+`«<b class="im_srv_lnk">${a.source_text}</b>»`)}if(a.source_act===te||a.source_act===ne)if(a.source_message){var p=Ut(Emoji.emojiToHTML(stripHTML(a.source_message.replace(/<br\s?\/?>/gi," ")),!0)),h=Rt("",p,!1,"im_srv_mess_link");l=l.replace("{msg}",h)}else l=l.replace(/{link}(.+){\/link}/i,(e,t)=>Rt("",t,!1,"im_srv_mess_link"));return l}function wt(e,t,n,r){if(t===Z){var a=geByClass1("_im_mess_"+e.messageId,r);if(a){var i=n.tabs[e.peerId];a.parentNode.innerHTML=Object(P.getTemplate)("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:Dt(n,e,i)+n.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return r}function Ut(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(a.MENTION_RAW,"$1$4")}function Ht(e,t){return!t&&e===vk.id}function xt(e,t){return Object(g.showTooltip)(e,{url:Object(s.isCommunityPeer)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function Ft(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=se(Object(P.getTemplate)("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===n?"im-preloader_bottom":"im-preloader_top",r].join(" ")})),i=!1;function s(){i=!0,removeClass(a,"im-preloader_visible"),a.parentNode&&a.parentNode.removeChild(a)}setTimeout(()=>{i||("bottom"===n?e.appendChild(a):e.insertBefore(a,domFC(e)),addClass(a,"im-preloader_visible"))},0),t.then(s).catch(e=>{Object(L.imWeirdCatch)("wrapLoading",e),s()})}}function Gt(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,r.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Bt(e,t){if(!t&&!e)return!1;var n=e.target||e.srcElement,r=8,a=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!n||n.onclick||n.onmousedown||"A"==n.tagName||hasClass(n,"_im_no_select")||hasClass(n,"im_msg_media_link")||"IMG"==n.tagName&&!hasClass(n,"_im_graffiti")&&!hasClass(n,"emoji")&&!hasClass(n,"emoji_css")&&!hasClass(n,"im_gift")||"TEXTAREA"==n.tagName||hasClass(n,"play_new")||hasClass(n,"videoplayer")||(a=i.test(n.className)))break}while(r--&&(n=n.parentNode));return!a||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Vt(e,t){return`<div class="im-mess--text">\n      <span>${getLang("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${ct(e)}&msgid=${t}">${getLang("mail_im_goto_conversation")}</a>\n    </div>`}function Yt(e,t,n){var r=getLang("mail_deleteall1"),a=getLang("mail_sure_to_delete_all"),i=getLang("mail_delete");return Object(d.isChatPeer)(t)&&(Object(M.doesChatTabHaveFlag)(e,1024)?(r=getLang("mail_leave_channel"),a=getLang("mail_unfollow_channel_confirmation"),i=getLang("mail_unfollow_channel")):a=getLang("mail_chat_sure_to_delete_all")),Object(s.isCommunityPeer)(t)&&(a=getLang("mail_group_sure_to_delete_all")),Object(f.showFastBox)(r,a,i,n,getLang("global_cancel"))}function Kt(e,t,n){var r=Object(s.getTab)(e,t),a=Object(d.isChatPeer)(t),i=a&&Object(s.isChannelPeer)(r),o=a&&Object(s.tabIsMessageRequestToChat)(r),c=getLang("mail_deleteall1"),u=getLang("mail_sure_to_delete_all"),l=getLang("mail_delete");if(a){if(!Object(s.isChatActive)(r))return Yt(r,t,n.bind(null,!0));i?(c=getLang("mail_leave_channel"),u=getLang("mail_vkcomgroup_leave_confirm"),l=getLang("mail_leave_channel")):o?(c=getLang("mail_reject_mr_confirmation_title"),u=getLang("mail_reject_mr_confirmation_text"),l=getLang("mail_message_request_reject")):(c=getLang("mail_leave_chat"),u=getLang("mail_chat_leave_confirm"),l=getLang("mail_leave_chat"))}Object(s.isCommunityPeer)(t)&&(u=getLang("mail_group_sure_to_delete_all"));var _=new MessageBox({title:c,width:i?450:500}).content(u).setButtons(l,()=>n(!!isChecked(geByClass1("_check_is_delete"))||!a),getLang("global_cancel")).show();return!a||i||o||_.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_deleteall1")}</div>`),_}function qt(e){return Object(f.showFastBox)(getLang("mail_unpin_title"),getLang("mail_unpin_text"),getLang("mail_unpin"),e,getLang("global_cancel"))}function $t(e,t,n,r){var a=getLang("mail_dialog_msg_delete_N",t),i=Object(f.showFastBox)(getLang("mail_dialog_msg_delete_title"),a,getLang("mail_delete"),()=>r(isChecked(geByClass1("_check_forall"))),getLang("global_cancel")),s="",o=!1;return n&&(s=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_delete_for_all")}</div>`,o=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(s),o&&checkbox(geByClass1("_check_forall")),i}function Wt(e,t,n,r,a){t.showProgress(),e.set(r.bind(null,a)).then(()=>{t.hideProgress(),t.hide(),n().removePeer(e,a),n().updateDialogFilters(e)})}function Qt(e,t,n,r){var a=e.get().tabs[t].memberIds;e.set(r.bind(null,"add_member",a)).then(n().showCreation)}function Jt(e,t,n){var r=e.get();if(r.active_tab===a.FOLDER_ALL&&0===r.dialog_tab_cts.mr)return!1;var i=r.active_tab===a.FOLDER_MESSAGE_REQUEST?a.FOLDER_ALL:a.FOLDER_MESSAGE_REQUEST;return e.set(n.bind(null,i)).then(e=>{t().restoreDialogs(e,!0)})}function Xt(e,t,n){if(e.get().active_tab===a.FOLDER_ALL&&0===e.get().unread_cnt)return!1;var r=e.get().active_tab===a.FOLDER_UNREAD?a.FOLDER_ALL:a.FOLDER_UNREAD;return e.set(n.bind(null,r)).then(e=>{t().restoreDialogs(e,!0)})}function zt(e,t,n,r){if(t.get().active_tab===e)return Promise.resolve(t);var a=Object(s.isReversedDialogs)(t);return t.set(r.bind(null,e)).then(e=>(n().restoreDialogs(e,!0,a!==Object(s.isReversedDialogs)(e)),e))}function Zt(e,t){void 0===t&&(t=e.get().peer);var n=e.get().tabs[t];return a.FOLDER_MASKS[a.FOLDER_IMPORTANT]&n.folders}function en(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(s.isFoldersAvailable)(e))return!1;var r=n||e.get().tabs[t];return a.FOLDER_MASKS[a.FOLDER_UNRESPOND]&r.folders}function tn(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function nn(e){return null!=e.get().pendingForward}function rn(e,t){return(t.get().block_states[e]||{}).who===vk.id}function an(e,t){var n=e.get().block_states;Object.keys(n).forEach(a=>{n[a].time?!1===n[a].free&&Date.now()-n[a].time>=5e4&&t.push([r.mutexEvent([,1,"gim"+e.get().gid,a,0,""])]):n[a].time=Date.now()})}function sn(e,t,n){var r;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(n,a)=>{a&&(r=t(n,e,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),r.unmount()}}},n)}function on(e,t){return cn(e.get(),t,Object(s.getTab)(e,t).last_seen)}function cn(e,t,n,r){if(n.platform)return getLang("mail_header_online_status")+(n.mobile?un(t,!1,!1,!0):"");if(!n.can_see){var a=Object(y.oCacheGet)(e,t),i=a||e.tabs[t];return function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(n.status,i.sex)}if(!n.time||Date.now()-1e3*n.time>7776e6)return"";var s=getDateText(n.time,e.timeshift),o=langSex(Object(y.oCacheGet)(e,t).sex,getLang("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",s);return n.mobile&&(o+=un(t,!1,!1,r)),o}function un(e,t,n,r){var a={mid:e};n||(a.was=1),t?a.forcetoup=!0:a.forcetodown=!0,a=Object.assign(a,r);var i=JSON.stringify(a).slice(1,-1).replace(/"/g,"&quot;");return Object(P.getTemplate)("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function dn(e,t){var n=t.get().tabs[e];return Object(f.showBox)("al_settings.php",{act:"blacklist_box",q:n.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function ln(e,t){return Object(f.showBox)("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function _n(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function gn(e,t,n,r){var a;Rn(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(r,i)=>{i&&(a=n(r,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{a&&a.unmount()}}},r),e)}function fn(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function mn(e,t,n){var r=geByClass1("_im_mess_"+e,n);return r&&toggleClass(r,"im-mess_fav",t),n}function pn(e,t,n){var r=geByClass1("_im_unread_bar_row",t);if(!r)return t;var a=domClosestSibling(r,"._im_mess_stack",-1),i=domClosestSibling(r,"._im_mess_stack"),o=a?geByClass("_im_mess",a).pop():null,c=i?geByClass1("_im_mess",i):null;if(re(r),De(t),!c||!o)return t;var u=domData(c,"msgid"),d=Object(s.getPreviousMessage)(e,n,u),l=Object(s.getMessage)(e,n,u);if(!d||st(e.tabs[n],d,l,e))return t;var _=geByClass1("_im_stack_messages",a),g=geByClass1("_im_stack_messages",i).children;return Object(I.toArray)(g).forEach(e=>{re(e),_.appendChild(e)}),re(i),t}function hn(e,t,n){var r=Object(s.getFirstUnread)(e,e.get().peer);if(!r)return[!1,0];var a=geByClass1("_im_mess_"+r,t);if(!a){var i=Object(s.getLastMessage)(e,e.get().peer,r);if(!i)return[!0,0];a=geByClass1("_im_mess_"+i.messageId,t)}var o=hasClass(a,"_im_mess_srv")?a:Object(U.gpeByClass)("_im_mess_stack",a);if(!o)return[!0,0];var c=a?a.offsetTop:0,u=o.offsetTop+c,d=n.contHeight();return u<=n.scrollTop()+n.getScrollHeight()?[!0,0]:[!1,Math.max(0,d-u)]}function bn(e,t,n){cancelEvent(t);var r=Object(U.gpeByClass)("_im_top_notice",n);fadeOut(r,200,re.pbind(r));var a=Object(U.gpeByClass)("_im_page_dialogs",r);a&&hasClass(a,"im-page--dialogs-notice")&&removeClass(a,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function vn(e,t,n){cancelEvent(t);var r=Object(U.gpeByClass)("_im_aside_notice",n);slideUp(r,200,re.pbind(r)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function On(e,t){cancelEvent(e);var n=Object(U.gpeByClass)("_im_aside_promo_block",t);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function En(e,t){Object(U.gpeByClass)("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function Tn(e){return e.length>1?function(e){return[].concat(e).sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(e):e}function Cn(e,t,n,r,a){if(n=n.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," "),n=Object(c.replaceMentions)(n,(e,t,n,r,a)=>a),r&&(n=Emoji.emojiToHTML(n,!0)),t&&"..."!==t.trim()&&!Object(d.isChatPeer)(e)&&(n=Object(P.getTemplate)("im_topic",{topic:t,cls:"im-topic_dialog"})+n),!n&&a.length>0){var i=Tn(a);n=Object(P.getTemplate)("im_dialog_media",{name:An(i[0],i)})}return n}function An(e,t){var n={photo:getLang("mail_added_photos","raw"),video:getLang("mail_added_videos","raw"),audio:getLang("mail_added_audios","raw")};switch(e.type){case"mail":var r=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(r,getLang("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var a=t.filter(t=>t.type===e.type).length;return langNumeric(a,n[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?getLang("mail_added_audio_album"):getLang("mail_added_audio_playlist");case"artist":return getLang("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return getLang("mail_added_graffiti");case"audiomsg":return getLang("mail_added_audiomsg");default:return getLang("mail_added_docs")}case"geo":case"map":return getLang("mail_added_geo");case"wall":return getLang("mail_added_wall");case"wall_reply":return getLang("mail_added_wall_reply");case"gift":return getLang("mail_added_gift");case"link":case"share":return getLang("mail_added_link");case"sticker":return getLang("mail_added_sticker");case"market":return getLang("mail_added_market_item");case"money_transfer":return getLang("mail_added_money_transfer");case"money_request":return getLang("mail_added_money_request");case"story":return getLang("mail_added_story");case"mask":return getLang("mail_added_mask");case"article":return getLang("mail_added_article");case"call":case"group_call_in_progress":return getLang("mail_added_call");case"poll":return getLang("mail_added_poll");case"podcast":return getLang("mail_added_podcast");default:return getLang("mail_added_"+e.type)}return""}function In(e){addClass(e,"im-send-btn_loading")}function yn(e){removeClass(e,"im-send-btn_loading")}function jn(e){var t=e.get(),n=Object(s.getPinnedMessage)(e);if(!n||!Object(j.isPinnedMessageVisibleInTab)(e,Object(s.getPeer)(e)))return"";var r=Object(y.oCacheGet)(e,n.userId);if(!r)return"";var a=Sn(e,n);if(!a)if(!(a=n.text)&&n.attaches.length){var i=Tn(n.attaches);a=Object(P.getTemplate)("im_pinned_message_media",{text:An(i[0],i)})}else a=ot(e,a,n&&n.kludges||{})||"";return a=a.replace(/<br\s?\/?>/gi," "),Object(P.getTemplate)("im_pinned_message",{date:getSmDate(n.date,t.timeshift),content:a,link:r.link,name:r.name})}function Sn(e,t){var n="";if(t&&Object(o.isMoneyRequest)(t)&&void 0!==t.kludges.attach1_tr_amount){var r="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(r=getLang("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var a=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),i=langNumeric(t.kludges.attach1_total_amount/1e3,r,!0);n=getLang("mail_money_request_collected_amount_from").replace("{amount}",a).replace("{total_amount}",i)}else{var s=langNumeric(t.kludges.attach1_tr_amount/1e3,r,!0);n=getLang("mail_money_request_collected_amount").replace("{amount}",s)}if(intval(t.kludges.attach1_held_amount)){var c=langNumeric(t.kludges.attach1_held_amount/1e3,r,!0);n+=" "+getLang("mail_money_request_held_amount").replace("{amount}",c)}t.text&&(n+='<span class="divider"></span>'+ot(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(n+=Object(P.getTemplate)("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return n}function Ln(e,t,n){var r=n.getAttribute("data-info");r&&Object(g.showTooltip)(n,{text:r,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function Mn(e,t,n){var r=+n.getAttribute("data-time");r&&Object(g.showTooltip)(n,{text:getLang("mail_message_edited")+" "+getSmDate(r,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function Pn(e,t,n){var r=n.target,a=r.closest("."+$),i=a.querySelector("."+W);if(i){var s,o=Number(i.getAttribute("data-msgid")),c=k.casperMessagesStore.getExpireTime(o),u="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var d=t.querySelectorAll(".im-mess-stack--bomb");Array.from(d).forEach(e=>{e!==r&&tooltips.hide(e,{fasthide:!0})})}var l=Nn(e);Object(g.showTooltip)(r,{text:f(formatTime(c)),className:"_im_history_tooltip "+u,appendParentCls:$,black:1,shift:[12,4],onShowStart:_,onShowEnd(){s=setTimeout(_,500)},onHide(){clearTimeout(s)},force:!0,toup:r.getBoundingClientRect().top>l+37,hasover:!0}),setTimeout(_,500)}function _(){var e=a.querySelector(`.${u} .tt_text`);e&&(e.innerHTML=f(formatTime(k.casperMessagesStore.getExpireTime(o)))),s=setTimeout(_,500)}function f(e){return`<div class="wrapped">${e}</div>`}}function Nn(e){var t=Object(s.getPeer)(e),n=Object(s.getTab)(e,t),r=Object(j.isPinnedMessageVisibleInTab)(e,Object(s.getPeer)(e))||n&&n.top_banner,a=Object(R.getPeerProfileHeight)();return 105+(r?kn(e):0)+a}function kn(e){var t=Object(s.getPinnedMessage)(e);return t&&Object(o.isMoneyRequest)(t)?62:52}function Rn(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?Mn(t,0,e.target):hasClass(e.target,"_im_page_info")&&Ln(0,0,e.target)})}function Dn(e,t,n,r,a){var i,s=e.get();Rn(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:n,gid:e.get().gid,hash:s.tabs[n].hash},{onDone:(n,a)=>{a&&(i=r(n,e,t,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},a),e)}function wn(e){return Object(I.unpackStore)(e).isLastMsgFalseDebugger}function Un(){console.trace(),alert("Вы поймали баг исчезнувшего lastMsg. Пожалуйста откройте консоль (Cmd + Option + I), остановите выполнение JS на странице (F8+cmd+\\) и свяжитесь с командой сообщений на вебе.")}function Hn(e,t,n){var r=e.get();Rn(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:r.peer,msgid:t,gid:r.gid,hash:r.tabs[r.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},n),e)}function xn(e,t){return!(!Object(d.isChatPeer)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function Fn(e){return!Object(d.isChatPeer)(e.peerId)||e.data.kicked?0:e.membersCount}function Gn(e,t){var n=Object(y.oCacheGet)(e,t.peerId),r=Object(s.getTab)(e,t.peerId)||{},a=t.lastmsg;return n&&(t.photo=t.photo||n.photo,t.name=t.name||n.name,t.href=t.link||n.link,t.sex=t.sex||n.sex),t.last_touched=r.last_touched||0,t.verified=!!t.verified,t.lastmsg=a||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,wn(e)&&(a||t.lastmsg_meta&&t.lastmsg_meta[0])&&!1===t.lastmsg&&(console.log(F({},t)),Un()),t.folders=t.folders||null,t.unread=t.unread||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0},t.online=t.last_seen&&t.last_seen.platform||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(d.isChatPeer)(t.peerId)&&(t.memberIds=t.memberIds||r.memberIds||null),t}function Bn(e,t){for(var n in t)t.hasOwnProperty(n)&&Gn(e,t[n])}function Vn(e,t){var n=[],r=t.find(e=>"mail"===e[0]),a=r?r[1].split(";"):[];for(a.length>100&&(r[1]=a.slice(0,100).join(";"));e.length>4096;){var i=e.substr(0,4096).lastIndexOf(" ");-1==i&&(i=4096),n.push({msgText:trim(e.substr(0,i))}),e=trim(e.substr(i))}for(e.length&&n.push({msgText:e,attaches:t}),n.length||n.push({attaches:t}),a=a.slice(100);a.length;a=a.slice(100))n.push({attaches:[["mail",a.slice(0,100).join(";")]]});return n}function Yn(e){return e.length>4096}function Kn(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=Object.assign(qn(t,r),{act:"a_chat_preview"}),s=!1;Object(f.showBox)("al_im.php",i,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(n),s&&s.unmount()}},onFail:e=>(setTimeout(()=>Object(f.showFastBox)(getLang("global_error"),e),0),!0),onDone(t){s=C(t.bodyNode,e,a)}},{})}function qn(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash,link:e.invite_link}:e}function $n(){Object(f.showFastBox)(getLang("global_error"),getLang("mail_message_wait_until_uploaded"))}function Wn(e,t){var n=Object(s.getTab)(e,t.peerId)||{},r=e.get(),a=Object(d.isChatPeer)(t.peerId)&&Object(M.isUserAdminInChat)(n,r.id),i=Object(d.isChatPeer)(t.peerId)&&Object(M.isUserAdminInChat)(n,t.userId);if(!t)return!1;if(!Object(o.isOut)(t)&&(!a||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(ye(e,t.peerId,t.messageId))return!1;if(Object(d.isChatPeer)(t.peerId)){if(!Object(s.isChatActive)(n))return!1}else if(n.block_error>0)return!1;return!0}function Qn(e,t){var n=Object(s.getTab)(e,t),r=-1!==n.memberIds.indexOf(n.ownerId),a=r?[n.ownerId]:[];return(a=a.concat(n.memberIds.filter(t=>t!==n.ownerId&&Object(y.oCacheExists)(e,t)).slice(0,r?4:5))).map(t=>Object(y.oCacheGet)(e,t))}function Jn(e,t){return t.map(t=>Object(y.oCacheGet)(e,t))}function Xn(e,t){return Object(s.getTab)(e,t).memberIds.reduce((t,n)=>{var r=Object(y.oCacheGet)(e,n);return t[r.id]=r,t},{})}function zn(e,t){if("number"!=typeof e||0===e)return"";var n,r=[[31536e3,t?getLang("global_years_accusative","raw"):getLang("global_age_years","raw")],[2592e3,t?getLang("global_months_accusative","raw"):getLang("global_age_months","raw")],[604800,t?getLang("global_weeks_accusative","raw"):getLang("global_age_weeks","raw")],[86400,t?getLang("global_days_accusative","raw"):getLang("global_age_days","raw")],[3600,t?getLang("global_hours_accusative","raw"):getLang("global_hours","raw")],[60,t?getLang("global_minutes_accusative","raw"):getLang("global_minutes","raw")],[1,t?getLang("global_seconds_accusative","raw"):getLang("global_age_seconds","raw")]],a=e,i=[];if(r.forEach(e=>{var t=H(e,2),n=t[0],r=t[1],s=Math.floor(a/n);a%=n,s>=1&&i.push(langNumeric(s,r))}),1===(n=i.length))return i.pop();var s=i.slice(0,n-1).join(", "),o=i.pop();return getLang("global_and").replace(/{before}/gi,s).replace(/{after}/gi,o)}function Zn(e,t,n,a){a&&!ye(e,n,a)&&(Object(s.getMessage)(e,n,a)?(e.setState({msgid:a}),Object(i.updateLocation)({msgid:a}),t()):e.get().longpoll.push([r.changePeer(n,a)]))}function er(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var n=e.get().tabs[e.get().peer],r=Object(s.parserMessage)(n.msgs[domData(t,"msgid")]);return r&&r.peerId==e.get().peer?r:null}function tr(e,t){if(Object(s.isClassicInterface)(e)){var n=document.getElementById("ui_rmenu_mr");n&&(Object(s.existsIncomingMessageRequest)(e)?n.classList.remove("unshown"):n.classList.add("unshown"))}else t(e)}function nr(e){var t=Object(I.unpackStore)(e),n=Number(t.dialog_tab_cts[a.FOLDER_MESSAGE_REQUEST]),r=n>0?n:"",i=document.querySelector('._im_right_menu_counter[data-tab="mr"]');i&&(i.innerHTML=r)}function rr(){for(var e=curBox();e;)e.hide(),e=curBox()}function ar(e,t){return getLang("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function ir(e,t){var n=Object(s.getPeer)(e),r=Object(s.getMessage)(e,n,t);return Object(M.canPinOrUnpin)(e,n)&&!Object(o.hasPrivateStory)(r)&&!Object(o.isCasperMessage)(r)}function sr(e,t){var n=Object(s.getPeer)(e);return!t.find(t=>{var r=Object(s.getMessage)(e,n,t);return Object(o.hasPrivateStory)(r)||Object(o.isCasperMessage)(r)})}function or(e,t){var n=Object(s.getPeer)(e);return!t.find(t=>{var r=Object(s.getMessage)(e,n,t);return Object(o.isCasperMessage)(r)})}function cr(e,t){var n=k.casperMessagesStore.isProcessed(e.messageId),r=k.casperMessagesStore.has(e.messageId),a=k.casperMessagesStore.getExpireTime(e.messageId)>k.MAX_DEVIATION;(!r&&!n||r&&a)&&t(e),r&&a&&k.casperMessagesStore.remove(e.messageId)}function ur(e){return e===vk.id}function dr(e,t){return Object(d.isUserPeer)(t)&&!ur(t)&&!Object(s.isCommunityInterface)(e)&&!et(t)}function lr(e,t){var n=e.get(),r=Object(s.isCommunityInterface)(e);return Object(d.isUserPeer)(t)&&!ur(t)&&!r&&!inArray(t,n.moneyTransferExcept)&&!et(t)||Object(s.isCommunityPeer)(t)&&n.moneyTransferCommAvail&&Object(s.getCurrentTab)(e).moneyTransferAvail&&!r||r&&n.moneyRequestAvail&&!Object(d.isChatPeer)(t)||Object(d.isChatPeer)(t)&&Object(s.getCurrentTab)(e).moneyRequestAvail&&!Object(s.isCasperChat)(e,t)}function _r(e,t,n){var r=geByClass1("_im_mess_"+n.messageId,t),a=r&&r.closest("._im_mess_stack");if(!r||!a)return t;var i,s,o,c=Array.from(a.querySelectorAll("._im_mess")),u=H((s=(i=a).previousElementSibling,o=i.nextElementSibling,[s&&1===s.nodeType?s:null,o&&1===o.nodeType?o:null]),2),d=u[0],l=u[1],_=d&&d.classList.contains("im-expired-message"),g=l&&l.classList.contains("im-expired-message"),f=_&&0===c.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId),m=g&&c.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId)===c.length-1,p=gr((f?+d.getAttribute("data-count"):0)+(m?+l.getAttribute("data-count"):0)+1,"_im_expired_message_"+n.messageId),h=se(p);if(f&&(h.classList.add(...d.classList),d.remove()),m&&(h.classList.add(...l.classList),l.remove()),1===c.length)a.replaceWith(h);else{var b=H(c.reduce((e,t)=>{var r=+t.getAttribute("data-msgid");return r<n.messageId&&e[0].push(t),r>n.messageId&&e[1].push(t),e},[[],[]]),2),v=b[0],O=b[1];a.replaceWith(se(fr(e,v))||"",h,se(fr(e,O))||"")}return t}function gr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(P.getTemplate)("sImExpiredMessagePlaceholder",{text:langNumeric(e,getLang("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(l.classNames)(t)})}function fr(e,t){if(0===t.length)return"";var n=+t[0].getAttribute("data-peer"),r=+t[0].getAttribute("data-msgid"),a=Object(s.getMessage)(e,n,r);return Object(P.getTemplate)("im_mess_stack",Object.assign(mr(e,a),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function mr(e,t){var n=Object(I.unpackStore)(e),r=t.peerId,a=t.messageId,i=Object(s.getTab)(e,r),c=Object(o.getUserId)(t),u=Object(o.getAdminId)(e,t),_=Object(y.oCacheGet)(n,u?-n.gid:c)||i,g=Object(d.isChatPeer)(r)?_.name:_.first_name,f=_.link||i.href,m=Object(d.isChatPeer)(r)&&_.image_status?_.image_status:"",p=Object(P.getTemplate)("im_mess_stack_name",{name:g+m,link:f,class:Object(o.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(o.isGift)(t)&&(p+=Object(P.getTemplate)("sImGiftLabel",{content:langSex(_.sex||0,getLang("mail_gift_message_sent","raw"))})),Object(o.isMoney)(t)){var h=Object(o.isMoneyRequest)(t)?getLang("mail_money_request_message_sent","raw"):getLang("mail_money_tranfer_message_sent","raw");p+=Object(P.getTemplate)("sImMoneyTransferLabel",{content:langSex(_.sex||0,h)})}var b=function(e,t){var n=Object(I.unpackStore)(e),r=t.peerId,a=t.messageId,i=Object(d.isChatPeer)(r)&&Object(s.isCasperChat)(n,r),c=Object(o.getAdminId)(e,t),u=Object(s.isCommunityInterface)(e)?"/gim"+n.gid:"/im",_=i?"":Object(P.getTemplate)("im_stack_date",{date:(g=t.date,f=n.timeshift,langDate(1e3*g,"{hour}:{minute} {am_pm}",1e3*f,[],!0)),link:`${u}?sel=${r}&msgid=${a}`});var g,f;if(c&&n.admins[c]){var m=n.admins[c],p=c===vk.id?getLang("mail_by_you"):m[0];_+=" "+Object(P.getTemplate)("im_admin_link",{name:p,href:m[1]})}return _+function(e,t){if(!Object(o.isCasperMessage)(t))return"";var n=H(k.casperMessagesStore.getTimings(t.messageId),3),r=n[0],a=n[1],i=n[2],c=Math.max(r+a-i,0);return Object(P.getTemplate)("sImBomb",{classnames:Object(l.classNames)({"im-mess-stack--bomb_hidden":Object(s.isCasperChat)(e,t.peerId),"im-mess-stack--bomb_expiring":c<=k.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":c<=k.EXPIRING_SOON_TIME})})}(n,t)}(e,t);return{photo:_.photo,href:f,cls:"",date_attr:"",link:`/im?sel=${r}&msgid=${a}`,name:stripHTML(p),stack_name:p,peerId:c,messageMeta:b,admin:u}}function pr(e,t){var n=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(n)).forEach(e=>{e.innerHTML=Object(P.getTemplate)("im_dialog_media",{name:getLang("mail_expired_message")})})}function hr(e){return Object(d.isChatPeer)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,getLang("mail_im_n_chat_members","raw")):""}var br=A.CallStatSource.CONVO_SNIPPET,vr=A.CallStatSource.CONVO_HEADER,Or=A.CallStatSource.CONVO_LIST,Er=A.CallStatSource.CONVO_JOIN_SNIPPET,Tr=A.CallStatSource.CONVO_JOIN_HEADER,Cr=A.CallStatSource.CONVO_JOIN_BANNER;function Ar(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){if(!t)return void window.Calls.startCall(n,a);var i=Object(d.isChatPeer)(t);if(i){var o=Object(s.getTab)(e,t),c=F({},o,{canAddMembers:Object(M.canInviteUser)(e,t,void 0)});window.Calls.startGroupCall(t,[c],r,n,a)}else{var u=Object(y.oCacheGet)(e,t),l=F({},u,{canAddMembers:!0});window.Calls.call(t,n,[l,[u]],a)}}}function Ir(e){var t=decodeURIComponent(e.target.getAttribute("href"));if(t&&window.Calls&&window.Calls.showJoinPopup)return cancelEvent(e),window.Calls.showJoinPopup(t,A.CallStatSource.LINK_JOIN_SNIPPET)}function yr(e,t){var n=Object(s.getTab)(e,t);return!Object(s.isCommunityInterface)(e)&&!!n.can_start_call}function jr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;if(window.Calls&&window.Calls.call){var i=Object(s.getTab)(e,t);if(!Object(s.isChatActive)(i))return;window.Calls.joinCallByLink(t,n,[i],r,a)}}function Sr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=t?"&msgid="+t:"";return`/im?sel=${ct(e)}${n}`}function Lr(e,t){Object(f.showBox)("al_im.php",{act:"group_calls_onboarding_box"},{params:{hideButtons:!0,hideOnBGClick:!1,width:655,onHide:()=>{"group_calls"===nav.objLoc.promo&&(delete nav.objLoc.promo,nav.setLoc(nav.objLoc)),ls.remove("group_calls_tooltip_shown"),ajax.post("al_index.php",{act:"hide_feature_tt",hash:t,type:"group_calls"})}},containerClass:"GroupCallsOnboarding",onDone:t=>{var n=geByClass1("GroupCallsOnboarding__call-button",t.bodyNode),r=geByClass1("GroupCallsOnboarding__skip-button",t.bodyNode),a=geByClass1("GroupCallsOnboarding__close-button",t.bodyNode),i=ge("box_layer",t.bodyNode),o=function(){t.hide();var n=new ElementTooltip(geByClass1("_im_create_call"),{content:getLang("mail_group_calls_im_search_tt"),forceSide:"bottom",cls:"feature_intro_tt feature_intro_blue_tt",autoShow:!1,appendTo:geByClass1("_im_dialogs_search"),type:ElementTooltip.TYPE_HORIZONTAL,width:250,offset:Object(s.isClassicInterface)(e)?[10,25]:[13,12],rightShift:30,onHide:function(){Object(m.removeEvent)(n._ttel,"click")}});n.show(),Object(m.addEvent)(n._ttel,"click",()=>n.hide()),cur.destroy.push(()=>{Object(m.removeEvent)(n._ttel,"click"),n.destroy()})};Object(m.addEvent)(n,"click",()=>{t.hide(),Ar(e,null,!1,null,Or)}),Object(m.addEvent)(r,"click",o),Object(m.addEvent)(a,"click",o);var c=e=>{e.target===i&&(Object(m.removeEvent)(i,"click",c),o())};Object(m.addEvent)(i,"click",c),cur.destroy.push(()=>{Object(m.removeEvent)(r,"click"),Object(m.removeEvent)(a,"click"),Object(m.removeEvent)(n,"click"),Object(m.removeEvent)(i,"click",c),t.hide(),t.destroy()})}})}},S2bU:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceHyperLinks",(function(){return s})),n.d(t,"replaceEmailLinks",(function(){return o})),n.d(t,"replaceMentions",(function(){return c})),n.d(t,"replaceMassMentions",(function(){return u})),n.d(t,"replaceHashtags",(function(){return _})),n.d(t,"linksReplacer",(function(){return g}));var r,a=n("h++7"),i=n("t7n3");function s(e,t){for(var n,r=0,i=e;null!==(n=a.MESSAGE_REGEXP.exec(e));){var s=(n=d(n))[0].length,o=n.index+s,c=e[n.index-1],u=e[o-1],_=void 0!==c&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(c),g=void 0!==u&&/([:;$])/i.test(u);if(!_&&!g){var f=l(n),m=f.domain.toLowerCase();if(m.length<=a.MAX_DOMAIN_LENGTH&&a.TOP_DOMAINS.includes(m)){var p=t(f);i=i.slice(0,n.index+r)+p+i.slice(o+r),r+=p.length-s}}}return i}function o(e,t){return e.replace(a.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function c(e,t){return e.replace(a.MENTION,t||function(e,t,n,r,a){return'<a href="/'+(t+n)+'" class="mem_link" mention="'+Object(i.clean)(r||"")+'" mention_id="'+Object(i.clean)(t+n)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+a+"</a>"})}function u(e,t){return e.replace(a.RE_MASSMENTION,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink" data-mention="'+e.slice(1).toLowerCase()+'">'+e+"</span>"}))}function d(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,n=e[6].length-1;return"."===e[0][t]&&"."===e[6][n]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,n)),e}function l(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function _(e,t){return e.replace((r||(r=new RegExp(a.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),r),(function(e,n,r,a,i){return(n||"")+t(r+(i||""))}))}function g(e,t){var n=t.url,r=t.full,s=t.protocol,o=t.query;try{r=decodeURIComponent(r)}catch(e){}if(r.length>55&&(r=r.substr(0,53)+".."),r=Object(i.clean)(r).replace(/&amp;/g,"&"),!e&&n.match(a.OUR_DOMAINS)){var c=n=Object(i.replaceEntities)(n).replace(a.ENTITIES,encodeURIComponent),u=n.indexOf("#/"),d="";u>=0?c=n.substr(u+1):(u=n.indexOf("#!"))>=0&&(c="/"+n.substr(u+2).replace(/^\//,""));var l=c.match(a.VK_DOMAIN);return l&&l[1].length<32&&(d=' mention_id="'+l[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(s+n+o)+'" target="_blank" rel="noopener"'+d+">"+r+"</a>"}var _=Object(i.replaceEntities)(n+o).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(s+_))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(i.clean)((s+n+o).replace(/'/g,"\\'"))+"', {}, event);")+'">'+r+"</a>"}},Syd7:function(e,t,n){"use strict";n.r(t),n.d(t,"getPeerProfileHeight",(function(){return J})),n.d(t,"mount",(function(){return z}));var r=n("q1tI"),a=n("i8i4"),i=n("rHUl"),s=n("P13b"),o=(n("91GP"),n("17x9"),n("ZxpX")),c=n("ErRf"),u=n("nAFc"),d=n("ERyv"),l=n("4+be"),_=n("6krn"),g=n("754W"),f=n("6aSF"),m=n("dt/K"),p=n("vT4u"),h=n("EasH"),b=_.default.getLang;class v extends r.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(h.showFastBox)(b("mail_ad_tag_no_access_box_title"),b("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`,n="";n=e.isEasyPromotedMarket?b("mail_ad_tag_easy_promoted_market"):e.hasAdAccess?`${b("mail_ad_tag_text_prefix")} ${e.adId}`:b("mail_ad_tag_no_access_text");var a=r.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},n);return r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&r.createElement("a",{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},a),!e.hasAdAccess&&r.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},a))}return r.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},r.createElement("span",null,Object(u.decodeHTMLEntities)(e.name)))}}var O=v,E=_.default.getLang;class T extends r.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,n=e.tags,a=e.isPeerProfileCollapsed,i=e.adId,s=e.hasAdAccess,o=e.isEasyPromotedMarket,c=e.toggleProfile,u=n.filter(e=>t.includes(e.id));i&&u.unshift({adId:i,hasAdAccess:s,isEasyPromotedMarket:o});var d=0;a&&this.state.isTagsCollapsed&&u.length>5&&(d=u.splice(5).length);return u=u.map((e,t)=>r.createElement(O,{key:t,data:e})),r.createElement("div",{className:"PeerProfileTagsList"},u.length>0&&u,d>0&&r.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+E("mail_im_peer_profile_extra_tags",d)),!u.length&&r.createElement("div",{className:"PeerProfileTagsListItem--empty"},E("mail_im_peer_profile_tags_empty")," ",r.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",r.createElement(g.default,{className:"PeerProfileTagsList__toggleProfileLink",onClick:c},E(a?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var C=T,A=n("0Rlc");var I=function(e){var t=e.data,n=e.onCheckboxChange;return r.createElement("div",{className:"PeerProfileTagsGridItem",onClick:e=>{e&&e.preventDefault(),n(t.id,!t.isChecked)}},r.createElement(A.default,{className:"PeerProfileTagsGridItem__checkbox",checked:t.isChecked,onChange:(e,r)=>n(t.id,r)},r.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),r.createElement("span",{className:"PeerProfileTagsGridItem__name",title:t.name},Object(u.decodeHTMLEntities)(t.name))))};class y extends r.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return r.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>r.createElement(I,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var j=y,S=n("r7nW"),L=n("Ht+d"),M=n("oziD"),P=n("0toi"),N=_.default.getLang;class k extends r.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=r.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,n=e.data,a=e.onNameChange,i=e.onRemove;return r.createElement("div",{className:"PeerProfileTagsModalField"},r.createElement("input",{type:"hidden",value:n.id?n.id:""}),r.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(u.decodeHTMLEntities)(n.name),ref:this.inputRef,onChange:e=>a(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:N("mail_im_peer_profile_manage_tags_placeholder")}),r.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:n.color}}),r.createElement(m.default,{position:"t",text:N("mail_im_peer_profile_manage_tags_remove")},r.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>i(t)})))}}var R=k;function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var w=_.default.getLang,U=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],H=U[0];class x extends r.Component{constructor(e){var t;super(e),t=this,this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():H,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return U.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var n=e.target.value;this.setState({tags:this.state.tags.map((e,r)=>r===t?D({},e,{name:n,state:e.state||"changed"}):e)})},this.onRemove=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.state.tags,a=r[e];!n&&a.id&&a.uses>0?t.setState({isConfirmationModalOpen:!0,indexToRemove:e}):t.setState({tags:t.state.tags.filter((t,n)=>n!==e),deletedTags:[...t.state.deletedTags,D({},a,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={tags:e.tags.length?e.tags.map(e=>D({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1,isConfirmationModalOpen:!1,indexToRemove:null},this.inputsRef=r.createRef()}render(){var e=this.state,t=e.tags,n=e.isConfirmationModalOpen,a=t[e.indexToRemove],i=Object(o.classNames)("PeerProfileTagsModal",{"PeerProfileTagsModal--hidden":n});return r.createElement(r.Fragment,null,r.createElement(S.default,{onClose:this.props.onClose,className:i,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(P.default.Header,{title:w("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(P.default.Body,null,r.createElement(f.default,{className:"PeerProfileTagsModal__scroll",neverHide:!0},r.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>r.createElement(R,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?r.createElement(g.default,{className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},w("mail_im_peer_profile_manage_tags_add_link")):""))),r.createElement(P.default.Footer,{actionButtons:[r.createElement(L.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},w("global_cancel")),r.createElement(M.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},w("global_save"))]}))),n&&r.createElement(P.default,{title:w("global_warning"),appearance:"blue",actionButtons:[r.createElement(L.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},w("global_cancel")),r.createElement(L.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.onRemove(this.state.indexToRemove,!0)}},w("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},Object(l.langStr)(1===a.uses?w("mail_im_peer_profile_tag_delete_confirmation_text_single"):w("mail_im_peer_profile_tag_delete_confirmation_text",a.uses,!0),"tag_name",Object(u.decodeHTMLEntities)(a.name))))}}var F=x,G=n("MV/q"),B=_.default.getLang;class V extends r.Component{constructor(e){var t;super(e),t=this,this.onChange=e=>{var t=e.target.value;this.setState({note:t})},this.onSubmit=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&e.preventDefault();var r=t.state.note&&t.state.note.trim();n||r?(t.setState({isLoading:!0}),t.props.onNoteSave(r)):t.setState({note:""})},this.toggleConfirmationModal=(e,t)=>{e&&e.preventDefault(),this.setState({isConfirmationModalOpen:t})},this.state={note:e.note||"",isLoading:!1,isConfirmationBoxOpen:!1,isConfirmationModalOpen:!1},this.inputRef=r.createRef()}componentDidMount(){this.inputRef.current.element.focus()}render(){var e=Object(o.classNames)("PeerProfileNoteModal",{"PeerProfileNoteModal--hidden":this.state.isConfirmationModalOpen}),t=[...this.props.note?[r.createElement(L.default,{key:"delete",appearance:"link",onClick:e=>this.toggleConfirmationModal(e,!0),className:"PeerProfileNoteModal__deleteButton"},B("mail_im_peer_profile_note_delete_link"))]:[],r.createElement(L.default,{key:"cancel",appearance:"tertiary",onClick:this.props.onClose},B("global_cancel")),r.createElement(M.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},B("global_save"))];return r.createElement(r.Fragment,null,r.createElement(S.default,{onClose:this.props.onClose,className:e,disableBackdropClick:!0,disableEscapeClose:!0},r.createElement("form",{onSubmit:this.onSubmit},r.createElement(P.default.Header,{title:B("mail_im_peer_profile_note_box_title"),onClose:this.props.onClose,appearance:"blue"}),r.createElement(P.default.Body,null,r.createElement(G.default,{className:"PeerProfileNoteModal__input",value:Object(u.decodeHTMLEntities)(this.state.note),placeholder:B("mail_im_peer_profile_note_box_placeholder"),onChange:this.onChange,style:{height:21},maxLength:96,ref:this.inputRef})),r.createElement(P.default.Footer,{actionButtons:t}))),this.state.isConfirmationModalOpen&&r.createElement(P.default,{title:B("global_warning"),appearance:"blue",actionButtons:[r.createElement(L.default,{key:"cancel",appearance:"tertiary",onClick:e=>this.toggleConfirmationModal(e,!1)},B("global_cancel")),r.createElement(L.default,{key:"delete",onClick:e=>{this.toggleConfirmationModal(e,!1),this.setState({note:""},()=>this.onSubmit(null,!0))}},B("global_delete"))],onClose:e=>this.toggleConfirmationModal(e,!1),className:"PeerProfileConfirmationModal"},B("mail_im_peer_profile_note_delete_confirmation_text")))}}var Y=V;function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var q=_.default.getLang;class $ extends r.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var n=this.props.store,r=n.get().peer;this.setState(n=>({peerTags:t?[].concat(n.peerTags,e):n.peerTags.filter(t=>t!==e)}),()=>{n.set(p.peerProfileToggleTag.bind(null,e,t,t?"bind":"unbind",r,[...this.state.peerTags])).catch(e=>Object(d.imWeirdCatch)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(p.peerProfileManageTags.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isTagsModalOpened:!1}),showDoneBox(q("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(d.imWeirdCatch)("PeerProfile.manageTags",e))})},this.onNoteSave=e=>{var t=this.props.store,n=t.get().peer;t.set(p.peerProfileSaveNote.bind(null,n,e)).then(()=>{this.setState({note:e,isNoteModalOpened:!1}),showDoneBox(q(e?"mail_im_peer_profile_save_note_success":"mail_im_peer_profile_delete_note_success"),{out:1e3})}).catch(e=>Object(d.imWeirdCatch)("PeerProfile.saveNote",e))},this.toggleModal=(e,t,n)=>{switch(e&&e.preventDefault(),n){case"tags":this.setState({isTagsModalOpened:t});break;case"note":this.setState({isNoteModalOpened:t})}t&&Object(c.cancelStackPush)("peer_profile_modal",()=>{Object(c.cancelStackFilter)("peer_profile_modal"),this.toggleModal(null,!1,n)})};var t=e.store.get(),n=t.peer,r=Object(i.getTab)(t,n),a=r.peer_profile_info||{};this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:r.peer_tags||[],note:a.note,isTagsModalOpened:!1,isNoteModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(i.getTab)(e,e.peer),n=this.state,a=n.isCollapsed,s=n.tags,c=n.peerTags,d=n.note,_=n.isTagsModalOpened,p=n.isNoteModalOpened,h=s.length>0,b=h?s.reduce((e,t)=>(e[t.id]=!0,e),{}):[],v=c.filter(e=>b[e]),O=t.peer_profile_info,E=O&&(O.city||O.age),T=Object(o.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":a});return r.createElement("div",{className:T},r.createElement(f.default,{className:"PeerProfile__scroll",neverHide:!0},r.createElement("dl",{className:"PeerProfile__container"},r.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_tags_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},a&&!h&&!t.ad_id&&r.createElement(g.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},q("mail_im_peer_profile_manage_tags")),(h||t.ad_id)&&r.createElement(C,{tags:s,peerTags:v,isPeerProfileCollapsed:a,adId:t.ad_id,hasAdAccess:t.has_ad_access,isEasyPromotedMarket:t.is_easy_promoted_market,toggleProfile:this.toggleProfile}),!a&&r.createElement(j,{tags:[...s].map(e=>K({},e,{isChecked:c.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!a&&r.createElement(g.default,{className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0,"tags")},q("mail_im_peer_profile_manage_tags")),_&&r.createElement(F,{tags:s,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1,"tags")})),r.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_info_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},E&&r.createElement(r.Fragment,null,O.city&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(O.city)),O.age&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(O.age)),O.likes_cnt&&r.createElement(m.default,{className:"PeerProfile__infoTooltip",position:"t",text:q("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},r.createElement("span",{className:"PeerProfile__infoItem"},O.likes_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(O.likes_cnt)),O.replies_cnt&&r.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(O.replies_cnt))))),!E&&r.createElement("span",null,q("mail_im_peer_profile_info_empty"))),e.is_peer_profile_note_enabled&&r.createElement(r.Fragment,null,r.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_note_label_text")),r.createElement("dd",{className:"PeerProfile__content PeerProfile__note"},!d&&r.createElement(g.default,{onClick:e=>this.toggleModal(e,!0,"note")},q("mail_im_peer_profile_note_add_link")),!!d&&r.createElement(r.Fragment,null,r.createElement("span",{className:"PeerProfile__noteText"},Object(u.decodeHTMLEntities)(d)),r.createElement("span",{className:"PeerProfile__noteDivider"}," · "),r.createElement(g.default,{onClick:e=>this.toggleModal(e,!0,"note")},q("mail_im_peer_profile_note_edit_link"))),p&&r.createElement(Y,{note:d,onNoteSave:this.onNoteSave,onClose:e=>this.toggleModal(e,!1,"note")}))),r.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_join_date_label_text")),r.createElement("dd",{className:"PeerProfile__content"},O&&O.join_date?Object(u.decodeHTMLEntities)(O.join_date):Object(l.langSex)(t.sex,q("mail_im_peer_profile_join_date_empty_text","raw"))))),(h||t.ad_id)&&r.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}var W=$;function Q(){return document.querySelector("#PeerProfile")}function J(){var e=Q();return e?e.offsetHeight:0}function X(e,t){if(t){var n=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=n+J()+"px"}else e.style.removeProperty("padding-top")}function z(e){return{render(t){var n=t.get(),o=Q(),c=n.peer,u=Object(i.getTab)(n,c);n.is_peer_profile_enabled&&o&&Object(s.isFullyLoadedTab)(n,c)&&!Object(i.isChannelPeer)(u)&&!Object(i.isCommunityChat)(t,c)&&(o.innerHTML&&a.unmountComponentAtNode(o),a.render(r.createElement(W,{store:t}),o,()=>{X(e,!0)}))},destroy(){var t=Q();t&&(a.unmountComponentAtNode(t),X(e,!1))}}}},Wu9C:function(e,t,n){"use strict";n.r(t),n.d(t,"isPinnedMessageVisibleInTab",(function(){return _})),n.d(t,"pinnedMessageHide",(function(){return g})),n.d(t,"pinnedMessageUnHide",(function(){return f})),n.d(t,"pinnedMessageUnpin",(function(){return m})),n.d(t,"mount",(function(){return O}));var r=n("ofcU"),a=n("vT4u"),i=n("P13b");function s(e){return{unmount(){Object(r.destroyModule)(e)}}}function o(e,t,n,a){var o=Object(r.createMutations)(s).bindMutations,c=t=>{n().messageKeyboardButtonClick(t),e.hide()};return o(Object(r.createModule)({handlers:(t,n)=>{n(e.bodyNode,"click",i.MESSAGE_KEYBOARD_BUTTON_CLASS,c)}}))}var c=n("rHUl"),u=n("aong"),d=n("uytb"),l=n("FWc3");function _(e,t){if(Object(u.unpackStore)(e).searchShown)return!1;var n=Object(c.getTab)(e,t),r=n&&Object(c.parserMessage)(n.pinned);return!!r&&n.pinHideId!=r.chat_local_id}function g(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(c.getTab)(e,t),i=a&&Object(c.parserMessage)(a.pinned);a&&i&&(a.pinHideId=i.chat_local_id,cur.imDb.update(d.PIN_HIDDEN_ID_OP,[a.peerId,a.pinHideId]),h(n,t,e),re(geByClass1("_im_pinned_tt")),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function f(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(c.getTab)(e,t);a&&a.pinHideId&&(delete a.pinHideId,cur.imDb.update(d.PIN_HIDDEN_ID_OP,[a.peerId,void 0]),h(n,t,e),r&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function m(e,t,n){var r=h.bind(null,n,t),s=Object(i.showUnpinDialog)(()=>{s.hideProgress(),s.hide(),e.set(a.unpinMessageOptimistic.bind(null,t)).then(r).then(e=>e.set(a.unpinMessage.bind(null,t))).then(r)})}function p(e,t,n){var r=e.get().peer,a=Object(c.parserMessage)(Object(c.getTab)(e,r).pinned);if(n.target.classList.contains("_im_pin_hide"))a&&g(e,r,t);else if("A"!==n.target.tagName){var s=a&&a.messageId;s&&!Object(i.isAlreadyDeleted)(e,r,s)?Object(i.focusOnMessage)(e,t().focusOnMessage,r,s):Object(i.showPinnedBox)(e,t,r,o,n),statlogsValueEvent("im_pinned_messages","open")}}function h(e,t,n){return e().updateChatTopic(t,n),Object(a.setActions)(n.get()),e().updateActions(n),n}function b(e){Object(l.showTooltip)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function v(e){return{unmount(){Object(r.destroyModule)(e)}}}function O(e,t,n){var a=Object(r.createMutations)(v).bindMutations,i=p.bind(null,t,n),s=b.bind(null);return a(Object(r.createModule)({handlers:(t,n)=>{n(e,"click","_im_pinned_message",i),n(e,"mouseover","_im_pin_hide",s)}}))}},ambf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_DEVIATION",(function(){return s})),n.d(t,"EXPIRING_TIME",(function(){return o})),n.d(t,"EXPIRING_SOON_TIME",(function(){return c})),n.d(t,"EXPIRING",(function(){return u})),n.d(t,"EXPIRING_SOON",(function(){return d})),n.d(t,"EXPIRED",(function(){return l})),n.d(t,"casperMessagesStore",(function(){return p}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("MhhX");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=2e3,o=6e4,c=1e4,u="expiring",d="expiring_soon",l="expired",_=[],g={},f={},m=0,p={add(e){var t=a(b(e),3),n=t[0],r=t[1],i=t[2],s=Math.max(n+r-o-i,0),_=Math.max(n+r-c-i,0),m=Math.max(n+r-i,0),p=setTimeout(()=>{h({type:u,message:e})},s),v=setTimeout(()=>{h({type:d,message:e})},_),O=setTimeout(()=>{h({type:l,message:e}),f[e.messageId]=!0,delete g[e.messageId]},m);g[e.messageId]={message:e,expiringTime:s,expiredTime:m,timers:[p,v,O]}},remove(e){this.has(e)&&(g[e].timers.forEach(clearTimeout),delete g[e])},setTimeshift(e){m=1e3*(e||0)},getTimings:e=>g[e]?b(g[e].message):[0,0,0],getExpireTime(e){if(!g[e])return 0;var t=a(b(g[e].message),3),n=t[0],r=t[1],i=t[2];return Math.max(Math.floor((n+r-i)/1e3),0)},isProcessed:e=>!!f[e],subscribe(e){_.push(e)},unsubscribe(e){_=_.filter(t=>t!==e)},has:e=>!!g[e],destroy(){g={},_=[],f={}}};function h(e){_.forEach(t=>t(e))}function b(e){return[1e3*e.date+m,1e3*(Object(r.getMessageTTL)(e)||0),Date.now()]}},bIHZ:function(e,t,n){"use strict";n.r(t),n.d(t,"updateLocation",(function(){return a})),n.d(t,"updateLazyLocation",(function(){return i}));var r=n("t7n3");function a(e){var t=Object(r.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var n=window.nav.toStr(t);window.nav.setLoc(n)}function i(){var e={};return{scheduleNav:function(t){e=Object(r.extend)(e,t)},commitNav:function(){a(e),e={}},scheduleNavWithTimeOut:function(t,n){void 0===n&&(n=100),e=Object(r.extend)(e,t),setTimeout((function(){a(e),e={}}),n)}}}},f01n:function(e,t,n){"use strict";n.r(t),n.d(t,"constructEvent",(function(){return s})),n.d(t,"DELETE",(function(){return o})),n.d(t,"SET_FLAGS",(function(){return c})),n.d(t,"REPLACE_FLAGS",(function(){return u})),n.d(t,"RESET_FLAGS",(function(){return d})),n.d(t,"ADD_MESSAGE",(function(){return l})),n.d(t,"READ_INBOUND",(function(){return _})),n.d(t,"READ_OUTBOUND",(function(){return g})),n.d(t,"GOT_ONLINE",(function(){return f})),n.d(t,"GOT_OFFLINE",(function(){return m})),n.d(t,"CHAT_CHANGED",(function(){return p})),n.d(t,"CONVERSATION_UPDATED",(function(){return h})),n.d(t,"TYPING",(function(){return b})),n.d(t,"RECORDING_AUDIO",(function(){return v})),n.d(t,"VIDEO_CALL",(function(){return O})),n.d(t,"UNREAD_COUNT",(function(){return E})),n.d(t,"NOTIFY_SETTINGS_CHANGED",(function(){return T})),n.d(t,"KEYBOARD_CALLBACK_RECEIVED",(function(){return C})),n.d(t,"EMPTY",(function(){return A})),n.d(t,"RESET_DIRECTORIES",(function(){return I})),n.d(t,"REPLACE_DIRECTORIES",(function(){return y})),n.d(t,"SET_DIRECTORIES",(function(){return j})),n.d(t,"RESYNC",(function(){return S})),n.d(t,"REFRESH_LP_KEY",(function(){return L})),n.d(t,"TRANSITION",(function(){return M})),n.d(t,"RESET_PEER",(function(){return P})),n.d(t,"MUTEX",(function(){return N})),n.d(t,"CHANGE_PEER",(function(){return k})),n.d(t,"CHANGE_TAB",(function(){return R})),n.d(t,"FAILED_MESSAGE",(function(){return D})),n.d(t,"RESEND",(function(){return w})),n.d(t,"DELETE_DIALOG",(function(){return U})),n.d(t,"EDIT_MESSAGE",(function(){return H})),n.d(t,"REPLACE_MESSAGE",(function(){return x})),n.d(t,"INVALIDATE_MESSAGE",(function(){return F})),n.d(t,"AUDIO_START",(function(){return G})),n.d(t,"WAITING_FOR_RECONNECT",(function(){return B})),n.d(t,"RECONNECTING",(function(){return V})),n.d(t,"RECONNECTED",(function(){return Y})),n.d(t,"INCOMING_CALL",(function(){return K})),n.d(t,"FLAG_UNREAD",(function(){return q})),n.d(t,"FLAG_OUTBOUND",(function(){return $})),n.d(t,"FLAG_IMPORTANT",(function(){return W})),n.d(t,"FLAG_CHAT",(function(){return Q})),n.d(t,"FLAG_FRIENDS",(function(){return J})),n.d(t,"FLAG_SPAM",(function(){return X})),n.d(t,"FLAG_DELETED",(function(){return z})),n.d(t,"FLAG_MEDIA",(function(){return Z})),n.d(t,"FLAG_STEALTH",(function(){return ee})),n.d(t,"FLAG_HAS_REPLY",(function(){return te})),n.d(t,"FLAG_AUDIO_MESSAGE_LISTENED",(function(){return ne})),n.d(t,"FLAG_DELETE_BY_TTL",(function(){return re})),n.d(t,"FOLDER_IMPORTANT",(function(){return ae})),n.d(t,"FOLDER_UNRESPOND",(function(){return ie})),n.d(t,"FOLDER_HAS_BANNER",(function(){return se})),n.d(t,"FOLDER_AD_TAG",(function(){return oe})),n.d(t,"FOLDER_MARKED_UNREAD",(function(){return ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED",(function(){return ue})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED",(function(){return de})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED",(function(){return le})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED",(function(){return _e})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_PINNED",(function(){return ge})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_JOINED",(function(){return fe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_LEFT",(function(){return me})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_KICKED",(function(){return pe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED",(function(){return he})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED",(function(){return be})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED",(function(){return ve})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED",(function(){return Oe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED",(function(){return Ee})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BUSINESS_NOTIFY_DATA_CHANGED",(function(){return Te})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CANCELED",(function(){return Ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_REJECTED",(function(){return Ae})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_ACCEPTED",(function(){return Ie})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_JOINED",(function(){return ye})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED",(function(){return je})),n.d(t,"MESSAGE_REQUEST_STATUS_ACCEPTED",(function(){return Se})),n.d(t,"MESSAGE_REQUEST_STATUS_NEW",(function(){return Le})),n.d(t,"deleteEvent",(function(){return Me})),n.d(t,"replaceFlagsEvent",(function(){return Pe})),n.d(t,"setFlagsEvent",(function(){return Ne})),n.d(t,"resetFlagsEvent",(function(){return ke})),n.d(t,"addMessageEvent",(function(){return Re})),n.d(t,"editMessageEvent",(function(){return De})),n.d(t,"replaceMessageEvent",(function(){return we})),n.d(t,"invalidateMessageEvent",(function(){return Ue})),n.d(t,"editMessageLocallyEvent",(function(){return He})),n.d(t,"readInboundEvent",(function(){return xe})),n.d(t,"readOutboundEvent",(function(){return Fe})),n.d(t,"gotOnlineEvent",(function(){return Ge})),n.d(t,"gotOfflineEvent",(function(){return Be})),n.d(t,"resetDirectoriesEvent",(function(){return Ve})),n.d(t,"replaceDirectoriesEvent",(function(){return Ye})),n.d(t,"setDirectoriesEvent",(function(){return Ke})),n.d(t,"deleteDialogEvent",(function(){return qe})),n.d(t,"chatChangedEvent",(function(){return $e})),n.d(t,"chatUpdatedEvent",(function(){return We})),n.d(t,"typingEvent",(function(){return Qe})),n.d(t,"recordingAudioEvent",(function(){return Je})),n.d(t,"videoCallEvent",(function(){return Xe})),n.d(t,"unreadCountEvent",(function(){return ze})),n.d(t,"notifySettingsChangedEvent",(function(){return Ze})),n.d(t,"incomingCallEvent",(function(){return et})),n.d(t,"refreshMessageEvent",(function(){return tt})),n.d(t,"audioStartEvent",(function(){return nt})),n.d(t,"keyboardCallbackReceivedEvent",(function(){return rt})),n.d(t,"emptyEvent",(function(){return at})),n.d(t,"transitionEvent",(function(){return it})),n.d(t,"resyncEvent",(function(){return st})),n.d(t,"refreshLpKeyEvent",(function(){return ot})),n.d(t,"waitingForReconnectEvent",(function(){return ct})),n.d(t,"reconnectingEvent",(function(){return ut})),n.d(t,"reconnectedEvent",(function(){return dt})),n.d(t,"resetPeer",(function(){return lt})),n.d(t,"changePeer",(function(){return _t})),n.d(t,"changeTab",(function(){return gt})),n.d(t,"failedMessage",(function(){return ft})),n.d(t,"mutexEvent",(function(){return mt})),n.d(t,"resendEvent",(function(){return pt}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var r=n("rudk");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e){switch(e[0]){case 0:return Me(e);case 1:return Pe(e);case 2:return Ne(e);case 3:return ke(e);case 4:return Re(e);case 5:return De(e);case 6:return xe(e);case 7:return Fe(e);case 8:return Ge(e);case 9:return Be(e);case 10:return Ve(e);case 11:return Ye(e);case 12:return Ke(e);case 13:return qe(e);case 18:return we(e);case 19:return Ue(e);case 51:return $e(e);case 52:return We(e);case 63:return Qe(e);case 64:return Je(e);case 70:return Xe(e);case 80:return ze(e);case 114:return Ze(e);case 115:return et(e);case 116:return tt(e);case 117:return nt(e);case 119:return rt(e);case-1:return st();case-2:return ot(e);case-3:return ct(e);case-4:return ut();case-5:return dt();default:return at(e)}}var o="event_delete",c="event_set_flags",u="event_replace_flags",d="event_reset_flags",l="event_add_message",_="event_read_inbound",g="event_read_outbound",f="event_got_online",m="event_got_offline",p="event_chat_changed",h="event_chat_updated",b="event_typing",v="event_recoding_audio",O="event_video_call",E="event_unread_count",T="event_notify_settings_changed",C="event_keyboard_callback_received",A="event_empty",I="event_reset_directories",y="event_replace_directories",j="event_set_directories",S="event_resync",L="event_refresh_lp_key",M="transition_event",P="reset_peer",N="mutex",k="change_peer",R="event_change_tab",D="event_failed_message",w="event_resend",U="event_delete_dialog",H="event_edit_message",x="event_replace_message",F="event_invalidate_event",G="event_audio_start",B="event_waiting_for_reconnect",V="event_reconnecting",Y="event_reconnected",K="incoming_call",q=1,$=2,W=8,Q=16,J=32,X=64,z=128,Z=512,ee=65536,te=1<<21,ne=4096,re=1<<22,ae=1,ie=2,se=8,oe=32768,ce=1<<20,ue=1,de=2,le=3,_e=4,ge=5,fe=6,me=7,pe=8,he=9,be=10,ve=11,Oe=12,Ee=13,Te=14,Ce=15,Ae=16,Ie=17,ye=18,je=19,Se=1,Le=3;function Me(e){var t=a(e,2)[1];return{type:o,localId:t}}function Pe(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:u,messageId:n,mask:r,peerId:i}}function Ne(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:c,messageId:n,flags:r,peerId:i}}function ke(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:d,messageId:n,flags:r,peerId:i}}function Re(e){var t=a(e,11),n=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=t[6],d=t[7],_=t[8],g=t[9],f=t[10],m=extend(u,d||void 0);return{type:l,messageId:intval(n),flags:intval(i),peerId:intval(s),date:intval(o),attaches:Object(r.convertKludgesToAttaches)(m,n),subject:u.title||"",text:c,kludges:m,randomId:intval(_),userId:Object(r.isChatPeer)(s)?intval(m.from):intval(s),update_time:f,chat_local_id:g}}function De(e){var t=Re(e);return t.type=H,t}function we(e){var t=Re(e);return t.type=x,t}function Ue(e){var t=a(e,2)[1];return{type:F,messageId:t}}function He(e){return extend({},e,{type:H})}function xe(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:_,peerId:n,upToId:r,unread:i}}function Fe(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:g,peerId:n,upToId:r,unread:i}}function Ge(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:f,userId:-n,platform:r,lastSeenTs:i}}function Be(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:m,userId:-n,reason:r,lastSeenTs:i}}function Ve(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:I,peerId:n,mask:r,local:void 0!==i&&i}}function Ye(e){var t=a(e,3),n=t[1],r=t[2];return{type:y,peerId:n,mask:r}}function Ke(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:j,peerId:n,mask:r,local:void 0!==i&&i}}function qe(e){var t=a(e,3),n=t[1],r=t[2];return{type:U,peerId:n,localId:r}}function $e(e){var t=a(e,3),n=t[1],r=t[2];return{type:p,chatId:n,self:r}}function We(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:h,peerId:r,updateType:n,updateArg:i}}function Qe(e){var t=a(e,5),n=t[1],r=t[2],i=t[3],s=t[4];return{type:b,peerId:n,userIds:r,totalCount:i,ts:s}}function Je(e){var t=a(e,5),n=t[1],r=t[2],i=t[3],s=t[4];return{type:v,peerId:n,userIds:r,totalCount:i,ts:s}}function Xe(e){var t=a(e,3),n=t[1],r=t[2];return{type:O,userId:n,callId:r}}function ze(e){var t=a(e,4),n=t[1],r=t[2],i=t[3];return{type:E,count:n,countNotMuted:r,showOnlyNotMuted:i}}function Ze(e){var t=a(e,2)[1],n=void 0===t?{}:t;return{type:T,peerId:n.peer_id,sound:n.sound,disabledUntil:n.disabled_until}}function et(e){var t=a(e,2)[1];return{type:K,payload:t}}function tt(e){var t=a(e,2)[1],n=void 0===t?{}:t,r=Re([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return r.type=H,r}function nt(e){var t=a(e,2)[1],n=void 0===t?{}:t;return{type:G,uuid:n.uuid,deviceName:n.device_name||""}}function rt(e){var t=a(e,2)[1],n=t.event_id,r=t.owner_id,i=t.peer_id,s=t.action;return{type:C,event_id:n,owner_id:r,peer_id:i,action:s}}function at(e){return{type:A,params:e}}function it(e){return{type:M,state:e}}function st(){return{type:S}}function ot(e){var t=a(e,3),n=t[1],r=t[2];return{type:L,key:n,url:r}}function ct(e){var t=a(e,2)[1];return{type:B,timeout:t}}function ut(){return{type:V}}function dt(){return{type:Y}}function lt(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:P,cancelSearch:e,removeActivePeer:t}}function _t(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{type:k,peerId:e,msgid:t,forward:n,cancelSearch:r,entryPoint:a}}function gt(e){return{type:R,tab:e}}function ft(e,t,n){return{type:D,message:t,peer:e,error:n}}function mt(e){var t=a(e,6),n=(t[0],t[1]),r=t[2],i=t[3],s=t[4],o=t[5];return{type:N,free:!!intval(n)||intval(s)===vk.id,resource:r,peerId:intval(i),who:intval(s),name:o}}function pt(e,t){return{type:w,message:t,peerId:e}}},lJdi:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE",(function(){return c})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN",(function(){return u})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE",(function(){return d})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS",(function(){return l})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_INVITE_LINK",(function(){return _})),n.d(t,"MAIL_CHAT_FLAG_SERVICE_CHAT",(function(){return g})),n.d(t,"MAIL_CHAT_FLAG_IS_CHANNEL",(function(){return f})),n.d(t,"MAIL_CHAT_FLAG_IS_SUPERGROUP",(function(){return m})),n.d(t,"MAIL_CHAT_FLAG_IS_FAKE_CHANNEL",(function(){return p})),n.d(t,"MAIL_CHAT_FLAG_IS_PROMO_CHAT",(function(){return h})),n.d(t,"MAIL_CHAT_FLAG_IS_BUSINESS_NOTIFY",(function(){return b})),n.d(t,"MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE",(function(){return v})),n.d(t,"MAIL_CHAT_FLAG_IS_CASPER",(function(){return O})),n.d(t,"MAIL_CHAT_FLAG_IS_COPIED",(function(){return E})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT",(function(){return T})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED",(function(){return C})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION",(function(){return A})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION",(function(){return I})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE",(function(){return y})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE",(function(){return j})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN",(function(){return S})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK",(function(){return L})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK",(function(){return M})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL",(function(){return P})),n.d(t,"MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL",(function(){return N})),n.d(t,"MAIL_CHATS_ACTION_SEE_INVITE_LINK",(function(){return k})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_INVITE_LINK",(function(){return R})),n.d(t,"MAIL_CHATS_ACTION_INVITE_USER",(function(){return D})),n.d(t,"MAIL_CHATS_ACTION_PIN_OR_UNPIN",(function(){return w})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_TITLE",(function(){return U})),n.d(t,"MAIL_CHATS_ACTION_ADD_ADMIN",(function(){return H})),n.d(t,"MAIL_CHATS_ACTION_MASS_MENTION",(function(){return x})),n.d(t,"MAIL_CHATS_ACTION_START_GROUP_CALL",(function(){return F})),n.d(t,"canSeeInviteLink",(function(){return B})),n.d(t,"canMassMention",(function(){return V})),n.d(t,"canChangeInviteLink",(function(){return Y})),n.d(t,"canAddAdmin",(function(){return K})),n.d(t,"canInviteUser",(function(){return q})),n.d(t,"canKickUser",(function(){return $})),n.d(t,"canPinOrUnpin",(function(){return W})),n.d(t,"canStartGroupCall",(function(){return Q})),n.d(t,"canChangeTitle",(function(){return J})),n.d(t,"canChangeAvatar",(function(){return X})),n.d(t,"canSeeAllMessages",(function(){return z})),n.d(t,"canSeeSettingsItem",(function(){return Z})),n.d(t,"canCloseChat",(function(){return ee})),n.d(t,"checkChatRights",(function(){return te})),n.d(t,"doesChatTabHaveFlag",(function(){return ne})),n.d(t,"isUserAdminInChat",(function(){return re})),n.d(t,"isUserOwnerInChat",(function(){return ae})),n.d(t,"isUserInvitedByMe",(function(){return ie}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var r=n("rHUl"),a=n("aong"),i=n("P13b");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=1,u=4,d=8,l=16,_=32,g=64,f=256,m=512,p=1024,h=2048,b=4096,v=16384,O=32768,E=65536,T=1<<17,C=1<<18,A=1<<19,I=1<<20,y=1<<21,j=1<<22,S=1<<23,L=1<<24,M=1<<25,P=1<<26,N=1<<27,k="see_invite_link",R="change_invite_link",D="invite_user",w="pin_unpin",U="change_title",H="add_admin",x="mass_mention",F="call",G={[R]:[_,_],[H]:[l,l],[k]:[L,M],[D]:[c,y],[w]:[u,S],[U]:[d,j],[x]:[A,I],[F]:[P,N]};function B(e,t,n){return te(e,k,t,n)}function V(e,t,n){return te(e,x,t,n)}function Y(e,t,n){return te(e,R,t,n)}function K(e,t,n,i){var s=Object(a.unpackStore)(e);return!ae(Object(r.getTab)(s,n||s.peer),t)&&te(e,H,n,i)}function q(e,t,n){return te(e,D,t,n)}function $(e,t,n,s){var o=Object(a.unpackStore)(e);if(function(e,t){var n=Object(a.unpackStore)(e);return void 0!==n.service&&(n.service&t)>0}(e,1))return!0;var c=Object(r.getTab)(o,n||o.peer);return!(c.data.kicked&&!c.data.closed)&&(!Object(i.isFvkcomgroup)(e,n)&&(!ae(c,t)&&(!!ae(c,s=void 0===s?window.vk.id:s)||(re(c,s)||ie(c,t))&&!re(c,t))))}function W(e,t,n){return te(e,w,t,n)}function Q(e,t,n){return te(e,F,t,n)}function J(e,t,n){return te(e,U,t,n)}function X(e,t,n){return J(e,t,n)&&!Object(i.isFvkcomgroup)(e,t)}function z(e,t,n){return!Object(r.isCommunityPeer)(n)||!!Object(r.getTab)(e,t).caccess[n]}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,s=Object(a.unpackStore)(e),o=Object(i.isFvkcomgroup)(s,t),c=s.tabs[s.peer];if(Object(r.isCommunityChat)(s,t)){var u=c&&c.data&&Object(r.isChatActive)(c),d=ae(c,-s.gid)&&u,l=d||re(c,n)&&u,_=c.allowedUpdateFlags?c.allowedUpdateFlags.filter(e=>e!==v):[];return!(!l||!_.length)}return ae(c,n)&&!o}function ee(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,i=Object(a.unpackStore)(e),s=Object(r.isCommunityChat)(i,t),o=Object(r.isCommunityChatDeleted)(i,t),c=i.tabs[i.peer],u=c&&c.data&&Object(r.isChatActive)(c),d=ae(c,-i.gid)&&u,l=d||re(c,n)&&u;return s&&!o&&l&&c.allowedUpdateFlags&&c.allowedUpdateFlags.includes(v)}function te(e,t,n,o){var c=Object(a.unpackStore)(e),u=c.gid?-c.gid:window.vk.id;o=void 0===o?u:o,n=void 0===n?c.peer:n;var d=Object(r.getTab)(c,n),l=d&&d.data&&Object(r.isChatActive)(d),_=s(G[t],2),g=_[0],f=_[1],m=f|g,p=Object(i.isFvkcomgroup)(e,n),h=ae(d,o)&&l,b=h||re(d,o)&&l;if(p)switch(t){case H:case D:return!1;case k:return l;default:return c.gid>0}else if(Object(r.isCommunityChat)(e,n)){if(Object(r.isClosedChat)(e,n))return!1;switch(t){case k:return Object(r.isServiceChatTab)(d)?l:ne(d,m)?ne(d,f)?l:b:h;case R:return h||b;case H:return ne(d,m)?b:h;case x:case F:case D:return Object(r.isServiceChatTab)(d)?l:!h&&(ne(d,m)?b:l);case w:case U:return Object(r.isServiceChatTab)(d)?l:b;default:return!1}}switch(t){case R:return ne(d,g)?b:h;case H:return ne(d,m)?b:h;case k:return ne(d,m)?ne(d,f)?l:b:h;case D:case w:case x:case F:case U:return ne(d,m)?ne(d,g)?b:h:l}return!1}function ne(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function re(e,t){return(e&&e.adminIds||[]).indexOf(+t)>-1}function ae(e,t){return e.ownerId===t}function ie(e,t){return-1!==e.invitedByMe.indexOf(t)}},rHUl:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return l})),n.d(t,"isSearchShown",(function(){return _})),n.d(t,"getPeer",(function(){return g})),n.d(t,"getCurrentKeyboard",(function(){return f})),n.d(t,"getKeyboard",(function(){return m})),n.d(t,"getTab",(function(){return p})),n.d(t,"getCurrentTab",(function(){return h})),n.d(t,"getSelectedMessages",(function(){return b})),n.d(t,"getMessageRangeFromSelection",(function(){return v})),n.d(t,"countUnread",(function(){return O})),n.d(t,"getMessageByRid",(function(){return E})),n.d(t,"isRidExist",(function(){return T})),n.d(t,"getLocalId",(function(){return C})),n.d(t,"getLastMessage",(function(){return A})),n.d(t,"parserMessage",(function(){return I})),n.d(t,"getAuthorFullName",(function(){return y})),n.d(t,"getMessage",(function(){return j})),n.d(t,"getPreviousMessage",(function(){return S})),n.d(t,"isClassicInterface",(function(){return L})),n.d(t,"isLocksAvailable",(function(){return M})),n.d(t,"isFoldersAvailable",(function(){return P})),n.d(t,"isCommunityInterface",(function(){return N})),n.d(t,"isChannelPeer",(function(){return k})),n.d(t,"getBareTab",(function(){return R})),n.d(t,"isReversedDialogs",(function(){return D})),n.d(t,"isFullyLoadedTab",(function(){return w})),n.d(t,"makeTabNotFullyLoaded",(function(){return U})),n.d(t,"isGoToEndVisible",(function(){return H})),n.d(t,"isGoToMentionVisible",(function(){return x})),n.d(t,"getUnreadScrollBottom",(function(){return F})),n.d(t,"isSendingAvailable",(function(){return G})),n.d(t,"isCommunityPeer",(function(){return B})),n.d(t,"isCommunityBlocked",(function(){return V})),n.d(t,"checkVoiceMessageAvailable",(function(){return Y})),n.d(t,"isSearching",(function(){return K})),n.d(t,"getSearchText",(function(){return q})),n.d(t,"isSearchingValue",(function(){return $})),n.d(t,"isRecentSearchesActive",(function(){return W})),n.d(t,"getPinnedMessage",(function(){return Q})),n.d(t,"doPopularSuggExist",(function(){return J})),n.d(t,"isAnyMessageBeingEdited",(function(){return X})),n.d(t,"getGroupId",(function(){return z})),n.d(t,"getTabDraft",(function(){return Z})),n.d(t,"getTemplates",(function(){return ee})),n.d(t,"tabIsMessageRequest",(function(){return te})),n.d(t,"tabIsRejectedMessageRequest",(function(){return ne})),n.d(t,"tabIsMessageRequestToChat",(function(){return re})),n.d(t,"removeMessageRequestFolderFlags",(function(){return ae})),n.d(t,"isMessageRequestFolder",(function(){return ie})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return se})),n.d(t,"existsIncomingMessageRequest",(function(){return oe})),n.d(t,"isMessageRequestChangedEvent",(function(){return ce})),n.d(t,"isCommunityChat",(function(){return ue})),n.d(t,"isCommunityChatDeleted",(function(){return de})),n.d(t,"isClosedChat",(function(){return le})),n.d(t,"isCasperChat",(function(){return _e})),n.d(t,"isServiceChatTab",(function(){return ge})),n.d(t,"isCasperChatTab",(function(){return fe})),n.d(t,"isChatActive",(function(){return me})),n.d(t,"isTabMarkedUnread",(function(){return pe}));n("Vd3H"),n("rGqo"),n("Btvt");var r=n("MhhX"),a=n("f01n"),i=n("h++7"),s=n("86+7"),o=n("rjmT"),c=n("aong"),u=n("lJdi"),d=n("rudk");function l(e,t){var n=Object(c.unpackStore)(e),a=n.tabs[n.peer];return Object.keys(a.msgs).filter(n=>{var i=j(e,t,n);return!Object(r.isOut)(i)&&intval(n)>a.in_up_to})[0]}function _(e){return Object(c.unpackStore)(e).searchShown}function g(e){return Object(c.unpackStore)(e).peer}function f(e){return m(e,g(e))}function m(e,t){var n=(p(e,t)||{}).keyboard;if(!n||!n.buttons||n.buttons.length)return n}function p(e,t){var n=Object(c.unpackStore)(e);return n.tabs&&n.tabs[t]}function h(e){var t=Object(c.unpackStore)(e);return t.peer?t.tabs[t.peer]:null}function b(e){return Object(c.unpackStore)(e).selectedMessages}function v(e,t,n){var a=p(e,t),i=b(e)[0];if(void 0===i)return[n];var s=Math.min(n,i),o=Math.max(n,i);return Object.keys(a.msgs).filter(e=>e>=s&&e<=o).filter(t=>{var n=j(e,e.get().peer,t);return!Object(r.isServiceMsg)(n)&&!Object(r.isCallMessage)(n)}).map(intval)}function O(e,t){var n=p(Object(c.unpackStore)(t),e),a=0;for(var i in n.msgs)if(n.msgs.hasOwnProperty(i)){var s=j(t,e,i);Object(r.isOut)(s)||(a+=Object(r.isUnread)(n,s)?1:0)}return a}function E(e,t,n){var r=p(e,t);return Object.keys(r.msgs).filter(r=>intval(j(e,t,r).randomId)===n).length>0}function T(e,t,n){return!!E(e,t,n)}function C(e,t){var n=Object(c.unpackStore)(e),r=n.msg_local_ids_sort&&n.msg_local_ids_sort[t];return void 0!==r?2e9+r:t}function A(e,t,n){var r=p(e,t),i=j(e,t,n),s=Object.keys(r.msgs).filter(n=>{var r=j(e,t,n),s=r.local&&r.type!==a.EDIT_MESSAGE;return!(!i.local&&s)&&(!(!i.local||s)||C(e,i.messageId)>C(e,r.messageId))}).pop();return s?j(e,t,s):null}function I(e){return e&&e.length>0?a.addMessageEvent([0].concat(e)):e}function y(e,t,n){var a=p(e,t),i=j(e,t,n),o=Object(c.unpackStore)(e);return Object(r.isOut)(i)?Object(s.oCacheGet)(e,o.id).name:i.userId!==i.peerId?!!Object(s.oCacheExists)(e,i.userId)&&Object(s.oCacheGet)(e,i.userId).name:a.tab}function j(e,t,n){var r=p(e,t),a=r&&r.msgs&&r.msgs[n];return a?I(a):null}function S(e,t,n){var r=p(e,t),a=r&&r.msgs&&Object.keys(r.msgs).sort((e,t)=>+e-t);if(!a)return null;var i=a&&a.indexOf(""+n),s=i>-1?a[i-1]:null;return r.msgs[s]}function L(e){var t=Object(c.unpackStore)(e);return t.gid||t.isClassic}function M(e){return Object(c.unpackStore)(e).gid}function P(e){return Object(c.unpackStore)(e).gid}function N(e){return!!Object(c.unpackStore)(e).gid}function k(e){return!!(e.peerId>2e9&&Object(u.doesChatTabHaveFlag)(e,1024))}function R(e,t){var n=Object(c.unpackStore)(t);return n.tabs[e]||n.mapped_index[e]}function D(e){var t=Object(c.unpackStore)(e);return!!N(e)&&((19542789===t.gid||103416369==t.gid)&&(t.active_tab===i.FOLDER_UNRESPOND||t.active_tab===i.FOLDER_UNREAD))}function w(e,t){var n=(e=Object(c.unpackStore)(e)).tabs;return!(!n||!n[t]||void 0===n[t].history||!n[t].msgs)}function U(e,t){var n=p(e,t);n&&(n.msgs=void 0,n.msgid=void 0,n.scrollTop=void 0,n.scrollBottom=void 0,n.contHeight=void 0,n.offset=void 0,n.skipped=void 0)}function H(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function x(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function F(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function G(e){return!Object(c.unpackStore)(e).lockedSending}function B(e){return e>-2e9&&e<0}function V(e,t){return!!B(t)&&!!p(e,t).blocked_community}function Y(e){return Object(c.unpackStore)(e).voice_message_available}function K(e){var t=Object(c.unpackStore)(e);return!(!q(t)&&!t.recentSearch)}function q(e){return Object(c.unpackStore)(e).searchText}function $(e,t){var n=Object(c.unpackStore)(e);return!!(t&&t!==q(e)||n.recentSearch)}function W(e){return Object(c.unpackStore)(e).recentSearch}function Q(e){var t=h(e);return t&&t.pinned&&I(t.pinned)}function J(e){var t=e.get().popular_sugg;return t&&t.length>0}function X(e){return 1==Object(c.unpackStore)(e).isEditing}function z(e){return Object(c.unpackStore)(e).gid}function Z(e){return e.draft||(e.draft=Object(o.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function ee(e){return(Object(c.unpackStore)(e).templates||[]).filter(e=>!e.deleted)}function te(e){return!!e&&Boolean(e.is_message_request||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function ne(e){return Boolean(e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function re(e){return Object(d.isChatPeer)(e.peerId)&&te(e)}function ae(e){return e&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED]}function ie(e){return Object(c.unpackStore)(e).active_tab===i.FOLDER_MESSAGE_REQUEST}function se(e){return e.peerId>19e8&&e.peerId<2e9}function oe(e){return!!Object(c.unpackStore)(e).dialog_tab_cts[i.FOLDER_MESSAGE_REQUEST]}function ce(e){var t=e.type,n=e.updateType;return t===a.CONVERSATION_UPDATED&&(n===a.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||n===a.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ue(e,t){return Object(u.doesChatTabHaveFlag)(p(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function de(e,t){return Object(u.doesChatTabHaveFlag)(p(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function le(e,t){return Object(u.doesChatTabHaveFlag)(p(e,t),u.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function _e(e,t){return Object(u.doesChatTabHaveFlag)(p(e,t),u.MAIL_CHAT_FLAG_IS_CASPER)}function ge(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_SERVICE_CHAT)}function fe(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_IS_CASPER)}function me(e){return!e.data.closed&&!e.data.kicked}function pe(e){return!!(e.folders&i.FOLDER_MASKS[i.FOLDER_MARKED_UNREAD])}},rjmT:function(e,t,n){"use strict";n.r(t),n.d(t,"ImDraft",(function(){return c})),n.d(t,"loadDraftForPeer",(function(){return d}));n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("KKXr"),n("VRzm"),n("Btvt"),n("OEbY"),n("pIFo");var r=n("BxOC"),a=n("f01n"),i=n("vT4u");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function u(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function d(e,t){return new c(e,"draft_"+t)}c.prototype.dump=function(){if(this._key){var e,t={txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0},n=0===t.txt.length&&!t.attaches&&!t.urlBinds&&!t.cancelled;this._db.updateByKey(this._key,n?void 0:t)}},c.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},c.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},c.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},c.prototype.addAttach=function(e,t,n){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var r=this.dData.attaches.findIndex(n=>n.type===e&&n.id===t);-1===r?(this.dData.attaches.push({type:e,id:t,object:n}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[r]={type:e,id:t,object:n},this.dump())},c.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=s(e,2),n=t[0],r=t[1];return this.dData.attaches.find(e=>e.type==n&&e.id==r)||{type:n,id:r}})),this.dump()},c.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},c.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},c.prototype.addBindUrl=function(e,t,n){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:n}),this.dump())},c.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},c.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},c.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&a.FLAG_HAS_REPLY&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},c.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},c.prototype.hasAttaches=function(){return this.dData.attaches.length>0},c.prototype.destroy=function(){this.dData={},this._key=this._db=null},c.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(u)?Object(r.post)(i.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=s(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},c.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},c.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFwd",(function(){return s})),n.d(t,"convertKludgesToAttaches",(function(){return o})),n.d(t,"isReservedPeer",(function(){return c})),n.d(t,"isUserPeer",(function(){return u})),n.d(t,"isChatPeer",(function(){return d})),n.d(t,"convertAttachesToPhpMedia",(function(){return l}));var r=n("jE6c");function a(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var i={};function s(e){if(i[e])return i[e];for(var t=e?e.length:0,n=[],r=[],s="",o=0;o<t;o++){var c=e[o],u=c.charCodeAt(0);u>=48&&u<=57||"_"===c||"-"===c?s+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==s&&(r.push(s),n.push("id"),s=""),r.push(c),n.push(c))}s.length>0&&(r.push(s),n.push("id"));var d=function e(t,n,r,i){if(void 0===r&&(r=0),void 0===i&&(i=0),i>50)return[[],t.length];for(var s=[],o="";r<t.length;){var c=t[r];if("id"===c)o=n[r];else if(","===c&&o)s.push(a(o)),o="";else if("("===c){var u=e(t,n,r+1,i+1),d=u[0];r=u[1],s.push(a(o,d)),o=""}else if(")"===c)return""!==o&&s.push(a(o)),[s,r];r++}return o&&s.push(a(o)),[s,r]}(n,r)[0];return Object.keys(i).length>300&&(i={}),i[e]=d,d}function o(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:s(e.fwd).length}});for(var a=1;e["attach"+a+"_type"];++a)"call"===e["attach"+a+"_type"]?n.push({type:e["attach"+a+"_type"],id:e["attach"+a],initiatorId:Object(r.intval)(e["attach"+a+"_call_initiator_id"]),state:e["attach"+a+"_call_state"],duration:Object(r.intval)(e["attach"+a+"_call_duration"]),receiverId:Object(r.intval)(e["attach"+a+"_call_receiver_id"])}):n.push({type:e["attach"+a+"_type"],id:e["attach"+a],kind:e["attach"+a+"_kind"],productId:e["attach"+a+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function c(e){return 0==e}function u(e){return e>0&&e<2e9}function d(e){return e>2e9}function l(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},uytb:function(e,t,n){"use strict";n.r(t),n.d(t,"RECENT_SEARCH_OP",(function(){return s})),n.d(t,"PIN_HIDDEN_ID_OP",(function(){return o})),n.d(t,"deleteOldStoredFormat",(function(){return l})),n.d(t,"mount",(function(){return g}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var r=n("BJj/");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s="recent_search",o="pin_hide";function c(e){return"im_store_"+e}function u(e){return ls.get(c(e))||{}}function d(e,t,n){if(ls.checkVersion()){var r=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",r.length),n(c(e),r)}}function l(e,t){for(var n=["fwd","draft","bind_attach"],r=u(e),a=!1,i=n.length;i--;)n[i]in r&&(delete r[n[i]],a=!0);a&&d(e,r,t)}function _(e,t,n){n.key===c(e)&&(t.db=JSON.parse(n.newValue),t.checkTime=Date.now())}function g(e){var t=Object(r.debounce)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&l(e,t);var n={db:u(e),checkTime:Date.now()},i=_.bind(null,e,n);return window.addEventListener("storage",i,!1),{select:(t,r)=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),function(e,t,n){return t===s?e[t]||[]:t===o?e[t]&&e[t][n]:e[t]?extend(!0,{},e[t][n]):null}(n.db,t,r)),selectByKey:t=>(Date.now()-n.checkTime>1e3&&(n.db=u(e)),n.db[t]),update(r,i){var c=function(e,t,n){switch(e[t]||(e[t]={}),t){case s:var r=n;r&&r.length>0?e[t]=r:delete e[t];break;case o:var i=a(n,2),c=i[0],u=i[1];u?e[t][c]=+u:delete e[t][c]}return e}(n.db,r,i);return n.db=c,n.checkTime=Date.now(),d(e,c,t)},updateByKey:(r,a)=>(n.db[r]=a,n.checkTime=Date.now(),d(e,n.db,t)),unmount(){window.removeEventListener("storage",i,!1)}}}},vT4u:function(e,t,n){"use strict";n.r(t),n.d(t,"CONTROLLER",(function(){return I})),n.d(t,"ACTIVITY_PERIOD",(function(){return y})),n.d(t,"ACTIVITY_TYPE_TYPING",(function(){return j})),n.d(t,"ACTIVITY_TYPE_RECORDING_AUDIO",(function(){return S})),n.d(t,"CHAT_ACTION_SETTINGS",(function(){return k})),n.d(t,"CHAT_ACTION_BLOCK",(function(){return R})),n.d(t,"CHAT_ACTION_INVITE",(function(){return D})),n.d(t,"CHAT_ACTION_MEDIA",(function(){return w})),n.d(t,"CHAT_ACTION_SEARCH",(function(){return U})),n.d(t,"CHAT_ACTION_PIN_HIDE",(function(){return H})),n.d(t,"CHAT_ACTION_PIN_UNHIDE",(function(){return x})),n.d(t,"CHAT_ACTION_UNPIN",(function(){return F})),n.d(t,"CHAT_ACTION_MUTE",(function(){return G})),n.d(t,"CHAT_ACTION_UNMUTE",(function(){return B})),n.d(t,"CHAT_ACTION_CLEAR",(function(){return V})),n.d(t,"CHAT_ACTION_LEAVE",(function(){return Y})),n.d(t,"CHAT_ACTION_RETURN",(function(){return K})),n.d(t,"CHAT_ACTION_BLOCK_COMMUNITY",(function(){return q})),n.d(t,"CHAT_ACTION_ALLOW_COMMUNITY",(function(){return $})),n.d(t,"CHAT_ACTION_BLOCK_NOTIFY",(function(){return W})),n.d(t,"CHAT_ACTION_CALL_AUDIO",(function(){return Q})),n.d(t,"CHAT_ACTION_CALL_VIDEO",(function(){return J})),n.d(t,"CHAT_ACTION_UNREAD",(function(){return X})),n.d(t,"ACTION_PRIORITIES",(function(){return z})),n.d(t,"loadHashes",(function(){return Z})),n.d(t,"loadWriteHash",(function(){return ne})),n.d(t,"strHistory",(function(){return ae})),n.d(t,"updateBlockStates",(function(){return ie})),n.d(t,"setCallAvailability",(function(){return se})),n.d(t,"loadPeer",(function(){return oe})),n.d(t,"restoreHistoryQueue",(function(){return ce})),n.d(t,"removeFailed",(function(){return ue})),n.d(t,"removeExpiredFailed",(function(){return de})),n.d(t,"selectPeer",(function(){return _e})),n.d(t,"selectPeerOnMessage",(function(){return fe})),n.d(t,"changePeer",(function(){return me})),n.d(t,"updateMentions",(function(){return pe})),n.d(t,"setActions",(function(){return he})),n.d(t,"loadMoreHistory",(function(){return be})),n.d(t,"loadLessHistory",(function(){return ve})),n.d(t,"readLastMessages",(function(){return Ee})),n.d(t,"readTillSpecificMessage",(function(){return Te})),n.d(t,"markAudioMessageAsListened",(function(){return Ce})),n.d(t,"loadLongPollKey",(function(){return Ae})),n.d(t,"loadLongPollTs",(function(){return Ie})),n.d(t,"setMessageErrored",(function(){return ye})),n.d(t,"resendMessage",(function(){return je})),n.d(t,"loadAdmins",(function(){return Le})),n.d(t,"updateVideoThumb",(function(){return Ne})),n.d(t,"editMessage",(function(){return ke})),n.d(t,"addMessage",(function(){return Re})),n.d(t,"markInboundMessagesAsRead",(function(){return He})),n.d(t,"markOutboundMessagesAsRead",(function(){return xe})),n.d(t,"initTextStore",(function(){return Fe})),n.d(t,"processFwd",(function(){return Ge})),n.d(t,"mergeTabs",(function(){return Be})),n.d(t,"updateOnline",(function(){return Ve})),n.d(t,"setActivity",(function(){return Ye})),n.d(t,"updateActivity",(function(){return Ke})),n.d(t,"waitActivity",(function(){return qe})),n.d(t,"sendMessage",(function(){return We})),n.d(t,"deliverMessage",(function(){return Qe})),n.d(t,"deliverEditedMessage",(function(){return Je})),n.d(t,"addSelection",(function(){return Xe})),n.d(t,"cleanSelected",(function(){return ze})),n.d(t,"dropSelection",(function(){return Ze})),n.d(t,"replaceMessage",(function(){return et})),n.d(t,"saveMedia",(function(){return tt})),n.d(t,"loadMedia",(function(){return nt})),n.d(t,"addAttachmentsToStoreData",(function(){return rt})),n.d(t,"replaceMediaAttachesStore",(function(){return at})),n.d(t,"setCurrentSearchDate",(function(){return it})),n.d(t,"setInplaceSearch",(function(){return st})),n.d(t,"setCurrentSearch",(function(){return ot})),n.d(t,"searchHints",(function(){return ct})),n.d(t,"searchHintsIndex",(function(){return ut})),n.d(t,"localIndexToDialog",(function(){return dt})),n.d(t,"searchTopConv",(function(){return _t})),n.d(t,"searchImTopConv",(function(){return gt})),n.d(t,"searchLocalHints",(function(){return ft})),n.d(t,"preloadSearchIndex",(function(){return mt})),n.d(t,"loadDialogs",(function(){return pt})),n.d(t,"searchMessages",(function(){return ht})),n.d(t,"isSearchAllLoaded",(function(){return bt})),n.d(t,"isSearchingInplace",(function(){return vt})),n.d(t,"cancelSearch",(function(){return Ot})),n.d(t,"clearDate",(function(){return Et})),n.d(t,"searchInplaceStart",(function(){return Tt})),n.d(t,"searchMessagesInplace",(function(){return Ct})),n.d(t,"loadImportant",(function(){return At})),n.d(t,"loadActualLastMessage",(function(){return It})),n.d(t,"removeUnreadDeletedMsgsFromTab",(function(){return yt})),n.d(t,"removeMessagesMarkDeleted",(function(){return jt})),n.d(t,"removeMessages",(function(){return St})),n.d(t,"removeMessageSend",(function(){return Lt})),n.d(t,"removeMessagesWithRestore",(function(){return Mt})),n.d(t,"restoreMessage",(function(){return Pt})),n.d(t,"restoreMessageSend",(function(){return Nt})),n.d(t,"acceptMessageRequest",(function(){return Rt})),n.d(t,"rejectMessageRequest",(function(){return Dt})),n.d(t,"cancelMessageRequest",(function(){return wt})),n.d(t,"sendTyping",(function(){return Ut})),n.d(t,"sendRecordingAudio",(function(){return Ht})),n.d(t,"forwardMessages",(function(){return xt})),n.d(t,"prepareForward",(function(){return Ft})),n.d(t,"deletedDialog",(function(){return Gt})),n.d(t,"flushHistory",(function(){return Bt})),n.d(t,"updateChatTopic",(function(){return Vt})),n.d(t,"loadChatInfo",(function(){return Yt})),n.d(t,"addNewMemberOptimisticly",(function(){return Kt})),n.d(t,"addNewMember",(function(){return qt})),n.d(t,"loadChatMember",(function(){return $t})),n.d(t,"checkNewPeople",(function(){return Wt})),n.d(t,"loadNewPeople",(function(){return Qt})),n.d(t,"updateChatPhoto",(function(){return Jt})),n.d(t,"updateActions",(function(){return Xt})),n.d(t,"leaveChat",(function(){return zt})),n.d(t,"returnToChat",(function(){return Zt})),n.d(t,"toggleMutePeer",(function(){return en})),n.d(t,"toggleMuteMentionsPeer",(function(){return tn})),n.d(t,"setMutedPeer",(function(){return nn})),n.d(t,"setExecStack",(function(){return rn})),n.d(t,"favMessage",(function(){return an})),n.d(t,"updateFavMessage",(function(){return sn})),n.d(t,"updateImportant",(function(){return on})),n.d(t,"loadSpam",(function(){return cn})),n.d(t,"flushSpam",(function(){return un})),n.d(t,"setCreationType",(function(){return dn})),n.d(t,"getOwnerPhoto",(function(){return ln})),n.d(t,"getContactsList",(function(){return _n})),n.d(t,"presetAvatar",(function(){return gn})),n.d(t,"setChatPhoto",(function(){return fn})),n.d(t,"createChat",(function(){return mn})),n.d(t,"createCommunityChat",(function(){return pn})),n.d(t,"resync",(function(){return hn})),n.d(t,"toggleSendingAbility",(function(){return bn})),n.d(t,"setDelayedMessage",(function(){return vn})),n.d(t,"isAnythingLoading",(function(){return On})),n.d(t,"updateUnreadCount",(function(){return En})),n.d(t,"changeSubmitSettings",(function(){return Tn})),n.d(t,"updateFavAndTitle",(function(){return Cn})),n.d(t,"saveHistoryScroll",(function(){return An})),n.d(t,"filterFromTab",(function(){return In})),n.d(t,"changeDialogsTab",(function(){return yn})),n.d(t,"updateFolderState",(function(){return Sn})),n.d(t,"toggleDialogImportant",(function(){return Ln})),n.d(t,"markDialogAnswered",(function(){return Mn})),n.d(t,"markDialogUnread",(function(){return Pn})),n.d(t,"markDialogRead",(function(){return Nn})),n.d(t,"getMutexQueue",(function(){return kn})),n.d(t,"releaseBlock",(function(){return Rn})),n.d(t,"toggleCommunityMute",(function(){return Dn})),n.d(t,"deleteDialog",(function(){return wn})),n.d(t,"restoreDialog",(function(){return Un})),n.d(t,"spamDialog",(function(){return Hn})),n.d(t,"updateTabbedPeers",(function(){return xn})),n.d(t,"isEverythingLoaded",(function(){return Fn})),n.d(t,"cleanTab",(function(){return Gn})),n.d(t,"stringifyTab",(function(){return Bn})),n.d(t,"updateGoToEndVisibility",(function(){return Vn})),n.d(t,"updateGoToMentionVisibility",(function(){return Yn})),n.d(t,"toggleCommunityMessages",(function(){return Kn})),n.d(t,"updateHistory",(function(){return qn})),n.d(t,"syncHistory",(function(){return $n})),n.d(t,"startRecording",(function(){return Wn})),n.d(t,"cancelRecording",(function(){return Qn})),n.d(t,"setVoiceMessageAvail",(function(){return Jn})),n.d(t,"toggleConversation",(function(){return Xn})),n.d(t,"updateSearchQuery",(function(){return zn})),n.d(t,"initializeChatResize",(function(){return Zn})),n.d(t,"joinChat",(function(){return er})),n.d(t,"getInviteLink",(function(){return tr})),n.d(t,"resetInviteLink",(function(){return nr})),n.d(t,"leaveInvitation",(function(){return rr})),n.d(t,"saveRecentSearchPeer",(function(){return ar})),n.d(t,"resetRecentSearch",(function(){return ir})),n.d(t,"removeFromRecentSearch",(function(){return sr})),n.d(t,"pinMessageOptimistic",(function(){return or})),n.d(t,"unpinMessageOptimistic",(function(){return cr})),n.d(t,"pinMessage",(function(){return ur})),n.d(t,"unpinMessage",(function(){return dr})),n.d(t,"getPinnedMessage",(function(){return lr})),n.d(t,"getMessageLocalId",(function(){return _r})),n.d(t,"getChatMembers",(function(){return gr})),n.d(t,"getChatDetails",(function(){return fr})),n.d(t,"updateFlags",(function(){return mr})),n.d(t,"removeChatPhoto",(function(){return pr})),n.d(t,"kickUserOptimisticly",(function(){return hr})),n.d(t,"kickUser",(function(){return br})),n.d(t,"toggleAdminOptimisticly",(function(){return vr})),n.d(t,"toggleAdmin",(function(){return Or})),n.d(t,"checkChatMember",(function(){return Er})),n.d(t,"hidePromoTooltip",(function(){return Tr})),n.d(t,"videoAutoPlayHandler",(function(){return Cr})),n.d(t,"hideTopBannerAction",(function(){return Ar})),n.d(t,"callbackTopBannerAction",(function(){return Ir})),n.d(t,"loadBanner",(function(){return yr})),n.d(t,"setKeyboard",(function(){return jr})),n.d(t,"deleteKeyboard",(function(){return Sr})),n.d(t,"toggleKeyboard",(function(){return Lr})),n.d(t,"loadKeyboard",(function(){return Mr})),n.d(t,"changeCommunityAccess",(function(){return Pr})),n.d(t,"deleteTemplate",(function(){return Nr})),n.d(t,"createTemplate",(function(){return kr})),n.d(t,"updateTemplate",(function(){return Rr})),n.d(t,"resetTabAll",(function(){return Dr})),n.d(t,"updateMessageRequestsCounter",(function(){return wr})),n.d(t,"updateCasperMessageExpiringStatus",(function(){return Ur})),n.d(t,"prepareCasperMessagesFromMessages",(function(){return Hr})),n.d(t,"peerProfileToggleTag",(function(){return xr})),n.d(t,"peerProfileManageTags",(function(){return Fr})),n.d(t,"peerProfileSaveNote",(function(){return Gr})),n.d(t,"reloadMessage",(function(){return Br})),n.d(t,"getPeerActiveCallData",(function(){return Vr})),n.d(t,"removePeerActiveCallData",(function(){return Yr}));n("HEwt"),n("rE2o"),n("ioFf"),n("hhXQ"),n("a1Th"),n("OG14"),n("OEbY"),n("Vd3H"),n("91GP"),n("SRfc"),n("rGqo"),n("VRzm"),n("Btvt");var r=n("BxOC"),a=n("bIHZ"),i=n("f01n"),s=n("DM26"),o=n("rudk"),c=n("aong"),u=n("uytb"),d=n("P13b"),l=n("h++7"),_=n("rHUl"),g=n("MhhX"),f=n("86+7"),m=n("ERyv"),p=n("Wu9C"),h=n("lJdi"),b=n("O8ze"),v=n("zxIV"),O=n("XzvV"),E=n("ambf");function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var I="al_im.php",y=5,j="typing",S="audiomessage",L=Object(a.updateLazyLocation)(),M=L.scheduleNav,P=L.commitNav,N=L.scheduleNavWithTimeOut;var k="settings",R="block",D="invite",w="media",U="search",H="pin_hide",x="pin_unhide",F="unpin",G="mute",B="unmute",V="clear",Y="leave",K="return",q="block_community",$="allow_community",W="block_notify",Q="call_audio",J="call_video",X="unread",z={[k]:0,[R]:1,[D]:2,[w]:3,[U]:6,[X]:6,[H]:7,[x]:7,[F]:8,[G]:10,[B]:10,[V]:11,[Y]:12,[K]:12,[q]:12,[$]:12,[W]:12};function Z(e,t,n){return Object(r.post)(I,{act:"a_renew_hash",peers:e.join(","),gid:t.hidegid?void 0:n.gid})}function ee(e,t,n){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then(r=>r?t(...n):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var n=Object.keys(e.tabs).filter(t=>Object(d.isFullyLoadedTab)(e,t));e.renew_hashes=Z(n,{},e).then(t=>{var r=C(t,3),a=r[0],i=r[1],s=r[2];return n.forEach(t=>{e.tabs[t].hash=a[t]}),e.writeHash=i,e.manageTagsHash=s,delete e.renew_hashes,e.last_hashes_update=Date.now(),e})}return e.renew_hashes}(e).then(e=>t(...n)))}function te(e){return function(){var t=arguments,n=t[t.length-1];return e(...t).catch(r=>{if(r&&r.match&&r.match(/1001;/))return ee(n,e,t);throw r})}}function ne(e){return Object(r.post)(I,T({act:"a_get_write_hash"},e))}function re(e){return"string"==typeof e?Object(v.se)(`<div>${e}</div>`):e}function ae(e){return"string"==typeof e?e:e.innerHTML}function ie(e,t){return t.block_states=extend(t.block_states,e),Promise.resolve(t)}function se(e,t){return t.tabs[e].can_start_call=Object(h.canStartGroupCall)(t,e),Promise.resolve(t)}function oe(e,t,n,a,i){return i.tabHistoryNotChanged=!1,Object(s.retryFn)(r.post,3,e=>e-1)(I,{act:"a_start",peer:e,msgid:n,history:t,prevpeer:i.prevPeer,gid:i.gid,block:a}).then(t=>{var r=C(t,6),a=r[0],s=r[1],o=r[2],c=r[3],u=r[4],_=r[5];if(s.forEach(e=>Object(f.oCacheAdd)(i,e)),i.tabs||(i.tabs={}),i.dialog_tab_cts=Object.assign({},u,{[l.FOLDER_MESSAGE_REQUEST]:i.dialog_tab_cts[l.FOLDER_MESSAGE_REQUEST]}),i.tabs[e]||(i.tabs[e]=Object(d.normalizeTab)(i,a)),ie(c,i),n){if(i.tabs[e]){var g=i.tabs[e].lastmsg,m=i.tabs[e].lastmsg_meta;extend(i.tabs[e],a),i.tabs[e].lastmsg=g,i.tabs[e].lastmsg_meta=m}}else extend(i.tabs[e],a);return i.admins=extend(i.admins,o),i.imQueue(e,!1),Cr(),_&&(i.tabs[e].peer_profile_info=_),ce(e,i)}).catch(e=>Object(m.imWeirdCatch)("loadPeer",e))}function ce(e,t){var n=t.imQueue(e,!1),r=t.tabs[e],a=n.filter(n=>!Object(_.isRidExist)(t,e,n.rid));return r.msgs=a.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),r.msgs),t.imQueueSet(e,a),t.tabs[e].history=Object(d.restoreQueue)(a,t,re(t.tabs[e].history)),Promise.resolve(t)}function ue(e,t,n,r){var a=r.imQueue(t),i=[],s=[];return a.forEach(e=>{e.failed&&n&&e.mess.messageId!==n&&s.push(e),!e.failed||n&&e.mess.messageId!==n||i.push("rid"+e.rid)}),r.imQueueSet(t,s),r.tabs[t].history=Object(d.removeMessages)(i,re(r.tabs[t].history)),Object(d.removeMessages)(i,e),Promise.resolve(r)}function de(e,t,n){var r=n.imQueue(t),a=[],i=[],s=Date.now();return r.forEach(e=>{e.failed&&s-e.ts<864e5&&i.push(e),e.failed&&s-e.ts>=864e5&&a.push("rid"+e.rid)}),n.imQueueSet(t,i),n.tabs[t].history=Object(d.removeMessages)(a,re(n.tabs[t].history)),Object(d.removeMessages)(a,e),Promise.resolve(n)}function le(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(r.post)(I,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>ie(C(e,1)[0],t))}function _e(e,t){var n=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(d.isFullyLoadedTab)(t,n)&&!t.tabs[n].msgid?(t.gid&&le(n,t),Promise.resolve(t).then(he)):(Object(d.isFullyLoadedTab)(t,n)&&(t.tabs[n].msgid=!1),oe(n,e,!1,!0,t)))).then(he).then(ge.bind(null,n))}function ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(d.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(d.isTabLoaded)(t,e)&&n&&(t.tabs[e].last_visited=Date.now()),t}function fe(e,t,n){var r=n.msgid,a=n.peer;return!e&&Object(d.isFullyLoadedTab)(n,a)&&n.tabs[a].msgs[r]?(t===n.peer?n.tabHistoryNotChanged=!0:n.tabHistoryNotChanged=!1,n.gid&&le(a,n),Promise.resolve(n).then(he).then(ge.bind(null,a))):oe(a,!0,r,!0,n).then(he).then(()=>(Object(_.getTab)(n,a).msgid=r,n)).then(ge.bind(null,a))}function me(e,t,n,r){if(On(r))throw Object(d.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var a=r.gid?"gim"+r.gid:"im";if(r.prevPeer=r.peer,r.peer=e,r.msgid=t||"",r.currentEntryPoint=n,cur.peer=e,M({sel:e?Object(d.convertPeerToUrl)(e):null,msgid:r.msgid,email:"",0:a}),0!=r.prevPeer&&ge(r.prevPeer,r,!0),0!==e){Object(d.isTabLoaded)(r,e)&&ge(e,r,!0),xn(r.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(r.tabbedPeers):r.tabbedPeers.map(t=>(t.peer==e&&"perm"!==t.type&&(t.type="perm"),t)),!1,r)}else xn(r.tabbedPeers,!1,r);return P(),Ot(r.prevPeer,r)}function pe(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((n,r)=>{if(cur.wallMentions=[],!Object(d.isChatPeer)(e.peer)||!Object(d.isFullyLoadedTab)(e,e.peer)||Object(d.isFvkcomgroup)(e,e.peer))return r();var a=e.tabs[e.peer];function i(){var r=[];Object.keys(a.msgs||{}).reverse().forEach(e=>{var t=Object(_.parserMessage)(a.msgs[e]),n=t&&t.userId;n&&n!=vk.id&&-1===r.indexOf(n)&&Object(d.isUserAliveInChat)(a,n)&&r.push(n)}),(a.memberIds||[]).forEach(e=>{-1===r.indexOf(e)&&r.push(e)});var i=[];r.forEach(t=>{if(Object(f.oCacheExists)(e,t)){var n=Object(f.oCacheGet)(e,t),r=n.link.substring(1);i.push([n.id,n.name,"@"+r,n.photo,void 0,void 0,void 0,r,n.first_name,""])}});var s=getLang("mail_im_mention_all"),o=getLang("mail_im_mention_online");t&&Object(h.canMassMention)(e)&&i&&i.length>1&&(l.MASS_MENTION_ALIASES.online.forEach(e=>i.push(["online",o,"@"+e,"/images/mention_online.svg",void 0,void 0,void 0,e,e,""])),l.MASS_MENTION_ALIASES.all.forEach(e=>i.push(["all",s,"@"+e,"/images/mention_all.svg",void 0,void 0,void 0,e,e,""]))),n(i)}a.membersLoaded?i():gr(e.peer,e).then(i)})}function he(e){var t=e.peer;if(0===t)return Promise.resolve(e);var n=e.tabs[t],r=Object(d.isChatPeer)(t),a=Object(_.isChannelPeer)(n),i=Object(_.isCommunityChat)(e,t),s=r&&!Object(_.isChatActive)(n),o=!!n.offset,c=[];o&&c.push(w),o&&c.push(U),0===n.unread&&c.push(X),!Object(d.isEmailPeer)(t)&&!o||a||c.push(V),!Object(d.isCommunityInterface)(e)||a||i||c.push(R),a&&!s&&c.push(k),Object(d.isCommunityPeer)(t)&&(n.can_send_notify?c.push(W):c.push(n.blocked_community?$:q)),!Object(d.isCommunityInterface)(e)&&(r||Object(d.isUserPeer)(t)||Object(d.isCommunityPeer)(t))&&(!r||!s)&&c.push(inArray(t,e.mutedPeers)?B:G);var u=!Object(d.isCommunityInterface)(e)&&Object(d.isUserPeer)(t)&&n.is_friend&&!n.block_error,l=r&&!s&&Object(h.canInviteUser)(e);(u||l)&&c.push(D),!r||s||Object(d.isCommunityInterface)(e)||c.push(Y),r&&n.data.closed&&!n.data.kicked&&c.push(K),r&&n.pinned&&(c.push(Object(p.isPinnedMessageVisibleInTab)(e,t)?H:x),Object(h.canPinOrUnpin)(e)&&c.push(F));var g=Object(d.chatActions)(e,a);return e.curActions=c.sort((e,t)=>z[e]-z[t]).reduce((e,t)=>(e[t]=g[t],e),{}),Promise.resolve(e)}function be(e,t,n){var a=n.tabs[n.peer];return Object(r.post)(I,{peer:n.peer,whole:e,act:"a_history",offset:a.offset+(a.skipped||0),toend:t,gid:n.gid}).then(e=>{var t=C(e,4),r=t[0],i=t[1],s=t[2],o=t[3];return a.allShown=s,n.admins=extend(n.admins,o),a.history=r+ae(a.history),a.historyToAppend=r,a.offset+=Object.keys(i).length,a.msgs=extend(a.msgs,i),n})}function ve(e){var t=e.tabs[e.peer];return Object(r.post)(I,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(n=>{var r=C(n,5),a=r[0],i=r[1],s=r[2];r[3],r[4];t.allShown=t.allShown||s,t.history=ae(t.history)+a,t.historyToAppend=a;var o=Object.keys(i).length;return t.skipped-=o,t.offset+=o,t.msgs=extend(t.msgs,i),e})}function Oe(e,t,n,r){var a=e.tabs[t];return r===i.FLAG_OUTBOUND&&a.out_up_to>n||(r===i.FLAG_OUTBOUND?a.out_up_to=n:a.in_up_to=n),e}var Ee=te((function(e,t){if(Object(d.tabIsMessageRequest)(t.tabs[e]))return Promise.resolve(t);var n=t.tabs[e],a=n.msgs||{},s=Object.keys(a).map(n=>Object(_.getMessage)(t,e,n)).filter(e=>!Object(g.isOut)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return n.skipped>0&&(s=s.filter(e=>intval(e)<=n.lastmsg-n.skipped)),(s=intval(s.shift()))<=n.in_up_to?Promise.resolve(t):(t.longpoll.push([i.readInboundEvent([6,e,s,null])]),Object(r.post)(I,{peer:e,ids:[s],hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>Oe(t,e,s,i.FLAG_OUTBOUND)).catch(()=>t))})),Te=te((function(e,t,n){var a=n.tabs[t];return Object(d.tabIsMessageRequest)(a)||Object(d.tabIsOutgoingMessageRequest)(a)||e<=a.in_up_to?Promise.resolve(n):(n.longpoll.push([i.readInboundEvent([6,t,e,null])]),Object(r.post)(I,{peer:t,ids:[e],hash:a.hash,act:"a_mark_read",gid:n.gid}).then(()=>Oe(n,t,e,i.FLAG_OUTBOUND)))})),Ce=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(I,{peer:e,id:t,hash:a.hash,act:"a_mark_listened",gid:n.gid})}));function Ae(e){return Object(r.post)(I,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var n=C(t,3),r=n[0],a=n[1],i=n[2];return extend({},e,{imKey:r,imUrl:a,imPart:i})})}function Ie(e){return Object(r.post)(I,{act:"a_get_ts",gid:e.gid}).then(t=>{var n=C(t,1)[0];return extend({},e,{imTs:n})})}function ye(e,t,n){var r=n.tabs[e];return r.msgs[t.messageId]&&(r.msgs[t.messageId].errored=1,r.history=Object(d.setMessageError)(e,t,re(r.history))),Promise.resolve(n)}function je(e,t,n,r){var a=r.tabs[e];return a.msgs[t]&&(a.msgs[t].errored=0,a.lastmsg_meta=n,a.lastmsg=t,a.history=Object(d.startResendMessage)(e,t,re(a.history))),Promise.resolve(r)}function Se(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((e,i)=>(!n&&!In(i)(t)||a&&!a(i,e[i],t)||(e[i]=Object(c.arrayUnique)(r(e[i],i))),e),e.dialog_tabs))}function Le(e,t){return 0===e.length?Promise.resolve(t):Object(r.post)(I,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var n=C(e,1)[0];return t.admins=extend(t.admins,n),t})}function Me(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var n={peer:e,type:"temp"};xn(t.tabbedPeers.concat([n]),!1,t)}}function Pe(e,t,n){return Object(d.isReversedDialogs)(n)?t.concat([e]):[e].concat(t)}function Ne(e,t){var n=e.get().peer,r=Object(_.getTab)(e,n);if(Object(d.isFullyLoadedTab)(e,n)){var a=re(r.history);r.history=Object(d.updateMessageInCache)(e,a,t)}}function ke(e,t){var n=Object(_.getTab)(t,e.peerId);if(Object(d.isFullyLoadedTab)(t,e.peerId)){var r=re(n.history);n.msgs[e.messageId]=extend(!0,{},e),n.history=Object(d.editAndReplaceMessage)(t,e,r)}n&&n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var a=n&&n.pinned&&Object(_.parserMessage)(n.pinned);if(a&&a.messageId===e.messageId&&(n.pinned=e),Object(d.isTabLoaded)(t,e.peerId)&&!Object(g.isOut)(e)&&Object(g.isUnread)(n,e)){var i=Object(g.hasUserMentions)(e,t.id),s=n.mentions&&n.mentions.includes(e.messageId);i&&!s?(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):!i&&s&&Ue(e.peerId,t=>t!==e.messageId,t)}return Promise.resolve(t)}function Re(e,t){var n=e.flags&i.FLAG_OUTBOUND,r=e.peerId;if(Object(d.isTabLoaded)(t,r)){var a=t.tabs[r];if(a.lastmsg>e.messageId)return Promise.resolve(t);if(a.deletedDialog=!1,!t.msg_local_ids_sort&&e.local?t.msg_local_ids_sort={[e.messageId]:0}:e.local&&(t.msg_local_ids_sort[e.messageId]=Object.keys(t.msg_local_ids_sort).length),n||Object(d.tabIsMessageRequest)(a)?a.unread=0:(a.lastmsg===e.messageId&&a.unread?De(t,1,e.peerId):(!a.unread&&De(t,1,e.peerId),a.unread++),E.casperMessagesStore.has(e.messageId)&&!Object(_.isCasperChatTab)(a)&&(a.expiring_messages||(a.expiring_messages=[]),a.expiring_messages.push(e.messageId)),Object(g.hasUserMentions)(e,t.id)&&(a.mentions||(a.mentions=[]),a.mentions.push(e.messageId)),Me(e.peerId,t)),Object(d.isFullyLoadedTab)(t,r)){var s=Object(g.isMessageToBlockedCommunity)(a,e),o=s||0===a.offset;s&&(a.blocked_community=0),a.skipped>0&&a.skipped++,a.offset++,a.msgs[e.messageId]=extend(!0,{},e);var c=re(a.history);a.history=Object(d.appendToHistory)(t,e,c,!0,!0,!0),o&&he(t)}if(a.typing){var u=a.typing.userIds.indexOf(e.userId);u>=0&&a.typing.userIds.splice(u,1)}return a.lastmsg=e.messageId,a.lastmsg_meta=e,Number.isInteger(e.messageId)&&e.messageId>(a.minor_sort_id||0)&&(a.minor_sort_id=e.messageId),ge(e.peerId,t),Se(t,a,!1,Pe.bind(null,r),jn.bind(null,t)),Promise.resolve(t)}return oe(r,0,0,0,t).then(t=>(Se(t,t.tabs[r],!1,Pe.bind(null,r),jn.bind(null,t)),ge(e.peerId,t),n||Me(e.peerId,t),t))}function De(e,t,n){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[n],e.unread_cnt+=t}function we(e,t,n){var r=n.tabs[e];return r.expiring_messages&&(r.expiring_messages=r.expiring_messages.filter(t),r.expiring_messages.length||delete r.expiring_messages),n}function Ue(e,t,n){var r=n.tabs[e];return r.mentions&&(r.mentions=r.mentions.filter(t),r.mentions.length||delete r.mentions),n}function He(e,t){var n=Object(_.getTab)(t,e.peerId);if(Object(d.isFullyLoadedTab)(t,e.peerId)){var r=n.unread;if(t=Oe(t,e.peerId,e.upToId,0),null!==e.unread?n.unread=e.unread:n.unread=e.upToId>=n.lastmsg?0:Object(_.countUnread)(e.peerId,t)+(n.unread>0?+n.skipped:0),r>0&&!n.unread&&De(t,-1,e.peerId),!n.skipped){var a=re(n.history);n.history=Object(d.removewNewUnreadBarAndMerge)(t,a,e.peerId)}}else Object(d.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&De(t,-1,e.peerId),t.tabs[e.peerId].unread=0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(d.isTabLoaded)(t,e.peerId)&&e.upToId>=n.lastmsg&&(t.dialog_tabs[l.FOLDER_UNREAD]=t.dialog_tabs[l.FOLDER_UNREAD].filter(t=>intval(t)!==e.peerId)),Object(d.isTabLoaded)(t,e.peerId)&&(we(e.peerId,t=>t>e.upToId,t),Ue(e.peerId,t=>t>e.upToId,t)),0!==t.unread_cnt||t.active_tab!==l.FOLDER_UNREAD||t.gid?Promise.resolve(t):yn(l.FOLDER_ALL,t)}function xe(e,t){var n=t.tabs[e.peerId];if(Object(d.isTabLoaded)(t,e.peerId)&&Oe(t,e.peerId,e.upToId,i.FLAG_OUTBOUND),Object(d.isFullyLoadedTab)(t,e.peerId)){var r=re(n.history);n.history=Object(d.markMessagesAsRead)(t,e.peerId,r)}return Promise.resolve(t)}function Fe(e,t,n,r,a){return a.text={},a.imQueue=e,a.imQueueResend=t,a.imQueueSet=n,a.imQueueComplete=r,Promise.resolve(a)}function Ge(e,t,n){function r(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var a=e[0],i=Object(_.getMessage)(n,t,a),s=Object(_.getAuthorFullName)(n,t,a);return!1===s?n.set($t.bind(null,{[t]:[i.userId]})).then(n=>{var s=Object(_.getAuthorFullName)(n,t,a);return{msgIds:e,object:r(i,s)}}):Promise.resolve({msgIds:e,object:r(i,s)})}return Promise.resolve({msgIds:e})}function Be(e,t){Object(d.normalizeTabsGotFromServer)(t,e);var n=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((n,r)=>{var a=t.tabs[r]?t.tabs[r].msgs:{},i=extend({},a||{},e[r].msgs||{});return n[r]=extend(t.tabs[r]||{},e[r]),i&&(n[r].msgs=i),e[r].lastmsg||(Object(d.isLastMsgDebugEnabled)(t)&&!1!==n[r].lastmsg&&(console.log(T({},e[r])),Object(d.showDebugAlert)()),n[r].lastmsg=!1),n},t.tabs),n&&(t.tabs[t.peer]=n),Promise.resolve(t)}function Ve(e,t,n,r){var a=Object(_.getTab)(r,e);if(a&&a.last_seen&&a.last_seen.can_see){var i=!1!==t?mobPlatforms[t]?1:0:a.last_seen.mobile;a.online=t,a.last_seen={platform:t,time:n||a.last_seen.time,mobile:i,can_see:a.last_seen.can_see}}return Promise.resolve(r)}function Ye(e,t,n){var r=Object(_.getTab)(n,e.peerId);return r&&(e.ts=Date.now()/1e3,r.activity||(r.activity={}),r.activity[t]=e,r.typing===j&&(r.typing=e)),Promise.resolve(n)}function Ke(e,t){var n=Object(_.getTab)(t,e.peerId),r=Object(g.isAudioMsg)(e)?"audiomessage":"typing";return n&&n.activity&&n.activity[r]&&(n.activity[r].userIds=n.activity[r].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function qe(e,t,n){var r=e.peerId;return Object(s.pause)(y+2).then(()=>{if(Object(d.isTabLoaded)(n,r)){var e=n.tabs[r];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*y&&(delete e.activity[t],0===Object.keys(e.activity)&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*y&&(e.typing=void 0)}return n})}function $e(e){var t={},n=e.find(e=>"poll"===e[0]);if(n){var r=C(n,3)[2];Object.assign(t,r)}return t}var We=function(e,t,n,a){var i=Date.now()+rand(0,100).toFixed(0),s=a.ref_id,c=a.ref_source;a.ref_source=void 0,a.ref_id=void 0,(c||s)&&(M({ref_source:null,ref:null}),P()),Object(b.statlogsSendingQueueLength)(a);var u=t.attaches.length>0,d=Object(b.statlogsSendingTime)(a,"send","server",u),l=Object.assign({act:"a_send",to:e,hash:n.hash,ref_source:c,ref:s,msg:t.message,payload:t.payload,media:Object(o.convertAttachesToPhpMedia)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:n.hidegid?void 0:a.gid,entrypoint:a.currentEntryPoint||"",sticker_referrer:t.sticker_referrer},n.external,$e(t.attaches));return Object(r.post)(I,l,2e4).then(e=>{var t=C(e,1)[0];return d(),a.version!==t.version&&nav.reload({force:!0}),a.currentEntryPoint="",a}).catch(e=>{throw Object(b.statlogsSendingError)(a,e,"send","server_send"),e})},Qe=te((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,a=r.tabs[e];return We(e,t,T({hash:a.hash},n),r)})),Je=te((function(e,t,n){var a=t.attaches.length>0,i=Object(b.statlogsSendingTime)(n,"edit","server",a);return Object(r.post)(I,Object.assign({act:"a_edit_message",hash:e.hash,id:t.messageId,peerId:e.peerId,gid:n.gid,msg:t.origText,media:Object(o.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},$e(t.attaches)),2e4).then(e=>{C(e,1)[0];return i(),n}).catch(e=>{throw Object(b.statlogsSendingError)(n,e,"edit","server_send"),e})}));function Xe(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var n=t.selectedMessages.concat(e);t.selectedMessages=Object(c.arrayUnique)(n).sort((e,t)=>e-t)}return Promise.resolve(t)}function ze(e){return e.selectedMessages=[],Promise.resolve(e)}function Ze(e){return e.selectedMessages=[],Promise.resolve(e)}function et(e,t){if(Object(d.isFullyLoadedTab)(t,e.peerId)){var n=t.tabs[e.peerId],r=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,r),t.imQueueComplete(e.peerId,e.randomId),n.lastmsg_meta=e,n.lastmsg=e.messageId,Number.isInteger(e.messageId)&&e.messageId>n.minor_sort_id&&(n.minor_sort_id=e.messageId),n.msgs["rid"+e.randomId]&&(n.msgs[e.messageId]=e,delete n.msgs["rid"+e.randomId]),n.history=Object(d.replaceMessageAttrs)(t,re(n.history),e)}return Promise.resolve(t)}function tt(e,t){return Promise.resolve()}function nt(e,t){var n=Object(b.statlogsSendingTime)(t,"unknown","attach"),a={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(s.retryFn)(r.post,3,e=>e*e)(I,a).then(r=>(n(),rt(e,r,t))).catch(n=>(Object(b.statlogsSendingError)(t,n,"unknown","server_load_attach"),rt(e,null,t)))}function rt(e,t,n){var r=n.tabs[e.peerId],a=t&&t[2];return r.mediacontent||(r.mediacontent={}),r.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],a&&(a.no_forward&&(r.msgs[e.messageId].kludges.no_forward=!0),a.no_pin&&(r.msgs[e.messageId].kludges.no_pin=!0)),at(e,n)}function at(e,t){var n=t.tabs[e.peerId];return n.history=Object(d.replaceAttaches)(re(n.history),e,t),Promise.resolve(t)}function it(e,t,n){var r=Object(d.dayFromVal)(t),a=n.tabs[e];return a.searchDay=r,a.searchOffset=0,a.searchAllLoaded=!1,a.searchMsgs=[],Promise.resolve(n)}function st(e,t,n){return n.tabs[t].searchText=e,Tt(t,n),n}function ot(e,t,n){if(t){var r=n.tabs[t];r.searchText=e,r.searchOffset=0,r.searchAllLoaded=!1}else n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1;return Promise.resolve(n)}function ct(e,t,n,a,i){return Object(r.post)(I,{act:"a_hints",str:e,gid:a.hidegid?0:i.gid,query:n,peerIds:t.join(",")}).then(t=>{var n=C(t,3),r=n[0],a=n[1];if(ie(n[2],i),a.forEach(e=>Object(f.oCacheAdd)(i,e)),Be(r,i),e){var s=r&&Object.keys(r).length;Object(O.saveSearchAttemptStats)(O.serviceMessages,0,s,e)}return Object.keys(r).sort((e,t)=>r[e].order-r[t].order).map(e=>r[e])})}function ut(e,t,n,r){return ct(e,t,n,{},r).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===n})))}function dt(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function lt(e){return(t,n)=>e(n).then(e=>{var r=(t?e.search(t):e.list).map(dt);return n.mapped_index||(n.mapped_index={}),r.forEach(e=>{n.mapped_index[e.peerId]=e}),r})}var _t=lt(e=>e.topConvTree),gt=lt(e=>e.imTopConvTree),ft=lt(e=>e.hintsTree);function mt(e,t){var n,a,i;t.topConvTree=new Promise(e=>{n=e}),t.hintsTree=new Promise(e=>{a=e}),t.imTopConvTree=new Promise(e=>{i=e});var o=e.select(u.RECENT_SEARCH_OP);return Object(s.retryFn)(r.post,1,()=>4)(I,{act:"a_dialogs_preload",rs:o.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var r=C(e,4),s=r[0],o=r[1],c=r[2],u=r[3];return t.popular_sugg=c,new vkIndexer(s,e=>e[1],n),new vkIndexer(o,e=>e[1],a),u&&u.length>0?new vkIndexer(u,e=>e[1],i):i(),t})}function pt(e){var t,n,a=e.active_tab,i=e.dialog_tabs[a];return i.length>0?i.forEach(r=>{var a=e.tabs[r],i=a.minor_sort_id,s=a.major_sort_id;void 0===t||t>s?(t=s,n=i):t===s&&n>i&&(n=i)}):(t=0,n=0),Object(r.post)(I,{act:"a_get_dialogs",start_message_id:n,major_sort_id:t,tab:a,gid:e.gid}).then(t=>{var n=C(t,4),r=n[0],s=n[1],o=n[2],c=n[3];return o.forEach(t=>Object(f.oCacheAdd)(e,t)),ie(c,e),Be(s,e),e.dialog_tabs[a]=i.filter(e=>!s[e]).concat(Object.keys(s).map(intval)),e.dialog_tabs_all[a]=!r.has_more,Promise.resolve(e)})}var ht=te((function(e,t){return Object(r.post)(I,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(n=>{var r=C(n,5),a=r[0],i=r[1],s=r[2],o=r[3],c=r[4];return i.forEach(e=>Object(f.oCacheAdd)(t,e)),Object(d.normalizeTabsGotFromServer)(t,a),e===t.searchText&&(t.searchOffset=o,t.searchAllLoaded=c),Object.keys(a).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=a[e]}),[a,s]})}));function bt(e,t){return t.tabs[e].searchAllLoaded}function vt(e,t){return!(t.peer!==e||!Object(d.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function Ot(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.inplaceSearch,delete n.searchOffset,delete n.searchAllLoaded,delete n.searchText,delete n.searchDay,delete n.searchMsgs,M({st:""}),P()}return Promise.resolve(t)}function Et(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.searchDay,n.searchOffset=0,n.searchAllLoaded=!1,n.searchMsgs=[]}return Promise.resolve(t)}function Tt(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var Ct=te((function(e,t){var n=t.tabs[e],a="";if(Tt(e,t),n.searchDay&&(a="day:"+n.searchDay),!a&&!n.searchText)return Promise.reject();var i=`in:${e} ${a} ${n.searchText||""}`;return M({st:n.searchText}),P(),Object(r.post)(I,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:n.searchOffset||0}).then(e=>{var t=C(e,4),r=t[0],a=t[1],i=t[2],s=t[3];return n.searchOffset=a,n.searchAllLoaded=i,n.searchMsgs=(n.searchMsgs||[]).concat(s),r})}));function At(e){return Object(r.post)(I,{act:"a_important",offset:e,part:e>0})}function It(e,t){var n=Object(_.getTab)(e,t);return Object(r.post)(I,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(r=>{var a=C(r,4),i=a[0],s=a[1],o=a[2],c=a[3],u=intval(i[0]);Object(d.isLastMsgDebugEnabled)(e)&&!u&&!1!==n.lastmsg&&(console.log(T({},n)),Object(d.showDebugAlert)()),n.lastmsg=u||!1,n.lastmsg_meta=i,(!Object(_.isCasperChat)(e,t)||u>n.minor_sort_id)&&(n.minor_sort_id=u);var g=C(s,3);n.unread=g[0],n.in_up_to=g[1],n.out_up_to=g[2],o?n.mentions=o:n.mentions&&delete n.mentions,c?n.expiring_messages=c:n.expiring_messages&&delete n.expiring_messages,n.unread||(e.get().dialog_tabs[l.FOLDER_UNREAD]=e.get().dialog_tabs[l.FOLDER_UNREAD].filter(e=>e!=t)),Se(e.get(),n,!1,Pe.bind(null,t),jn.bind(null,e.get()))})}function yt(e,t,n){n.tabs[e].unread-=t.length;var r=t.reduce((e,t)=>(e[t]=!0,e),{});return we(e,e=>!r[e],n),Ue(e,e=>!r[e],n),Promise.resolve(n)}function jt(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e}return Promise.resolve(n)}function St(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var r=n.tabs[t];if(r.history=Object(d.removeMessages)(e,re(r.history)),r.offset-=e.filter(e=>r.msgs[e]).length,e.forEach(e=>delete r.msgs[e]),e.forEach(e=>{var t=(n.selectedMessages||[]).indexOf(e);-1!=t&&n.selectedMessages.splice(t,1)}),r.inplaceSearch){var a=e.reduce((e,t)=>(e[t]=!0,e),{});r.searchMsgs=r.searchMsgs.filter(e=>!a[e]),r.searchOffset=r.searchMsgs.length}}return Promise.resolve(n)}var Lt=te((function(e,t,n,a,i){return Object(r.post)(I,{act:"a_mark",peer:t,hash:n||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:a})}));function Mt(e,t,n,r){if(Object(d.isFullyLoadedTab)(r,t)){var a=r.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e,a.history=Object(d.removeMessagesWithRestore)(e,t,n,re(a.history)),a.offset-=e.filter(e=>a.msgs[e]).length}return Promise.resolve(r)}function Pt(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var r=n.tabs[t];r.deleted&&(r.deleted=r.deleted.filter(t=>t!==e)),r.history=Object(d.restoreMessage)(e,t,re(r.history)),r.offset++}return Promise.resolve(n)}function Nt(e,t,n,a){return Object(r.post)(I,{act:"a_restore",id:e,peer:t,hash:n,gid:a})}var kt=te((function(e,t,n){return Object(d.tabIsMessageRequest)(n.tabs[e])?Promise.resolve(n):(n.tabs[e].lastTyping=Date.now(),Object(r.post)(I,{act:"a_activity",type:t,peer:e,gid:n.gid,hash:n.tabs[e].hash}).then(()=>n,()=>n))})),Rt=te((e,t)=>Object(r.post)(I,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var n=t.tabs[e];return n.is_message_request=!1,n.folders=Object(_.removeMessageRequestFolderFlags)(n.folders),t})),Dt=te((e,t)=>Object(r.post)(I,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(Se(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),xn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),wt=te((e,t,n)=>Object(r.post)(I,{act:"a_cancel_message_request",peer_id:e,contact_id:t,hash:n.tabs[e].hash}).then(()=>{var r=n.tabs[e];return r&&r.invitedByMessageRequest&&(r.invitedByMessageRequest=r.invitedByMessageRequest.filter(e=>e.id!==t)),n})),Ut=te((function(e,t){return kt(e,j,t)})),Ht=te((function(e,t){return kt(e,S,t)}));function xt(e,t,n,r){return t&&(r.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(n?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(r)}function Ft(e,t){return t.pendingForward=e,Promise.resolve(t)}function Gt(e,t,n){if(!Object(d.isTabLoaded)(n,e))return n;n.blockedFlagUpdates||(n.blockedFlagUpdates={}),n.blockedFlagUpdates[e]=!0;var r=n.tabs[e];return Se(n,r,!0,t=>t.filter(t=>t!==e)),r.unread>0&&!Object(d.tabIsMessageRequest)(r)&&De(n,-1,e),r.deletedDialog=!0,xn(n.tabbedPeers.filter(t=>t.peer!==e),!0,n),t.then(t=>{var a=C(t,2);a[0],a[1];return delete n.blockedFlagUpdates[e],r.msgs=null,r.history=null,r.unread=0,r.lastmsg=!1,r.lastmsg_meta=null,r.minor_sort_id=0,n})}var Bt=te((function(e,t){return Gt(e,Object(r.post)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),Vt=te((function(e,t,n){return Object(r.post)(I,{act:"a_set_chat_title",peer:e,new_title:t,gid:n.gid,hash:n.tabs[e].hash}).then(()=>(n.onUpdate&&n.onUpdate(),n))})),Yt=te((function(e,t){return Object(r.post)(I,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var r=C(n,1)[0];return t.tabs[e]=extend(t.tabs[e],r),t})}));function Kt(e,t,n){var r=n.tabs[e];return r.memberIds=[].concat(r.memberIds,t).filter((e,t,n)=>n.indexOf(e)===t),r.membersCount=r.memberIds.length,Promise.resolve(n)}var qt=te((function(e,t,n,a){return Object(r.post)(I,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:a.gid,hash:a.tabs[e].hash,show_history:n?1:0}).then(e=>a)}));function $t(e,t){if(isEmpty(e))return Promise.resolve(t);var n=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(r.post)(I,{act:"a_load_member",need:n,gid:t.gid}).then(e=>(C(e,1)[0].forEach(e=>Object(f.oCacheAdd)(t,e)),t))}function Wt(e,t,n){var r={},a=n.get();function s(e,t){Object(d.isChatPeer)(e)&&t&&!Object(f.oCacheExists)(a,t)&&(r[e]?-1===r[e].indexOf(t)&&r[e].push(t):r[e]=[t])}var o=t.filter(e=>!Object(d.isTabLoaded)(a,e.peerId)).map(e=>e.peerId);t.forEach(e=>{s(e.peerId,e.userId)}),e.forEach(e=>{s(e.peerId,+e.kludges.source_mid||+e.kludges.from)});var c=t.filter(e=>e.flags&i.FLAG_OUTBOUND&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!a.admins[e]);return 0===Object.keys(r).length&&0===c.length&&0===o.length?Promise.resolve(a):{shouldLoad:Object.keys(r).length>0||c.length>0||o.length>0,needMembers:r,needAdminIds:c,needPeers:o}}function Qt(e,t,n){var r=e.needMembers,a=e.needAdminIds,i=e.needPeers;return t.pause(),Promise.all([$t(r,n),Le(a,n),Promise.all(i.map(e=>oe(e,0,0,0,n)))]).catch(()=>n).then(()=>t.resume()).then(()=>n)}var Jt=te((function(e,t){return e.kludges.source_act===d.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(r.post)(I,{act:"a_get_chat_photo",msg_id:e.messageId}).then(n=>{var r=C(n,2),a=r[0],i=r[1];t.chat_photo_msg=i;var s=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=a[0],t.tabs[e.peerId].photoLarge=a[1],Object(d.isFullyLoadedTab)(t,e.peerId)){var o=e.kludges.source_act;s.history=Object(d.addChatPhotoToUpdate)(e,o,t,re(s.history))}return t}))}));function Xt(e,t,n,r){return t!==vk.id||Object(d.isTabLoaded)(r,n)&&r.peer==n&&(r=he(r)),Promise.resolve(r)}var zt=te((function(e,t){return Object(r.post)(I,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Xt.bind(null,d.CHAT_KICK_USER,vk.id,e,t))})),Zt=te((function(e,t){return Object(r.post)(I,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(Xt.bind(null,d.CHAT_INVITE_USER,vk.id,e,t))})),en=te((function(e,t,n,a){return Object(r.post)(I,{act:"a_mute",peer:e,hash:a.tabs[e].hash,gid:a.gid,value:Number(t),until:n}).then(()=>{var n=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:n,peer:e}),a}).then(nn.bind(null,e,t))})),tn=te((function(e,t,n){return Object(r.post)(I,{act:"a_mute_mentions",peer:e,hash:n.tabs[e].hash,gid:n.gid,value:Number(t)}).then(()=>n)}));function nn(e,t,n){var r=n.mutedPeers.filter(t=>t!==e);return t&&r.push(e),n.mutedPeers=r,cur.mutedPeers=n.mutedPeers,he(n)}function rn(e,t){return t.stack=e,Promise.resolve(t)}var an=te((function(e,t,n,a){return sn(e,n,t,a),Object(r.post)(I,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:a.gid,peer:n,hash:a.tabs[n].hash}).then(()=>a)}));function sn(e,t,n,r){if(Object(d.isFullyLoadedTab)(r,t)){var a=r.tabs[t];e.filter(e=>a.msgs[e]).forEach(e=>{var s=Object(_.getMessage)(r,t,e),o=n?s.flags|i.FLAG_IMPORTANT:s.flags&~i.FLAG_IMPORTANT;s.flags=o,a.msgs[e]=s,a.history=Object(d.updateStar)(e,n,re(a.history))})}return Promise.resolve(r)}function on(e,t,n){return n.importants||(n.importants={}),(n.importants[t]||0)!==e&&(n.important_cnt+=e,n.importants[t]=e),Promise.resolve(n)}function cn(e,t){return Object(r.post)(I,{act:"a_spam",offset:e,gid:t,part:e>0})}function un(e,t){return Object(r.post)(I,{act:"a_flush_spam",gid:t,hash:e})}function dn(e,t,n){return n.creationType=e,n.creationFilter=t,Promise.resolve(n)}function ln(e,t){return Object(r.post)(I,{act:"a_owner_photo",photo:JSON.parse(e).data[0],peer:t})}function _n(e){return Object(r.post)(I,{act:"a_get_contacts"}).then(t=>{var n=C(t,1)[0];return e.contactsList=n,e})}function gn(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function fn(e,t,n){return Object(r.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:n.gid}).then(e=>n)}var mn=te((function(e,t,n,a,i){return i.creating=!0,i.longpoll.pause(),Object(r.post)(I,{act:"a_multi_start",hash:i.writeHash,peers:t.join(","),title:n,flags:a}).then(e=>{var t=C(e,1)[0];return i.next_peer=t.peerId,i.tabs[t.peerId]=t,Se(i,t,!1,e=>[t.peerId].concat(e)),i.longpoll.resume(),i}).then(t=>e?fn(t.next_peer,e,t):t).then(e=>(e.creating=!1,e)).catch(e=>{throw i.creating=!1,i.longpoll.resume(),e})})),pn=te((function(e,t,n){return n.creating=!0,Object(r.post)(I,{act:"a_multi_start",hash:n.writeHash,peers:[],title:t,gid:n.gid,is_community_chat:1}).then(t=>{var r=C(t,1)[0].peer_id;if(!r)throw new Error("No peer_id");return e?fn(r,e,n):n}).then(e=>(e.creating=!1,e)).catch(e=>{throw n.creating=!1,e})}));function hn(e){var t;e.resync_in_process=new Promise(e=>{t=e});var n=Object.keys(e.tabs).length,a=e.active_tab;return Object(r.post)(I,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:n,tab:a,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(n=>{var r=C(n,5),i=r[0],s=r[1],o=r[2],u=r[3],_=r[4];s.forEach(t=>Object(f.oCacheAdd)(e,t)),Object(d.normalizeTabsGotFromServer)(e,i),o.user_unread&&handlePageCount("msg",o.user_unread),Object(c.lplog)("Resync success","success");var g,m=e.peer;if(Object(d.isReservedPeer)(m))g=Promise.resolve(!1);else{var p={tabs:{[m]:e.tabs[m]},oCache:{}};g=Be({[m]:i[m]},p)}return g.then(n=>{e.tabs=i,e.admins=extend(e.admins,u),n&&(e.tabs[m]=n.tabs[m],e.tabs[m].history=Object(d.restoreQueue)(m,e,re(e.tabs[m].history))),e.loadingDialogs=!1,e.mutedPeers=o.mutedPeers,e.lastDialogsOptions={has_more:o.has_more},e.dialog_tab_cts=Object.assign({},o.folder_cts,{[l.FOLDER_MESSAGE_REQUEST]:e.dialog_tab_cts[l.FOLDER_MESSAGE_REQUEST]}),e.dialog_tabs[a]=_.map(intval);var r=e.dialog_tabs[a].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=a).forEach(t=>{a==l.FOLDER_ALL?e.dialog_tabs[t]=r.filter(In(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),En(intval(o.unread),e)})}).catch(t=>(Object(c.lplog)("Resync error: "+t.message+" "+t.stack,"error"),Object(s.pause)(2).then(hn.bind(null,e))))}function bn(e,t){return t.lockedSending=e,Promise.resolve(t)}function vn(e,t,n){return e&&!n.delayed_message?(n.delayed_message=e,n.delayed_ts=t):e||(n.delayed_message=e,n.delayed_ts=t),Promise.resolve(n)}function On(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function En(e,t){return t.unread_cnt=e,t.dialog_tab_cts[l.FOLDER_UNREAD]=e,Promise.resolve(t)}function Tn(e,t){return t.ctrl_submit=!!e,Object(r.post)(I,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function Cn(e,t,n){n.cur_unread_cnt||(n.cur_unread_cnt={}),t&&!inArray(e,n.mutedPeers)&&(n.cur_unread_cnt[e]=!0);var r=document.title,a=window.devicePixelRatio>=2?"_2x":"";if(t&&!n.update_title_to){var i=function(e,t,n){return function(){n.update_old_title=e;var r=Object.keys(n.cur_unread_cnt).length;if(0===r)return Object(v.setDocumentTitle)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(n.update_title_to),void(n.update_title_to=!1);e?(Object(v.setDocumentTitle)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(r>9?10:r)+t+".ico"),Object(v.setDocumentTitle)(winToUtf(getLang("mail_im_new_messages",r))))}}(r,a,n);n.update_title_to=setInterval(i,1e3),i()}else!t&&n.update_old_title&&(Object(v.setDocumentTitle)(n.update_old_title),n.cur_unread_cnt={},r=!1,n.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+a+".ico"),clearInterval(n.update_title_to),n.update_title_to=!1);return Promise.resolve(n)}function An(e,t,n,r,a){return Object(d.isFullyLoadedTab)(a,e)&&(a.tabs[e].scrollTop=intval(t),a.tabs[e].scrollBottom=intval(n),a.tabs[e].contHeight=intval(r)),Promise.resolve(a)}function In(e){return e===l.FOLDER_ALL?e=>!Object(d.tabIsMessageRequest)(e):e===l.FOLDER_UNREAD?e=>!Object(d.tabIsMessageRequest)(e)&&(e.unread>0||Object(_.isTabMarkedUnread)(e)):e===l.FOLDER_MESSAGE_REQUEST?e=>Object(d.tabIsMessageRequest)(e):t=>t.folders&l.FOLDER_MASKS[e]}function yn(e,t){t.active_tab=e,Object(a.updateLocation)({tab:e===l.FOLDER_ALL?null:e});var n=[];if(e!==l.FOLDER_ALL&&!Object(d.isReversedDialogs)(t)){var r=t.dialog_tabs[e];n=t.dialog_tabs[l.FOLDER_ALL].map(e=>t.tabs[e]).filter(In(e)).map(e=>e.peerId),t.dialog_tabs[e]=r.length>=n.length?r:n}return Promise.resolve(t)}function jn(e,t,n,r){var a=e.dialog_tabs_all;return!(!a[l.FOLDER_ALL]&&!a[t])||(!!n.includes(r.peerId)||("r"===r.lastmsg[0]||n.map(t=>e.tabs[t.toString()]).filter(t=>Object(d.isReversedDialogs)(e)?t.minor_sort_id>r.minor_sort_id:t.minor_sort_id<r.minor_sort_id).length>0))}function Sn(e,t,n,r,a,s){if(Object(d.isTabLoaded)(s,e)&&!a){var o=s.tabs[e];return n===i.REPLACE_DIRECTORIES&&(t^=o.folders),function(e,t,n){return!(e===i.SET_DIRECTORIES&&n.folders&t)&&(!!(e!==i.RESET_DIRECTORIES||n.folders&t)&&!Object(d.tabIsMessageRequest)(n))}(n,t,o)&&Object.keys(l.FOLDER_MASKS).filter(e=>l.FOLDER_MASKS[e]&t).forEach(e=>{s.dialog_tab_cts[e]+=function(e,t,n){return t!==i.RESET_DIRECTORIES||e.folders&l.FOLDER_MASKS[n]?t===i.REPLACE_DIRECTORIES?e.folders&l.FOLDER_MASKS[n]?-1:1:t===i.SET_DIRECTORIES?1:-1:0}(o,n,e)}),n===i.SET_DIRECTORIES?s.tabs[e].folders|=t:n===i.RESET_DIRECTORIES?s.tabs[e].folders&=~t:s.tabs[e].folders=t^=o.folders,Se(s,s.tabs[e],!0,(t,n)=>t.concat([e]).map(e=>s.tabs[e]).filter(In(n)).map(e=>e.peerId),jn.bind(null,s)),Promise.resolve(s)}return oe(e,0,0,0,s).then(Sn.bind(null,e,t,n,null,!1,s))}var Ln=te((function(e,t){var n=l.FOLDER_MASKS[l.FOLDER_IMPORTANT],a=t.tabs[e].folders&n,s=a?i.resetDirectoriesEvent:i.setDirectoriesEvent;return t.longpoll.push([s([0,e,n,!0])]),Object(r.post)(I,{act:"a_dialog_star",val:a?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),Mn=te((function(e,t,n){var a=l.FOLDER_MASKS[l.FOLDER_UNRESPOND];return n.longpoll.push([i.resetDirectoriesEvent([0,e,a,!0]),i.readInboundEvent([6,e,t,null])]),Object(r.post)(I,{act:"a_mark_answered",peer:e,lastmsg:t,hash:n.tabs[e].hash,gid:n.gid}).then(()=>n)})),Pn=te((e,t)=>(t.longpoll.push([i.resetPeer(),i.setDirectoriesEvent([0,e,l.FOLDER_MASKS[l.FOLDER_MARKED_UNREAD],!0])]),Object(r.post)(I,{act:"a_mark_conversation_as_unread",peer_id:e,hash:t.tabs[e].hash,gid:t.gid}))),Nn=te((e,t)=>{t.longpoll.push([i.resetDirectoriesEvent([0,e,l.FOLDER_MASKS[l.FOLDER_MARKED_UNREAD],!0])]);var n=t.tabs[e];return Object(r.post)(I,{peer:e,ids:n.lastmsg?[n.lastmsg]:[],mark_conversation_as_read:!0,hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>t)});function kn(e){return Object(r.post)(I,{act:"a_get_mutex_key",gid:e})}function Rn(e,t){return ie({[e]:{free:!0}},t),Object(r.post)(I,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function Dn(e,t){var n=ls.get("comm_mute_"+t.gid)?1:0;return e&&(n^=1),ls.set("comm_mute_"+t.gid,n),t.mute=n,Promise.resolve(t)}var wn=te((function(e,t){return Se(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(r.post)(I,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>(n[0]?(xn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,Se(t,t.tabs[e],!1,Pe.bind(null,e),jn.bind(null,t))),n))}));function Un(e,t,n,a){return Object(r.post)(I,{act:"a_restore_dialog",hash:t,gid:a.gid,spam:n?1:0,peer:e}).then(t=>(a.tabs[e].deletedDialog=!1,Se(a,a.tabs[e],!1,t=>[e].concat(t)),a.tabs[e].unread=t,a))}function Hn(e,t,n){return Object(r.post)(I,{act:"a_spam_dialog",peer:e,gid:n.gid,hash:t})}function xn(e,t,n){return n.tabbedPeers=e,Object(d.isClassicInterface)(n)&&(M({peers:n.tabbedPeers.filter(e=>{var t=e.peer,r=e.type;return t!==n.peer&&"perm"===r}).map(e=>Object(d.getBareTab)(e.peer,n)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(d.convertPeerToUrl).join("_"),to:""}),t&&P()),Promise.resolve(n)}function Fn(e){return!e.peer||(vt(e.peer,e)?bt(e.peer,e):!!Object(d.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function Gn(e,t){var n=t.tabs[e];return Object(d.isFullyLoadedTab)(t,e)&&(n.skipped=null,n.msgs=null,n.offset=null,n.allShown=null,n.history=null),Promise.resolve(t)}function Bn(e,t){var n=t.tabs[e];return Object(d.isFullyLoadedTab)(t,e)&&(n.history=ae(n.history)),Promise.resolve(t)}function Vn(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Yn(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Kn(e,t,n){if(!Object(d.isCommunityPeer)(t))return Promise.resolve(n);var a=Object(_.getTab)(n,t);return a.blocked_community=!e,!1===e&&(a.can_send_notify=!1),Object(r.post)(I,{act:"a_toggle_community",peer_id:t,hash:a.hash,state:e?1:0}).then(()=>he(n))}function qn(e,t){if(0!==t.peer&&Object(d.isFullyLoadedTab)(t,t.peer)){var n=Object(_.getTab)(t,t.peer);n.history=re(n.history),e(n.history)}return Promise.resolve(t)}function $n(e){if(0!==e.peer&&Object(d.isFullyLoadedTab)(e,e.peer)){var t=Object(_.getTab)(e,e.peer),n=geByClass1("_im_peer_history");n&&(t.history=re(n.innerHTML))}return Promise.resolve(e)}function Wn(e){return e.audio_msg.isRecording?Promise.reject():(e.audio_msg.isRecording=!0,Promise.resolve(e))}function Qn(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Jn(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Xn(e){M({act:e?"create":null}),P()}function zn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;M({q:e}),P()}function Zn(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(d.getClassicChatHeight)()>window.clientHeight()&&Object(d.setClassicChatHeight)(0)),Promise.resolve(e)}var er=te((function(e,t,n,a){return Object(r.post)(I,{act:"a_join_chat",chat_id:e,hash:t,invite_link:n,write_hash:a.writeHash}).then(e=>{var t=C(e,4),n=t[0],r=t[1],i=t[2],s=t[3];return i.forEach(e=>Object(f.oCacheAdd)(a,e)),a.tabs[n]=r,Se(a,r,!1,Pe.bind(null,n),jn.bind(null,a)),a.admins=extend(a.admins,s),[n]})}));function tr(e,t){return Object(r.post)(I,{act:"a_get_link",gid:t.gid,chat_id:e})}var nr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(I,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(n.inviteLink=e[0],e))}));function rr(e){return N({invite_chat_id:null,invite_hash:null,mr:null,invite_link:null}),e.invitation=void 0,Promise.resolve(e)}function ar(e,t){var n=Object(c.arrayUnique)([e].concat(t.select(u.RECENT_SEARCH_OP))).slice(0,500);t.update(u.RECENT_SEARCH_OP,n)}function ir(e){e.update(u.RECENT_SEARCH_OP,[])}function sr(e,t){var n=t.select(u.RECENT_SEARCH_OP).filter(t=>t!==e);return t.update(u.RECENT_SEARCH_OP,n),n}function or(e,t,n){var r=n.tabs[t],a=Object(_.getMessage)(n,t,e);return Object(_.isChatActive)(r)&&!a.kludges.source_act&&(r.pinned=a),Promise.resolve(n)}function cr(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var ur=te((function(e,t,n){var a=n.tabs[t];return Object(_.isChatActive)(a)?Object(r.post)(I,{act:"a_pin_message",msgid:e,chat:t,gid:n.gid,hash:n.tabs[t].hash}).then(e=>{var r=C(e,1)[0];return n.tabs[t]=Object.assign({},a,r),n}):Promise.resolve(n)})),dr=te((function(e,t){var n=t.tabs[e];return Object(_.isChatActive)(n)?Object(r.post)(I,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(r=>{var a=C(r,1)[0];return t.tabs[e]=Object.assign({},n,a),t}):Promise.resolve(t)})),lr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(I,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var r=C(e,1)[0];return n.pinned=r||null,t})})),_r=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(I,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:a.hash})})),gr=te((function(e,t){var n=t.tabs[e];return n.membersLoaded?Promise.resolve(t):Object(r.post)(I,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=C(e,1),a=C(r[0],3),i=a[0],s=a[1],o=a[2];return n.memberIds=i,n.adminIds=s,o.forEach(e=>Object(f.oCacheAdd)(t,e)),n.membersLoaded=!0,t})})),fr=te((function(e,t){return Promise.all([gr(e,t),function(e,t){var n=t.tabs[e];return Object(r.post)(I,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var r=C(e,1)[0];return n.photoGrid=r.grid,n.photoLarge=r.photo,n.membersLastSeen=r.lastSeen||null,n.inviters=r.inviters,n.caccess=r.caccess,n.invitedByMe=r.invitedByMe||[],n.inviteLinks=r.links||null,n.invitedByMessageRequest=r.invitedByMessageRequest,n.serverSettings=r.serverSettings||null,n.isDefaultPhotoOwner=r.isDefaultPhotoOwner||null,n.owner=r.owner||null,n.allowedUpdateFlags=r.allowedUpdateFlags,n.canInvite=r.canInvite||null,n.notifications=r.notifications,t})}(e,t)]).then(()=>t)})),mr=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(I,{act:"a_update_flags",chat:e,gid:n.gid,hash:a.hash,flags:t}).then(e=>(n.onUpdate&&n.onUpdate(),e))})),pr=te((function(e,t){var n=t.tabs[e];return Object(r.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:n.photoHash}).then(()=>(n.photo=null,n.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function hr(e,t,n){var r=n.tabs[e];return r.memberIds=r.memberIds.filter(e=>e!==t),r.adminIds=r.adminIds.filter(e=>e!==t),r.membersCount=r.memberIds.length,Promise.resolve(n)}var br=te((function(e,t,n){var a=n.tabs[e];return Object(r.post)(I,{act:"a_kick_user",chat:e,hash:a.hash,mid:t,gid:n.gid}).then(()=>(a.memberIds=a.memberIds.filter(e=>e!==t),a.adminIds=a.adminIds.filter(e=>e!==t),a.membersCount=a.memberIds.length,n))}));function vr(e,t,n,r){var a=r.tabs[e];return a.adminIds=n?[].concat(a.adminIds,t).filter((e,t,n)=>n.indexOf(e)===t):a.adminIds.filter(e=>e!==t),Promise.resolve(r)}var Or=te((function(e,t,n,a){var i=a.tabs[e];return Object(r.post)(I,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+n,gid:a.gid}).then(()=>vr(e,t,n,a))}));function Er(e,t,n,r){var a=Object(_.getMessage)(e,n,t).userId;return Object(f.oCacheGet)(r,a)?Promise.resolve(r):$t({[n]:[a]},r)}function Tr(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function Cr(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var Ar=te((function(e,t){return t.tabs[e].top_banner=void 0,Object(r.post)(I,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),Ir=te((function(e,t,n){n.tabs[e].top_banner=void 0;var a=n.tabs[e];return Object(r.post)(I,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:a.hash}).then(()=>n)}));function yr(e,t){return Object(r.post)(I,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(n=>{var r=C(n,1)[0];return t.tabs[e].top_banner=r,t})}function jr(e,t,n){return n.tabs[e].keyboard=t&&t.buttons?t:null,Lr(e,!1,!0,n)}function Sr(e,t){return jr(e,null,t)}function Lr(e,t,n,r){return((r.tabs||{})[e]||{}).keyboard&&(r.tabs[e].keyboard.hide=t,n&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(r)}var Mr=te((function(e,t){var n=t.tabs[e];return Object(r.post)(I,{act:"a_get_keyboard",peer_id:e,hash:n.hash}).then(n=>{var r=C(n,1)[0];return jr(e,r,t)})}));function Pr(e,t,n,a){var i=a.tabs[e];return i.caccess[t]=n,Object(r.post)(I,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:n?1:0,gid:a.gid}).then(()=>a).catch(e=>{throw i.caccess[t]=!n,e})}var Nr=te((function(e,t){var n=t.tabs[t.peer];return Object(r.post)(I,{act:"a_delete_template",template_id:e,hash:n.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var n=t.templates.find(t=>t.id===e);return n&&(n.deleted=!0),t})}));function kr(e,t,n){var a=n.tabs[n.peer];return Object(r.post)(I,{act:"a_create_template",hash:a.hash,gid:n.gid,peer_id:n.peer,name:e,text:t}).then(e=>(n.templates.unshift(e[0]),n))}function Rr(e,t,n,a){var i=a.tabs[a.peer];return Object(r.post)(I,{act:"a_update_template",template_id:e,hash:i.hash,gid:a.gid,peer_id:a.peer,group_id:a.gid,name:t,text:n}).then(t=>{var n=a.templates.find(t=>t.id===e);return n&&Object.assign(n,t[0]),a})}function Dr(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=Object(_.getTab)(t,e);n.allShown=!1,n.lastReset=Date.now()}return t}function wr(e,t){var n=e.updateType,r=e.updateArg,a=0;return n===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(a=r===i.MESSAGE_REQUEST_STATUS_NEW?1:-1),n===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(a=-1),t.dialog_tab_cts[l.FOLDER_MESSAGE_REQUEST]+=a,Promise.resolve(t)}function Ur(e,t,n){if(Object(d.isFullyLoadedTab)(n,e.peerId)){var r=Object(_.getTab)(n,e.peerId);r.history=Object(d.setCasperMessageExpiringStatusDOM)(r.history,t,e.messageId)}return Promise.resolve(n)}function Hr(e,t){return Promise.resolve().then(()=>{if(Object(d.isFullyLoadedTab)(t,e)){var n=Object(_.getTab)(t,e);Object.values(n.msgs).forEach(e=>{var t=Object(_.parserMessage)(e);Object(g.isCasperMessage)(t)&&!E.casperMessagesStore.has(t.messageId)&&E.casperMessagesStore.add(t)})}return Promise.resolve(t)})}var xr=te((function(e,t,n,a,i,s){return Object(r.post)(I,{act:"a_peer_profile_toggle_tag",hash:s.manage_tags_hash,group_id:s.gid,peer_id:a,tag_id:e,action:n}).then(()=>{s.tabs[a].peer_tags=i;var n=s.peer_profile_tags.findIndex(t=>t.id===e);return t?s.peer_profile_tags[n].uses++:!t&&s.peer_profile_tags[n].uses>0&&s.peer_profile_tags[n].uses--,s})})),Fr=te((function(e,t){return Object(r.post)(I,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t.peerProfileTagsChanged=!0,t))})),Gr=te((function(e,t,n){return Object(r.post)(I,{act:"a_peer_profile_save_note",hash:n.manage_tags_hash,group_id:n.gid,peer_id:e,note:t}).then(()=>(n.tabs[e].peer_profile_info.note=t,n))})),Br=te((e,t)=>Object(r.post)(I,{act:"a_reload_message",msg_id:e,hash:t.writeHash}).then(e=>C(e,1)[0])),Vr=te((e,t)=>{var n=t.tabs[e];return Object(r.post)(I,{act:"a_get_active_call_data",peer_id:n.peerId,hash:n.hash}).then(e=>{var r=C(e,1)[0];return r?n.callInProgress=r:n.callInProgress&&delete n.callInProgress,t})}),Yr=(e,t)=>{var n=t.tabs[e];return n.callInProgress&&delete n.callInProgress,Promise.resolve(t)}},"wSs/":function(e,t,n){"use strict";n.r(t),n.d(t,"canMessageBeEdited",(function(){return c})),n.d(t,"convertEmojiHtmlToRegularText",(function(){return u})),n.d(t,"findLastMessageToEdit",(function(){return d})),n.d(t,"wasMessageReallyModified",(function(){return l})),n.d(t,"replaceMsgAfterEdit",(function(){return _}));n("Vd3H"),n("rGqo"),n("Btvt"),n("pIFo");var r=n("rHUl"),a=n("MhhX"),i=n("P13b"),s=n("rudk"),o=n("aong");function c(e,t){t=Object(r.parserMessage)(t);var n=Object(o.unpackStore)(e),s=vk.id==t.peerId&&!n.gid,c=n.pinMessageEditSettings,u=c.messageEditAllowedTime,d=c.pinEditDelayTime,l=c.isPinEditEnabled,_=Date.now()/1e3,g=Object(r.getPinnedMessage)(n),f=g&&g.messageId===t.messageId,m=t.kludges&&t.kludges.pinned_at,p=_-t.date>u,h=m&&_-m<d;if(333==t.peerId)return!1;if(!s&&!Object(a.isOut)(t))return!1;if(Object(a.isServiceMsg)(t))return!1;if(f&&p&&l){if(h)return!1}else if(p)return!1;return!(Object(a.isGift)(t)||Object(a.isSticker)(t)||Object(a.isAudioMsg)(t)||Object(a.isGraffiti)(t)||Object(a.isMoney)(t)||Object(a.isVKPay)(t)||Object(a.isCallMessage)(t))&&!Object(i.isAlreadyDeleted)(e,t.peerId,t.messageId)}function u(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function d(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(n=>c(e,t.msgs[n]))||null}function l(e,t,n){var r=Object(s.convertKludgesToAttaches)(t.kludges,t.messageId),a=n.dData.attaches;if(u(t.text)!==n.dData.txt||r.length!==a.length)return!0;for(var i=r.length;i--;){var o=r[i],c=a[i];if(o.id!=c.id||o.type!=c.type||"poll"==o.type&&c.object&&c.object.poll_is_edited)return!0}return!1}function _(e,t,n,r,a,s){t.origText=n,t.text=Object(i.replaceSpecialSymbols)(clean(n)).replace(/\n/gi,"<br>"),t.attaches=r,t.kludges.emoji=1,t.local=1,t.share_url=a,t.cancelled_shares=s,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}}}]);try{stManager.done("cmodules/bundles/97eb3afca142bb7a7187dda4654ffe58.0d3e6dd53af2c0bcd0d4.js")}catch(e){}