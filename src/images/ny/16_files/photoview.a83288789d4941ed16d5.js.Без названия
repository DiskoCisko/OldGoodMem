!function(e){function t(t){for(var r,_,s=t[0],c=t[1],n=t[2],l=0,d=[];l<s.length;l++)_=s[l],Object.prototype.hasOwnProperty.call(a,_)&&a[_]&&d.push(a[_][0]),a[_]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(p&&p(t);d.length;)d.shift()();return i.push.apply(i,n||[]),o()}function o(){for(var e,t=0;t<i.length;t++){for(var o=i[t],r=!0,s=1;s<o.length;s++){var c=o[s];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=_(_.s=o[0]))}return e}var r={},a={"web/photoview":0},i=[];function _(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,_),o.l=!0,o.exports}_.e=function(){return Promise.resolve()},_.m=e,_.c=r,_.d=function(e,t,o){_.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},_.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},_.t=function(e,t){if(1&t&&(e=_(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(_.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)_.d(o,r,function(t){return e[t]}.bind(null,r));return o},_.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return _.d(t,"a",t),t},_.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},_.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var n=0;n<s.length;n++)t(s[n]);var p=c;i.push([244,"common","983f42e70b3e18d97715513130ff4d9c","7ff0c31fd89ceca852f0cf5e2f61c8c8","c6f51c78d2a3f17f935b490330a9da66","404c8348f788d0ca8871b1cd5f462b00","6bf9d574fcada9d6589f1522b8895ac0","42c63f80984342f2f64e56433dd0512e"]),o()}({"1OKH":function(e,t,o){"use strict";o.r(t),o.d(t,"photos",(function(){return s}));o("SRfc"),o("KKXr"),o("pIFo");var r=o("zxIV"),a=o("v+DW"),i=o("EasH"),_=o("DM2o"),s={LOAD_TYPE_PHOTOS:"photos",LOAD_TYPE_ALBUMS:"albums",LOAD_TYPE_TAGGED:"tagged",MAX_DESC_INPUT_HEIGHT:600,changeAlbumPhoto(e){showBox("al_photos.php",{act:"change_thumb_box",album:e})},onMouseOverEditRow(e){var t=Object(r.geByClass1)("photos_photo_edit_row_desc_placeholder",e),o=Object(r.geByClass1)("photos_photo_edit_row_desc_input",e);Object(r.setTitle)(t,!1,Object(r.val)(o))},editInitSorter(){var e=Object(r.ge)("photos_container_photos");cur.photosEditSorter=new GridSorter(e,"photos_photo_edit_row_thumb",{onReorder:s.reorderPhotos})},updateEditHeaderPos(){void 0===cur.photosEditHeaderEl&&(cur.photosEditHeaderEl=Object(r.geByClass1)("photos_edit_selection_header")),cur.photosEditHeaderEl&&(cur.photosEditHeaderElOffset=cur.photosEditHeaderElOffset||Object(r.getXY)(cur.photosEditHeaderEl)[1]-Object(r.getSize)(Object(r.ge)("page_header_cont"))[1],scrollGetY()>=cur.photosEditHeaderElOffset?Object(r.hasClass)(cur.photosEditHeaderEl,"photos_header_fixed")||(Object(r.addClass)(cur.photosEditHeaderEl,"photos_header_fixed"),Object(r.setStyle)(cur.photosEditHeaderEl,{width:Object(r.getSize)(Object(r.ge)("page_body"))[0]}),Object(r.setStyle)(Object(r.domNS)(cur.photosEditHeaderEl),{"margin-top":Object(r.getSize)(cur.photosEditHeaderEl)[1]+"px"})):(Object(r.removeClass)(cur.photosEditHeaderEl,"photos_header_fixed"),Object(r.setStyle)(cur.photosEditHeaderEl,{width:""}),Object(r.setStyle)(Object(r.domNS)(cur.photosEditHeaderEl),{"margin-top":0})))},_editGetSelectedCount(){var e=Object(r.geByClass)("photos_edit_selected").length;if(cur.photoEditSelectedAll){var t=Object(r.geByClass)("photos_photo_edit_row").length;e=e<t?cur.count-t+e:cur.count}return e},editSelectAll(e){cur.photoEditSelectedAll=!e,each(Object(r.geByClass)("photos_photo_edit_row"),(function(){Object(r.toggleClass)(this,"photos_edit_selected",cur.photoEditSelectedAll)})),s._editUpdateSelectedCounter()},_editUpdateSelectedCounter(){var e,t=s._editGetSelectedCount();e=t?getLang("photos_edit_selected_count").replace("{total}",cur.count).replace("{count}",t):langNumeric(cur.count,cur.lang.photos_edit_selected_count_initial,!0),Object(r.val)(Object(r.ge)("photos_edit_selected_label"),e);var o=Object(r.ge)("photos_edit_selected_actions");Object(r.toggleClass)(o,"photos_selected",!!t),Object(r.geByClass)("photos_edit_selected_action",o).forEach((function(e){Object(r.toggleClass)(e,"link_lock",!t)}));var a=Object(r.ge)("photos_select_all_toggle");cur.photosEditSelectedHalf=t>=cur.count/2,cur.photosEditSelectedHalf?Object(r.val)(a,getLang("photos_edit_deselect_all")):Object(r.val)(a,getLang("photos_edit_select_all"))},selectEditPhoto(e,t){var o=Object(r.gpeByClass)("photos_photo_edit_row",t),a=Object(r.toggleClass)(o,"photos_edit_selected");if(e.shiftKey&&cur.photoEditPrevSelectedRowEl&&cur.photoEditPrevSelectedRowEl!=o)for(var i=Object(r.gpeByClass)("photos_edit_photos_container",t),_=Object(r.domFC)(i),c=0;c<2&&_;)_!=cur.photoEditPrevSelectedRowEl&&_!=o||c++,c&&Object(r.toggleClass)(_,"photos_edit_selected",a),_=Object(r.domNS)(_);return cur.photoEditPrevSelectedRowEl=o,s._editUpdateSelectedCounter(),cancelEvent(e),!1},startEditPhotoDescription(e,t){s.stopEditPhotoDescription();var o=Object(r.gpeByClass)("photos_edit_photos_container",t),a=Object(r.hasClass)(t,"photos_photo_edit_row")?t:Object(r.gpeByClass)("photos_photo_edit_row",t),i=Object(r.geByClass1)("photos_photo_edit_row_desc_cont",a),_=Object(r.geByClass1)("photos_photo_edit_row_desc_placeholder",a),c=Object(r.geByClass1)("photos_photo_edit_row_desc_input",a);function n(e,t,o,a){var i=clean(Object(r.val)(o)).split("\n").join("<br>")+"&nbsp;",_=Object(r.ce)("div",{innerHTML:i,className:"photos_photo_edit_row_desc_input"},{width:Object(r.getSize)(t)[0],display:"block",visibility:"hidden"});e.appendChild(_);var c=Object(r.getSize)(_)[1]+(browser.msie?10:0);Object(r.setStyle)(o,{height:Math.min(s.MAX_DESC_INPUT_HEIGHT,Math.round(c))}),Object(r.re)(_)}Object(r.val)(c,c.getAttribute("data-orig-desc")),n(i,_,c),Object(r.show)(c),addEvent(document,"click",s.stopEditPhotoDescription),removeEvent(c,"input"),addEvent(c,"input",n.pbind(i,_,c)),c.select(),Object(r.addClass)(o,"photos_desc_editing"),Object(r.addClass)(a,"photos_row_desc_editing"),e&&cancelEvent(e)},onEditPhotoDescriptionKeyPress(e){switch(e.keyCode){case 27:s.stopEditPhotoDescription(null,!0);break;case 9:s.stopEditPhotoDescription(null,!1);var t=Object(r.gpeByClass)("photos_photo_edit_row",e.currentTarget);(t=Object(r.domNS)(t))&&s.startEditPhotoDescription(null,t),cancelEvent(e)}},stopEditPhotoDescription(e,t){var o;e&&Object(r.hasClass)(e.target,"photos_photo_edit_row_desc_input")||(removeEvent(document,"click",s.stopEditPhotoDescription),each(Object(r.geByClass)("photos_row_desc_editing"),(function(){o=this,Object(r.removeClass)(o,"photos_row_desc_editing");var e=Object(r.geByClass1)("photos_photo_edit_row_desc_placeholder",o),a=Object(r.geByClass1)("photos_photo_edit_row_desc_input",o),i=o.getAttribute("data-id"),_=o.getAttribute("data-edit-hash"),s="";t?s=a.getAttribute("data-orig-desc"):((s=trim(Object(r.val)(a)))!=a.getAttribute("data-orig-desc")&&ajax.post("al_photos.php",{act:"save_desc",photo:i,hash:_,text:s,edit:1},{}),a.setAttribute("data-orig-desc",s),e.titleSet=!1);Object(r.val)(e,clean(s)||getLang("photos_add_description_placeholder")),Object(r.toggleClass)(e,"photos_edit_has_desc",!!s),Object(r.hide)(a)})),Object(r.removeClass)(Object(r.gpeByClass)("photos_edit_photos_container",o),"photos_desc_editing"))},updatePeriods(){cur.periods=Object(r.geByClass)("photos_period_delimiter",Object(r.ge)("photos_all_block"))},destroyPeriod(){cur.fixedPeriod&&(Object(r.re)(cur.fixedPeriod),cur.fixedPeriod=!1,cur.fixedPeriodEl=!1)},fixPeriod(){if(Object(r.ge)("photos_albums_block")&&(s.headerHeight=s.headerHeight||Object(r.getSize)(Object(r.ge)("page_header_cont"))[1],cur.periods&&cur.periods.length)){var e=vk.staticheader?Math.max(scrollGetY(),s.headerHeight):scrollGetY()+s.headerHeight,t=!1,o=!1,a=Object(r.getSize)(cur.periods[0])[1];for(var i in cur.periods)if(cur.periods.hasOwnProperty(i)){if(Object(r.getXY)(cur.periods[i])[1]>=e)break;t=cur.periods[i];var _=intval(i)+1;o=!!cur.periods[_]&&Object(r.getXY)(cur.periods[_])[1]-e}if(t&&!cur.fileApiUploadStarted){if(t==cur.fixedPeriodEl)setTimeout((function(){Object(r.setStyle)(cur.fixedPeriod,{left:Object(r.getXY)(t)[0]+"px"})}));else{if(cur.fixedPeriod)cur.fixedPeriod.innerHTML=t.innerHTML;else{var c=cur.fixedPeriod=Object(r.ce)("div",{innerHTML:t.innerHTML,className:"photos_period_delimiter_fixed"},{left:Object(r.getXY)(t)[0]+"px"});Object(r.ge)("page_body").appendChild(cur.fixedPeriod),(cur._back?cur._back.hide:cur.destroy).push((function(){Object(r.re)(c)}))}cur.fixedPeriodEl=t}var n=!1!==o?o-a:0;n>=0&&(n=0),cur.fixedPeriodTop!==n&&(Object(r.setStyle)(cur.fixedPeriod,{top:n+"px"}),cur.fixedPeriodTop=n)}else!t&&cur.fixedPeriod&&(Object(r.re)(cur.fixedPeriod),cur.fixedPeriod=!1,cur.fixedPeriodEl=!1)}},scrollResize(){if(!browser.mobile&&!cur.pvShown){var e=document.documentElement,t=window.innerHeight||e.clientHeight||bodyNode.clientHeight,o=scrollGetY(),a=Object(r.ge)("ui_photos_load_more"),i=Object(r.ge)("ui_albums_load_more"),_=Object(r.ge)("ui_tagged_load_more"),c=.8*t;Object(r.isVisible)(a)&&a.offsetTop-(o+t)<c&&s.load(),Object(r.isVisible)(i)&&cur.showAllAlbums&&i.offsetTop-(o+t)<c&&s.load(s.LOAD_TYPE_ALBUMS),Object(r.isVisible)(_)&&cur.showAllTagged&&_.offsetTop-(o+t)<c&&s.load(s.LOAD_TYPE_TAGGED),cur.fixPeriods&&s.fixPeriod(),s.updateEditHeaderPos()}},initScroll(){cur.module="photos",s.scrollnode=browser.msie6?pageNode:window,addEvent(s.scrollnode,"scroll",s.scrollResize),addEvent(window,"resize",s.scrollResize),removeEvent(window,"load",s.initScroll),cur.destroy.push((function(){removeEvent(s.scrollnode,"scroll",s.scrollResize),removeEvent(window,"resize",s.scrollResize)}))},recache(e,t){if(cur.loading)return cur.loading=1,void setTimeout(s.recache.pbind(e,t),100);for(var o=cur.offset;ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+o+"&part=1"];o+=20){var r=ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+o+"&part=1"];r[0]+=t,ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+(o+t)+"&part=1"]=r,delete ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+o+"&part=1"]}cur.offset+=t},loaded(e,t,o,a){var i,_,c,n,p,l;switch(a||(cur.loading=0),a=a||s.LOAD_TYPE_PHOTOS){case s.LOAD_TYPE_TAGGED:cur.taggedOffset=e,c=cur.moreFromTagged,p=cur.moreTaggedOpts,n=cur.taggedOffset;break;case s.LOAD_TYPE_ALBUMS:cur.albumsOffset=e,c=cur.moreFromAlbums,p=cur.moreAlbumsOpts,n=cur.albumsOffset,l=cur.albumsCount;break;default:cur.offset=e,c=cur.moreFrom,p=cur.moreOpts,n=cur.offset,l=cur.count}i=Object(r.ge)("photos_container_"+a),_=Object(r.ge)("ui_"+a+"_load_more");for(var d=Object(r.ce)("div",{innerHTML:trim(t)});d.firstChild;){if(Object(r.hasClass)(d.firstChild,"photos_period_delimiter")){var u=d.firstChild.getAttribute("data-year");if(Object(r.geByClass1)("photos_period_delimiter_"+u)){Object(r.re)(d.firstChild);continue}}cur.photoEditSelectedAll&&Object(r.addClass)(d.firstChild,"photos_edit_selected"),i.appendChild(d.firstChild)}o&&extend(cur.privacy,o),a==s.LOAD_TYPE_PHOTOS&&s.updatePeriods(),e>=l||!t?Object(r.hide)(_):a!=s.LOAD_TYPE_PHOTOS&&(cur.loading=1,ajax.post(c,extend({offset:n,part:1},p||{}),{cache:1,onDone:function(){2==cur.loading?s.loaded.apply(window,arguments):cur.loading=!1},onFail:function(){return cur.loading=0,!0}}))},load(e){var t,o,i,_;switch(e=e||s.LOAD_TYPE_PHOTOS){case s.LOAD_TYPE_PHOTOS:t=Object(r.ge)("ui_photos_load_more"),o=cur.moreFrom,i=cur.moreOpts,_=cur.offset;break;case s.LOAD_TYPE_TAGGED:t=Object(r.ge)("ui_tagged_load_more"),o=cur.moreFromTagged,i=cur.moreTaggedOpts,_=cur.taggedOffset;break;case s.LOAD_TYPE_ALBUMS:t=Object(r.ge)("ui_albums_load_more"),o=cur.moreFromAlbums,i=cur.moreAlbumsOpts,_=cur.albumsOffset}o&&Object(r.isVisible)(t)&&!Object(a.isButtonLocked)(t)&&(cur.loading?cur.loading=2:(e==s.LOAD_TYPE_PHOTOS&&i&&(cur.loading=1),ajax.post(o,extend({offset:_,part:1},i||{}),{onDone:s.loaded,onFail:function(){return cur.loading=0,!0},showProgress:function(){Object(a.lockButton)(t)},hideProgress:function(){Object(a.unlockButton)(t)},cache:1})))},loadMoreButtonClick(e){switch(e){case s.LOAD_TYPE_ALBUMS:cur.showAllAlbums=!0;break;case s.LOAD_TYPE_TAGGED:cur.showAllTagged=!0}this.load(e)},reorderAlbums(e,t,o){var r=e.id.replace("album",""),a=(t&&t.id||"").replace("album",""),i=(o&&o.id||"").replace("album","");ajax.post("al_photos.php",{act:"reorder_albums",album:r,before:a,after:i,hash:cur.reorderHash})},reorderPhotos(e,t,o){var a="edit"==nav.objLoc.act?"photo_edit_row_":"photo_row_",i=e.id.replace(a,""),_=(t&&t.id||"").replace(a,""),s=(o&&o.id||"").replace(a,""),c=Object(r.domData)(Object(r.ge)("photos_container_photos"),"rev");c=c?"1"===c?1:"":nav.objLoc.rev,ajax.post("al_photos.php",{act:"reorder_photos",photo:i,before:_,after:s,rev:c,hash:cur.reorderHash})},privacy(e){if("photos_move"==e){var t=Privacy.getValue(e);return(t=(t=t.split("_"))[2])!=cur.album.split("_")[1]&&s.movePhoto(t),!0}var o=e.match(/^album(\d+)/);if(o){var a=Object(r.ge)("album"+vk.id+"_"+o[1]);if(a){if(a.helper){var i=Object(r.getSize)(a);if(i[0]!=a.w||i[1]!=a.h){Object(r.setStyle)(a.helper,{width:i[0],height:i[1]-Object(r.ge)("photos_container").sorter.dh}),extend(a,{x:a.x-a.w/2+i[0]/2,w:i[0],y:a.y-a.h/2+i[1]/2,h:i[1]});for(var _=a.nextSibling;_&&_.nextSibling;_=_.nextSibling.nextSibling)Object(r.setStyle)(_.nextSibling,{left:_.offsetLeft,top:_.offsetTop})}}clearTimeout(cur["privacy_timer_"+e]),cur["privacy_timer_"+e]=setTimeout(ajax.post.pbind("al_friends.php",{act:"save_privacy",key:e,val:Privacy.getValue(e),hash:cur.privacyHash}),500)}}},deleteAlbum(e,t){Object(i.showFastBox)({title:getLang("photos_deleting_album"),dark:1,bodyStyle:"padding: 20px;"},getLang("photos_sure_del_album"),getLang("global_delete"),(function(o){ajax.post("al_photos.php",{act:"delete_album",album:e,hash:t},{showProgress:a.lockButton.pbind(o),hideProgress:a.unlockButton.pbind(o)})}),getLang("global_cancel"))},showSaved(e,t){var o=Object(r.ge)(e),a=function(){setTimeout(animate.pbind(o,{backgroundColor:t,borderLeftColor:"#D8DFEA",borderRightColor:"#D8DFEA",borderTopColor:"#D8DFEA",borderBottomColor:"#D8DFEA"},1e3),1e3)};Object(r.isVisible)(o)?animate(o,{backgroundColor:"#E7F1F9",borderLeftColor:"#4C96D4",borderRightColor:"#4C96D4",borderTopColor:"#4C96D4",borderBottomColor:"#4C96D4"},200,a):(Object(r.show)(o),a())},saveAlbum(e){var t={act:"save_album",album:cur.album,hash:cur.albumhash,title:Object(r.ge)("album_title").value,desc:Object(r.ge)("album_description").value,enable_hintach:isChecked("hintach_enabled_for_album")};if(!t.title)return Object(a.notaBene)("album_title");var o=cur.album.replace(vk.id+"_","");cur.privacy["album"+o]?extend(t,{view:Privacy.getValue("album"+o),comm:Privacy.getValue("albumcomm"+o)}):Object(r.ge)("album_only_check")&&extend(t,{main:isChecked("album_main_check"),only:isChecked("album_only_check"),comm:isChecked("album_comments_check")}),ajax.post("al_photos.php",t,{onDone:function(){var e=Object(r.ge)("album_main_check");e&&isChecked(e)&&(Object(r.addClass)(e,"on"),Object(r.addClass)(e,"disabled"),Object(r.hide)("album_delete_action"));var t=Object(r.ge)("photos_changes_saved");Object(r.setStyle)(t,{opacity:1}),setTimeout((function(){Object(r.setStyle)(t,{opacity:0})}),1500)},showProgress:a.lockButton.pbind(e),hideProgress:a.unlockButton.pbind(e)})},savePhotos(){for(var e={act:"save_photos",album:cur.album,hash:cur.albumhash},t=Object(r.ge)("photos_container"),o=0,a=t.firstChild;a;a=a.nextSibling)if(a.firstChild&&Object(r.isVisible)(a.firstChild)){var i=a.id.replace("photo_edit_row","");e["photo_id"+o]=i,e["photo_desc"+o]=Object(r.ge)("photo_caption"+i).value,++o}ajax.post("al_photos.php",e,{onDone:function(){for(var e=t.firstChild;e;e=e.nextSibling)if(e.firstChild&&Object(r.isVisible)(e.firstChild)){var o=e.id.replace("photo_edit_row","");Object(r.ge)("photo_save_result"+o).innerHTML=getLang("photos_privacy_description")}cur.descs=!1,scrollToTop(200),s.showSaved("photos_saved_msg","#F3F8FC"),Object(r.ge)("photos_container").sorter&&sorter.update(Object(r.ge)("photos_container").sorter.elems[0])},progress:"photos_save_progress"})},deleteSelectedPhotos(e){var t=[];each(Object(r.geByClass)("photos_edit_selected"),(function(){t.push(this.getAttribute("data-id"))}));var o=intval(s._editGetSelectedCount()>t.length),a=cur.album.split("_");showBox("/al_photos.php",{act:"delete_selected_box",Photo_ids:o?"":t.join(","),owner_id:a[0],album_id:a[1],all:o},{onDone(){var t=curBox();t.removeButtons(),t.addButton(getLang("photos_del_selected_box_yes"),t=>{Object(r.show)("photos_del_box_progress"),Object(r.hide)("photos_del_box_text"),Object(r.re)(t);var o=Object(r.ge)("photos_del_box_progress_text");s.doEditBatchProcess({act:"delete_photos",hash:e,owner_id:a[0],album_id:a[1]},cur.editDeletePhotosArray,Object(r.ge)("photos_del_box_progress_wrap"),"photos_del_selected_title_progress",(function(e,t,a,i,_){Object(r.val)(o,getLang("photos_del_selected_box_text_progress").replace("{count}",i).replace("{total}",_)),cur.count=Math.max(cur.count-e,0),each(a,(function(e,t){Object(r.re)("photo_edit_row_"+t),cur.count=Math.max(cur.count,0)})),s._editUpdateSelectedCounter()}),(function(){var e=curBox();(e&&e.hide(),0==cur.count)?nav.reload():Object(r.geByClass)("photos_photo_edit_row").length<40&&s.load()}))}),t.addButton(getLang("box_cancel"),(function(){t.hide(),cur.editDeletePhotosArray=!1}),"no")}})},doEditBatchProcess(e,t,o,a,i,_){var s=t.split(","),c=s.length,n=cur.editPhotosMaxChunkSize||50,p=Math.ceil(c/n),l=Object(r.geByClass1)("photos_progress_bar",Object(r.ge)(o))||Object(r.geByClass1)("ui_progress_bar",Object(r.ge)(o)),d=0,u=document.title,v=curBox();i(0,!1,[],0,c),function t(o){if(!v.isVisible())return _(d),void Object(r.setDocumentTitle)(u);var h=s.slice(o*n,(o+1)*n);ajax.post("/al_photos.php",extend({photos:h.join(",")},e),{onDone:function(e,s,n){d+=e,o++,Object(r.setStyle)(l,{width:100*o/p+"%"});var v=getLang(a).replace("{count}",d).replace("{total}",c);Object(r.setDocumentTitle)(v),i(e,s,h,d,c,n),o<p?t(o):setTimeout((function(){Object(r.setDocumentTitle)(u),_(d,s)}),200)}})}(0)},_showProgressPanel(e){var t=Object(r.se)('<div class="photo_mask_progress _photo_mask_progress"><div class="round_spinner"></div></div>');return e.appendChild(t),t},_hideProgressPanel(e){Object(r.re)(Object(r.geByClass1)("_photo_mask_progress",e))},deletePhoto(e,t,o,a){var i;if(""===e&&o&&(i=Object(r.gpeByClass)("photos_photo_edit_row",o),e=Object(r.attr)(i,"data-id"),t=Object(r.attr)(i,"data-edit-hash")),i=i||Object(r.ge)("photo_edit_row_"+e)){var _=s._showProgressPanel(i);return Object(r.addClass)(i,"photos_deleted"),ajax.post("al_photos.php",{act:"delete_photo",photo:e,hash:t,edit:1},{onDone:function(e){Object(r.re)(_),i.appendChild(Object(r.se)(e)),s.recache(cur.offset,-1),cur.count-=1,s._editUpdateSelectedCounter(),cur.count<2&&Object(r.hide)("album_thumb_action"),Object(r.ge)("photos_go_to_album_cont")&&!cur.count&&Object(r.hide)("photos_go_to_album_cont"),cur.photoAddUpdate&&cur.photoAddUpdate(i),cur.introTooltipHide&&cur.introTooltipHide(!0)}}),cancelEvent(a)}},restorePhoto(e,t,o){var a=Object(r.ge)("photo_edit_row_"+t);if(a&&Object(r.hasClass)(a,"photos_deleted")){var i=s._showProgressPanel(a);Object(r.re)(Object(r.geByClass1)("photos_restore",a)),ajax.post("al_photos.php",{act:"restore_photo",photo:t,hash:o,edit:1},{onDone:function(){Object(r.re)(i),Object(r.removeClass)(a,"photos_deleted"),s.recache(cur.offset,1),cur.count+=1,s._editUpdateSelectedCounter(),cur.count>1&&Object(r.show)("album_thumb_action"),Object(r.ge)("photos_go_to_album_cont")&&cur.count&&Object(r.show)("photos_go_to_album_cont"),cur.photoAddUpdate&&cur.photoAddUpdate(a)},progress:"photo_restore_progress"+t})}},toggleMoveToAlbumMode(e,t){var o=Object(r.ge)("photos_move_box_search"),a=Object(r.ge)("pv_move_to_album_cont"),i=Object(r.ge)("photos_box_edit_data"),_=curBox(),c=Object(r.geByClass1)("box_title",_.titleWrap);if(e){Object(r.hide)(o),Object(r.hide)(a),Object(r.show)(i),_.setOptions({width:500});var n=getLang("photos_move_to_new_album_title");cur.noAlbums||(n+=`\n          <span class="divider">|</span>\n          <a onclick="return photos.toggleMoveToAlbumMode(false, event)" href="" class="toggle">\n            ${getLang("photos_move_to_another_album_toggle")}\n          </a>\n        `),Object(r.val)(c,n),_.removeButtons().addButton(getLang("photos_create_album_and_move"),cur.saveNewAlbum).addButton(getLang("global_cancel"),_.hide,"no"),cur.onNewAlbumDone=function(e){curBox().hide(),s.movePhotosBox(cur.editPhotosArray.split(","),!1,(function(){setTimeout((function(){var t=Object(r.ge)("album"+e);s.doMovePhotos(!1,t)}))}))}}else Object(r.show)(o),Object(r.show)(a),Object(r.hide)(i),_.setOptions({width:795}),Object(r.val)(c,getLang("photos_move_box_title")+'<span class="divider">|</span><a onclick="return photos.toggleMoveToAlbumMode(true, event)" href="" class="toggle">'+getLang("photos_move_to_new_album")+"</a>"),_.removeButtons().addButton(getLang("global_cancel"),_.hide);return cancelEvent(t)},showMove(e,t,o){var a=cur.moveddc,i=Object(r.ge)("photos_move_link"+e);cur.privacyPhotoMove?Privacy.show(i,o,"photos_move"):(cur.zIndexUpdated&&(s.hideMove(),cur.noZIndexUpdate=!0),Object(r.ge)("photo_edit_row"+e)&&(cur.zIndexUpdated=e,Object(r.setStyle)(Object(r.ge)("photo_edit_row"+e),{zIndex:150})),s.hideMove()),extend(cur,{movelnk:i,moveph:e,movehash:t}),cur.privacyPhotoMove||(i.parentNode.replaceChild(a,i),cur.movedd.focus(),cur.movedd.showDefaultList(),addEvent(document,"click",s.hideMove))},hideMove(){if(cur.noZIndexUpdate)delete cur.noZIndexUpdate;else if(!cur.privacyPhotoMove){if(cur.movelnk)try{cur.moveddc.parentNode.replaceChild(cur.movelnk,cur.moveddc),cur.movelnk=!1,cur.movedd.clear(),cur.zIndexUpdated&&Object(r.ge)("photo_edit_row"+cur.zIndexUpdated)&&(Object(r.setStyle)(Object(r.ge)("photo_edit_row"+cur.zIndexUpdated),{zIndex:100}),delete cur.zIndexUpdated)}catch(e){}removeEvent(document,"click",s.hideMove)}},movePhoto(e,t,o){e=intval(e);var a=r.show.pbind("photo_return_progress"+t),_=r.hide.pbind("photo_return_progress"+t);if(!t){if(!e||e==cur.album.split("_")[1])return s.hideMove();t=cur.moveph,o=cur.movehash,a=function(){Object(r.hide)("photo_delete_link"+t),Object(r.show)("photo_edit_progress"+t)},_=function(){Object(r.hide)("photo_edit_progress"+t),Object(r.show)("photo_delete_link"+t)}}ajax.post("al_photos.php",{act:"move_photo",album:e,photo:t,hash:o},{onDone:function(o){var a=Object(r.ge)("photo_edit_row"+t);if(a&&a.firstChild){if(e==cur.album.split("_")[1]){if(Object(r.isVisible)(a.firstChild))return;a.removeChild(a.firstChild.nextSibling),Object(r.show)(a.firstChild),s.recache(cur.offset,1),++cur.count,cur.count>1&&Object(r.show)("album_thumb_action")}else{if(!Object(r.isVisible)(a.firstChild))return;s.hideMove(),Object(r.hide)(a.firstChild),a.appendChild(Object(r.ce)("div",{innerHTML:o})),s.recache(cur.offset,-1),--cur.count,cur.count<2&&Object(r.hide)("album_thumb_action")}cur.photoAddUpdate&&cur.photoAddUpdate(a),cur.introTooltipHide&&cur.introTooltipHide(!0),Object(r.ge)("photos_go_to_album_cont")&&Object(r.toggle)("photos_go_to_album_cont",!!cur.count)}},onFail:function(e){if(s.hideMove(),e)return setTimeout(Object(i.showFastBox)({title:getLang("global_error"),dark:1,bodyStyle:"padding: 20px;"},e).hide,2e3),!0},showProgress:a,hideProgress:_})},updateThumbs(e,t){var o=Object(r.ge)("photos_add_img"+cur.peEditPhoto);o&&(o.src=e)},editPhoto(e,t,o){cur.peEditPhoto=e,showBox("al_photos.php",{act:"edit_photo",photo:e,webgl:1,stat:["ui_controls.css","ui_controls.js"]},{dark:1})},backupDesc(e){cur.descs||(cur.descs={}),cur.descs[e]=trim(Object(r.ge)("photo_caption"+e).value)},saveDesc(e,t){var o=Object(r.ge)("photo_caption"+e).value,a=cur.descs[e];delete cur.descs[e],trim(o)!=a&&ajax.post("al_photos.php",{act:"save_desc",photo:e,hash:t,text:o,edit:1},{onDone:function(t){Object(r.ge)("photo_save_result"+e).innerHTML=t},onFail:function(t){return Object(r.ge)("photo_save_result"+e).innerHTML='<div class="photo_save_error">'+t+"</div>",!0},showProgress:function(){Object(r.ge)("photo_save_result"+e).innerHTML=getLang("photos_privacy_description"),Object(r.show)("photo_save_progress"+e)},hideProgress:function(){Object(r.hide)("photo_save_progress"+e)}})},genFile:(e,t,o)=>Object(r.ce)("div",{innerHTML:`\n        <a class="photo_file_cancel" id="photo_cancel${e}" onclick="${t}">${o}</a>\n        <div class="photo_file_button">\n          <div class="file_button_gray">\n            <div class="file_button" id="photo_file_button${e}">${getLang("photos_choose_file")}</div>\n          </div>\n        </div>\n      `}),initFile(e){FileButton.init("photo_file_button"+e,{name:"photo",id:"photo_file"+e,accept:"image/jpeg,image/png,image/gif",onchange:s.fileSelected})},addFile(){var e=cur.files.length,t=s.genFile(e,"photos.fileCancel("+e+")",getLang("global_cancel"));extend(t,{className:"photo_upload_file",id:"photo_upload_row"+e}),Object(r.ge)("photo_upload_files").appendChild(t),s.initFile(e),cur.files.push({})},filesLoad(){for(var e=0,t=0;e<cur.files.length;++e){if(Object(r.ge)("photo_file"+e).value)break}if(e!=cur.files.length){cur.allcont=utilsNode.appendChild(Object(r.ce)("div",{innerHTML:`\n        <iframe name="photo_frame_all"></iframe>\n        <form target="photo_frame_all" id="photo_form_all" method="POST" action="${cur.url}" enctype="multipart/form-data"></form>\n      `}));var o=Object(r.ge)("photo_form_all"),a=extend(cur.fields,{act:"do_add",al:1,from_host:locHost,ondone:"photos.filesDone",onfail:"photos.filesFail"});for(t in a)a.hasOwnProperty(t)&&o.appendChild(Object(r.ce)("input",{name:t,value:a[t]}));for(e=0,t=0;e<cur.files.length;++e){var i=Object(r.ge)("photo_file"+e);i.value&&(i.name="file"+t,o.appendChild(i),++t)}o.submit()}},fileSelected(){var e=intval(this.id.replace("photo_file",""));if(cur.files[e].deleting||!cur.files[e].cont&&!cur.files[e].id){cur["fileDone"+e]=s.fileDone.pbind(e),cur["fileFail"+e]=s.fileFail.pbind(e),cur.files[e].cont=utilsNode.appendChild(Object(r.ce)("div",{innerHTML:`\n        <iframe name="photo_frame${e}"></iframe>\n        <form target="photo_frame${e}" id="photo_form${e}" method="POST" action="${cur.url}" enctype="multipart/form-data"></form>\n      `}));var t=Object(r.ge)("photo_form"+e),o=extend(cur.fields,{act:"do_add",al:1,from_host:locHost,ondone:"cur.fileDone"+e,onfail:"cur.fileFail"+e});for(var i in o)o.hasOwnProperty(i)&&t.appendChild(Object(r.ce)("input",{name:i,value:o[i]}));t.appendChild(this),t.submit();var _=Object(r.ge)("photo_file_button"+e);Object(a.lockButton)(_),setTimeout((function(){_.innerHTML=_.innerHTML}),0),Object(r.show)("photo_cancel"+e),Object(r.ge)("photo_cancel"+e).innerHTML=getLang("global_cancel"),e==cur.files.length-1&&s.addFile()}},fileDone(e,t){Object(r.hide)("photo_cancel"+e);for(var o="",a=e+1;a<cur.files.length;++a)if(cur.files[a].id&&!cur.files[a].deleting){o=cur.files[a].id;break}setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",before:o,context:1},AjaxConvert.fromQueryString(t)),{onDone:function(t,o){if(!t)return s.fileFail(e,0);cur.files[e].cont.innerHTML="",utilsNode.removeChild(cur.files[e].cont),extend(cur.files[e],{id:t,deleting:!1,cont:!1}),Object(r.ge)("photo_upload_row"+e).innerHTML=o,autosizeSetup("photo_caption"+t,{minHeight:30}),Object(r.show)("photo_delete"+t)},onFail:function(t){if(t)return setTimeout(Object(i.showFastBox)({title:getLang("global_error"),dark:1,bodyStyle:"padding: 20px;"},t).hide,3e3),s.fileCancel(e),!0}}),0)},fileCancel(e,t){if(cur.files[e].cont&&(cur.files[e].cont.innerHTML="",utilsNode.removeChild(cur.files[e].cont)),!t){var o=Object(r.ge)("photo_file_button"+e);Object(a.unlockButton)(o),o.innerHTML=getLang("photos_choose_file"),cur.files[e]={},s.initFile(e),Object(r.hide)("photo_cancel"+e)}},fileFail(e,t){s.fileCancel(e)},fileDelete(e,t){for(var o=0;o<cur.files.length&&cur.files[o].id!=e;)++o;if(o!=cur.files.length&&!cur.files[o].deleting){cur.files[o].deleting=!0,ajax.post("al_photos.php",{act:"delete_photo",photo:e,hash:t,edit:2},{onFail:function(){cur.files[o].deleting=!1}});var a=Object(r.ge)("photo_edit_row"+e);a.parentNode.insertBefore(s.genFile(o,"photos.fileRestore('"+e+"', '"+t+"')",getLang("global_restore")),a),Object(r.hide)(a),s.initFile(o),Object(r.show)("photo_cancel"+o)}},fileRestore(e,t){for(var o=0,a="";o<cur.files.length&&cur.files[o].id!=e;)++o;if(o!=cur.files.length&&cur.files[o].deleting&&-1!==cur.files[o].deleting){if(cur.files[o].cont)return s.fileCancel(o);for(var i=o+1;i<cur.files.length;++i)if(cur.files[i].id&&!cur.files[i].deleting){a=cur.files[i].id;break}cur.files[o].deleting=-1,ajax.post("al_photos.php",{act:"restore_photo",photo:e,hash:t,before:a,edit:2},{onDone:function(){cur.files[o].deleting=!1}});var _=Object(r.ge)("photo_edit_row"+e);Object(r.show)(_),Object(r.re)(_.previousSibling)}},filesDone(e){setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",context:2},AjaxConvert.fromQueryString(e))),0)},filesFail(){for(var e=0;e<cur.files.length;++e)s.fileCancel(e);cur.allcont.innerHTML="",utilsNode.removeChild(cur.allcont),cur.allcont=!1},chooseFlash(){if(browser.flash<10)return animate(Object(r.ge)("photo_flash_needed"),{backgroundColor:"#FFEFE8",borderBottomColor:"#E89B88",borderLeftColor:"#E89B88",borderRightColor:"#E89B88",borderTopColor:"#E89B88"},100,()=>{animate(Object(r.ge)("photo_flash_needed"),{backgroundColor:"#FFFFFF",borderBottomColor:"#CCCCCC",borderLeftColor:"#CCCCCC",borderRightColor:"#CCCCCC",borderTopColor:"#CCCCCC"},500)});cur.photoCheckFails=0,Object(r.show)("photo_flash_upload"),Object(r.hide)("photo_default_upload"),Object(r.hide)("photo_upload_unavailable")},chooseDefault(){cur.photoCheckFails=0,Object(r.show)("photo_default_upload"),Object(r.hide)("photo_flash_upload"),cur.serverChecked?(Object(r.show)("photo_upload_files"),Object(r.hide)("photo_default_check")):(Object(r.hide)("photo_upload_files"),Object(r.show)("photo_default_check"),cur.checkUpload())},flashWidth:()=>-1==_ua.indexOf("Mac")||-1==_ua.indexOf("Opera")&&-1==_ua.indexOf("Firefox")?"600":"601",activeTab(e){for(var t=Object(r.domPN)(Object(r.domPN)(e)),o=Object(r.domFC)(t);o;o=Object(r.domNS)(o))Object(r.removeClass)(o,"active_link");Object(r.addClass)(Object(r.domPN)(e),"active_link")},checkHtml5Uploader(){var e=window.XMLHttpRequest||window.XDomainRequest,t=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;return e&&(window.FormData||window.FileReader&&(window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary||window.ArrayBuffer&&window.Uint8Array&&t))},upload:(e,t)=>t&&(2==t.button||t.ctrlKey)?(s.checkHtml5Uploader()&&(e.href+="&html5=1"),!0):!(void 0!==cur.uplId&&window.Upload&&Upload.checked&&Upload.checked[cur.uplId]&&s.checkHtml5Uploader())||(Object(r.ge)("photos_upload_input").click(),!1),uploadLink:(e,t)=>(s.checkHtml5Uploader()&&(e.href+="&html5=1"),nav.go(e,t)),onUploadSelect(e){if(Object(r.ge)("photos_upload_area")){window.filesToUpload=e;var t=Object(r.ge)("photos_upload_area").innerHTML;Object(r.ge)("photos_upload_area").innerHTML='<img src="/images/upload.gif">',nav.go(Object(r.ge)("photos_upload_area").href+"&html5=1",!1,{onFail:function(e){return Object(r.ge)("photos_upload_area").innerHTML=t,setTimeout(Object(i.showFastBox)({title:getLang("global_error"),dark:1,bodyStyle:"padding: 20px;"},e).hide,3e3),!0}})}},thumbOver(e,t,o){cur.hideTO&&cur.hideTO[t]&&clearTimeout(cur.hideTO[t]);var a=Object(r.geByClass1)("description",e),i=Object(r.geByClass1)("photo_album_title",e),_=Object(r.getSize)(a)[1];animate(i,{marginTop:163-(_?_+7:0)},{duration:200,transition:Fx.Transitions.easeOutCirc});var s=Object(r.geByClass1)("photo_album_info_back",e),c=Object(r.geByClass1)("photo_album_info_cont",e);if(s&&c)if(!s.over||o){var n=o?.6:.5,p=o?1:.8;o&&(s.over=1),animate(s,{opacity:n},{duration:200,transition:Fx.Transitions.easeOutCirc}),animate(c,{opacity:p},{duration:200,transition:Fx.Transitions.easeOutCirc})}else s.over=0},thumbOut(e,t,o){var a=Object(r.geByClass1)("photo_album_info_back",e),i=Object(r.geByClass1)("photo_album_info_cont",e),_=()=>{if(o){var t=Object(r.geByClass1)("photo_album_title",e);animate(t,{marginTop:163},200)}if(a&&i){var _=o?0:.8;animate(a,{opacity:o?0:.5},200),animate(i,{opacity:_},200)}};o?(cur.hideTO=cur.hideTO||{},cur.hideTO[t]=setTimeout(_,150)):_()},openEditor:(e,t)=>(stManager.add([jsc("web/photoview.js"),"photoview.css"],(function(){var t=Object(r.gpeByClass)("photos_photo_edit_row",e);cur.onPESave=function(e){curBox().hide(),Object(r.setStyle)(Object(r.geByClass1)("photos_photo_edit_row_thumb",t),"background-image","url('"+e+"')"),cur.onPESave=!1,bodyNode.style.overflow="auto"};var o=t.getAttribute("data-id");Photoview.openEditor(o,cur.savedThumbs?cur.savedThumbs[o]:t.getAttribute("data-thumb"))})),cancelEvent(t)),addToAlbum(){cur.isPhotoUpload=!0,s.movePhotosBox(cur.savedPhotos||[],!1)},movePhotosBox(e,t,o,a){var i=[],_=!1;isArray(e)?i=e:(""===e&&t&&(e=Object(r.gpeByClass)("photos_photo_edit_row",t).getAttribute("data-id")),e?i.push(e):each(Object(r.geByClass)("photos_edit_selected"),(function(){i.push(this.getAttribute("data-id"))})),_=intval(s._editGetSelectedCount()>i.length));var c=cur.album?cur.album.split("_"):[vk.id];return showBox("/al_photos.php",{act:"a_move_to_album_box",photo_ids:_?"":i.join(","),owner_id:c[0],from_album_id:c[1],all:_},{onDone:o}),cancelEvent(a)},cancelMove(e,t,o,a,i,_,c){var n=Object(r.gpeByClass)("photos_photo_edit_row",t);Object(r.re)(Object(r.geByClass1)("photos_cancel_move",n)),s._showProgressPanel(n),ajax.post("al_photos.php",{act:"move_photos",photos:o,to_album_id:a,from_album_id:i,hash:c,owner_id:_},{onDone:function(){s._hideProgressPanel(n),cur.count++,s._editUpdateSelectedCounter()}}),cancelEvent(e)},doMovePhotos(e,t,o){var a=Object(r.domClosest)("_photos_album",t),i=Object(r.domData)(a,"aid"),_=Object(r.domData)(a,"from-aid"),c=Object(r.domData)(a,"owner-id"),n=Object(r.domData)(a,"move-hash"),p=Object(r.domData)(a,"from"),l=Object(r.geByClass1)("photos_album_counter",t),d=Object(r.geByClass1)("photos_album_thumb",t),u=Object(r.ge)("pv_move_to_album_progress");d.insertBefore(u,d.children[0]),Object(r.show)(u),Object(r.addClass)(t,"photos_in_progress"),Object(r.addClass)(Object(r.gpeByClass)("photos_container_albums",t),"photos_inactive"),s.doEditBatchProcess({act:"move_photos",to_album_id:i,from_album_id:_,owner_id:c,hash:n,from:p},cur.editPhotosArray,Object(r.ge)("pv_move_to_album_progress"),"photos_move_in_progress_title",(function(e,t,a,n,p,d){cur.count=Math.max(cur.count-e,0),Object(r.val)(l,+Object(r.val)(l)+e),each(a,(function(e,t){var a=Object(r.ge)("photo_edit_row_"+t);if(!cur.isPhotoUpload)if(a&&!o){var s="return photos.cancelMove(event, this, '"+t+"', "+_+", "+i+", "+c+", '"+d+"')",n=Object(r.se)('<div class="photos_cancel_move"><a href="" onclick="'+s+'">'+getLang("global_cancel")+"</a></div>");a.appendChild(n)}else Object(r.re)(a);cur.count=Math.max(cur.count,0)})),s._editUpdateSelectedCounter()}),(function(e,t){var a=curBox();a&&a.hide();var i=langNumeric(e,cur.lang.photos_x_photos_moved_no_cancel);(i=i.replace("{album}",t),showDoneBox(i),cur.pvShown&&cur.pvCurPhoto&&(cur.pvCurPhoto.album=t,Object(r.geByClass1)("pv_album_name").innerHTML=t),o||cur.isPhotoUpload)&&(0==cur.count?nav.reload():Object(r.geByClass)("photos_photo_edit_row").length<40&&s.load())})),e&&cancelEvent(e)},publishPhotos(e){if(cur.savedPhotos){cur.savingPhotos=!0;var t={act:"post",type:"photos_upload",to_id:vk.id,attach1_type:"photos_list",attach1:(cur.savedPhotos||[]).join(","),hash:cur.post_hash};ajax.post("/al_wall.php",t,{showProgress:a.lockButton.pbind(e),onDone:function(){delete cur._back,nav.go("/al_profile.php"),showBackLink()}})}return!1},registerDragZone(e){addEvent(document,"dragenter dragover",(function(t){if(s.checkHtml5Uploader())return setTimeout((function(){clearTimeout(cur.dragTimer),delete cur.dragTimer}),0),e.on(t),cancelEvent(t)})),addEvent(document,"dragleave",(function(t){cur.dragTimer&&(clearTimeout(cur.dragTimer),delete cur.dragTimer),cur.dragTimer=setTimeout((function(){e.un(t)}),100),cancelEvent(t)})),addEvent(document,"drop",(function(t){return e.un(t,!0),e.drop(t.dataTransfer.files),cancelEvent(t)})),cur.destroy.push((function(){removeEvent(document,"dragenter dragover"),removeEvent(document,"dragleave"),removeEvent(document,"drop")}))},openWebcamPhoto(){showBox("al_photos.php",{act:"webcam_photo",oid:cur.oid},{params:{dark:1}}).setOptions({width:644})},initWebcam(e,t){cur.lang=extend(cur.lang||{},t),e.setOptions({hideButtons:!0,width:644,bodyStyle:"padding:0px;border:0px;"}),s.cameraInit()},cameraInit(){var e=["ajx=1"];for(var t in Upload.vars[cur.uplId])Upload.vars[cur.uplId].hasOwnProperty(t)&&e.push(t+"="+Upload.vars[cur.uplId][t]);var o=Upload.uploadUrls[cur.uplId]+(Upload.uploadUrls[cur.uplId].match(/\?/)?"&":"?")+e.join("&"),a={s_noCamera:getLang("profile_no_camera"),s_noAccess:getLang("profile_no_camera_access"),s_setAccess:getLang("profile_set_camera_access"),s_capture:getLang("profile_capture_image"),s_videoMode:getLang("profile_to_video_mode"),upload_url:o,saveClbk:"photos.cameraPhotoDone",hideClbk:"photos.uploadReturn",overClbk:"photos.cameraBtnOver",outClbk:"photos.cameraBtnOut",downClbk:"photos.cameraBtnDown",upClbk:"photos.cameraBtnUp",showSaveClbk:"photos.showCameraSaveBtn",hideSaveClbk:"photos.hideCameraSaveBtn",hideCaptureClbk:"photos.hideCameraCaptureBtn",progressClbk:"photos.cameraSaveProgress",getBtnsPos:"photos.updateCameraButtonsPos",jpgQuality:"95"};for(var i in a)a.hasOwnProperty(i)&&(a[i]=winToUtf(a[i]));return e={allownetworking:"true",wmode:"transparent"},this.addWebcamPhotoControls=Object(r.geByClass1)("add_webcam_photo_controls"),Object(r.hide)("camera_button_no"),renderFlash("webcam_photo",{url:"/swf/CaptureImg.swf",id:"flash_camera",width:604,height:480,preventhide:1,style:"visibility: visible",version:9},e,a),Object(_.statlogsValueEvent)("webcam_stat","click_open"),!1},cameraPhotoDone(e){Object(_.statlogsValueEvent)("webcam_stat","capture"),delete this.addWebcamPhotoControls,e=JSON.parse(e.replace(/\\"/g,'"')),ajax.post("al_photos.php",extend({act:"choose_uploaded",from_webcam:1},e),{onDone:function(e,t){s.showEditView(e,t)}})},updateCameraButtonsPos(){var e=this.addWebcamPhotoControls,t=[],o=Object(r.getXY)(e);Object(r.setStyle)(this.addWebcamPhotoControls,{visibility:"visible"});var a=function(e,a){if(Object(r.isVisible)(a.parentNode)){var i=Object(r.getXY)(a),_=Object(r.getSize)(a);t.push([i[0]-o[0],i[1]-o[1],_[0]+2,_[1]+2])}};each(Object(r.geByTag)("button",e),a),each(Object(r.geByClass)("button",e),a),1==t.length&&t.push([999,999,1,1]),Object(r.ge)("flash_camera").setButtonsPos&&Object(r.ge)("flash_camera").setButtonsPos(t)},showCameraSaveBtn(){Object(r.show)("camera_button_no"),Object(r.ge)("camera_button_yes").innerHTML=getLang("profile_oph_camera_save"),Object(r.ge)("camera_button_no").innerHTML=getLang("profile_to_video_mode"),this.updateCameraButtonsPos()},hideCameraSaveBtn(e){Object(r.hide)("camera_button_no");var t=Object(r.ge)("camera_button_no");Object(r.ge)("camera_button_yes").innerHTML=getLang("profile_capture_image"),t&&(t.innerHTML=getLang("profile_oph_camera_back")),e||this.updateCameraButtonsPos()},hideCameraCaptureBtn(){Object(r.hide)(Object(r.ge)("camera_button_no").parentNode),Object(r.ge)("camera_button_yes").innerHTML=getLang("profile_no_camera_back"),this.updateCameraButtonsPos()},cameraSaveProgress(e){var t=Object(r.ge)("camera_button_yes");t&&(e?Object(a.lockButton)(t):Object(a.unlockButton)(t))},cameraBtnOver(e){var t=Object(r.geByClass1)(e,this.addWebcamPhotoControls);t&&Object(r.addClass)(t,"hover")},cameraBtnOut(e){var t=Object(r.geByClass1)(e,this.addWebcamPhotoControls);t&&(Object(r.removeClass)(t,"hover"),Object(r.removeClass)(t,"active"))},cameraBtnDown(e){var t=Object(r.geByClass1)(e,this.addWebcamPhotoControls);t&&Object(r.addClass)(t,"active")},cameraBtnUp(e){var t=Object(r.geByClass1)(e,this.addWebcamPhotoControls);t&&Object(r.removeClass)(t,"active")},uploadReturn(){curBox().hide(),delete this.addWebcamPhotoControls},showEditView(e,t){cur.webcamPhotoMedia=e,cur.pvPhoto=null,cur.uploadPhotoData=t,stManager.add([jsc("web/photoview.js")],(function(){cur.fromWebcam=!0,Photoview.openEditor(e,t.editable.sizes.x[0])}))},onFiltersSave(){cur.imMedia?cur.imMedia.chooseMedia("photo",cur.webcamPhotoMedia,extend(cur.uploadPhotoData,{upload_ind:cur.imUploadInd+"_selfie"})):cur.chooseMedia("photo",cur.webcamPhotoMedia,extend(cur.uploadPhotoData,{upload_ind:cur.uplId+"_selfie"})),delete cur.webcamPhotoMedia,delete cur.uploadPhotoData},returnToWebcam(){curBox().hide(),this.openWebcamPhoto()}}},244:function(e,t,o){e.exports=o("TkEv")},J1I5:function(e,t,o){"use strict";o.r(t),o.d(t,"Phototag",(function(){return a}));var r=o("yTQ2"),a={startTag(){if(!cur.pvTagger&&cur.pvPhoto.firstChild&&(!cur.pvTaggerTooltip&&window.layer?cur.pvTaggerTooltip=new r.default(layer,{closeOnClick:!1,resetDropdownOnShow:!1,onUserSelected:a.addTag,onEscapePressed:a.stopTag}):cur.pvTaggerTooltip.resetFriendsDropdown(),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(getLang("photos_select_tag_area"),`<button class="flat_button" onclick="Phototag.stopTag()">${getLang("global_done")}</button>`),Photoview.toggleNavControls(""),Photoview.toggleOnPhotoControls(!1),layerWrap.scrollTop=0,cur.pvTagger="loading",cur.pvTagger)){var e={minw:30,minh:30,onStart(){cur.pvPhotoTags&&cur.pvPhotoTags.pauseTooltips(),cur.pvTaggerTooltip.hide()},onFinish:a.showFriends};Photoview.updatePhotoDimensions(),cur.pvTagger=window.photoTagger(cur.pvPhoto.firstChild,extend(e,{zstart:50})),cur.pvPhotoTags&&cur.pvPhotoTags.hideAllSuggestedAreas()}},stopTag(){cur.pvTagger&&"loading"!=cur.pvTagger?(Photoview.toggleTopInfoPanel(!1),hide(cur.pvFriends),cur.pvTaggerTooltip&&cur.pvTaggerTooltip.hide(),cur.pvListId&&cur.pvData[cur.pvListId].length>1&&Photoview.toggleNavControls("left close right"),Photoview.toggleOnPhotoControls(!0),cur.pvTagger.destroy(),cur.pvTagger=!1,Photoview.updatePhotoDimensions(),cur.pvPhotoTags&&cur.pvPhotoTags.reload()):cur.pvTagger=!1},addTag(e,t){if(!cur.pvTagger||"loading"==cur.pvTagger)return!1;var o=cur.pvTagger.result();if(!e&&!t||!o[2])return!1;var r=cur.pvListId,a=cur.pvIndex,i=cur.pvData[r][a],_=getSize(cur.pvPhoto.firstChild),s=o[0]/_[0]*100,c=o[1]/_[1]*100,n=(o[0]+o[2])/_[0]*100,p=(o[1]+o[3])/_[1]*100;return ajax.post("al_photos.php",{act:"add_tag",mid:e,photo:i.id,name:t,hash:i.hash,x:s,y:c,x2:n,y2:p},{onDone(e,t,o){i.tags=e,i.tagged=t,i.tagshtml=o,cur.pvListId==r&&cur.pvIndex==a&&(re(Photoview.actionInfo()),Photoview.setTags(o),(!i.taginfo&&i.actions.tag&&e[0]<cur.pvMaxTags?show:hide)(cur.pvTagLink),cur.pvTaggerTooltip.hide(),cur.pvTagger.reset(),cur.pvPhotoTags.renderTagAreas(),cur.pvTaggerTooltip.resetFriendsDropdown())},onFail:cur.pvPhotoTags.handleTagRequestFail}),!1},showFriends(){if(cur.pvTagger&&"loading"!=cur.pvTagger){var e=cur.pvTagger.result(),t=e[0],o=e[1],r=e[2],a=e[3],i=getXYRect(cur.pvPhoto.firstChild,!0),_=i.left+t,s=i.top+o,c=i.left+t+r,n=i.top+o+a;cur.pvTaggerTooltip.hide(),cur.pvPhotoTags&&cur.pvPhotoTags.resumeTooltips(),cur.pvTaggerTooltip.show({left:_,top:s,right:c,bottom:n},{},!0)}}}},TkEv:function(e,t,o){"use strict";o.r(t);var r=o("iX+u");window.Photoview=r.Photoview;try{stManager.done(jsc("web/photoview.js"))}catch(e){}},WX8S:function(e,t,o){"use strict";o.r(t),o.d(t,"FullscreenPV",(function(){return a}));o("SRfc");var r=o("zxIV"),a={init(){if(cur.pvCanvas&&!cur.pvFSControls){var e=positive(getCookie("remixfsss")),t=Math.min(positive(getCookie("remixfsdt"))||5,15);cur.pvFSControls=cur.pvCanvas.appendChild(Object(r.ce)("div",{id:"pv_fs_controls",innerHTML:`\n<div id="pv_fs_topright" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_num"></div>\n      </td>\n      <td>\n        <div id="pv_fs_close" onclick="Photoview.fullscreenStop()">\n          <div id="pv_fs_close_btn"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_bottomleft" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_slide_check" onclick="FullscreenPV.startSlide()">\n          <div class="pv_fs_slide_check_icon"></div>${getLang("photos_slideshow")}\n        </div>\n      </td>\n      <td>\n        <div id="pv_fs_slide_speed_wrap">\n          <div id="pv_fs_slide_about"></div>\n          <div id="pv_fs_slide_speed" onmousedown="FullscreenPV.startSlideEdit(event)">\n            <div id="pv_fs_slide_speed_back"></div>\n            <div id="pv_fs_slide_speed_line">\n              <div id="pv_fs_slide_speed_ctrl"></div>\n            </div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_left_wrap" class="pv_fs_controls">\n  <div id="pv_fs_left"></div>\n</div>\n\n<div id="pv_fs_right_wrap" class="pv_fs_controls">\n  <div id="pv_fs_right"></div>\n</div>\n`,onmouseover:a.over,onmouseout:a.out})),extend(cur,{pvFSInfo:Object(r.ge)("pv_fs_num"),pvFSSlideCheck:Object(r.ge)("pv_fs_slide_check"),pvFSSlideSpeedWrap:Object(r.ge)("pv_fs_slide_speed_wrap"),pvFSSlideLine:Object(r.ge)("pv_fs_slide_speed_line"),pvFSSlideAbout:Object(r.ge)("pv_fs_slide_about"),pvFSSlideCont:Object(r.ge)("pv_fs_bottomleft"),pvFSSlideDelta:t,pvFSLeft:Object(r.ge)("pv_fs_left"),pvFSRight:Object(r.ge)("pv_fs_right")}),cur.pvFSSlideLine.style.width=Math.floor(100*(t-1)/14)+"%",Object(r.val)(cur.pvFSSlideAbout,getLang("photos_seconds",t)),e&&Object(r.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),a.slide(),addEvent(cur.pvCanvas,"mousemove",a.showControls),addEvent(cur.pvCanvas,"mousedown",a.onClick),addEvent(cur.pvCanvas,"mouseup",a.endSlideEdit),a.showControls(!0),cur.pvPhoto.blur(),a.updateInfo()}},over(e){var t=e||window.event,o=t.target||t.srcElement||document;cur.pvFSOver=!o.id.match(/^pv_fs_(left|right)(_wrap)?$/)},out(){cur.pvFSOver=!1},onClick:e=>(__afterFocus||e&&(2==e.button||3==e.which)||Object(r.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSLeftShown?Photoview.show(cur.pvListId,cur.pvIndex-1):cur.pvFSRightShown&&Photoview.show(cur.pvListId,cur.pvIndex+1)),!!e&&cancelEvent(e)),showControls(e){var t,o,i=cur.pvFSrX=e.pageX,_=cur.pvFSrY=e.pageY;cur.pvFSSlideEdit&&a.updateSlide(),void 0!==cur.pvFSX&&void 0!==cur.pvFSY&&Math.abs(i-cur.pvFSX)+Math.abs(_-cur.pvFSY)<4||(cur.pvFSControlsTimer||(Object(r.removeClass)(cur.pvCanvas,"pv_fs_nocursor"),clearTimeout(cur.pvFSHideControlsTimer),Object(r.show)(cur.pvFSControls),Object(r.addClass)(cur.pvFSControls,"pv_fs_shown")),clearTimeout(cur.pvFSControlsTimer),cur.pvFSOver||cur.pvFSSlideEdit||(cur.pvFSControlsTimer=setTimeout(a.hideControls,3e3)),(t=!cur.pvFSOver&&(i<100||cur.pvFSWidth&&i<(cur.pvScrWidth-cur.pvFSWidth)/2))&&!cur.pvFSLeftShown?Object(r.addClass)(cur.pvFSLeft,"pv_fs_over"):!t&&cur.pvFSLeftShown&&Object(r.removeClass)(cur.pvFSLeft,"pv_fs_over"),cur.pvFSLeftShown=t,(o=!cur.pvFSOver&&!t)&&!cur.pvFSRightShown?Object(r.addClass)(cur.pvFSRight,"pv_fs_over"):!o&&cur.pvFSRightShown&&Object(r.removeClass)(cur.pvFSRight,"pv_fs_over"),cur.pvFSRightShown=o,cur.pvFSX=i,cur.pvFSY=_)},hideControls(){Object(r.addClass)(cur.pvCanvas,"pv_fs_nocursor"),Object(r.removeClass)(cur.pvFSControls,"pv_fs_shown"),clearTimeout(cur.pvFSHideControlsTimer),cur.pvFSHideControlsTimer=setTimeout(r.hide.pbind(cur.pvFSControls),300),cur.pvFSControlsTimer=!1},startSlide(){Object(r.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")?(clearTimeout(cur.pvFSTimer),Object(r.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),setCookie("remixfsss",0)):(Object(r.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),a.slide(),setCookie("remixfsss",1),clearTimeout(cur.hideAboutTO),cur.hideAboutTO=setTimeout((function(){Object(r.removeClass)(cur.pvFSSlideAbout,"highlighted")}),3e3),Object(r.addClass)(cur.pvFSSlideAbout,"highlighted"))},updateSlide(){var e=Math.floor(15*Math.max(Math.min((vk.rtl?cur.pvFSrLeft+cur.pvFSrWidth-cur.pvFSrX:cur.pvFSrX-cur.pvFSrLeft)/cur.pvFSrWidth,.99),0))+1;cur.pvFSSlideDelta!=e&&(setCookie("remixfsdt",cur.pvFSSlideDelta=e),cur.pvFSSlideLine.style.width=Math.floor(100*(e-1)/14)+"%",Object(r.val)(cur.pvFSSlideAbout,getLang("photos_seconds",e)))},startSlideEdit(e){if(cur.pvFSrX&&cur.pvFSrY)return extend(cur,{pvFSSlideEdit:!0,pvFSrLeft:Object(r.getXY)(Object(r.domPN)(cur.pvFSSlideLine))[0],pvFSrWidth:Object(r.getSize)(Object(r.domPN)(cur.pvFSSlideLine))[0]}),Object(r.addClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),a.updateSlide(),clearTimeout(cur.pvFSTimer),cancelEvent(e||window.event)},endSlideEdit(){cur.pvFSSlideEdit&&(cur.pvFSSlideEdit=!1,Object(r.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),a.slide(),cur.pvFSOver||(clearTimeout(cur.pvFSControlsTimer),cur.pvFSControlsTimer=setTimeout(a.hideControls,3e3)))},slide(){clearTimeout(cur.pvFSTimer),!Object(r.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")||cur.pvFSSlideEdit||Object(r.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSTimer=setTimeout((function(){cur.pvSlideNeedAnimation=!0,Photoview.show(cur.pvListId,cur.pvIndex+1)}),1e3*cur.pvFSSlideDelta))},updateInfo(){var e=((cur.pvData||{})[cur.pvListId]||[]).length,t=cur.pvIndex+1;Object(r.val)(cur.pvFSInfo,t+" / "+e),Object(r.toggle)(cur.pvFSInfo,e>1),(e>1?r.removeClass:r.addClass)(cur.pvCanvas,"pv_fs_one")}};window.FullscreenPV=a},"g/In":function(e,t,o){"use strict";o.r(t);o("HEwt"),o("a1Th"),o("Btvt"),o("rGqo"),o("rE2o"),o("ioFf"),o("KKXr");var r=o("zxIV"),a=o("EasH"),i=o("4+be"),_=o("yTQ2"),s=o("Nk8j");function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],r=!0,a=!1,i=void 0;try{for(var _,s=e[Symbol.iterator]();!(r=(_=s.next()).done)&&(o.push(_.value),!t||o.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}t.default=class{constructor(e,t){this.imageNode=e,this.containerNode=t,this.activeAreaId=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this._handleImageMouseMove=this._handleImageMouseMove.bind(this),this._handleAreaClick=this._handleAreaClick.bind(this),this._removeActiveAreaAfterTimeout=this._removeActiveAreaAfterTimeout.bind(this),this._queueCheckUpdates=this._queueCheckUpdates.bind(this),this._queueReceiveUpdates=this._queueReceiveUpdates.bind(this),this._userSelectedCallback=this._userSelectedCallback.bind(this),this._handleSuggestionDeclined=this._handleSuggestionDeclined.bind(this),this._updatePhotoView=this._updatePhotoView.bind(this),this.deleteTag=this.deleteTag.bind(this),this._init(),this._queueCheckUpdates()}_init(){this.photoTooltip=new _.default(window.layer,{onMouseLeave:this._removeActiveAreaAfterTimeout,onUserSelected:this._userSelectedCallback,onDeleteClicked:this.deleteTag,onEscapePressed:this._removeActiveAreaAfterTimeout,onSuggestionDeclined:this._handleSuggestionDeclined}),this.photoView=window.Photoview,this.areasContainer=ce("div",{className:"photo_tags_suggested_areas_list"}),this.containerNode.innerHTML="",this.containerNode.appendChild(this.areasContainer),addEvent(this.imageNode,"mousemove",this._handleImageMouseMove),addEvent(this.imageNode,"mouseleave",this._removeActiveAreaAfterTimeout),addEvent(this.imageNode,"mouseenter",this.showAllSuggestedAreas.bind(this)),addEvent(this.areasContainer,"mouseleave",this._removeActiveAreaAfterTimeout),addEvent(this.areasContainer,"click",this._handleAreaClick),this.renderTagAreas()}_handleImageMouseMove(e){if(!this.areasHidden){var t=getXY(e.target),o=Math.round(100*(e.pageX-t[0])/e.target.offsetWidth),r=Math.round(100*(e.pageY-t[1])/e.target.offsetHeight);for(var a in clearTimeout(this.areasTimeOut),this.areasTimeOut=setTimeout(()=>{this.photoTooltip.isActive||this.activeAreaId||this.hideAllSuggestedAreas()},700),this.showAllSuggestedAreas(),this.areas)if(this.areas.hasOwnProperty(a)){var i=this.areas[a],_=i.x,s=i.y,c=i.x2,n=i.y2;if(o>parseInt(_)&&o<parseInt(c)&&r>parseInt(s)&&r<parseInt(n)){if(a===this.activeAreaId)return void(this.tagAreaFound=!0);if(this.tagAreaFound=this.showTagArea(a),this.tagAreaFound)return}}this.tagAreaFound=!1,this._removeActiveAreaAfterTimeout()}}_handleAreaClick(e){cancelEvent(e),this.photoTooltip.showAndFocusFriendsList(e)}showTagArea(e){var t=this.areas[e];return!(!t||t.isDeleted)&&(null!==this.activeAreaId&&this.areas[this.activeAreaId]&&removeClass(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=e,addClass(this.areas[e].ele,"active"),this.showTooltip(e),this.showAllSuggestedAreas(),!0)}hideTagArea(){clearTimeout(this.waitTimeout),null!==this.activeAreaId&&this.areas[this.activeAreaId]&&removeClass(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=null,this.photoTooltip.hide(),this.hideAllSuggestedAreas()}_removeActiveAreaAfterTimeout(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.activeAreaId&&!this.waitToRemove&&(this.waitToRemove=!0,clearTimeout(this.waitTimeout),this.waitTimeout=setTimeout(()=>{!this.photoTooltip.isActive&&!this.tagAreaFound&&!this.photoTooltip.interaction&&this.hideTagArea(),this.waitToRemove=!1},e))}showTooltip(e){if(!this.tooltipsPaused){var t=this.areas[e].ele,o=this._getTooltipOptions(e);if(t){var a=Object(r.getXYRect)(t,!0),i=a.top,_=a.right,s=a.bottom,c=a.left;this.photoTooltip.show({top:i,right:_,bottom:s,left:c},o)}}}showAllSuggestedAreas(){addClass(this.areasContainer,"visible_all"),removeClass(this.areasContainer,"area_hover"),this.activeAreaId&&addClass(this.areasContainer,"area_hover")}hideAllSuggestedAreas(){removeClass(this.areasContainer,"visible_all")}pauseTooltips(){this.hideTagArea(),this.tooltipsPaused=!0}resumeTooltips(){this.tooltipsPaused=!1}_createTagElement(e,t,o,r){var a=cur.pvPhWidth,i=cur.pvPhHeight/a,_=o-e,s=r-t,c=ce("div",{className:"photo_tags_suggested_area"},{left:e+"%",marginTop:i*t+"%",width:_+"%"}),n=ce("div",{},{paddingBottom:100*i*(s/_)+"%"});return c.appendChild(n),c}renderTagAreas(){this.areas={},this.areasContainer.innerHTML="";var e=Object(s.getPhotoData)("tags"),t=Object(s.getPhotoData)("suggested_tags");for(var o in cur.postTo&&cur.postTo<0&&(t=[]),e)if("0"!==o&&e.hasOwnProperty(o)){var r=c(e[o],7),a=r[0],i=r[1],_=r[2],n=r[3],p=r[4],l=r[5],d=r[6],u=this._createTagElement(a,i,_,n);this.areas[o]={ele:u,x:a,y:i,x2:_,y2:n,userName:p,userHref:l,canDeleteTag:Boolean(d),confirmedTag:!1},this.areasContainer.appendChild(u)}for(var v in t)if(v&&t.hasOwnProperty(v)){var h=c(t[v],7),g=h[0],m=h[1],b=h[2],w=h[3],P=h[4],f=h[5],O=h[6],E=this._createTagElement(g,m,b,w),T=void 0;P&&(T="/id"+P),this.areas[v]={ele:E,x:g,y:m,x2:b,y2:w,userHref:T,suggestedUserId:P,suggestedUserName:f,usersList:O,confirmedTag:!1},this.areasContainer.appendChild(E)}}_userSelectedCallback(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(s.getPhotoData)("tags"),a=Object(s.getPhotoData)("suggested_tags"),i=this.activeAreaId,_=this.areas[i],c=_.x,n=_.y,p=_.x2,l=_.y2,d="/id"+e,u=cur.pvAskForAutoTag&&o,v=clean(t);r[i]=[c,n,p,l,v,d,!0],delete a[i];var h={suggestedUserId:!1,suggestedUserName:!1,usersList:[],userId:e,userName:v,userHref:d,canDeleteTag:!0},g=this.activeAreaId;this._confirmSuggestedTag(i,e,t,()=>{this.activeAreaId=g,this.areas[g]=extend(_,h),this.photoTooltip.updateState(h),this.showTagArea(g),this._removeActiveAreaAfterTimeout(1e3),u&&(cur.pvAskForAutoTag=!1,this.showSettingsBox())})}showSettingsBox(){showBox("/al_photos.php",{act:"show_autotag_settings"},{params:{containerClass:"autotag_settings_box",grey:!0,width:450}})}deleteTag(e){e||(e=this.activeAreaId,this.photoView.deleteTag(e)),this.hideTagArea();var t=this.areas[e];e&&t&&(t=extend(t,{isDeleted:!0}),addClass(t.ele,"deleted"))}_getTooltipOptions(e){var t=this.areas[e],o=t.suggestedUserId,r=t.suggestedUserName;return{suggestedUserId:o,userName:t.userName,userHref:t.userHref,suggestedUserName:r,usersList:t.usersList,canDeleteTag:t.canDeleteTag}}_handleSuggestionDeclined(){var e=this.activeAreaId,t=this.areas[e];if(t){var o=Object(s.getPhotoData)("suggested_tags");this.areas[e]=extend(t,{suggestedUserId:!1,suggestedUserName:!1,userHref:null}),this.showTagArea(e),o&&o[e]&&(o[e][4]=0);var r=Object(s.getPhotoData)("id"),a=Object(s.getPhotoData)("hash");ajax.post("al_photos.php",{act:"decline_suggested_tag",tag:e,photo:r,hash:a},{onFail:this.handleTagRequestFail})}}_confirmSuggestedTag(e,t,o,r){var a=Object(s.getPhotoData)("id"),i=Object(s.getPhotoData)("hash");ajax.post("al_photos.php",{act:"confirm_suggested_tag",tag:e,tagged_id:t,name:o,photo:a,hash:i},{onDone:(e,t,o)=>{this._updatePhotoView(e,t,o),r()},onFail:this.handleTagRequestFail})}handleTagRequestFail(e){var t=Object(i.getLang)("global_error");return setTimeout(Object(a.showFastBox)(t,e).hide,3e3),!0}unMount(){removeEvent(this.imageNode,"mousemove",this._handleImageMouseMove),removeEvent(this.areasContainer,"click",this._handleAreaClick),this.containerNode.innerHTML=""}hideAreas(){this.areasHidden=!0,hide(this.areasContainer),this.photoTooltip.hide()}showAreas(){this.areasHidden=!1,show(this.areasContainer),removeEvent(this.imageNode,"mousemove",this._handleImageMouseMove),addEvent(this.imageNode,"mousemove",this._handleImageMouseMove)}reload(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hideTagArea(),this.resumeTooltips(),this.renderTagAreas(),e&&(this.imageNode=e),this.activeAreaId=null,this.waitToRemove=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this.showAreas()}_queueCheckUpdates(){cur.pvTagsQueueParams&&window.Notifier&&Notifier.addKey(cur.pvTagsQueueParams,this._queueReceiveUpdates)}_updatePhotoView(e,t,o){Object(s.setPhotoData)("tags",e),Object(s.setPhotoData)("tagged",t),Object(s.setPhotoData)("tagshtml",o),this.photoView.setTags(o)}_queueReceiveUpdates(e,t){t.events&&t.events.forEach(e=>{var t=e.split("<!>"),o=t[1],r=t[2],a=JSON.parse(r),i=JSON.parse(t[3]),_=JSON.parse(t[4]),c=t[5];if(Object(s.getPhotoData)("id")===o)Object(s.setPhotoData)("suggested_tags",a),this._updatePhotoView(i,_,c),this.renderTagAreas();else if(cur.pvData){var n=function(e){if(cur.pvData.hasOwnProperty(e)){var t=cur.pvData[e];t.length&&t.forEach((t,r)=>{if(t.id&&t.id===o){var s=cur.pvData[e][r];s.suggested_tags=a,s.tags=i,s.tagged=_,s.tagshtml=c}})}};for(var p in cur.pvData)n(p)}})}}},"iX+u":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Photoview",(function(){return Photoview}));var core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("HEwt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("ioFf"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("91GP"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("pIFo"),_web_photos_photos__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("1OKH"),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("WX8S"),_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("J1I5"),_photo_tags__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("g/In"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("98sY"),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("/PiP"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("zxIV"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("Egk5"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("t7n3"),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("zmTt"),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("qwyz"),_internal_nospam_common__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("FThC"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("FWc3"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("7jxN"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("aong"),_photoview_utils__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("Nk8j"),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("W9Tc");function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var o=[],r=!0,a=!1,i=void 0;try{for(var _,s=e[Symbol.iterator]();!(r=(_=s.next()).done)&&(o.push(_.value),!t||o.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var Photoview={MIN_WIDTH:600,MIN_HEIGHT:450,PE_MIN_WIDTH:750,PE_MIN_HEIGHT:500,SIDE_COLUMN_WIDTH:310,SIDE_MIN_GAP:40,VERTICAL_MIN_GAP:15,BOTTOM_BAR_HEIGHT:52,SIDE_NAV_PANELS_MAX_WIDTH:120,SIDE_NAV_PANELS_MIN_WIDTH:25,LEFT_RIGHT_NAV_RATIO:.25,blank:"/images/blank.gif",blankf:()=>{},cacheSize:3,allSizes:["x","y","z","w"],PE_V1:1,PE_V2:2,PE_V3:4,_getViewedPhotoFullId(){var e=cur.pvListId,t=cur.pvIndex;return cur.pvData[e][t].id},changeThumbs(e,t,o){if(e){var r=[ge("photo_row"+cur.filterPhoto),ge("photos_add_thumb"+cur.filterPhoto)],a=geByClass("page_post_thumb_wrap");for(var i in a.push.apply(a,geByClass("page_preview_photo")),a.push.apply(a,geByClass("im_preview_photo")),a.push.apply(a,geByClass("photo")),a.push.apply(a,geByClass("page_square_photo")),a.push.apply(a,geByClass("photos_row")),a)if(a.hasOwnProperty(i)){var _=a[i].getAttribute("onclick");if(!_){var s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(a[i]);_=!!s&&s.getAttribute("onclick")}_&&-1!=_.indexOf(`'${cur.filterPhoto}'`)&&r.push(a[i])}for(var c in r)if(r[c]){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(r[c],"page_square_photo")||r[c].style.backgroundImage){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(r[c],{backgroundImage:`url('${e}')`});continue}var n=geByTag1("img",r[c]);n&&(n.src=e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(n,{height:"auto"}))}if(cur.pvNoTemp||(cur.pvNoTemp={}),cur.pvNoTemp[cur.filterPhoto]=!0,window.ThumbsEdit&&t){var p=ThumbsEdit.cache();for(var l in p)if(p.hasOwnProperty(l)){var d=p[l].previews||[],u=!1;for(var v in d)d.hasOwnProperty(v)&&"photo"==d[v].type&&d[v].photo.id=="photo"+o&&(d[v].photo.sizes=t,delete d[v].photo.restrictionBlur,u=!0);u&&ThumbsEdit.refresh(l)}}}},openStickersEditor(e){cur.pvEditorMode||(e||(e=cur.pvCurPhoto),Photoview.stopTagger(),cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas(),Photoview.toggleNavControls(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvLikeFSWrap),Photoview.hideTag(!0),cur.pvEditorMode=!0,cur.pvEditorSaved=!1,Photoview.updatePhotoDimensions(),stManager.add([jsc("web/spe.js"),"photo_editor.css"],()=>{SPE.init(e,(t,o,r,a)=>{var i=document.querySelector(`.photos_photo_edit_row[data-id="${t.id}"] .photos_photo_edit_row_thumb`);i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(i,"background-image",`url(${o})`);var _=t.id!=e.id;if(cur.pvEditorSaved=!0,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),e.closeOnPEEdit){if(t&&o&&window.ThumbsEdit&&r){var s=ThumbsEdit.cache();for(var c in s)if(s.hasOwnProperty(c)){var n=c.replace("thumbs_edit",""),p=cur.addMedia[n],l=s[c].previews||[],d=!1;for(var u in l)if(l.hasOwnProperty(u)&&"photo"==l[u].type&&l[u].photo.id=="photo"+e.id){var v=l[u].photo;if(_){v.id="photo"+t.id,v.pid=t.id.split("_")[1];var h=p.getMedias();each(h,(function(){if("photo"==this[0]&&this[1]==e.id)return this[1]=t.id,!1}))}l[u].click=p.showPhoto.pbind(t.id,t.list,parseJSON(a)),l[u].itemId=v.pid,v.sizes=r,d=!0}d&&(ThumbsEdit.refresh(c),p.onChange&&p.onChange())}}return Photoview.changeThumbs(o,r,t.id),Photoview.hide(0)}if(cur.pvListId){var g=cur.pvListId,m=cur.pvData[g],b=cur.pvIndex;if(!m)return nav.reload();var w=m[b];if(_){var P=extend({},t);b=++cur.pvIndex,m.splice(b,0,P),w=P,cur.pvCommsLikes[w.id]=[w.comments,0,vkNow(),!1],delete w.comments,delete w.likes}var f=cur.pvShown&&g==cur.pvListId&&b==cur.pvIndex;t&&o&&!_&&(Photoview.changeThumbs(o,r,e.id),delete w.x_,delete w.x_src,delete w.y_,delete w.y_src,delete w.z_,delete w.z_src,extend(w,t)),w.peType=Photoview.PE_V3,f&&(cur.pvCurData=Photoview.genData(w,Photoview.getPhotoSize()),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto).src=Photoview.blank,setTimeout(Photoview.show.pbind(cur.pvListId,cur.pvIndex),0))}},()=>{if(delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),e.closeOnPEEdit)return Photoview.hide(0);show(cur.pvLikeFSWrap),Photoview.toggleNavControls(["left","right","close"]),setTimeout(Photoview.updatePhotoDimensions,1)})}))},genUrl:(e,t)=>t?(t.match(/\.[a-z]{3}(?:\?|$)/i)||(t+=".jpg"),t.match(/https?:\/\//i)?t:(e||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+t):"",genData(e,t){for(var o,r,a="x"==t?3:"y"==t?2:"z"==t?1:0,i=["w","z","y","x"].slice(a),_=0;_<4-a;++_){var s=i[_];if(o=e[s+"_"])break;if(r=e[s+"_src"])break}return o||(o=[r]),{src:Photoview.genUrl(e.base,o[0]),width:o[2]&&o[1],height:o[1]&&o[2],restrictionBlur:e.restrictionBlur,restrictionGeo:e.restrictionGeo,restrictionTitle:e.restrictionTitle,restrictionText:e.restrictionText,photoRaw:e.photoRaw,unblurHash:e.unblurHash}},actionInfo:()=>ge("pv_action_info")||domPN(cur.pvTags).insertBefore(ce("div",{id:"pv_action_info",className:"pv_right_block"}),cur.pvTags),locNav(e,t,o,r){if(cur.pvListId=="newtag"+vk.id+(o.rev?"/rev":"")&&o[0]=="albums"+vk.id&&"added"==o.act)return Photoview.hide(r.hist),!1;if((o=nav.toStr(o)).replace("?rev=1","/rev")==cur.pvListId&&cur.pvShown)return Photoview.hide(r.hist),!1;var a=o.match(/^photo(-?\d+_\d+)\??((all=1|newtag=\d+)(&rev=1)?|(rev=1&)?tag=\d+|rev=1)?$/);if(a){var i=cur.pvListId;i&&cur.pvShown||(i="added"==nav.objLoc.act?"newtag"+vk.id+(nav.objLoc.rev?"/rev":""):nav.strLoc.replace("?rev=1","/rev"));var _=cur.pvData[i];if(_)for(var s=0,c=_.length;s<c;++s)if(_[s]&&_[s].id==a[1])return Photoview.show(i,s,!1,cur.pvRoot),!1}},updateLocNav(){if(cur.pvRoot){for(var e=0,t=cur.nav.length;e<t;++e)if(cur.nav[e]==Photoview.locNav)return;cur.nav.push(Photoview.locNav)}else for(var o=0,r=cur.nav.length;o<r;++o)cur.nav[o]==Photoview.locNav&&(cur.nav.splice(o,1),--o,--r)},toggleOnPhotoControls(e){e=!!e,toggle(cur.pvFSWrap,e)},checkLayerVisibility(){if(cur.pvShown)return!0;debugLog("layerqueue.hide from photoview"),layerQueue.hide(),addEvent(window,"resize",Photoview.onResize),addEvent(document,"keydown",Photoview.onKeyDown),addEvent(layerWrap,"click",Photoview.onLayerClick),boxQueue.hideAll(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(layerBG,{opacity:""}),layers.show(),layers.fullhide=Photoview.hide},emojiShowTT:(e,t)=>void 0!==cur.pvEmoji&&Emoji.ttShow(cur.pvEmoji,e,t),emojiHideTT:(e,t)=>void 0!==cur.pvEmoji&&Emoji.ttHide(cur.pvEmoji,e,t),onImageWrapMouseDown(e){if(2!=e.button&&!cur.pvEditorMode){if(e.target.closest(".pv_attach_product_badge"))return!1;if(cur.pvAttachedProducts.isProcess)return Photoview.attachProductPoint(e),!1;if(!cur.pvTagger&&!1===Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(e)){var t=cur.pvIndex;return Photoview.updateNavBtnsLeftThreshold(),e.pageX<cur.pvLeftBtnAmount?t-=1:t+=1,cur.pvPointerPosition=[e.pageX,e.pageY],Photoview.show(!1,t,e)}}},onImageWrapMouseLeave(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(cur.pvNavBtnLeft,"pv_nav_btn_show"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(cur.pvNavBtnRight,"pv_nav_btn_show"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(cur.pvImageAreaWrap,"pv_init_hover"),Photoview.updateNavBtnsLeftThreshold(!0)},onImageWrapMouseMove(e){Photoview.updateNavBtnsLeftThreshold(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",e.pageX<cur.pvLeftBtnAmount),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvNavBtnRight,"pv_nav_btn_show",e.pageX>cur.pvLeftBtnAmount)},toggleLightModeClass(e){e=!!e&&cur.pvIsLightMode,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvBox,"pv_light_mode",!!e),e=!!e&&cur.pvShowBottomActions,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvBox,"pv_show_bottom_actions",!!e)},isPhotosList:()=>!!(cur.pvVideoTagsShown||cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown),createLayer(){cur.pvLayerCreated=!0,delete cur.pvLeftBtnAmount,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(layerWrap,"pv_layer_wrap"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(layerBG,"pv_layer");var e=Photoview.isPhotosList(),t=nav.objLoc[0].match(/^faq(\d)+$/),o=nav.objLoc[0].match(/^bug(\d)+$/),r=cur.translationBoxOpened;cur.pvIsLightMode=o||0==nav.objLoc[0].indexOf("blog/")||t||inArray(nav.objLoc[0],["blog","about","support","helpdesk","tutorial","market","bugs","translation","restore2"])||r,cur.pvShowBottomActions=!cur.pvIsLightMode||t||inArray(nav.objLoc[0],["helpdesk","support"]);var a=cur.pvAlbumsShown?cur.pvAlbumsData[cur.pvAlbumsShown].html:"",i=cur.pvVideoTagsShown?cur.pvVideoTagsData.html:"",_=e?"display: none":"",s=e?"":"display: none",c=cur.pvAlbumsShown?"":"display: none",n=cur.pvVideoTagsShown?"":"display: none",p=cur.pvAlbumShown?cur.pvAlbumData[cur.pvAlbumShown].html:"",l=cur.pvAlbumShown?"":"display: none";cur.pvPhotoTagShown&&(p=cur.pvPhotoTagData[cur.pvPhotoTagShown].html,l=""),ge("pv_comments")&&(cur.pvBackupComments=ge("pv_comments"),domPN(ge("pv_comments")).removeChild(ge("pv_comments")));var d=`\n    <div style="${s}" class="box_title_wrap box_grey">\n      <div class="box_x_button" onclick="Photoview.hide(0)"></div>\n      <div class="box_title_controls"></div>\n      <div class="box_title"></div>\n    </div>\n    `,u=cur.pvIsLightMode?"":'\n      <div class="pv_fs_wrap">\n        <div class="pv_fs_btn" onmousedown="return Photoview.fullscreen(event);"><div></div></div>\n      </div>\n    ',v=`\n      <div class="pv_bottom_info clear_fix">\n        <div>\n          <div class="pv_bottom_info_left">\n            <span class="pv_album_name" onmouseover="setTitle(this)"></span>\n            <span class="pv_counter"></span></div>\n            ${cur.pvShowBottomActions?'<div class="pv_bottom_actions"></div>':""}\n        </div>\n      </div>`,h=cur.pvIsLightMode?"":'\n      <div class="pv_narrow_column_wrap">\n        <div class="pv_narrow_column_cont wall_module">\n          <div class="narrow_column" id="pv_narrow"></div>\n        </div>\n      </div>',g=getProgressHtml("pv_image_progress");layer.innerHTML=`\n    <div class="pv_cont">\n      <div id="pv_box" class="_scroll_node pv_box" tabindex="0" onclick="cur.pvClicked = true;" onmouseenter="removeClass(layerWrap, 'pv_mouse_out_layer')" onmouseleave="addClass(layerWrap, 'pv_mouse_out_layer')">\n        ${d}\n        <div class="clear_fix pv_photo_wrap" style="${_}">\n          <div class="pv_close_btn" onclick="Photoview.hide(0)"></div>\n          <div class="no_select pv_left_wrap">\n            <div class="no_select pv_image_wrap">\n              <div id="pv_tag_info" class="clear_fix">\n                <div class="pv_tag_info_buttons_wrap"></div>\n                <div class="pv_tag_info_text" onmouseover="setTitle(this)"></div>\n              </div>\n              <div id="pv_tag_frame"></div>\n              <div id="pv_tag_faded"></div>\n              <div id="pv_tag_person" onmouseout="Photoview.hideTag()"></div>\n              <div class="pv_photo_tags" id="pv_photo_tags"></div>\n              <div class="pv_img_area_wrap pv_init_hover" onmouseleave="return Photoview.onImageWrapMouseLeave(event)" onmousedown="return Photoview.onImageWrapMouseDown(event)" onmousemove="Photoview.onImageWrapMouseMove(event)">\n                <div class="pv_img_progress_wrap">${g}</div>\n                <div id="pv_photo"></div>\n                \n      <div class="pv_nav_btn" id="pv_nav_btn_left" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex - 1, event);">\n        <div class="pv_nav_btn_icon"></div>\n      </div>\n      <div class="pv_nav_btn" id="pv_nav_btn_right" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex + 1, event);"><div class="pv_nav_btn_icon"></div></div>\n    \n                <div class="pv_like_fs_wrap">\n                ${u}\n                </div>\n              </div>\n            </div>\n            ${v}\n          </div>\n          ${h}\n        </div>\n        <div id="pv_albums_wrap" class="pv_white_bg photos_container_albums" style="${c}">${a}</div>\n        <div id="pv_album_wrap" class="pv_white_bg" style="${l}">${p}</div>\n        <div id="pv_vtagged_wrap" class="pv_white_bg" style="${n}">${i}</div>\n      </div>\n    </div>`,cur.pvYourComment&&domPN(ge("pv_your_comment")).replaceChild(cur.pvYourComment,ge("pv_your_comment")),extend(cur,{pvCont:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(layer),pvBox:ge("pv_box"),pvImageAreaWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_img_area_wrap"),pvLeftWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_left_wrap"),pvTitle:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("box_title_wrap"),pvTitleText:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("box_title"),pvImageWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_image_wrap"),pvNavBtnLeft:ge("pv_nav_btn_left"),pvNavBtnRight:ge("pv_nav_btn_right"),pvNavBtnClose:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_close_btn"),pvNarrowColumnWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_narrow_column_wrap"),pvNarrowColumn:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_narrow_column_cont"),pvPhotoWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_photo_wrap"),pvAlbumWrap:ge("pv_album_wrap"),pvAlbumsWrap:ge("pv_albums_wrap"),pvVTagsWrap:ge("pv_vtagged_wrap"),pvPhotoTagsContainer:ge("pv_photo_tags"),pvTagInfo:ge("pv_tag_info"),pvTagFrame:ge("pv_tag_frame"),pvTagFaded:ge("pv_tag_faded"),pvTagPerson:ge("pv_tag_person"),pvPhoto:ge("pv_photo"),pvTagInfoText:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_tag_info_text"),pvTagInfoButtons:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_tag_info_buttons_wrap"),pvBottomInfo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_bottom_info"),pvAlbumName:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_album_name"),pvCounter:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_counter"),pvBottomActions:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_bottom_actions"),pvBottomLeft:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_bottom_info_left"),pvNarrow:ge("pv_narrow"),pvWide:ge("pv_wide"),pvImgProgress:ge("pv_image_progress"),pvLikeFSWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_like_fs_wrap"),pvFSWrap:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_fs_wrap"),pvFS:ge("pv_fs"),pvFSFg:ge("pv_fs_fg"),pvActions:ge("pvs_actions"),pvYourComment:ge("pv_your_comment"),pvAddMedia:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_add_media")),pvMediaPreview:ge("pv_media_preview"),pvCommentSend:ge("pv_comment_send"),pvComment:ge("pv_comment")}),addEvent(layerWrap,"scroll",Photoview.scrollResize),addEvent(layerWrap,"mousemove",Photoview.onLayerMouseMove),Photoview.updateSize(),e&&_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.init(!1,{parent:layerWrap});var m=layerWrap.scrollTop;elfocus(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("_scroll_node",cur.pvCont)),layerWrap.scrollTop=m},doShowAlbums(e,t){if(e=intval(e),!t||2!=t.button&&3!=t.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);var o=(cur.pvAlbumsData||{})[e];if(o){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),cur.pvShown=!0,cur.pvAlbumsShown=e,val("pva_owner")!=e&&extend(cur,{pvaOffset:o.opts.offset,pvaCount:o.opts.count,pvaPhotosOffset:o.opts.photos_offset,pvaPhotosCount:o.opts.photos_count,pvShowAllAlbums:!1}),cur.pvLayerCreated?(val("pva_owner")!=e&&val(cur.pvAlbumsWrap,o.html),isVisible(cur.pvAlbumsWrap)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvPhotoWrap,cur.pvAlbumWrap,cur.pvVTagsWrap),show(cur.pvAlbumsWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pva_scroll"))):Photoview.createLayer(!0),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.show(),show(cur.pvTitle),show(cur.pvAlbumsWrap),cur.pvTitleText.innerHTML=o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId?extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex}):(!browser.msie||browser.version>8)&&(cur.pvClicked=!1),Photoview.toggleNavControls(),cur.pvListId=!1;var r=extend(nav.objLoc,{z:"albums"+cur.pvAlbumsShown});return nav.strLoc!=nav.toStr(r)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(r)),Photoview.updatePeriods(),!!t&&cancelEvent(t)}}},jumpToAlbums(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="albums"+val("pva_owner")||cur.pvJumpTo.z!=nav.objLoc.z)?(e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.showAlbums)(val("pva_owner"),{noHistory:!0})},jumpToAlbum(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="album"+val("pvsa_album")||cur.pvJumpTo.z!=nav.objLoc.z)?(e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.showAlbum)(val("pvsa_album"),{noHistory:!0})},jumpToTagged(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="tag"+val("pvsa_tag")||cur.pvJumpTo.z!=nav.objLoc.z)?(cur.pvJumpTo.z=="tag"+val("pvsa_tag")&&(cur.pvJumpTo.z="photo_"+cur.pvJumpTo.z),e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Photoview.showTagged(val("pvsa_tag"),{noHistory:!0})},doShowAlbum(e,t){if(!t||2!=t.button&&3!=t.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);var o=(cur.pvAlbumData||{})[e];if(o){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),cur.pvShown||cur.pvAlbumShown||cur.pvAlbumsShown||layerQueue.push(),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.show(),cur.pvShown=!0,cur.pvAlbumShown=e,cur.pvLayerCreated&&val("pvsa_album")==e||extend(cur,{pvsaOffset:o.opts.offset,pvsaCount:o.opts.count}),cur.pvLayerCreated?(val("pvsa_album")!=e&&val(cur.pvAlbumWrap,o.html),isVisible(cur.pvAlbumWrap)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),show(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pvsa_scroll"))):Photoview.createLayer(),show(cur.pvTitle),show(cur.pvAlbumWrap);var r=o.opts.author||"";if(cur.pvTitleText.innerHTML=(r?r+'<span class="divider"></span> ':"")+o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var a=(cur.pvListId||"").split("/");a[0]&&Photoview.showRepeat(ge(a[0]))}else(!browser.msie||browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var i=extend(nav.objLoc,{z:"album"+cur.pvAlbumShown});return nav.strLoc!=nav.toStr(i)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(i)),!!t&&cancelEvent(t)}}},doShowTagged(e,t){if(e=intval(e),!t||2!=t.button&&3!=t.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);var o=(cur.pvPhotoTagData||{})[e];if(o){if(Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),cur.pvShown=!0,cur.pvPhotoTagShown=e,cur.pvLayerCreated&&val("pvsa_tag")==e||extend(cur,{pvsaOffset:o.opts.offset,pvsaCount:o.opts.count}),cur.pvLayerCreated?(val("pvsa_tag")!=e&&val(cur.pvAlbumWrap,o.html),isVisible(cur.pvAlbumWrap)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),show(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pvsa_scroll"))):Photoview.createLayer(),show(cur.pvTitle),show(cur.pvAlbumWrap),cur.pvTitleText.innerHTML=o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var r=(cur.pvListId||"").split("/");r[0]&&Photoview.showRepeat(ge(r[0]))}else(!browser.msie||browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var a=extend(nav.objLoc,{z:"photo_tag"+cur.pvPhotoTagShown});return nav.strLoc!=nav.toStr(a)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(a)),!!t&&cancelEvent(t)}}},toggleNavControls(e){each([cur.pvNavBtnRight,cur.pvNavBtnLeft,cur.pvNavBtnClose],(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(this)})),isString(e)&&(e=e.split(" ")),each(e||[],(function(e,t){switch(t){case"close":show(cur.pvNavBtnClose);break;case"left":show(cur.pvNavBtnLeft);break;case"right":show(cur.pvNavBtnRight)}}))},getPhotoSize(){var e;switch(cur.pvVeryBig){case 3:e="w";break;case 2:case 1:e="z";break;default:e="y"}return e},show(e,t,o,r){if(!cur.pvEditorMode&&(cur.pvAttachedProducts=cur.pvAttachedProducts||{},cur.pvAttachedProducts.badges&&cur.pvAttachedProducts.badges.forEach(e=>e.remove()),!o||2!=o.button&&3!=o.which))if(cur.cancelClick)delete cur.cancelClick;else{if(Photoview.destroyPeriod(),clearTimeout(window.__pvhideTimer),"temp"==e&&cur.pvShown){if(cur.pvListId&&"temp"!=cur.pvListId)return;cur.pvWasShown=!0}else cur.pvWasShown=!1;if(__afterFocus)return!!o&&cancelEvent(o);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==o))return!!o&&cancelEvent(o);if(!1===e){if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown){if(cur.pvOldListId)return extend(cur,{pvJumpTo:cur.pvOldJumpTo,pvJumpFrom:cur.pvOldJumpFrom,pvJumpSteps:cur.pvOldJumpSteps}),t==cur.pvOldIndex+1&&++cur.pvOldIndex,Photoview.show(cur.pvOldListId,cur.pvOldIndex,o,r);Photoview.toggleNavControls()}e=cur.pvListId}var a=((cur.pvData||{})[e]||{}).length,i=e!=cur.pvListId;if(a){o&&o.pageX&&o.pageY&&extend(cur,{pvOldX:o.pageX,pvOldY:o.pageY,pvOldT:vkNow()}),(cur.pvOptions||{}).queue&&(layerQueue.push(),cur.pvOptions.queue=!1,cur.pvHistoryLength=0),Photoview.checkLayerVisibility()||(i=!0);var _=t+(t<0?a:t>=a?-a:0),s=i?1:cur.pvIndex>t?-1:1;if(!i&&!cur.pvCanvas){if(cur.pvJumpTo){if(cur.pvJumpSteps+=t-cur.pvIndex,_===cur.pvJumpFrom&&cur.pvJumpSteps>=a)return extend(cur,{pvOldJumpFrom:cur.pvJumpFrom,pvOldJumpSteps:cur.pvJumpSteps-(t-cur.pvIndex),pvOldJumpTo:cur.pvJumpTo}),Photoview.jumpToAlbums(cur.pvJumpSteps<0);if(s>0&&(_<cur.pvJumpFrom&&_+4>cur.pvJumpFrom||_<cur.pvJumpFrom+a&&_+4>cur.pvJumpFrom+a)){vkImage().src=stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":"")+".png?3";var c=cur.pvJumpTo.z.match(/^albums(-?\d+)$/);c&&(cur.pvAlbumsData||(cur.pvAlbumsData={}),cur.pvAlbumsData[c[1]]||(cur.pvAlbumsData[c[1]]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:c[1],other:1},{onDone:Photoview.loadedAlbums})))}cur.pvJumpSteps<=-a&&(cur.pvJumpSteps+=a)}if(1==a&&t!=cur.pvIndex&&("temp"!=e||cur.pvOptions.temp_final))return Photoview.hide(),!!o&&cancelEvent(o)}i&&"temp"!=e&&(!1===cur.pvJumpFrom&&(cur.pvJumpFrom=_),cur.pvRoot=r,Photoview.updateLocNav()),t=_;var n=cur.pvData[e][t];if(n&&(n.x_||n.x_src)){cur.pvIndex=t,cur.pvShown=!0,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1,cur.pvListId=e,Photoview.calculateVeryBig();var p=Photoview.getPhotoSize();return cur.pvCurData=Photoview.genData(n,p),cur.pvLayerCreated||Photoview.createLayer(),cur.pvCurrent&&(cur.pvCurrent.onload=Photoview.blankf,cur.pvCurrent.src=Photoview.blank),delete cur.pvCurrent,cur.pvCurrent=vkImage(),cur.pvCurrent.onload=Photoview.preload.pbind(t,s),cur.pvCurrent.src=cur.pvCurData.src,i&&Photoview.toggleNavControls(a>1?"left right close":"close"),hideProgress(cur.pvCounter),"temp"!=e||cur.pvOptions.temp_final?"temp"==e&&cur.pvOptions.temp_final&&cur.pvOptions.temp_summary||(cur.pvCounter.innerHTML=a>1?getLang("photos_photo_counter_num_of_N").replace("%s",cur.pvIndex+1).replace(/%s|{count}/,a):""):((Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(cur.pvCurData)||cur.pvCurData.restrictionGeo)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvImgProgress),showProgress(cur.pvCounter,"","pr_baw")),cur.pvCurPhoto=n,cur.pvCurData.width&&cur.pvCurData.height?Photoview.doShow():(cur.pvCurData=cur.pvCurrent,cur.pvTimerPassed=0,clearTimeout(cur.pvTimer),cur.pvTimer=setTimeout(Photoview.doShow,0)),cur.pvBox&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown),!!o&&cancelEvent(o)}}}},_checkWebGL:()=>navigator.userAgent.indexOf("Windows NT 5.1")>=0?-1:function(){try{var e=document.createElement("canvas");e.width=e.height=100;var t={preserveDrawingBuffer:!0,premultipliedAlpha:!1};return!!window.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t))}catch(e){return!1}}()?1:browser.safari?(debugLog("photo editor: webgl enable needed"),-2):(debugLog("photo editor: webgl not suported"),-1),openEditor(e,t){function o(o){return o||debugLog("photo editor: CORS not available ("+t+")"),showBox("al_photos.php",{act:"edit_photo",photo:e||cur.pvData[cur.pvListId][cur.pvIndex].id,webgl:Photoview._checkWebGL(),cors:o},{dark:1,stat:["ui_controls.css","ui_controls.js"]})}t=t||cur.pvCurData.src;var r=vkImage();r.onerror=()=>o(0),r.onload=()=>o(1),r.crossOrigin="",r.src=t},showSpamActions(){show(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_more_acts_hidden")),cur.pvMoreActionsTooltip.updatePosition()},doShow(){var e=cur.pvCurData;if(Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(e)||show(cur.pvImgProgress),(!e.width||!e.height)&&cur.pvTimerPassed<5e3)return clearTimeout(cur.pvTimer),cur.pvTimerPassed+=100,void(cur.pvTimer=setTimeout(Photoview.doShow,100));if(cur.pvShown)if(cur.pvCanvas)Photoview.pvCanvasSet();else{Photoview.toggleLightModeClass(!0),isVisible(cur.pvAlbumsWrap)&&(val("pva_scroll",layerWrap.scrollTop),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvAlbumsWrap),show(cur.pvPhotoWrap),Photoview.updateSize()),isVisible(cur.pvAlbumWrap)&&(val("pvsa_scroll",layerWrap.scrollTop),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvAlbumWrap),show(cur.pvPhotoWrap),Photoview.updateSize()),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.hide(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTitle),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--geo",!!e.restrictionGeo),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--blur",Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(e));var t=cur.pvPhoto&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);if(t&&t.src){var o=/https?:\/\/[a-z0-9\.\-]+/;(t.src.replace(o,"")!=e.src.replace(o,"")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(t,"ZPhotosRestriction")||e.restrictionGeo||e.restrictionBlur)&&U(e)}else U(e);if(addEvent(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto),"load",()=>Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvImgProgress)),Photoview.updatePhotoDimensions(),window.tooltips&&tooltips.destroyAll(cur.pvBox),"temp"==cur.pvListId)return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvCommentsData),Photoview.toggleOnPhotoControls(!1),void Photoview.updateVerticalPosition();Photoview.toggleOnPhotoControls(!0);var r=cur.pvCurPhoto;if(r.peData)return r.closeOnPEEdit=!0,void Photoview.openStickersEditor(r);var a=!(r.commshown>=0)&&-r.commshown;cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),Photoview.hideTag(!0),(e.width<200||e.height<200)&&(r.actions.prof=!1,r.actions.dialog=!1);var i="";("NA"!=r.album&&2!=a||r.graffiti)&&(i=r.album);var _=!r.album||!r.author;if(!cur.pvIsLightMode&&!_){var s="";s+='<div class="pv_author_block clear_fix">';var c="";"NA"!=r.author&&(c=r.author),c&&(r.author_href&&(s+=`<a class="pv_author_img fl_l" href="${r.author_href}">`),s+=`<div class="ow_ava ow_ava_comm" style="background-image: url('${r.author_photo}');"></div>`,r.author_href&&(s+="</a>")),s+=`\n        <div class="pv_author_info">\n          <div id="pv_author_name">${c}</div>\n          <div class="pv_date_info_wrap">\n            <span id="pv_date_info">${r.date}</span>\n          </div>\n        </div>\n      </div>`,s+=getProgressHtml("pv_progress");var n=cur.pvCommsLikes[r.id],p=n[0],l=n[1];s+=Likes.makeTemplate(r.likes_tpl,{object_raw:r.id,likes_count:l||"",liked:r.liked,share_count:r.shares||"",share_opts:{list:cur.pvListId,to:"mail"}});var d=1&r.actions.edit||r.desc,u="";if(d){var v=r.desc||`<span class="pv_desc_edit">${getLang("photos_edit_desc")}</span>`,h="";1&r.actions.edit?(h+='class="pv_can_edit pv_desc_cont"',h+='onclick="Photoview.editInline(event)"'):h+='class="pv_desc_cont"',u=`<div ${h}>${v}</div>`}1==r.was_edited?s+=`<div id="pv_edit_info" class="pv_right_block">${getLang("photos_was_edited")}</div>`:r.was_edited&&(s+=`\n          <div id="pv_edit_info" class="pv_right_block" onmouseover="showTooltip(this, {\n            text: '${r.was_edited}',\n            black: 1\n          });">${getLang("photos_was_edited")}</div>`),s+='<div id="pv_desc" class="pv_right_block" style="'+(d?"":"display: none")+'">'+u+"</div>",s+='<div id="pv_attached_products_list"></div>',s+='<div id="pv_microdata">'+(r.microdata_html?r.microdata_html:"")+(r.microdata_preview_button?r.microdata_preview_button:"")+"</div>",r.microdata_html&&shortCurrency(),s+='<div id="pv_tags"'+(r.tagshtml?"":' style="display: none"')+' class="pv_right_block">'+getLang("photos_onthisphoto")+": "+r.tagshtml+"</div>",s+='<div id="pv_place" class="pv_right_block">'+(r.place?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+r.place+"</a>":"")+"</div>",s+=p.tagName?'<div id="pv_comments_place"></div>':trim(p),cur.pvReplyForm&&re(cur.pvReplyForm),cur.pvReplyForm=null,s+='<div id="pv_rotate"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>',cur.pvNarrow.innerHTML="",Photoview.updateRightBlock(),cur.pvNarrow.innerHTML=s;var g=_slicedToArray(Photoview.generateMarketList(r.attached_tags.tags),2),m=g[0],b=g[1];r.attached_tags.tags&&r.attached_tags.tags.length&&document.getElementById("pv_attached_products_list").appendChild(m),cur.pvImageAreaWrap.appendChild(b);var w=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_closed_commments_placeholder"),P=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_no_commments_placeholder");if(a||!r.actions.comm?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(w,"unshown"),a&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(P,"unshown")):r.reply_form&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(w,"unshown"),r.replyFormEl=cur.pvReplyForm=r.replyFormEl||se(r.reply_form),cur.pvNarrowColumn.appendChild(cur.pvReplyForm),cur.onReplyFormSizeUpdate=cur.onMediaChanged=e=>{cur.pvShown&&Photoview.updateRightBlock()},cur.onReplyFormFocus=()=>{Photoview.updateRightBlock(!0),cur.pvNarrowScrollbar.scrollBottom(0,!0)}),p.tagName){each(geByClass("page_gif_loading",p),()=>{Page.hideGif(this,!1)});var f=ge("pv_comments_place");domPN(f).replaceChild(p,f)}if(cur.pvNarrowScrollbar=new uiScroll(cur.pvNarrow,{global:!0}),r.reply_form){var O=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("reply_field",cur.pvNarrowColumn);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.data)(O,"send",Photoview.sendComment),placeholderInit(O,{editable:1}),cur.pvOptions.comment_focus_init){delete cur.pvOptions.comment_focus_init;var E=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("submit_post_field",cur.pvReplyForm);E&&E.focus()}}cur.editing=!1,Photoview.updateRightBlock()}var T=[];if(i=i||"",cur.pvAlbumName.innerHTML=i,toggle(cur.pvBottomInfo,!cur.pvIsLightMode||cur.pvShowBottomActions||i),vk.id&&r.actions.share&&T.push(`<a id="pv_share" onclick="Photoview.sendPhoto()">${getLang("photos_share_from_view")}</a>`),!r.taginfo&&r.actions.tag&&r.tags[0]<cur.pvMaxTags&&!Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(r)&&T.push(`\n          <a id="pv_tag_link" onclick="stManager.add([jsc('web/photo_tagger_mode.js'), 'tagger.css', jsc('web/tagger.js')], () => {\n            Phototag.startTag();\n          })">${getLang("photos_tagperson")}</a>`),r.actions.del&&T.push(`<a id="pv_delete" onclick="Photoview.deletePhoto()">${getLang("photos_pv_act_delete")}</a>`),r.actions.save&&T.push(`<a id="pv_save_to_me" onclick="Photoview.savePhoto()">${getLang("photos_pv_act_save")}</a>`),cur.pvShowBottomActions&&!_){var C=[],L=[];if(r.actions.spam&&(C.push(["spam",getLang("photos_report"),"","Photoview.showSpamActions()"]),C.push("sep"),L=cur.pvReasons),r.actions.forbid){var D=Photoview._getViewedPhotoFullId().split("_"),M=D[0],j=D[1];C.push(["atfr",getLang("reports_atfr"),"sfof("+M+", "+j+", 1)"])}if(r.actions.edit&&(r.peType&Photoview.PE_V1||r.peType&Photoview.PE_V2)&&C.push(["pe",getLang("photos_pv_act_photoeditor"),"Photoview.openEditor()"]),vk.id&&r.actions.pe&&r.peType&Photoview.PE_V3&&Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.isPhotoeditor3Available)()&&!inArray(nav.objLoc[0],["support","helpdesk"])&&!r.restrictionGeo&&!Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(r)){var A=Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_28__.partConfigEnabled)("web_photo_editor_hide_entrypoint")?getLang("photos_pv_act_photoeditor"):getLang("global_pe_edit");C.push(["spe",A,"Photoview.openStickersEditor()"])}if(r.actions.rot&&(C.push(["rotate_ccw",getLang("photos_pv_act_rotate_ccw"),"Photoview.rotatePhoto(-1)"]),C.push(["rotate_cw",getLang("photos_pv_act_rotate_cw"),"Photoview.rotatePhoto(1)"]),C.push("sep")),r.actions.place&&C.push(["place",getLang("photos_edit_add_place"),"Photoview.editPlace()"]),r.attached_tags&&r.attached_tags.hash&&C.push(["market",getLang("photos_edit_add_market"),"Photoview.selectProductInBox()"]),r.actions.prof&&C.push(["to_profile",getLang("photos_pv_act_to_avatar"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${r.id}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]})`]),r.actions.dialog&&C.push(["to_dialog",getLang("photos_load_to_dialog"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${r.id}', oid: ${r.actions.dialog}, list: '${cur.pvListId}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]});`]),r.actions.move){var y=r.id.split("_")[0];C.push(["move_to",getLang("photos_pv_act_move_to_album"),`\n            showBox('al_photos.php', {act: 'a_move_to_album_box', photo_id: '${r.id}', owner_id: ${y}}, {stat: ['page.js', 'page.css', 'wide_dd.js', 'wide_dd.css']})\n          `]),r.actions.cover&&C.push(["as_title",getLang("photos_album_to_cover"),`\n              ajax.post('al_photos.php', {act: 'a_set_as_album_title', photo: '${r.id}', hash: '${r.hash}'}, {onDone: showDoneBox})\n            `])}var S="";each(L,(e,t)=>{var o="Photoview.report('"+r.hash+"', '"+t[0]+"')";S+=`<div onclick="${o}" class="pv_more_act_item pv_more_spam_act_item" id="pv_more_spam_act_${t[0]}">${t[1]}</div>`}),S=S?'<div class="pv_more_acts_hidden">'+S+"</div>":"";var I="";each(C,(e,t)=>{"sep"===t?0!==e&&e!==C.length-1&&(I+='<div class="pv_more_act_item_sep"></div>'):I+=`\n              <div class="pv_more_act_item" onmouseover="${t[3]||""}" onclick="${t[2]||""}" id="pv_more_act_${t[0]}">\n                ${t[1]}\n              </div>\n            `}),r.restrictionGeo||Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(r)||(I+=`<a\n          class="pv_more_act_item"\n          id="pv_more_act_download"\n          target="_blank"\n          rel="noopener"\n          href="${Photoview.genData(r,"w").src}\n        ">\n            ${getLang("photos_pv_act_open_original")}\n        </a>`),I=`<div class="pv_more_acts">${I}</div>`,C.length?(C=(C=JSON.stringify(C)).replace(/\"/g,"&quot;"),T.push(`<a class="pv_actions_more" data-items="${C}">${getLang("photos_actions_more")}</a>`)):inArray(nav.objLoc[0],["support","helpdesk"])&&T.push(`\n            <a id="pv_more_act_download" target="_blank" rel="noopener" href="${Photoview.genData(r,"w").src}">\n              ${getLang("photos_pv_act_open_original")}\n            </a>\n          `),T=T.join('<span class="divider"></span>'),cur.pvIsLightMode&&(T+='<div id="pv_rotate" style="display:none;"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>'),cur.pvBottomActions.innerHTML=T;var B=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_actions_more");B&&(cur.pvMoreActionsTooltip=new ElementTooltip(B,{id:"pv_more_acts_tt",forceSide:"top",elClassWhenShown:"pv_more_shown",content:S+I,offset:[0,-5],autoShow:!0,noHideOnClick:!0}))}if(Photoview.updatePhotoDimensions(),extend(cur,{pvTagLink:ge("pv_tag_link"),pvLikeIcon:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_like_icon"),pvLikeLink:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_like_link"),pvDesc:ge("pv_desc"),pvTags:ge("pv_tags"),pvEditing:!1,pvProgress:ge("pv_progress")}),r.deleted||!r.author)cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),isArray(r.deleted)&&Photoview.toggleTopInfoPanel(r.deleted[0],r.deleted[1]),_||Photoview.toggleDeletedState(!0);else if(r.taginfo){cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done");var x=getLang("photos_confirm_tag"),k=getLang("photos_delete_tag"),W=`\n        <button class="flat_button" id="pv_confirm_tag" onclick="Photoview.confirmTag(${r.tagid}, this)">\n          ${x}\n        </button>\n        <button class="flat_button secondary black" id="pv_delete_tag" onclick="Photoview.deleteTag(${r.tagid}, this)">\n          ${k}\n        </button>\n      </div>\n      `;Photoview.toggleTopInfoPanel(r.taginfo,W),show(cur.pvCommentsData)}else Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1);(cur.pvOptions||{}).scroll&&cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollTop(cur.pvOptions.scroll),cur.pvBodyScrollTop=bodyNode.scrollTop,setTimeout((function(){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop)}),0),Photoview.updateVerticalPosition();var R=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);cur.pvPhotoTags?cur.pvPhotoTags.reload(R):vk.id&&(cur.pvPhotoTags=new _photo_tags__WEBPACK_IMPORTED_MODULE_13__.default(R,cur.pvPhotoTagsContainer)),setTimeout(Photoview.afterShow,2)}function U(e){var t="";if(Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(e)){var o=`event.stopPropagation(); Page.unblurPhoto('${e.photoRaw}', '${e.unblurHash}', this);`;t=`<div class="ZPhotosRestriction__title">${e.restrictionTitle||" "}</div><div class="ZPhotosRestriction__text">${e.restrictionText}</div><button class="ZPhotosRestriction__button" onmousedown="${o}">${getLang("photos_restriction_button_watch")}</button>`}e.restrictionGeo&&(t=`<div class="ZPhotosRestriction__title">${e.restrictionText||" "}</div>`),cur.pvPhoto.innerHTML='<img src="'+(e.src||"/images/blank.gif")+'" />'+t}},toggleTopInfoPanel(e,t){var o=!!isString(e)||!!e;void 0!==e&&(cur.pvTagInfoText.innerHTML=e),void 0!==t&&(cur.pvTagInfoButtons.innerHTML=t),toggle(cur.pvTagInfo,o),Photoview.updatePhotoTagsContainerDimensions(),Photoview.updatePhotoDimensions()},toggleDeletedState(e){e=!!e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvCont,"pv_deleted_state",e),Photoview.updateRightBlock()},updatePhotoTagsContainerDimensions(e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);if(t){e||(e=t.offsetWidth);var o=t.offsetLeft,r=t.offsetTop;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvPhotoTagsContainer,{top:r+"px",left:o+"px",width:e+"px"})}},updateTagFrameDimensions(e,t,o){var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);if(r){var a=r.offsetLeft,i=r.offsetTop;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagFaded,{width:cur.pvPhWidth+"px",height:cur.pvPhHeight+"px",left:a+"px",top:i+"px"}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagFrame,{left:a+"px",top:i+"px"}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagPerson,{left:a+"px",top:i+"px"}),e&&t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvTagFrame),{width:e,height:t,marginTop:intval(o)})}},afterShow(){cur.pvPhoto.href="/photo"+cur.pvCurPhoto.id,cur.pvPhoto.focus(),4&cur.pvCurPhoto.actions.edit&&1&cur.pvCurPhoto.actions.edit&&!cur.pvCurPhoto.desc&&Photoview.editInline(),cur.pvTagFrame.innerHTML='<img src="'+(cur.pvCurData.src||"/images/blank.gif")+'" />',Photoview.updateTagFrameDimensions(),(cur.pvOptions||{}).scroll&&(layerWrap.scrollTop=cur.pvOptions.scroll,cur.pvOptions.scroll=0),Photoview.updateLoc(),Photoview.updatePhotoDimensions()},pvCanvasUpdate(e){var t=cur.pvCurData;if(cur.pvCanvas&&t&&t.width&&t.height){cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight;var o,r=t.width||604,a=t.height||453,i=cur.pvScrWidth/r,_=ge("pv_fs_img_fade")||ge("pv_fs_img_wrap"),s=_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(_);a*i>cur.pvScrHeight&&(i=cur.pvScrHeight/a),i>1.25&&(i=1.25),r=Math.floor(r*i),a=Math.floor(a*i),o=Math.floor((cur.pvScrHeight-a)/2),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(s,"ZPhotosRestriction--geo",!!t.restrictionGeo),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(s,"ZPhotosRestriction--blur",Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(t));var c="";c=t.restrictionGeo?`<div class="ZPhotosRestriction__title">${t.restrictionText||" "}</div>`:Object(_photoview_utils__WEBPACK_IMPORTED_MODULE_27__.isImgBlurred)(t)?`<div class="ZPhotosRestriction__title">${t.restrictionTitle||" "}</div>`:"",s.innerHTML!==c&&(s.innerHTML=c),(cur.pvFSWidth!=r||cur.pvFSHeight!=a||cur.pvFSTop!=o||e)&&(cur.pvFSWidth=r,cur.pvFSHeight=a,cur.pvFSTop=o,s&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(s,{marginTop:o,width:r,height:a}),s.style.backgroundImage=`url('${t.src}')`))}},pvCanvasSet(){var e=cur.pvCurData;if(cur.pvCanvas&&e){var t,o=vkImage(),r=()=>{ge("pv_fs_img_fade")&&(re("pv_fs_img_wrap"),ge("pv_fs_img_fade").id="pv_fs_img_wrap")};r(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_fs_img_wrap"))&&cur.pvSlideNeedAnimation?(cur.pvSlideNeedAnimation=!1,cur.pvCanvas.insertBefore(se(`<div id="pv_fs_img_fade"><div style="background-image: url('${e.src}')" /></div>`),ge("pv_fs_img_wrap")),t=()=>{cssAnim(ge("pv_fs_img_wrap"),{opacity:0},{duration:1e3},()=>{r(),Photoview.fullscreenOnLoad()}),cssAnim(ge("pv_fs_img_fade"),{opacity:1},{duration:1e3})}):(val(ge("pv_fs_img_wrap"),`<div style="background-image: url('${e.src}')" /></div>`),t=Photoview.fullscreenOnLoad),Photoview.pvCanvasUpdate(!0),o.onload=t,o.src=e.src,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.updateInfo()}},updateLoc(){var e,t=cur.pvListId;cur.pvRoot?(e={0:"photo"+cur.pvCurPhoto.id},"photos"==t.substr(0,6)?e.all=1:"tag"==t.substr(0,3)?e.tag=intval(t.substr(3)):"newtag"==t.substr(0,6)&&(e.newtag=intval(t.substr(6))),-1!=t.indexOf("/rev")&&(e.rev=1),Object(_internal_nospam_common__WEBPACK_IMPORTED_MODULE_21__.isClaimContent)()&&(e.claim=window.nav.objLoc.claim,e.dmcah=window.nav.objLoc.dmcah)):e=extend(nav.objLoc,{z:"photo"+cur.pvCurPhoto.id+"/"+(cur.pvCurPhoto.list_override||t)}),nav.strLoc!=nav.toStr(e)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(e),(cur.pvOptions||{}).fromQueue&&(cur.pvNoHistory=!0,cur.pvHistoryLength=0)),cur.pvOptions&&(cur.pvOptions.fromQueue=!1)},canFullscreen(){var e=browser,t=floatval(browser.version);return!e.mobile&&(document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||e.safari&&t>5)},fullscreenOnLoad(){_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.slide()},fullscreenEnd(e){var t=cur.pvCanvas;t&&(cleanElems(t),re(t),clearTimeout(cur.pvFSTimer),clearTimeout(cur.pvFSControlsTimer),cur.pvCanvas=cur.pvFSControls=cur.pvFSTimer=cur.pvFSControlsTimer=!1,removeEvent(document,"webkitfullscreenchange mozfullscreenchange fullscreenchange webkitfullscreenerror mozfullscreenerror fullscreenerror"),show(pageNode),cur.pvCanvasUpdateTO&&clearInterval(cur.pvCanvasUpdateTO),void 0!==cur.pvScrWasY&&(scrollToY(cur.pvScrWasY,0),delete cur.pvScrWasY),!0!==e&&(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex)))},fullscreen(e){if(!cur.pvCanvas&&!cur.pe){var t=cur.pvCanvas=bodyNode.appendChild(ce("div",{className:"fixed",id:"pv_fullscreen",innerHTML:'<div id="pv_fs_img_wrap"></div>'})),o=t.requestFullscreen||t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;cur.pvFinishing=!1,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.init(),addEvent(document,"webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",Photoview.onFullscreen),addEvent(document,"webkitfullscreenerror mozfullscreenerror MSFullscreenError fullscreenerror",Photoview.fullscreenEnd.pbind(!0));try{o.call(t)}catch(e){cur.pvPartScreen=!0,Photoview.onFullscreen()}return cancelEvent(e)}},fullscreenStop(e){cur.pvFinishing=!0===e,cur.pvPartScreen=!1;var t=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen;try{t.call(document)}catch(e){Photoview.onFullscreen()}setTimeout(Photoview.fullscreenEnd,30)},onFullscreen(){Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_26__.isFullScreen)()?(cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight,cur.pvScrWasY=scrollGetY(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(pageNode),cur.pvCanvasUpdateTO=setInterval(Photoview.pvCanvasUpdate.pbind(!1),100),cur.pvFinishing||(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex))):Photoview.fullscreenEnd(cur.pvFinishing)},showDD(e,t){if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(e,"pv_report_blocked")&&t&&(clearTimeout(cur.hideShareTimer),e.blur(),!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(t,"pv_dd_hiding"))){if(isVisible(t))return fadeIn(t,0);cur.ddShown&&Photoview.hideDD(0),cur.ddShown=t,setTimeout(addEvent.pbind(document,"click",Photoview.hideDD),1),show(t)}},hideDD(e){if(e>0)cur.hideShareTimer=setTimeout(Photoview.hideDD.pbind(0),e);else{var t=cur.ddShown;t&&(-1==e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(t):(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(t,"pv_dd_hiding"),fadeOut(t,200,()=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(t,"pv_dd_hiding")})),removeEvent(document,"click",Photoview.hideDD),cur.ddShown=!1)}},createDD:(e,t)=>`\n      <div onmouseover="Photoview.showDD(this.previousSibling, this);" onmouseout="Photoview.hideDD(500)" onclick="Photoview.hideDD(-1)" class="pvs_dd fixed">\n        <table cellspacing="0" cellpadding="0">\n          <tr>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n            <td>\n              <div class="pvs_header_wrap">\n                <div class="pvs_header">\n                  <span class="pvs_header_text">${t}</span>\n                </div>\n              </div>\n              <div class="pvs_acts">${e}</div>\n              <div class="pvs_sh1"></div>\n              <div class="pvs_sh2"></div>\n            </td>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n          </tr>\n        </table>\n       </div>\n    `,report(e,t){var o=cur.pvCurPhoto.id.split("_"),r=()=>{var e=ge("pv_more_act_spam");val(e,getLang("global_report_sent")),re(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_more_acts_hidden")),cur.pvMoreActionsTooltip.updatePosition(),cur.pvMoreActionsTooltip.show()};stManager.add([jsc("web/reports.js"),"reports.css"],()=>{window.showReportReasonDescriptionPopup("photo",parseInt(o[0]),parseInt(o[1]),parseInt(t),e,r)})},showShare(){clearTimeout(cur.hideShareTimer);var e=ge("pvs_dd");if(ge("pv_share").blur(),isVisible(e))return fadeIn(e,0);setTimeout(addEvent.pbind(document,"click",Photoview.hideShare),1),show(e)},hideShare(e){if(e>0)cur.hideShareTimer=setTimeout(Photoview.hideShare.pbind(0),e);else{var t=ge("pvs_dd");t&&(-1==e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(t):fadeOut(t,200),removeEvent(document,"click",Photoview.hideShare))}},savePhoto(){var e=cur.pvListId,t=cur.pvData[e][cur.pvIndex];ajax.post("al_photos.php",{act:"save_me",photo:t.id,list:e,hash:t.hash},{onDone:()=>{var e=document.getElementById("pv_save_to_me");domPN(e).replaceChild(ce("div",{className:"pv_save_to_me_saved",innerHTML:getLang("photos_pv_act_save_saved")}),e),t.actions.save=0},onFail:e=>(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)(getLang("global_error"),e),!0)})},sendPhoto(){var e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t];showBox("like.php",{act:"publish_box",object:"photo"+o.id,list:e,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",jsc("web/sharebox.js")]})},moveToAlbumBox:(e,t,o)=>!showBox("al_photos.php",{act:"a_move_to_album_box",photo_id:e+"_"+t,owner_id:e,from:o},{stat:["page.js","page.css","wide_dd.js","wide_dd.css"]}),moveToAlbum(e,t,o){ajax.post("al_photos.php",{act:"a_move_photo",photo:e,album_id:t,hash:o},{onDone:e=>{curBox().hide();var t=ge("pv_album_name");t&&(t.innerHTML=e),cur.pvCurPhoto.album=e,showDoneBox('<div class="pv_done_box">'+getLang("photos_move_to_album_success").replace("{album}",e)+"</div>")}})},setTags(e){Photoview.hideTag(),e?(show(cur.pvTags),window.tooltips&&each(geByClass("delete",cur.pvTags),()=>{tooltips.destroy(this)}),cur.pvTags.innerHTML=getLang("photos_onthisphoto")+": "+e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTags)},preload(e,t){window.updateWndVScroll&&updateWndVScroll();var o=cur.pvListId,r=((cur.pvData||{})[o]||{}).length;if(r){var a=cur.pvVeryBig>2?"w":cur.pvVeryBig?"z":"y",i=cur.pvVeryBig>1||cur.pvVeryBig?"z":"y",_=cur.pvVeryBig>1?"z":cur.pvVeryBig?"y":"x",s=cur.pvVeryBig>1?"y":cur.pvVeryBig?"x":0;cur.pvLastFrom=e,cur.pvLastDirection=t;for(var c=Photoview.allSizes,n=0;n<Math.min(Photoview.cacheSize,r-Photoview.cacheSize);++n){for(var p=e+(n+1)*-t;p>=r;)p-=r;for(;p<0;)p+=r;var l=cur.pvData[o][p];if(l)for(var d=0,u=c.length;d<u;++d){var v=c[d];l[v]&&l[v].src&&(l[v].src=Photoview.blank,delete l[v])}}var h=function(c){for(var n=e+(c+1)*t;n>=r;)n-=r;for(;n<0;)n+=r;var p=cur.pvData[o][n];return p&&p.id?p[a]?"continue":p[a+"_src"]?(p[a]=vkImage(),p[a].src=p[a+"_src"],"continue"):(p[a]=1,p[i]?"continue":p[i+"_src"]?(p[i]=vkImage(),p[i].src=p[i+"_src"],"continue"):(p[i]=1,p[_]?"continue":p[_+"_src"]?(p[_]=vkImage(),p[_].src=p[_+"_src"],"continue"):(p[_]=1,p[s]?"continue":p[s+"_src"]?(p[s]=vkImage(),p[s].src=p[s+"_src"],"continue"):(p[s]=1,p.x?"continue":(p.x=vkImage(),void(p.x.src=p.x_src)))))):((!p||vkNow()-p>3e3)&&(cur.pvData[o][n]=vkNow(),setTimeout(()=>{ajax.post("al_photos.php",{act:"show",gid:cur.gid,list:o,offset:Photoview.realOffset(o,n,-1),direction:t},{onDone:Photoview.loaded})},10)),"break")};e:for(var g=0;g<Photoview.cacheSize;++g){switch(h(g)){case"break":break e;case"continue":continue}}}},hide(e,t){if(Photoview.hideTag(!0),cur.pvShown&&(!__afterFocus||!0===t)){if(cur.pvCanvas&&Photoview.fullscreenStop(!0),cur.prevPhotoWidth=cur.prevPhotoHeight=0,(cur.pvJumpTo||{}).z=="albums"+val("pva_owner")&&!cur.pvAlbumsShown&&0===e)return Photoview.jumpToAlbums(!0);if((cur.pvJumpTo||{}).z=="album"+val("pvsa_album")&&!cur.pvAlbumShown&&0===e)return Photoview.jumpToAlbum(!0);if((cur.pvJumpTo||{}).z=="tag"+val("pvsa_tag")&&!cur.pvPhotoTagShown&&0===e)return Photoview.jumpToTagged(!0);if("temp"==cur.pvListId)cur.pvCancelLoad();else if(!cur.pvNoHistory&&!e&&cur.pvHistoryLength>0&&cur.pvHistoryLength<10)return cur.pvNoHistory=!0,__adsUpdate("very_lazy"),cur.pvBodyScrollTop=bodyNode.scrollTop,history.go(-cur.pvHistoryLength);var o;if(!0!==e&&!layerQueue.count())cur.pvRoot?("newtag"==cur.pvListId.substr(0,6)?(o="albums"+vk.id+"?act=added",-1!=cur.pvListId.indexOf("/rev")&&(o+="&rev=1")):o=cur.pvListId.replace(/^photos/,"albums").replace("/rev","?rev=1"),nav.setLoc(o)):delete(o=clone(nav.objLoc)).z,nav.strLoc!=nav.toStr(o)&&nav.setLoc(o),__adsUpdate("very_lazy");window.__pvhideTimer=setTimeout(Photoview.doHide.pbind(cur),0),__adsUpdate(),cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1}},doHide(e){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop),cur.pvTaggerTooltip&&(cur.pvTaggerTooltip.unMount(),delete cur.pvTaggerTooltip),e.pvHistoryLength=0,cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),e.pvFriends&&(cleanElems("pv_add_tag","pv_cancel_tag",e.pvFriends.firstChild.firstChild,e.pvFriends),re(e.pvFriends),e.pvFriends=e.pvFriendName=!1),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.cancelEdit(!0);var t=Photoview.allSizes,o=e.pvListId,r=((e.pvData||{})[o]||{}).length;if(e.pvLastDirection&&r){for(var a=0;a<Photoview.cacheSize;++a){for(var i=e.pvLastFrom+(a+1)*e.pvLastDirection;i>=r;)i-=r;for(;i<0;)i+=r;var _=e.pvData[o][i];if(_)for(var s=0,c=t.length;s<c;++s){var n=t[s];_[n]&&_[n].src&&(_[n].src=Photoview.blank,delete _[n])}}e.pvLastDirection=e.pvLastFrom=!1}if(cur.pvYourComment=re(cur.pvYourComment),layers.hide(),layers.fullhide=!1,delete cur.pvLayerCreated,window.tooltips&&tooltips.destroyAll(cur.pvBox),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(layerWrap,"pv_layer_wrap"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(layerBG,"pv_layer"),layerBG.style.opacity="",e.pvShown=e.pvListId=e.pvClicked=!1,removeEvent(window,"resize",Photoview.onResize),removeEvent(document,"keydown",Photoview.onKeyDown),removeEvent(layerWrap,"click",Photoview.onLayerClick),removeEvent(layerWrap,"scroll",Photoview.scrollResize),removeEvent(layerWrap,"mousemove",Photoview.onLayerMouseMove),cur.pvOptions){var p=cur.pvOptions.onHide;cur.pvOptions.onHide=!1,p&&p()}if(layerQueue.pop(),Photoview.destroyPeriod(),e.pvPreloaded&&e===cur){for(var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("photos_container"),d=ce("div",{innerHTML:e.pvPreloaded});d.firstChild;)l.appendChild(d.firstChild);l.qsorter&&setTimeout(qsorter.added.pbind(l),0),e.pvPreloaded=!1}_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.hide(),Photoview.toggleFastChats(!0),delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&(cur.pvPhotoTags.unMount(),delete cur.pvPhotoTags)},editPhoto(){},descTT:e=>Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__.showTooltip)(e,{text:getLang("photos_edit_desc"),black:1,shift:[-160,13,0],showdt:0,appendParentCls:"narrow_column"}),editInline(e){if("A"!=((e||window.event||{}).target||{}).tagName&&!cur.pvEditing){window.tooltips&&window.tooltips.hideAll();var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o],a=e=>{if(cur.pvShown&&cur.pvListId==t&&cur.pvIndex==o&&!cur.pvEditing){cur.pvEditing=[t,o];var r=ge("pv_caption_warn"),a=getLang("photos_edit_desc_intro"),i=cur.pvDesc.appendChild(ce("div",{innerHTML:`\n          <textarea\n            class="dark"\n            id="pv_edit_text"\n            onkeydown="onCtrlEnter(event, Photoview.saveInline)"\n            onkeyup="checkTextLength(cur.pvCaptionLimit, this, ${r});"\n            placeholder="${a}"\n          >${e}</textarea>\n          <div id="pv_caption_warn"><div>`},{display:"none"})),_=ge("pv_edit_text");autosizeSetup(_,{minHeight:21,maxHeight:350}),setTimeout(()=>{show(i),elfocus(_),addEvent(_,"blur",Photoview.saveInline),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvDesc.firstChild),cur.pvNarrowScrollbar.scrollTop(0)},1)}};!r.desc?a(""):ajax.post("al_photos.php",{act:"edit_desc",photo:r.id},{onDone:a,progress:cur.pvProgress})}},cancelInline(){cur.pvEditing=!1,removeEvent(ge("pv_edit_text"),"blur"),show(cur.pvDesc.firstChild),re(cur.pvDesc.firstChild.nextSibling)},saveInline(){if(cur.pvEditing){removeEvent(ge("pv_edit_text"),"blur");var e=cur.pvEditing[0],t=cur.pvEditing[1],o=cur.pvData[e][t],r=trim(val("pv_edit_text"));if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_desc_edit",cur.pvDesc)&&!r)return Photoview.cancelInline();ajax.post("al_photos.php",{act:"save_desc",photo:o.id,hash:o.hash,text:r},{onDone:r=>{if(o.desc=r,cur.pvShown&&e==cur.pvListId&&t==cur.pvIndex){cur.pvEditing=!1;var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvDesc);val(a,r||'<span class="pv_desc_edit">'+getLang("photos_edit_desc")+"</span>"),a.onmouseover=r?Photoview.descTT.pbind(a):()=>{},show(a),re(domNS(a))}},progress:cur.pvProgress})}},cmp(e,t){var o=e.length,r=t.length;return o<r?-1:o>r?1:e<t?-1:e>t?1:0},receiveComms(e,t,o,r,a,i){if(e==cur.pvListId&&t==cur.pvIndex){for(var _=ce("div",{innerHTML:o}),s=ge("pv_comments_list"),c=domLC(s),n=getXY(l,!0)[1],p=cur.pvData[e][t],l=c,d=domLC(_);d;d=domLC(_)){for(p.actions.comm&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(d,"reply_replieable");l&&Photoview.cmp(l.id,d.id)>0;)l=domPS(l);l&&!Photoview.cmp(l.id,d.id)?(s.replaceChild(d,l),l=d):(l&&domNS(l)?s.insertBefore(d,domNS(l)):!l&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(s)?!0===a?(--p.commshown,_.removeChild(d)):s.insertBefore(d,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(s)):s.appendChild(d),++p.commshown)}i&&c&&(layerWrap.scrollTop+=getXY(c,!0)[1]-n),cur.pvCommsLikes[p.id][0]=ge("pv_comments"),extend(cur.pvReplyNames,r),Photoview.updateComms()}},commSaved(e){if(cur.pvShown){var t=ge("pv_comments"),o=!!t&&cur.pvData[cur.pvListId][cur.pvIndex],r=e.match(/^(-?\d+)photo(_\d+)/);o&&r&&ge("pv_comment"+r[1]+r[2])&&(cur.pvCommsLikes[o.id][0]=t)}},comments(e){if(e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_comments")).id||"";if(!isVisible("pv_comments_header")||Photoview.cmp(t,"pv_comment"+e)<0)return}var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r],i=ge("pv_comments_header");ajax.post("al_photos.php",{act:"photo_comments",offset:a.commshown,photo:a.id,list_id:cur.pvListId},{onDone:(t,a)=>{Photoview.receiveComms(o,r,t,a,!1,e),e&&ge("pv_comment"+e)&&Photoview.showComment(e)},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(()=>{i.innerHTML="",showProgress(i)}),hideProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(()=>{hideProgress(i)})})},updateComms(e){var t=cur.pvData[cur.pvListId][cur.pvIndex],o=ge("pv_comments_header"),r="";t.commcount>t.commshown&&(r=getLang("photos_show_prev_comments",t.commcount-t.commshown)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(ge("pv_comments_list"),"unshown",!e&&0==t.commcount),toggle(o,r),toggle(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_no_commments_placeholder"),0==t.commcount&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("_post_content",cur.pvBox)),o.innerHTML=r},commentChanged(){checkTextLength(cur.pvCommLimit,cur.pvComment),cur.pvCommenting=cur.pvData[cur.pvListId][cur.pvIndex].id},updateRightBlock(e){function t(){var e=getSize(cur.pvLeftWrap)[1]-(cur.pvReplyForm?getSize(cur.pvReplyForm)[1]:0);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvNarrow,"height",e);var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pv_no_commments_placeholder_wrap");if(t&&(isVisible(t.children[0])||isVisible(t.children[1]))){var o=getSize(t)[1],r=getSize("pv_comments_list")[1],a=e-ge("pv_comments").offsetTop-r;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(t,"margin-top",Math.max(0,a/2-o/2))}}t(),clearTimeout(cur.pvRightBlockUpdateTO),cur.pvRightBlockUpdateTO=setTimeout(t)},getReplyAsGroupEl:()=>ge("pv_reply_as_group"),sendComment(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=cur.pvListId,a=cur.pvIndex,i=cur.pvData[r][a],_=ge("reply_field"+e),s=_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.data)(_,"composer"),c=(cur.pvReplyNames[(cur.reply_to||{})[0]]||[])[1],n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("addpost_button",cur.pvReplyForm),p={},l=o.stickerId;if(l)p={message:"",attach1_type:"sticker",attach1:l,sticker_referrer:o.sticker_referrer};else{if((p=s?Composer.getSendParams(s,Photoview.sendComment.pbind(e)):{message:trim(Emoji.editableVal(_))}).delayed)return;if(!p.attach1_type&&(!p.message||c&&!c.indexOf(p.message)))return void Emoji.editableFocus(_,!1,!0)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)("reply_warn"+e);var d=Photoview.getReplyAsGroupEl();ajax.post("al_photos.php",_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.fixPostParams(extend(p,{act:"post_comment",photo:i.id,hash:i.hash,from_group:d&&domData(domClosest("_submit_post_box",ge(d)),"from-oid")<0?1:"",reply_to:(cur.reply_to||{})[1]})),{onDone:(o,c)=>{++i.commcount,Photoview.receiveComms(r,a,o,c,!0),l||(s?Composer.reset(s):Emoji.val(_,"")),_.autosize&&_.autosize.update(),browser.mobile?_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.hideEditReply(e):(Emoji.editableFocus(_,!1,!0),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.cancelReplyTo(e,t)),re("reply_link"+e),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.hideEditPostReply(null,!0),cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollBottom(),Photoview.updateRightBlock()},showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(n)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(n)}})},highlightComment(e){if(e=ge(e)){var t=getXY(e,!0)[1],o=animate.pbind(e,{backgroundColor:"#ECEFF3"},200,()=>{setTimeout(()=>{animate(e,{backgroundColor:"#FFF"},200,()=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(e,{backgroundColor:""})})},1e3)});t<0||t>lastWindowHeight-200?animate(layerWrap,{scrollTop:layerWrap.scrollTop+t-50},300,o):o()}},showComment(e){var t=ge("pv_comment"+e);return t?Photoview.highlightComment(t):Photoview.comments(e),!1},commDone(node,text,del,script){if(node){var fc=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(node),msg=domNS(fc),ph=null!=cur.pvListId&&null!=cur.pvIndex&&cur.pvData[cur.pvListId][cur.pvIndex];if(!text)return show(fc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(msg),void(ph?(++ph.commcount,++ph.commshown,Photoview.updateComms()):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_10__.photos.recache(cur.offset,1));if(msg?(msg.innerHTML=text,show(msg)):node.appendChild(ce("div",{innerHTML:text})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(fc),del&&(ph?(--ph.commshown,--ph.commcount,Photoview.updateComms(del)):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_10__.photos.recache(cur.offset,-1)),ph&&(cur.pvCommsLikes[ph.id][0]=ge("pv_comments")),script)try{eval(script)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__.logEvalError)(e,script)}}},commProgress(e,t){var o=ge("pv_actions"+e);if(o){var r=o.firstChild.nextSibling;if(!0!==t)return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(r),void show(o.firstChild);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(o.firstChild),r||(r=o.appendChild(ce("div",{className:"progress"}))),show(r)}},commParams:(e,t)=>({onDone:Photoview.commDone.pbind(e,t),progress:"pv_progress"+e+t,stat:[jsc("web/privacy.js"),"privacy.css"]}),commAction(e,t,o,r){var a=gpeByClass("reply",t),i=gpeByClass("post_actions",t);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(a,"post_actions_progress")||ajax.post("al_photos.php",{act:e+"_comment",comment:o,hash:r},{onDone:Photoview.commDone.pbind(a),showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass.pbind(i,"post_actions_progress"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass.pbind(i,"post_actions_progress")})},_isOverLayer:e=>e.target==layer||e.target==cur.pvCont,_isOverLayerLeft(e){if(Photoview._isOverLayer(e)){var t=getXY(cur.pvBox),o=getSize(cur.pvBox);return e.pageX<t[0]&&e.pageY>t[1]&&e.pageY<t[1]+o[1]}},onLayerMouseMove(e){if(Photoview._isOverLayer(e)){var t=Photoview._isOverLayerLeft(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(layerWrap,"pv_left_panel_over",t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",t)}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(layerWrap,"pv_left_panel_over")},onLayerClick(e,t){if(Photoview._isOverLayer(e)&&Photoview._isOverLayerLeft(e))return Photoview.show(!1,cur.pvIndex-1,e);Photoview._doLayerClick(e,t)},_doLayerClick(e,t){if(cur.pvClicked&&!t||__afterFocus||e&&cur.__mdEvent&&e.target!=cur.__mdEvent.target)cur.pvClicked=!1;else if(!e||2!=e.button&&3!=e.which&&!e.pvHandle){e&&(e.pvHandle=!0);var o=e.pageX,r=e.pageY;if(null==o&&null!=e.clientX){var a=document.documentElement,i=bodyNode;o=e.clientX+(a&&a.scrollLeft||i&&i.scrollLeft||0)-(a.clientLeft||0),r=e.clientY+(a&&a.scrollTop||i&&i.scrollTop||0)-(a.clientTop||0)}var _=Math.abs(o-intval(cur.pvOldX)),s=Math.abs(r-intval(cur.pvOldY));(_>3||s>3)&&vkNow()-intval(cur.pvOldT)>300&&(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag():cur.pvEditorMode?e.target!=layerWrap&&e.target!=layer||SPE.attemptHide(()=>{Photoview.hide(0)}):Photoview.hide(0))}},onKeyDown(e){if(!1===e.returnValue)return!1;if((!window.SPE||!window.SPE.editor)&&inArray(e.keyCode,[KEY.DOWN,KEY.UP])&&cur.pvNarrowScrollbar&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(e.target,"reply_field"))return cur.pvNarrowScrollbar.scrollBy(e.keyCode==KEY.DOWN?70:-70),cancelEvent(e);if(e.keyCode==KEY.ESC&&cur.pvEditing)return Photoview.cancelInline(),cancelEvent(e);e.altKey&&e.keyCode==KEY.RETURN&&Photoview.canFullscreen()&&(cur.pvCanvas?Photoview.fullscreenStop():Photoview.fullscreen()),e.keyCode==KEY.SPACE&&cur.pvCanvas&&(_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.startSlide(),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.showControls(!0));var t=e.target.contentEditable;return!!(window.Emoji&&Emoji.shown||e.target&&("INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName||"DIV"==e.target.tagName&&t&&"inherit"!=t))||(e.keyCode==KEY.ESC?(cur.pvCanvas?Photoview.fullscreenStop():cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag():e.vkCanceled||curBox()||(cur.pvEditorMode?SPE.attemptHide(()=>{Photoview.hide(0)}):Photoview.hide(0)),cancelEvent(e)):(cur.pvTagger||boxQueue.count()||cur.pvComment&&cur.pvComment.focused||e.ctrlKey||(e.keyCode==KEY.RIGHT?Photoview.show(cur.pvListId,cur.pvIndex+1):e.keyCode==KEY.LEFT&&Photoview.show(cur.pvListId,cur.pvIndex-1)),!cur.pvCanvas&&void 0))},updateVerticalPosition(e){if(cur.pvCont){var t=getSize(cur.pvCont),o=window.clientHeight()/2-t[1]/2-intval(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(layer,"margin-top",Math.round(o))}},calculateVeryBig(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0);cur.pvVeryBig=e>1800?3:e>1200?2:e>800&&1,window.devicePixelRatio>1&&(cur.pvVeryBig+=1,cur.pvVeryBig=Math.min(3,cur.pvVeryBig))},updateNavBtnsLeftThreshold(e){var t=getSize(cur.pvImageWrap)[0],o=getXY(cur.pvImageWrap)[0];cur.pvLeftBtnAmount&&!e||(cur.pvLeftBtnAmount=o+Photoview.LEFT_RIGHT_NAV_RATIO*t)},updatePhotoDimensions(e){if(!Photoview.isPhotosList()&&!cur.pvEditorModeDimensionsUpdated){var t=Photoview.MIN_WIDTH,o=Photoview.MIN_HEIGHT;cur.pvEditorMode&&(t=Photoview.PE_MIN_WIDTH,o=Photoview.PE_MIN_HEIGHT,cur.pvEditorModeDimensionsUpdated=!0),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(cur.pvBottomInfo,"pv_with_line_break");var r=isVisible(cur.pvTagInfo),a=r?getSize(cur.pvTagInfo)[1]:0,i=Math.max(document.documentElement.clientWidth,window.innerWidth||0),_=Math.max(document.documentElement.clientHeight,window.innerHeight||0),s=getSize(cur.pvBottomInfo)[1],c=Math.max(t,i-Photoview.SIDE_COLUMN_WIDTH-2*Photoview.SIDE_MIN_GAP),n=Math.max(o,_-s-2*Photoview.VERTICAL_MIN_GAP-a);Photoview.calculateVeryBig();var p=clone(cur.pvCurData||{width:t,height:o});p.width=p.width||t,p.height=p.height||o;var l=p.width/p.height,d=Math.min(c,p.width),u=d/l;u=Math.min(n,u),d=Math.ceil(u*l);var v=getXY(cur.pvBottomLeft)[0]+getSize(cur.pvBottomLeft)[0]>getXY(cur.pvBottomActions)[0]-20;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvBottomInfo,"pv_with_line_break",v),e&&(cur.prevPhotoWidth=cur.prevPhotoHeight=0);var h=cur.prevPhotoWidth=Math.max(d,t,cur.prevPhotoWidth||0),g=cur.prevPhotoHeight=Math.max(u,o,(cur.prevPhotoHeight||0)-a),m=Math.max(0,g/2-u/2);if(m>0&&!r){var b=(getSize(cur.pvPhoto)[1]+s)/2-u/2;b>s&&(m=b)}cur.pvAttachedProducts.photoSize={width:d,height:u,top:m},Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvPhoto,{width:h,height:g}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto),{width:d,height:u,marginTop:m}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagInfo,{width:h}),cur.pvTagFrame&&Photoview.updateTagFrameDimensions(d,u,m),cur.pvPhotoTagsContainer&&Photoview.updatePhotoTagsContainerDimensions(d),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvImgProgress,"marginTop",m+u/2);var w=(cur.pvIsLightMode?0:Photoview.SIDE_COLUMN_WIDTH)+h;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvCont,{width:w,paddingLeft:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.sbWidth)()}),Photoview.updateRightBlock(),Photoview.updateVerticalPosition(),cur.pvPhWidth=d,cur.pvPhHeight=u,Photoview.updateNavBtnsLeftThreshold();var P=getXY(cur.pvCont),f=getSize(cur.pvCont),O=P[1]+f[1],E=i-(P[0]+f[0])<85||_-O<60;Photoview.toggleFastChats(!E)}},toggleFastChats(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)("chat_onl_wrap","hidden",!e),each(geByClass("rb_box_wrap"),()=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(this,"hidden",!e)})},onResize(){if(cur.pvCanvas){var e=cur.pvVeryBig,t=cur.pvCanvas.offsetWidth,o=cur.pvCanvas.offsetHeight;return cur.pvVeryBig=t>1280||o>1280?2:(t>807||o>807)&&1,void(e!=cur.pvVeryBig&&setTimeout(Photoview.preload.pbind(cur.pvIndex,cur.pvLastDirection||1),10))}if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvCont,"width",800):Photoview.updatePhotoDimensions(!0),cur.pvPhoto){if(browser.mozilla&&cur.pvPhoto.firstChild){var r=cur.pvPhoto.firstChild.offsetLeft,a=(lastWindowWidth-cur.pvActualWidth)%2&&(cur.pvActualWidth-cur.pvPhWidth)%2?4:3;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagFrame,{left:r-a+"px"})}Photoview.scrollResize(),Photoview.stopTagger()}},stopTagger(){cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag()},updateSize(){cur.pvBox&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown||!!cur.pvAlbumShown),onBodyResize(),Photoview.onResize()},activate(e){e&&e.timeout?(clearTimeout(e.timeout),removeAttr(e,"timeout")):isVisible(e)&&fadeTo(e,200,vk.pvdark?1:.7)},deactivate(e){e&&isVisible(e)&&!e.timeout&&(e.timeout=setTimeout(()=>{removeAttr(e,"timeout"),fadeTo(e,200,.4)},1))},deletePhoto(e){var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o],a=curBox();if(cur.deletionProgress=cur.deletionProgress||{},!cur.deletionProgress[r.id])if(cur.deletionProgress[r.id]=!0,cur.pvTagger)Photoview.stopTagger();else{cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas();var i={act:"delete_photo",photo:r.id,hash:r.hash,set_prev:isChecked("pvb_prev_check"),sure:intval(e)};Object(_internal_nospam_common__WEBPACK_IMPORTED_MODULE_21__.isClaimContent)()&&(i._nol=JSON.stringify(window.nav.objLoc)),ajax.post("al_photos.php",i,{onDone:(e,i)=>{if(cur.deletionProgress[r.id]=!1,a)return a.hide(),nav.go("/id0",!1,{nocur:!0});t==cur.pvListId&&o==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(i||getLang("photo_deleted"),e),r.deleted=[cur.pvTagInfoText.innerHTML,cur.pvTagInfoButtons.innerHTML],Photoview.toggleDeletedState(!0),Photoview.updatePhotoDimensions())}})}},restorePhoto(e){var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o];Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(e)||ajax.post("al_photos.php",{act:"restore_photo",photo:r.id,hash:r.hash},{onDone:e=>{r.deleted=!1,t==cur.pvListId&&o==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1),Photoview.updatePhotoDimensions()),cur.pvPhotoTags&&cur.pvPhotoTags.showAreas()},onFail:e=>(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)(getLang("global_error"),e),!0),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton.pbind(e)})},spamPhoto(e,t){var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r];Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(t)||(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag():ajax.post("al_photos.php",{act:"spam_photo",photo:a.id,hash:a.hash,spam_hash:e,pv:1},{onDone:(e,t)=>{t&&(a.deleted=e),o==cur.pvListId&&r==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(getLang("photo_marked_as_spam_restore"),e),t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvCommentsData))},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton.pbind(t),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton.pbind(t)}))},rotatePhoto(e){var t=ge("pv_rotate_progress");if(!isVisible(t)){Photoview.stopTagger(),show(t),ge("pv_rotate").appendChild(ce("div",{id:"pv_rotate_frame",className:"upload_frame",innerHTML:'<iframe name="pv_rotate_frame"></iframe>'}));var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r],i=ge("pv_rotate_form");i.innerHTML="",i.action=a.rotate[0];var _=extend({act:"do_rotate",to:e,list_id:o,index:r,fid:a.id},a.rotate);if(e=(e+4)%4,"rotate_photo"==_.act&&(_.angle=(_.angle+e)%4),_["rot"+e])return _.act="done_rotate",_.complete=1,void ajax.post("/al_photos.php",_,{onDone:Photoview.rotateDone,onFail:()=>{Photoview.rotateDone()}});for(var s in _)0!=s&&i.appendChild(ce("input",{type:"hidden",name:s,value:_[s]}));i.submit()}},rotateDone(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)("pv_rotate_progress");var t=ge("pv_rotate_frame");if(t&&(re(t),e)){var o=e.list_id,r=e.index,a=cur.pvData[o][r];extend(a,{x_src:e.x_src,y_src:e.y_src,z_src:e.z_src,w_src:e.w_src,base:e.base,x_:e.x_,y_:e.y_,z_:e.z_,w_:e.w_,x:0,y:0,z:0,w:0,tags:e.tags,tagged:e.tagged,suggested_tags:e.suggested_tags,tagshtml:e.html}),extend(a.rotate,{photo:e.photo,hash:e.hash,rhash:e.rhash,angle:e.angle,rot1:e.rot1,rot3:e.rot3}),o==cur.pvListId&&r==cur.pvIndex&&Photoview.show(o,r),cur.pvPhotoTags&&cur.pvPhotoTags.reload()}},likeUpdate(e,t,o){t=intval(t);var r=ge("pv_like"),a=domByClass(r,"_count");if(a){var i=r.tt||{},_=clone(i.opts||{}),s=domByClass(i.container,"_value"),c=domByClass(i.container,"_content"),n=domByClass(i.container,"_title");o&&n&&val(n,o),i&&(i.likeInvalidated=!0),s&&(s.value=t),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_25__.animateCount)(a,t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(r,"pv_liked",e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(r,"no_likes",!t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.toggleClass)(c,"me_hidden",!e),t?!i.el||isVisible(i.container)||o||tooltips.show(i.el,extend(_,{showdt:0})):i.el&&i.hide()}},tagOver(e){animate(e,{backgroundColor:"#6B8DB1"},200),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__.showTooltip)(e,{text:getLang("photos_delete_tag"),shift:[0,-2,0]})},tagOut(e){e.parentNode&&e.parentNode.parentNode&&animate(e,{backgroundColor:"#C4D2E1"},200)},deleteTag(e,t){var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r];if(a.tagid){if(isVisible("pv_tag_handling"))return}else if(ge("pv_action_progress"))return;var i=t?1:0;ajax.post("al_photos.php",{act:"delete_tag",photo:a.id,tag:e,hash:a.hash,top_panel:i},{onDone:(t,i,_,s)=>{a.tagid?(a.taginfo=a.tagid=!1,cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(getLang("photos_tag_deleted"),t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(cur.pvTagInfoButtons,"no_events"),setTimeout(()=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(cur.pvTagInfoButtons,"no_events")},1e3)):Photoview.actionInfo().innerHTML=t,void 0!==i&&(a.tags=i,a.tagged=_,a.tagshtml=s,cur.pvListId==o&&cur.pvIndex==r&&(Photoview.setTags(s),(!a.taginfo&&a.actions.tag&&i[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTagLink))),cur.pvPhotoTags&&cur.pvPhotoTags.deleteTag(e)},onFail:e=>{if(e)return Photoview.actionInfo().innerHTML=e,!0},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(()=>{if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(t),a.tagid);else{var e=Photoview.actionInfo();e.innerHTML="",showProgress(e)}}),hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(t),a.tagid||re(Photoview.actionInfo())}})},restoreTag(e){if(!ge("pv_action_progress")){var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o];ajax.post("al_photos.php",{act:"restore_tag",photo:r.id,tag:e,hash:r.hash},{onDone:(e,a,i,_)=>{void 0!==a&&(r.tags=a,r.tagged=i,r.tagshtml=_,cur.pvListId==t&&cur.pvIndex==o&&(Photoview.setTags(_),(!r.taginfo&&r.actions.tag&&a[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTagLink)),cur.pvPhotoTags&&cur.pvPhotoTags.renderTagAreas()),Photoview.actionInfo().innerHTML=e},onFail:e=>{if(e)return Photoview.actionInfo().innerHTML=e,!0},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(()=>{var e=Photoview.actionInfo();e.innerHTML="",showProgress(e)}),hideProgress:()=>{re(Photoview.actionInfo())}})}},confirmTag(e,t){var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r];isVisible("pv_tag_handling")||ajax.post("al_photos.php",{act:"confirm_tag",tag:e,photo:a.id,hash:a.hash},{onDone:(e,t,i)=>{a.tags=e,a.tagged=t,a.tagshtml=i,a.taginfo=a.tagid=!1,o==cur.pvListId&&r==cur.pvIndex&&(Photoview.setTags(i),(!a.taginfo&&a.actions.tag&&e[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTagLink),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(!1))},showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(t)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(t)}})},toProfileTag(){var e=cur.pvData[cur.pvListId][cur.pvIndex].tagged[vk.id];e&&!cur.pvTagger&&Photoview.showTag(e)},showTag(e){cur.pvPhotoTags&&cur.pvPhotoTags.showTagArea(e)},showDynTag(e){if(clearTimeout(cur.pvHidingTag),cur.pvShowingTag!=e){var t=clone(cur.pvData[cur.pvListId][cur.pvIndex].tags[e]),o=ge("pv_tag"+e);if(o){each(t,(e,o)=>{t[e]=positive(o*cur[e%2?"pvPhHeight":"pvPhWidth"]/100)});var r=0;isVisible(cur.pvTagInfo)&&(r=getSize(cur.pvTagInfo)[1]),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagPerson,{marginLeft:t[0]+"px",marginTop:r+t[3]+"px",minWidth:t[2]-t[0]+"px"}),cur.pvTagPerson.innerHTML=o.firstChild.innerHTML;var a=getSize(cur.pvTagPerson);t[3]+a[1]>cur.pvPhHeight&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(cur.pvTagPerson,{marginTop:cur.pvPhHeight-a[1]+"px"}),cur.pvTagPerson.onmouseover=Photoview.showDynTag.pbind(e),cur.pvShowingTag=e,browser.msie?show(cur.pvTagPerson):fadeIn(cur.pvTagPerson,200)}}},hideTag(){cur.pvPhotoTags&&cur.pvPhotoTags.hideTagArea()},realOffset(e,t,o){var r=t;if(!cur.pvData||!cur.pvData[e])return r;for(var a=0;a<t;a++)cur.pvData[e][a]&&(cur.pvData[e][a].deleted||cur.pvData[e][a].moved)&&(r+=o);return r},realCount(e,t){var o=t;if(!cur.pvData||!cur.pvData[e])return o;for(var r=0;r<cur.pvData[e].length;r++)cur.pvData[e][r]&&(cur.pvData[e][r].deleted||cur.pvData[e][r].moved)&&o++;return o},list(e,t,o){"deleted"!=o&&(cur.pvList||(cur.pvList={}),cur.pvList[e+"_"+t]=o)},loaded(e,t,o,r,a){if("deleted"!=e){if(a&&(extend(cur,{lang:extend(cur.lang||{},a.lang),pvHash:a.hash,pvCommLimit:a.commlimit,pvCaptionLimit:a.captionlimit,pvMaxTags:a.maxtags,pvReasons:a.reasons,pvReplyNames:extend(cur.pvReplyNames||{},a.names||{}),pvAskForAutoTag:a.ask_for_autotag,pvTagsQueueParams:a.qparams}),window.pvcur=extend(window.pvcur||{},{wallTpl:a.wallTpl,rmedia_types:a.rmedia_types}),cur.wallTpl=cur.wallTpl||a.wallTpl,cur.options||(cur.options={}),cur.options.share||(cur.options.share=a.share),val(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_add_media")),getLang("global_add_media"))),t=Photoview.realCount(e,t),o=Photoview.realOffset(e,o,1),cur.pvData||(cur.pvData={}),cur.pvCommsLikes||(cur.pvCommsLikes={}),cur.pvData[e])if(cur.pvData[e].length<t)for(var i=cur.pvData[e].length;i<t;++i)cur.pvData[e].push(void 0);else cur.pvData[e].length>t&&(cur.pvData[e]=cur.pvData[e].slice(0,t));else cur.pvData[e]=new Array(t);for(var _=0,s=r.length;_<s;++_){for(var c=clone(r[_]),n=o+_;n>=t;)n-=t;cur.pvCommsLikes[c.id]=[c.comments,c.likes,vkNow(),!1],delete c.comments,delete c.likes,cur.pvData[e][n]=c}}},showDeleted(e,t,o){cur.pvShown&&"temp"==cur.pvListId&&(t+="<br><br>"+o),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)({title:getLang("global_error"),onHide:()=>{cur.pvShown&&"temp"==cur.pvListId&&Photoview.hide(!0)}},t)},spamDeleted(e,t,o){isVisible(curBox().progress)||ajax.post("al_photos.php",{act:"spam_photo",photo:t,hash:o,from:"deleted"},{onDone:t=>{domPN(e).replaceChild(ce("span",{innerHTML:t}),e)},showProgress:curBox().showProgress,hideProgress:curBox().hideProgress})},showPhoto(e,t,o,r){if(cur.pvShown&&("temp"!=cur.pvListId||cur.pvWasShown)&&void 0===o.noHistory||(debugLog("in showPhoto noHistory: "+o.noHistory),cur.pvNoHistory=o.noHistory,cur.pvHistoryLength=o.noHistory?0:o.histLen||0),extend(cur,{pvJumpTo:o.jumpTo||!1,pvJumpFrom:!1,pvJumpSteps:0}),t=cur.pvList&&cur.pvList[e+"_"+t]||t,cur.pvData&&cur.pvData[t]){var a=cur.pvData[t],i=cur.pvOptions&&cur.pvOptions.onHide,_=!0;cur.pvOptions=o,cur.pvOptions.onHide||(cur.pvOptions.onHide=i);for(var s=0,c=a.length;s<c;++s)if(a[s]){if(a[s].id===e)return Photoview.show(t,s,!1,o.root),o.onShow&&o.onShow(),!1}else _=!1;return _&&r?(o.onEmpty&&o.onEmpty(),!1):void 0}},loadedAlbums(e,t,o,r){cur.pvAlbumsData&&(ajax.preload("al_photos.php",extend({offset:r.offset,part:1,owner:e},{act:"show_albums"}),o),cur.curYear=r.cur_year,cur.pvAlbumsData[e]={html:t,opts:r},cur.pvAlbumsShowing==e&&(Photoview.doShowAlbums(e,!1),boxRefreshCoords(layer)))},showAlbums(e,t){e=intval(e),cur.pvAlbumsData||(cur.pvAlbumsData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=0,cur.pvAlbumsShowing=e;var o=t.onFail;cur.pvAlbumsData[e]?"loading"!=cur.pvAlbumsData[e]&&(Photoview.doShowAlbums(e,!1),boxRefreshCoords(layer)):(cur.pvAlbumsData[e]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:e},extend(t,{onDone:Photoview.loadedAlbums,onFail:t=>(o&&o(t),delete cur.pvAlbumsData[e],cur.pvAlbumsData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedAlbum(e,t,o,r){cur.pvAlbumData&&(o&&ajax.preload("al_photos.php",extend({offset:r.offset,part:1,album:e},{act:"show_album"}),o),cur.pvAlbumData[e]={html:t,opts:r},cur.pvAlbumShowing==e&&(Photoview.doShowAlbum(e,!1),boxRefreshCoords(layer)))},showAlbum(e,t){cur.pvAlbumData||(cur.pvAlbumData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=0,cur.pvAlbumShowing=e;var o=t.onFail;cur.pvAlbumData[e]?"loading"!=cur.pvAlbumData[e]&&(Photoview.doShowAlbum(e,!1),boxRefreshCoords(layer)):(cur.pvAlbumData[e]="loading",ajax.post("al_photos.php",{act:"show_album",album:e},extend(t,{onDone:Photoview.loadedAlbum,onFail:t=>(o&&o(t),delete cur.pvAlbumData[e],cur.pvAlbumData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedTagged(e,t,o){cur.pvPhotoTagData&&(cur.pvPhotoTagData[e]={html:t,opts:o},cur.pvPhotoTagShowing==e&&(Photoview.doShowTagged(e,!1),boxRefreshCoords(layer)))},showTagged(e,t){e=intval(e),cur.pvPhotoTagData||(cur.pvPhotoTagData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=0,cur.pvPhotoTagShowing=e;var o=t.onFail;cur.pvPhotoTagData[e]?"loading"!=cur.pvPhotoTagData[e]&&(Photoview.doShowTagged(e,!1),boxRefreshCoords(layer)):(cur.pvPhotoTagData[e]="loading",ajax.post("al_photos.php",{act:"show_tag",mid:e},extend(t,{onDone:Photoview.loadedTagged,onFail:t=>(o&&o(t),delete cur.pvPhotoTagData[e],cur.pvPhotoTagData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},updatePeriods(){Photoview.periods=geByClass("photos_period_delimiter")},destroyPeriod(){Photoview.fixedPeriod&&(re(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)},fixPeriod(){if(Photoview.periods&&Photoview.periods.length){var e=scrollGetY(),t=getSize(Photoview.periods[0])[1],o=!1,r=!1;for(var a in Photoview.periods)if(Photoview.periods.hasOwnProperty(a)){if(getXY(Photoview.periods[a])[1]>=e)break;o=Photoview.periods[a];var i=intval(a)+1;r=!!Photoview.periods[i]&&getXY(Photoview.periods[i])[1]-e}if(o){o==Photoview.fixedPeriodEl||(Photoview.fixedPeriod?Photoview.fixedPeriod.innerHTML=o.innerHTML:(Photoview.fixedPeriod=ce("div",{innerHTML:o.innerHTML,className:"pva_period_fixed"},{left:getXY(o)[0]+"px"}),utils.appendChild(Photoview.fixedPeriod)),Photoview.fixedPeriodEl=o);var _=!1!==r?r-t:0;_>=0&&(_=0),Photoview.fixedPeriodTop!==_&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.setStyle)(Photoview.fixedPeriod,{top:_+"px"}),Photoview.fixedPeriodTop=_)}else!o&&Photoview.fixedPeriod&&(re(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)}},scrollResize(){if(!browser.mobile&&cur.pvShown&&(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown||cur.pvVideoTagsShown)){var e=ge("ui_pv_photos_load_more"),t=ge("ui_pva_more_load_more"),o=3*lastWindowHeight;isVisible(e)&&o>getXY(e)[1]-(browser.msie6?0:scrollGetY())&&(cur.pvVideoTagsShown?Photoview.loadVideoTags():cur.pvPhotoTagShown?Photoview.loadTaggedPhotos():cur.pvAlbumsShown?Photoview.loadAlbumsPhotos():Photoview.loadAlbumPhotos()),cur.pvAlbumsShowing&&Photoview.fixPeriod(),cur.pvAlbumsShown&&cur.pvShowAllAlbums&&isVisible(t)&&o>getXY(t)[1]-(browser.msie6?0:scrollGetY())&&Photoview.loadAlbums()}},loadAlbums(){cur.pvShowAllAlbums=!0,Photoview.loadAlbumsPhotos(!0)},loadedAlbumsPhotos(e,t,o,r){if(cur.pvaLoading=0,cur.pvAlbumsShown){o?cur.pvaOffset=e:cur.pvaPhotosOffset=e,r&&(cur.curYear=r);var a=o?ge("pva_content"):ge("pva_content_photos"),i=o?ge("ui_pva_more_load_more"):ge("ui_pv_photos_load_more"),_=o?{act:"show_albums"}:{act:"show_albums",only_photos:1,cur_year:cur.curYear},s=o?cur.pvaOffset:cur.pvaPhotosOffset,c=o?cur.pvaCount:cur.pvaPhotosCount;if(a){for(var n=ce("div",{innerHTML:t});n.firstChild;){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hasClass)(n.firstChild,"photos_period_delimiter")){var p=domData(n.firstChild,"year");if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("photos_period_delimiter_"+p)){re(n.firstChild);continue}}a.appendChild(n.firstChild)}Photoview.onResize(),Photoview.updatePeriods(),e>=c||!t?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(i):o&&(cur.pvaLoading=1,ajax.post("al_photos.php",extend({offset:s,part:1,owner:cur.pvAlbumsShown},_||{}),{onDone(){debugLog("preload done: "+cur.pvaLoading),2==cur.pvaLoading?Photoview.loadedAlbumsPhotos.apply(window,arguments):cur.pvaLoading=!1},onFail:()=>(cur.pvaLoading=0,!0)}))}}},loadAlbumsPhotos(e){var t=e?ge("ui_pva_more_load_more"):ge("ui_pv_photos_load_more"),o=e?{act:"show_albums"}:{act:"show_albums",only_photos:1},r=e?cur.pvaOffset:cur.pvaPhotosOffset;cur.pvAlbumsShown&&t&&isVisible(t)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(t)&&(cur.pvaLoading?cur.pvaLoading=2:ajax.post("al_photos.php",extend({offset:r,part:1,owner:cur.pvAlbumsShown},o||{}),{cache:o.only_photos?0:1,onDone:Photoview.loadedAlbumsPhotos,onFail:()=>(cur.pvaLoading=0,!0),showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(t)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(t)}}))},loadedAlbumPhotos(e,t){if(cur.pvaLoading=0,cur.pvAlbumShown){cur.pvsaOffset=e;var o=ge("pvsa_content_photos"),r=ge("ui_pv_photos_load_more");if(o){if(o.appendChild(cf(t)),!cur.pvAlbumData[cur.pvAlbumShown].opts.no_known_count&&e>=cur.pvsaCount||!t)return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(r),void Photoview.onResize();setTimeout(()=>{Photoview.onResize()},10),cur.pvsaLoading=1,ajax.post("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},{onDone(){2==cur.pvsaLoading?Photoview.loadedAlbumPhotos.apply(window,arguments):(cur.pvsaLoading=!1,ajax.preload("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},arguments))},onFail:()=>(cur.pvsaLoading=0,!0)})}}},loadAlbumPhotos(){var e=ge("ui_pv_photos_load_more"),t=cur.pvsaOffset;cur.pvAlbumShown&&e&&isVisible(e)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(e)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_album",album:cur.pvAlbumShown,offset:t,part:1},{onDone:Photoview.loadedAlbumPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(e)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(e)},cache:!0}))},loadedTaggedPhotos(e,t){if(cur.pvaLoading=0,cur.pvPhotoTagShown){cur.pvsaOffset=e;var o=ge("pvsa_content_photos"),r=ge("ui_pv_photos_load_more");o&&(o.appendChild(cf(t)),Photoview.onResize(),e>=cur.pvsaCount||!t?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(r):(cur.pvsaLoading=1,ajax.post("al_photos.php",extend({offset:cur.pvsaOffset,part:1,mid:cur.pvPhotoTagShown},{act:"show_tag"}),{onDone(){debugLog("preload done: ",cur.pvsaLoading),2==cur.pvsaLoading?Photoview.loadedTaggedPhotos.apply(window,arguments):cur.pvsaLoading=!1},onFail:()=>(cur.pvsaLoading=0,!0)})))}},loadTaggedPhotos(){var e=ge("ui_pv_photos_load_more"),t=cur.pvsaOffset;cur.pvPhotoTagShown&&e&&isVisible(e)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(e)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_tag",mid:cur.pvPhotoTagShown,offset:t,part:1},{onDone:Photoview.loadedTaggedPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(e)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(e)},cache:1}))},thumbOver(e,t){clearTimeout((cur.pvHideTO||{})[t]);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pva_title",e),r=o.previousSibling,a=getSize(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pva_desc",e))[1];a<5||(animate(o,{marginTop:146-(a+7)},{duration:200,transition:Fx.Transitions.easeOutCirc}),"pva_repeat"==r.className&&animate(r,{marginTop:43-Math.floor((a+7)/2)},{duration:200,transition:Fx.Transitions.easeOutCirc}))},thumbOut(e,t){cur.pvHideTO||(cur.pvHideTO={}),cur.pvHideTO[t]=setTimeout(()=>{var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pva_title",e),o=t.previousSibling;animate(t,{marginTop:146},200),"pva_repeat"==o.className&&animate(o,{marginTop:43},200)},150)},fsMove(e){if(!(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown)&&cur.pvCurPhoto.author){var t=getXY(cur.pvActions),o=getSize(cur.pvActions),r=Math.max(100,.2*cur.pvPhWidth);e.pageX>t[0]-r&&e.pageX<t[0]+o[0]+r&&e.pageY>t[1]-r&&e.pageY<t[1]+o[1]+r?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.addClass)(cur.pvActions,"visible"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.removeClass)(cur.pvActions,"visible")}},showRepeat(e){if(e&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pva_repeat",e)){var t=stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":""),o=getLang("photos_repeat_album");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pva_link",e).insertBefore(ce("div",{className:"pva_repeat",innerHTML:`\n        <div class="pva_repeat_blob">\n         <div class="pva_repeat_cont">\n         <img class="pva_repeat_img png" src="${t}.png?3" />\n         <span class="pva_repeat_text">${o}</span></div>\n        </div>`}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.geByClass1)("pva_title",e))}},showPlace(){var e=cur.pvCurPhoto.geohash;showBox("al_places.php",{act:"show_photo_place",geohash:e,photo:cur.pvCurPhoto.id},{cache:1})},editPlace(){var e=cur.pvCurPhoto.geohash;showBox("al_places.php",{act:"show_photo_place",edit:1,geohash:e||"",photo:cur.pvCurPhoto.id})},updatePlace(e,t){var o=ge("pv_edit_place");t?(o&&(o.innerHTML=t?t+".":""),ge("pv_place").innerHTML=t?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+t+"</a>":"",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)("pv_add_place")):setTimeout(()=>{ajax.post("al_photos.php",{act:"get_photo_place",photo:e},{onDone:t=>{Photoview.updatePlace(e,t)}})},1e3)},reportComment(e,t,o){stManager.add([jsc("web/privacy.js"),"privacy.css"],()=>Privacy.show(e,t,"report_"+o))},selectProductInBox:function(){var e=cur.pvData[cur.pvListId][cur.pvIndex].attached_tags,t=(e.tags?e.tags.length:0)>=e.max_tags_per_object;if(e.tags&&t)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)(getLang("global_error"),getLang("market_attach_products_overflow",e.max_tags_per_object)),!1;Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.showAttachProductBox)(event,Photoview.attachProduct)},attachProduct:function(e){curBox().hide(),Photoview.toggleTopInfoPanel(`<span class="attach_market_title">${getLang("market_product_attach_photo")} "${e.title}</span>`,`<button id="attach_market_cancel" class="flat_button secondary_dark black">${getLang("groups_cancel2")}</button>\n      <button id="attach_market_save" class="flat_button" disabled>${getLang("Save")}</button>`);var t=()=>{Photoview.toggleTopInfoPanel();var e=cur.pvAttachedProducts;e.point&&e.point.remove(),cur.pvAttachedProducts.isProcess=!1};cur.pvAttachedProducts.isProcess=!0,document.getElementById("attach_market_cancel").addEventListener("click",t),document.getElementById("attach_market_save").addEventListener("click",(function(){t();var o,r=cur.pvAttachedProducts;if(Object.assign(e,r.tempTag),!r.tempTag)return!1;if(document.getElementById("MarketList")){var a=_slicedToArray(Photoview.generateMarketListItem(e),2),i=a[0],_=a[1];o=i,document.getElementById("MarketList").appendChild(i),cur.pvImageAreaWrap.appendChild(_)}else{var s=_slicedToArray(Photoview.generateMarketList([e],!0),3),c=s[0],n=s[1],p=s[2];o=p,cur.pvImageAreaWrap.appendChild(n),document.getElementById("pv_attached_products_list").appendChild(c)}var l=cur.pvData[cur.pvListId][cur.pvIndex],d="link"===e.type?e.url:e.url.match(/product-?\d+_\d+/)[0],u=_slicedToArray(l.id.split("_"),2),v=u[0],h=u[1];e.x=r.tempTag.x,e.y=r.tempTag.y,ajax.post("al_market.php",{act:"add_tag_content_product",owner_id:v,item_id:h,type:"photo",hash:l.attached_tags.hash,tag_object:d,x:r.tempTag.x,y:r.tempTag.y},{onDone:t=>{o.id=t,l.attached_tags.tags=l.attached_tags.tags||[],e.tag_id=t,l.attached_tags.tags.push(e)}})}))},attachProductPoint:function(e){var t=document.getElementById("pv_product_point");t||((t=document.createElement("div")).classList.add("attach_market_point"),t.id="pv_product_point");var o=cur.pvImageAreaWrap,r=cur.pvAttachedProducts;r.tempTag=r.tempTag||{},document.getElementById("attach_market_save").removeAttribute("disabled");var a=e.currentTarget.getBoundingClientRect(),i=cur.pvAttachedProducts.photoSize,_=e.clientX-a.left-(a.width-i.width)/2,s=e.clientY-a.top-(a.height-i.height)/2;_>0&&s>0&&_<i.width&&s<i.height&&(document.getElementById("pv_product_point")||o.appendChild(t),r.tempTag.y=(e.clientY-a.top-i.top)/i.height,r.tempTag.x=(e.clientX-a.left-(a.width-i.width)/2)/i.width,t.style.top=e.clientY-a.top+"px",t.style.left=e.clientX-a.left+"px"),r.point=t},generateMarketList:function(e){var t=document.createElement("span");t.innerHTML=getLang("photos_attached_goods"),t.classList.add("pv_photo_product_attach_label");var o,r=document.createElement("ul");r.id="MarketList",r.classList.add("AttachedProductsList");var a=document.createDocumentFragment(),i=document.createDocumentFragment();e&&e.forEach((function(t){var r=Photoview.generateMarketListItem(t);1===e.length&&(o=r[0]),a.appendChild(r[0]),i.appendChild(r[1])})),r.appendChild(a);var _=document.createElement("div");return _.appendChild(t),_.appendChild(r),[_,i,o]},generateMarketListItem:function(e){var t=document.createElement("li");t.id=e.tag_id,t.classList.add("AttachedProductsList__item");var o=document.createElement("a");o.href=e.url,o.setAttribute("target","_blank");var r=t=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(event)||(layerQueue.push(),cancelEvent(t),showWiki({w:e.url.match(/product-?\d+_\d+/)[0]},!1,event))};"link"!==e.type&&o.addEventListener("click",r),o.classList.add("AttachedProductsList__content");var a=document.createElement("div");a.classList.add("AttachedProductsList__img"),a.style.backgroundImage="url("+(e.thumb||"/images/market/attach_product_list_placeholder.png")+")",o.appendChild(a);var i=document.createElement("span");i.classList.add("AttachedProductsList__title"),i.innerHTML=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.unclean)(e.title)),o.appendChild(i);var _=document.createElement("span");_.classList.add("AttachedProductsList__price"),_.innerHTML=e.price,o.appendChild(_),t.appendChild(o);var s=cur.pvData[cur.pvListId][cur.pvIndex],c=document.createElement("button");s.attached_tags&&s.attached_tags.hash&&(c.classList.add("AttachedProductsList__cross"),t.appendChild(c));var n=document.createElement("a");n.href=e.url,n.setAttribute("target","_blank"),"link"!==e.type&&n.addEventListener("click",r),n.classList.add("pv_attach_product_badge"),n.innerHTML=`<span class="pv_attach_product_badge_title">${Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.unclean)(e.title))}</span>\n      <span class="pv_attach_product_badge_price">${e.price}</span>`;var p=cur.pvImageAreaWrap.getBoundingClientRect(),l=cur.pvAttachedProducts.photoSize;n.style.top=`calc(${Math.floor(e.y*l.height)}px + ${(p.height-l.height)/2}px)`,n.style.left=`calc(${Math.floor(e.x*l.width)}px + ${(p.width-l.width)/2}px)`,n.style.opacity="1";var d=_slicedToArray(s.id.split("_"),2),u=d[0],v=d[1];return s.attached_tags&&s.attached_tags.hash&&c.addEventListener("click",e=>{ajax.post("al_market.php",{act:"delete_tag_content_product",owner_id:u,item_id:v,type:"photo",access_key:cur.pvCurPhoto.hash,hash:s.attached_tags.hash,tag_id:e.target.parentElement.id});var t=cur.pvData[cur.pvListId][cur.pvIndex];return t.attached_tags.tags=t.attached_tags.tags.filter(t=>t.tag_id!=e.target.parentElement.id),n.remove(),document.getElementById("MarketList").childElementCount>1?e.target.parentElement.outerHTML="":document.getElementById("pv_attached_products_list").innerHTML="",cancelEvent(e)}),c.addEventListener("mouseover",e=>{Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__.showTooltip)(e.target,{text:getLang("photos_pv_act_delete"),black:1,center:!0,shift:[0,3]})}),t.addEventListener("mouseover",(function(){n.style.opacity="1"})),t.addEventListener("mouseout",(function(e){if(t.contains(e.relatedTarget))return!1;n.style.opacity="0"})),cur.pvImageAreaWrap.addEventListener("mouseover",(function(){cur.pvEditorMode||(n.style.opacity="1")})),cur.pvImageAreaWrap.addEventListener("mouseout",(function(e){if(cur.pvImageAreaWrap&&cur.pvImageAreaWrap.contains(e.relatedTarget))return!1;n.style.opacity="0"})),cur.pvAttachedProducts.badges=cur.pvAttachedProducts.badges||[],cur.pvAttachedProducts.badges.push(n),[t,n]}}},zmTt:function(e,t,o){"use strict";o.r(t);o("a1Th"),o("Btvt");var r=o("zxIV"),a=o("Egk5"),i=o("lXE5"),_={init:function(e,t){cur.lSTL&&Object(r.re)(cur.lSTL);var o=(t=t||{}).parent=t.parent||boxLayerWrap;extend(cur,{lSTLWrap:o,lSTL:o.appendChild(ce("div",{id:"layer_stl",innerHTML:`<div id="layer_stl_bg" class="fixed"></div><div id="layer_stl_cl"></div><nobr id="layer_stl_text" class="fixed">${getLang("global_to_top")}</nobr>`,el:e.bodyNode,onclick:a.cancelEvent,onmousedown:_.lSTLDown,sc:_.onScroll})),lSTLText:ge("layer_stl_text",o),lSTLShown:0,lSTLWas:0,lSTLWasSet:0,lSTLOpts:t}),e&&e.setOptions({onShow:_.show,onHide:_.hide}),e&&e.scrollInited||(addEvent(o,"scroll",_.onScroll),e&&(e.scrollInited=!0)),onBodyResize(),_.onScroll()},hide:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=cur.lSTLOpts;e&&e.parent&&(removeEvent(e.parent,"scroll",_.onScroll),hide(cur.lSTL),cur.lSTLShown=0,e.onHide&&e.onHide())})),show:function(){var e=cur.lSTLOpts;e&&e.parent&&(addEvent(e.parent,"scroll",_.onScroll),setTimeout(_.onScroll,0),e.onShow&&e.onShow())},lSTLDown:function(e){if(e=e||window.event,!Object(a.checkEvent)(e)){var t=cur.lSTLWrap;if(!__afterFocus){var o=0,r=t.scrollTop;cur.lSTLWasSet&&cur.lSTLWas?(o=cur.lSTLWas,cur.lSTLWas=0):cur.lSTLWas=r,t.scrollTop=o}return Object(a.cancelEvent)(e)}},onScroll:function(){if(cur.lSTL){var e=cur.lSTLWrap.scrollTop,t=cur.lSTLWas||e>200,o=0;if(cur.lSTL.style.marginTop=Math.min(e,boxLayer.scrollHeight-cur.lSTL.scrollHeight-1)+"px",vk.staticheader){var a=Object(r.getSize)("page_header_wrap")[1];cur.lSTLText.style.marginTop=Math.max(-Math.min(Object(i.scrollGetY)(),bodyNode.clientHeight-(window.lastWindowHeight||0)),-a)+"px"}t?(1!==cur.lSTLShown&&(Object(r.show)(cur.lSTL),cur.lSTLShown=1),cur.lSTLWas&&e>500&&(cur.lSTLWas=0),e>200?(o=(e-200)/200,cur.lSTLWasSet&&(cur.lSTLWasSet=0,val(Object(r.domLC)(cur.lSTL),getLang("global_to_top")),removeClass(Object(r.domLC)(cur.lSTL),"down"))):(o=(200-e)/200,cur.lSTLWas&&(cur.lSTLWasSet||(cur.lSTLWasSet=1,val(Object(r.domLC)(cur.lSTL),""),addClass(Object(r.domLC)(cur.lSTL),"down"))))):0!==cur.lSTLShown&&(hide(cur.lSTL),cur.lSTLShown=0),setStyle(cur.lSTL,{opacity:Math.min(Math.max(o,0),1)})}}};t.default=_}});